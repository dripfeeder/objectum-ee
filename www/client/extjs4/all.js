var _Mathfloor=Math.floor,_Stringprototype=String.prototype,_StringfromCharCode=String.fromCharCode;(function(){function ea(Aa){var Va=!1;return function(){if(Va)throw new Error('Callback was already called.');Va=!0,Aa.apply(ia,arguments)}}var aa={},ia,la;ia=this,null!=ia&&(la=ia.async),aa.noConflict=function(){return ia.async=la,aa};var ra=function(Aa,Va){if(Aa.forEach)return Aa.forEach(Va);for(var ja=0;ja<Aa.length;ja+=1)Va(Aa[ja],ja,Aa)},na=function(Aa,Va){if(Aa.map)return Aa.map(Va);var ja=[];return ra(Aa,function(Ia,ka,Ea){ja.push(Va(Ia,ka,Ea))}),ja},oa=function(Aa,Va,ja){return Aa.reduce?Aa.reduce(Va,ja):(ra(Aa,function(Ia,ka,Ea){ja=Va(ja,Ia,ka,Ea)}),ja)},da=function(Aa){if(Object.keys)return Object.keys(Aa);var Va=[];for(var ja in Aa)Aa.hasOwnProperty(ja)&&Va.push(ja);return Va};'undefined'!=typeof process&&process.nextTick?(aa.nextTick=process.nextTick,aa.setImmediate='undefined'==typeof setImmediate?aa.nextTick:setImmediate):'function'==typeof setImmediate?(aa.setImmediate=setImmediate,aa.nextTick=setImmediate):(aa.setImmediate=aa.nextTick,aa.nextTick=function(Aa){setTimeout(Aa,0)}),aa.each=function(Aa,Va,ja){if(ja=ja||function(){},!Aa.length)return ja();var Ia=0;ra(Aa,function(ka){Va(ka,ea(function(Ea){Ea?(ja(Ea),ja=function(){}):(Ia+=1,Ia>=Aa.length&&ja(null))}))})},aa.forEach=aa.each,aa.eachSeries=function(Aa,Va,ja){if(ja=ja||function(){},!Aa.length)return ja();var Ia=0,ka=function(){Va(Aa[Ia],function(Ea){Ea?(ja(Ea),ja=function(){}):(Ia+=1,Ia>=Aa.length?ja(null):ka())})};ka()},aa.forEachSeries=aa.eachSeries,aa.eachLimit=function(Aa,Va,ja,Ia){var ka=ua(Va);ka.apply(null,[Aa,ja,Ia])},aa.forEachLimit=aa.eachLimit;var ua=function(Aa){return function(Va,ja,Ia){if(Ia=Ia||function(){},!Va.length||0>=Aa)return Ia();var ka=0,Ea=0,Ta=0;(function Ma(){if(ka>=Va.length)return Ia();for(;Ta<Aa&&Ea<Va.length;)Ea+=1,Ta+=1,ja(Va[Ea-1],function(Fa){Fa?(Ia(Fa),Ia=function(){}):(ka+=1,Ta-=1,ka>=Va.length?Ia():Ma())})})()}},ga=function(Aa){return function(){var Va=Array.prototype.slice.call(arguments);return Aa.apply(null,[aa.each].concat(Va))}},pa=function(Aa,Va){return function(){var ja=Array.prototype.slice.call(arguments);return Va.apply(null,[ua(Aa)].concat(ja))}},ma=function(Aa){return function(){var Va=Array.prototype.slice.call(arguments);return Aa.apply(null,[aa.eachSeries].concat(Va))}},fa=function(Aa,Va,ja,Ia){var ka=[];Va=na(Va,function(Ea,Ta){return{index:Ta,value:Ea}}),Aa(Va,function(Ea,Ta){ja(Ea.value,function(Ma,Fa){ka[Ea.index]=Fa,Ta(Ma)})},function(Ea){Ia(Ea,ka)})};aa.map=ga(fa),aa.mapSeries=ma(fa),aa.mapLimit=function(Aa,Va,ja,Ia){return ha(Va)(Aa,ja,Ia)};var ha=function(Aa){return pa(Aa,fa)};aa.reduce=function(Aa,Va,ja,Ia){aa.eachSeries(Aa,function(ka,Ea){ja(Va,ka,function(Ta,Ma){Va=Ma,Ea(Ta)})},function(ka){Ia(ka,Va)})},aa.inject=aa.reduce,aa.foldl=aa.reduce,aa.reduceRight=function(Aa,Va,ja,Ia){var ka=na(Aa,function(Ea){return Ea}).reverse();aa.reduce(ka,Va,ja,Ia)},aa.foldr=aa.reduceRight;var ba=function(Aa,Va,ja,Ia){var ka=[];Va=na(Va,function(Ea,Ta){return{index:Ta,value:Ea}}),Aa(Va,function(Ea,Ta){ja(Ea.value,function(Ma){Ma&&ka.push(Ea),Ta()})},function(){Ia(na(ka.sort(function(Ta,Ma){return Ta.index-Ma.index}),function(Ta){return Ta.value}))})};aa.filter=ga(ba),aa.filterSeries=ma(ba),aa.select=aa.filter,aa.selectSeries=aa.filterSeries;var ya=function(Aa,Va,ja,Ia){var ka=[];Va=na(Va,function(Ea,Ta){return{index:Ta,value:Ea}}),Aa(Va,function(Ea,Ta){ja(Ea.value,function(Ma){Ma||ka.push(Ea),Ta()})},function(){Ia(na(ka.sort(function(Ta,Ma){return Ta.index-Ma.index}),function(Ta){return Ta.value}))})};aa.reject=ga(ya),aa.rejectSeries=ma(ya);var wa=function(Aa,Va,ja,Ia){Aa(Va,function(ka,Ea){ja(ka,function(Ta){Ta?(Ia(ka),Ia=function(){}):Ea()})},function(){Ia()})};aa.detect=ga(wa),aa.detectSeries=ma(wa),aa.some=function(Aa,Va,ja){aa.each(Aa,function(Ia,ka){Va(Ia,function(Ea){Ea&&(ja(!0),ja=function(){}),ka()})},function(){ja(!1)})},aa.any=aa.some,aa.every=function(Aa,Va,ja){aa.each(Aa,function(Ia,ka){Va(Ia,function(Ea){Ea||(ja(!1),ja=function(){}),ka()})},function(){ja(!0)})},aa.all=aa.every,aa.sortBy=function(Aa,Va,ja){aa.map(Aa,function(Ia,ka){Va(Ia,function(Ea,Ta){Ea?ka(Ea):ka(null,{value:Ia,criteria:Ta})})},function(Ia,ka){if(Ia)return ja(Ia);ja(null,na(ka.sort(function(Ta,Ma){var Fa=Ta.criteria,La=Ma.criteria;return Fa<La?-1:Fa>La?1:0}),function(Ta){return Ta.value}))})},aa.auto=function(Aa,Va){Va=Va||function(){};var ja=da(Aa);if(!ja.length)return Va(null);var Ia={},ka=[],Ea=function(Fa){ka.unshift(Fa)},Ta=function(Fa){for(var La=0;La<ka.length;La+=1)if(ka[La]===Fa)return void ka.splice(La,1)},Ma=function(){ra(ka.slice(0),function(Fa){Fa()})};Ea(function(){da(Ia).length===ja.length&&(Va(null,Ia),Va=function(){})}),ra(ja,function(Fa){var La=Aa[Fa]instanceof Function?[Aa[Fa]]:Aa[Fa],Oa=function(Pa){var Da=Array.prototype.slice.call(arguments,1);if(1>=Da.length&&(Da=Da[0]),Pa){var qa={};ra(da(Ia),function(Wa){qa[Wa]=Ia[Wa]}),qa[Fa]=Da,Va(Pa,qa),Va=function(){}}else Ia[Fa]=Da,aa.setImmediate(Ma)},$a=La.slice(0,Math.abs(La.length-1))||[],Ra=function(){return oa($a,function(Pa,Da){return Pa&&Ia.hasOwnProperty(Da)},!0)&&!Ia.hasOwnProperty(Fa)};if(Ra())La[La.length-1](Oa,Ia);else{var Na=function(){Ra()&&(Ta(Na),La[La.length-1](Oa,Ia))};Ea(Na)}})},aa.waterfall=function(Aa,Va){if(Va=Va||function(){},Aa.constructor!==Array){var ja=new Error('First argument to waterfall must be an array of functions');return Va(ja)}if(!Aa.length)return Va();var Ia=function(ka){return function(Ea){if(Ea)Va.apply(null,arguments),Va=function(){};else{var Ta=Array.prototype.slice.call(arguments,1),Ma=ka.next();Ma?Ta.push(Ia(Ma)):Ta.push(Va),aa.setImmediate(function(){ka.apply(null,Ta)})}}};Ia(aa.iterator(Aa))()};var xa=function(Aa,Va,ja){if(ja=ja||function(){},Va.constructor===Array)Aa.map(Va,function(ka,Ea){ka&&ka(function(Ta){var Ma=Array.prototype.slice.call(arguments,1);1>=Ma.length&&(Ma=Ma[0]),Ea.call(null,Ta,Ma)})},ja);else{var Ia={};Aa.each(da(Va),function(ka,Ea){Va[ka](function(Ta){var Ma=Array.prototype.slice.call(arguments,1);1>=Ma.length&&(Ma=Ma[0]),Ia[ka]=Ma,Ea(Ta)})},function(ka){ja(ka,Ia)})}};aa.parallel=function(Aa,Va){xa({map:aa.map,each:aa.each},Aa,Va)},aa.parallelLimit=function(Aa,Va,ja){xa({map:ha(Va),each:ua(Va)},Aa,ja)},aa.series=function(Aa,Va){if(Va=Va||function(){},Aa.constructor===Array)aa.mapSeries(Aa,function(Ia,ka){Ia&&Ia(function(Ea){var Ta=Array.prototype.slice.call(arguments,1);1>=Ta.length&&(Ta=Ta[0]),ka.call(null,Ea,Ta)})},Va);else{var ja={};aa.eachSeries(da(Aa),function(Ia,ka){Aa[Ia](function(Ea){var Ta=Array.prototype.slice.call(arguments,1);1>=Ta.length&&(Ta=Ta[0]),ja[Ia]=Ta,ka(Ea)})},function(Ia){Va(Ia,ja)})}},aa.iterator=function(Aa){var Va=function(ja){var Ia=function(){return Aa.length&&Aa[ja].apply(null,arguments),Ia.next()};return Ia.next=function(){return ja<Aa.length-1?Va(ja+1):null},Ia};return Va(0)},aa.apply=function(Aa){var Va=Array.prototype.slice.call(arguments,1);return function(){return Aa.apply(null,Va.concat(Array.prototype.slice.call(arguments)))}};var Ca=function(Aa,Va,ja,Ia){var ka=[];Aa(Va,function(Ea,Ta){ja(Ea,function(Ma,Fa){ka=ka.concat(Fa||[]),Ta(Ma)})},function(Ea){Ia(Ea,ka)})};aa.concat=ga(Ca),aa.concatSeries=ma(Ca),aa.whilst=function(Aa,Va,ja){Aa()?Va(function(Ia){return Ia?ja(Ia):void aa.whilst(Aa,Va,ja)}):ja()},aa.doWhilst=function(Aa,Va,ja){Aa(function(Ia){return Ia?ja(Ia):void(Va()?aa.doWhilst(Aa,Va,ja):ja())})},aa.until=function(Aa,Va,ja){Aa()?ja():Va(function(Ia){return Ia?ja(Ia):void aa.until(Aa,Va,ja)})},aa.doUntil=function(Aa,Va,ja){Aa(function(Ia){return Ia?ja(Ia):void(Va()?ja():aa.doUntil(Aa,Va,ja))})},aa.queue=function(Aa,Va){function ja(Ea,Ta,Ma,Fa){Ta.constructor!==Array&&(Ta=[Ta]),ra(Ta,function(La){var Oa={data:La,callback:'function'==typeof Fa?Fa:null};Ma?Ea.tasks.unshift(Oa):Ea.tasks.push(Oa),Ea.saturated&&Ea.tasks.length===Va&&Ea.saturated(),aa.setImmediate(Ea.process)})}Va===void 0&&(Va=1);var Ia=0,ka={tasks:[],concurrency:Va,saturated:null,empty:null,drain:null,push:function(Ea,Ta){ja(ka,Ea,!1,Ta)},unshift:function(Ea,Ta){ja(ka,Ea,!0,Ta)},process:function(){if(Ia<ka.concurrency&&ka.tasks.length){var Ea=ka.tasks.shift();ka.empty&&0===ka.tasks.length&&ka.empty(),Ia+=1;var Ta=function(){Ia-=1,Ea.callback&&Ea.callback.apply(Ea,arguments),ka.drain&&0===ka.tasks.length+Ia&&ka.drain(),ka.process()},Ma=ea(Ta);Aa(Ea.data,Ma)}},length:function(){return ka.tasks.length},running:function(){return Ia}};return ka},aa.cargo=function(Aa,Va){var ja=!1,Ia=[],ka={tasks:Ia,payload:Va,saturated:null,empty:null,drain:null,push:function(Ea,Ta){Ea.constructor!==Array&&(Ea=[Ea]),ra(Ea,function(Ma){Ia.push({data:Ma,callback:'function'==typeof Ta?Ta:null}),ka.saturated&&Ia.length===Va&&ka.saturated()}),aa.setImmediate(ka.process)},process:function Ea(){if(!ja){if(0===Ia.length)return void(ka.drain&&ka.drain());var Ta='number'==typeof Va?Ia.splice(0,Va):Ia.splice(0),Ma=na(Ta,function(Fa){return Fa.data});ka.empty&&ka.empty(),ja=!0,Aa(Ma,function(){ja=!1;var Fa=arguments;ra(Ta,function(La){La.callback&&La.callback.apply(null,Fa)}),Ea()})}},length:function(){return Ia.length},running:function(){return ja}};return ka};var Sa=function(Aa){return function(Va){var ja=Array.prototype.slice.call(arguments,1);Va.apply(null,ja.concat([function(Ia){var ka=Array.prototype.slice.call(arguments,1);'undefined'!=typeof console&&(Ia?console.error&&console.error(Ia):console[Aa]&&ra(ka,function(Ea){console[Aa](Ea)}))}]))}};aa.log=Sa('log'),aa.dir=Sa('dir'),aa.memoize=function(Aa,Va){var ja={},Ia={};Va=Va||function(Ea){return Ea};var ka=function(){var Ea=Array.prototype.slice.call(arguments),Ta=Ea.pop(),Ma=Va.apply(null,Ea);Ma in ja?Ta.apply(null,ja[Ma]):Ma in Ia?Ia[Ma].push(Ta):(Ia[Ma]=[Ta],Aa.apply(null,Ea.concat([function(){ja[Ma]=arguments;var Fa=Ia[Ma];delete Ia[Ma];for(var La=0,Oa=Fa.length;La<Oa;La++)Fa[La].apply(null,arguments)}])))};return ka.memo=ja,ka.unmemoized=Aa,ka},aa.unmemoize=function(Aa){return function(){return(Aa.unmemoized||Aa).apply(null,arguments)}},aa.times=function(Aa,Va,ja){for(var Ia=[],ka=0;ka<Aa;ka++)Ia.push(ka);return aa.map(Ia,Va,ja)},aa.timesSeries=function(Aa,Va,ja){for(var Ia=[],ka=0;ka<Aa;ka++)Ia.push(ka);return aa.mapSeries(Ia,Va,ja)},aa.compose=function(){var Aa=Array.prototype.reverse.call(arguments);return function(){var Va=this,ja=Array.prototype.slice.call(arguments),Ia=ja.pop();aa.reduce(Aa,ja,function(ka,Ea,Ta){Ea.apply(Va,ka.concat([function(){var Ma=arguments[0],Fa=Array.prototype.slice.call(arguments,1);Ta(Ma,Fa)}]))},function(ka,Ea){Ia.apply(Va,[ka].concat(Ea))})}};var _a=function(Aa,Va){var ja=function(){var ka=this,Ea=Array.prototype.slice.call(arguments),Ta=Ea.pop();return Aa(Va,function(Ma,Fa){Ma.apply(ka,Ea.concat([Fa]))},Ta)};if(2<arguments.length){var Ia=Array.prototype.slice.call(arguments,2);return ja.apply(this,Ia)}return ja};aa.applyEach=ga(_a),aa.applyEachSeries=ma(_a),aa.forever=function(Aa,Va){function ja(Ia){if(Ia){if(Va)return Va(Ia);throw Ia}Aa(ja)}ja()},'undefined'!=typeof define&&define.amd?define([],function(){return aa}):'undefined'!=typeof module&&module.exports?module.exports=aa:ia.async=aa})();var hexcase=1,b64pad='',chrsz=8;function hex_sha1(ea){return binb2hex(core_sha1(str2binb(ea),ea.length*chrsz))}function b64_sha1(ea){return binb2b64(core_sha1(str2binb(ea),ea.length*chrsz))}function str_sha1(ea){return binb2str(core_sha1(str2binb(ea),ea.length*chrsz))}function hex_hmac_sha1(ea,aa){return binb2hex(core_hmac_sha1(ea,aa))}function b64_hmac_sha1(ea,aa){return binb2b64(core_hmac_sha1(ea,aa))}function str_hmac_sha1(ea,aa){return binb2str(core_hmac_sha1(ea,aa))}function sha1_vm_test(){return'a9993e364706816aba3e25717850c26c9cd0d89d'==hex_sha1('abc')}function core_sha1(ea,aa){ea[aa>>5]|=128<<24-aa%32,ea[(aa+64>>9<<4)+15]=aa;for(var ia=Array(80),la=1732584193,ra=-271733879,na=-1732584194,oa=271733878,da=-1009589776,ua=0;ua<ea.length;ua+=16){for(var ga=la,pa=ra,ma=na,fa=oa,ha=da,ba=0;80>ba;ba++){ia[ba]=16>ba?ea[ua+ba]:rol(ia[ba-3]^ia[ba-8]^ia[ba-14]^ia[ba-16],1);var ya=safe_add(safe_add(rol(la,5),sha1_ft(ba,ra,na,oa)),safe_add(safe_add(da,ia[ba]),sha1_kt(ba)));da=oa,oa=na,na=rol(ra,30),ra=la,la=ya}la=safe_add(la,ga),ra=safe_add(ra,pa),na=safe_add(na,ma),oa=safe_add(oa,fa),da=safe_add(da,ha)}return[la,ra,na,oa,da]}function sha1_ft(ea,aa,ia,la){return 20>ea?aa&ia|~aa&la:40>ea?aa^ia^la:60>ea?aa&ia|aa&la|ia&la:aa^ia^la}function sha1_kt(ea){return 20>ea?1518500249:40>ea?1859775393:60>ea?-1894007588:-899497514}function core_hmac_sha1(ea,aa){var ia=str2binb(ea);16<ia.length&&(ia=core_sha1(ia,ea.length*chrsz));for(var la=Array(16),ra=Array(16),na=0;16>na;na++)la[na]=909522486^ia[na],ra[na]=1549556828^ia[na];var oa=core_sha1(la.concat(str2binb(aa)),512+aa.length*chrsz);return core_sha1(ra.concat(oa),672)}function safe_add(ea,aa){var ia=(65535&ea)+(65535&aa);return(ea>>16)+(aa>>16)+(ia>>16)<<16|65535&ia}function rol(ea,aa){return ea<<aa|ea>>>32-aa}function str2binb(ea){for(var aa=[],la=0;la<ea.length*chrsz;la+=chrsz)aa[la>>5]|=(ea.charCodeAt(la/chrsz)&(1<<chrsz)-1)<<32-chrsz-la%32;return aa}function binb2str(ea){for(var aa='',la=0;la<32*ea.length;la+=chrsz)aa+=_StringfromCharCode(ea[la>>5]>>>32-chrsz-la%32&(1<<chrsz)-1);return aa}function binb2hex(ea){for(var aa='0123456789ABCDEF',ia='',la=0;la<4*ea.length;la++)ia+=aa.charAt(15&ea[la>>2]>>8*(3-la%4)+4)+aa.charAt(15&ea[la>>2]>>8*(3-la%4));return ia}function binb2b64(ea){for(var ia='',la=0,ra;la<4*ea.length;la+=3){ra=(255&ea[la>>2]>>8*(3-la%4))<<16|(255&ea[la+1>>2]>>8*(3-(la+1)%4))<<8|255&ea[la+2>>2]>>8*(3-(la+2)%4);for(var na=0;4>na;na++)ia+=8*la+6*na>32*ea.length?b64pad:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.charAt(63&ra>>6*(3-na))}return ia}if(function(){function ea(hs,bs){return hs.set(bs[0],bs[1]),hs}function aa(hs,bs){return hs.add(bs),hs}function ia(hs,bs,ys){switch(ys.length){case 0:return hs.call(bs);case 1:return hs.call(bs,ys[0]);case 2:return hs.call(bs,ys[0],ys[1]);case 3:return hs.call(bs,ys[0],ys[1],ys[2]);}return hs.apply(bs,ys)}function la(hs,bs,ys,vs){for(var ws=-1,xs=null==hs?0:hs.length,Cs;++ws<xs;)Cs=hs[ws],bs(vs,Cs,ys(Cs),hs);return vs}function ra(hs,bs){for(var ys=-1,vs=null==hs?0:hs.length;++ys<vs&&!1!==bs(hs[ys],ys,hs););return hs}function na(hs,bs){for(var ys=null==hs?0:hs.length;ys--&&!1!==bs(hs[ys],ys,hs););return hs}function oa(hs,bs){for(var ys=-1,vs=null==hs?0:hs.length;++ys<vs;)if(!bs(hs[ys],ys,hs))return!1;return!0}function da(hs,bs){for(var ys=-1,vs=null==hs?0:hs.length,ws=0,xs=[],Cs;++ys<vs;)Cs=hs[ys],bs(Cs,ys,hs)&&(xs[ws++]=Cs);return xs}function ua(hs,bs){return null!=hs&&hs.length&&-1<xa(hs,bs,0)}function ga(hs,bs,ys){for(var vs=-1,ws=null==hs?0:hs.length;++vs<ws;)if(ys(bs,hs[vs]))return!0;return!1}function pa(hs,bs){for(var ys=-1,vs=null==hs?0:hs.length,ws=Array(vs);++ys<vs;)ws[ys]=bs(hs[ys],ys,hs);return ws}function ma(hs,bs){for(var ys=-1,vs=bs.length,ws=hs.length;++ys<vs;)hs[ws+ys]=bs[ys];return hs}function fa(hs,bs,ys,vs){var ws=-1,xs=null==hs?0:hs.length;for(vs&&xs&&(ys=hs[++ws]);++ws<xs;)ys=bs(ys,hs[ws],ws,hs);return ys}function ha(hs,bs,ys,vs){var ws=null==hs?0:hs.length;for(vs&&ws&&(ys=hs[--ws]);ws--;)ys=bs(ys,hs[ws],ws,hs);return ys}function ba(hs,bs){for(var ys=-1,vs=null==hs?0:hs.length;++ys<vs;)if(bs(hs[ys],ys,hs))return!0;return!1}function ya(hs,bs,ys){var vs;return ys(hs,function(ws,xs,Cs){if(bs(ws,xs,Cs))return vs=xs,!1}),vs}function wa(hs,bs,ys,vs){var ws=hs.length;for(ys+=vs?1:-1;vs?ys--:++ys<ws;)if(bs(hs[ys],ys,hs))return ys;return-1}function xa(hs,bs,ys){if(bs===bs)n:{--ys;for(var vs=hs.length;++ys<vs;)if(hs[ys]===bs){hs=ys;break n}hs=-1}else hs=wa(hs,Sa,ys);return hs}function Ca(hs,bs,ys,vs){--ys;for(var ws=hs.length;++ys<ws;)if(vs(hs[ys],bs))return ys;return-1}function Sa(hs){return hs!==hs}function _a(hs,bs){var ys=null==hs?0:hs.length;return ys?ka(hs,bs)/ys:Ga}function Aa(hs){return function(bs){return null==bs?Ua:bs[hs]}}function Va(hs){return function(bs){return null==hs?Ua:hs[bs]}}function ja(hs,bs,ys,vs,ws){return ws(hs,function(xs,Cs,Ss){ys=vs?(vs=!1,xs):bs(ys,xs,Cs,Ss)}),ys}function Ia(hs,bs){var ys=hs.length;for(hs.sort(bs);ys--;)hs[ys]=hs[ys].c;return hs}function ka(hs,bs){for(var vs=-1,ws=hs.length,ys,xs;++vs<ws;)xs=bs(hs[vs]),xs!==Ua&&(ys=ys===Ua?xs:ys+xs);return ys}function Ea(hs,bs){for(var ys=-1,vs=Array(hs);++ys<hs;)vs[ys]=bs(ys);return vs}function Ta(hs,bs){return pa(bs,function(ys){return[ys,hs[ys]]})}function Ma(hs){return function(bs){return hs(bs)}}function Fa(hs,bs){return pa(bs,function(ys){return hs[ys]})}function La(hs,bs){return hs.has(bs)}function Oa(hs,bs){for(var ys=-1,vs=hs.length;++ys<vs&&-1<xa(bs,hs[ys],0););return ys}function $a(hs,bs){for(var ys=hs.length;ys--&&-1<xa(bs,hs[ys],0););return ys}function Ra(hs){return'\\'+Bl[hs]}function Na(hs){var bs=-1,ys=Array(hs.size);return hs.forEach(function(vs,ws){ys[++bs]=[ws,vs]}),ys}function Pa(hs,bs){return function(ys){return hs(bs(ys))}}function Da(hs,bs){for(var ys=-1,vs=hs.length,ws=0,xs=[],Cs;++ys<vs;)Cs=hs[ys],Cs!==bs&&'__lodash_placeholder__'!==Cs||(hs[ys]='__lodash_placeholder__',xs[ws++]=ys);return xs}function qa(hs){var bs=-1,ys=Array(hs.size);return hs.forEach(function(vs){ys[++bs]=vs}),ys}function Wa(hs){var bs=-1,ys=Array(hs.size);return hs.forEach(function(vs){ys[++bs]=[vs,vs]}),ys}function za(hs){if(Nl.test(hs)){for(var bs=$l.lastIndex=0;$l.test(hs);)++bs;hs=bs}else hs=cs(hs);return hs}function Ba(hs){return Nl.test(hs)?hs.match($l)||[]:hs.split('')}var Ha=1/0,Ga=NaN,Qa=[['ary',128],['bind',1],['bindKey',2],['curry',8],['curryRight',16],['flip',512],['partial',32],['partialRight',64],['rearg',256]],Ja=/\b__p\+='';/g,Ya=/\b(__p\+=)''\+/g,Ka=/(__e\(.*?\)|\b__t\))\+'';/g,Xa=/&(?:amp|lt|gt|quot|#39);/g,Za=/[&<>"']/g,tl=RegExp(Xa.source),al=RegExp(Za.source),il=/<%-([\s\S]+?)%>/g,ll=/<%([\s\S]+?)%>/g,rl=/<%=([\s\S]+?)%>/g,nl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sl=/^\w*$/,ol=/^\./,dl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,cl=/[\\^$.*+?()[\]{}|]/g,ul=RegExp(cl.source),gl=/^\s+|\s+$/g,pl=/^\s+/,ml=/\s+$/,hl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,bl=/\{\n\/\* \[wrapped with (.+)\] \*/,yl=/,? & /,vl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,wl=/\\(\\)?/g,xl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Cl=/\w*$/,Sl=/^[-+]0x[0-9a-f]+$/i,_l=/^0b[01]+$/i,Al=/^\[object .+?Constructor\]$/,Vl=/^0o[0-7]+$/i,jl=/^(?:0|[1-9]\d*)$/,Il=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,kl=/($^)/,El=/['\n\r\u2028\u2029\\]/g,Ll=/['’]/g,Ol=/[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]/g,$l=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]?|[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,Rl=RegExp(['[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:[\'\u2019](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:[\'\u2019](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:[\'\u2019](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:[\'\u2019](?:D|LL|M|RE|S|T|VE))?|\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)|\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)|\\d+','(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])'+'[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*'].join('|'),'g'),Nl=/[\u200d\ud800-\udfff\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff\ufe0e\ufe0f]/,Pl=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Dl='Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout'.split(' '),ql={},Ua;ql['[object Float32Array]']=ql['[object Float64Array]']=ql['[object Int8Array]']=ql['[object Int16Array]']=ql['[object Int32Array]']=ql['[object Uint8Array]']=ql['[object Uint8ClampedArray]']=ql['[object Uint16Array]']=ql['[object Uint32Array]']=!0,ql['[object Arguments]']=ql['[object Array]']=ql['[object ArrayBuffer]']=ql['[object Boolean]']=ql['[object DataView]']=ql['[object Date]']=ql['[object Error]']=ql['[object Function]']=ql['[object Map]']=ql['[object Number]']=ql['[object Object]']=ql['[object RegExp]']=ql['[object Set]']=ql['[object String]']=ql['[object WeakMap]']=!1;var Wl={};Wl['[object Arguments]']=Wl['[object Array]']=Wl['[object ArrayBuffer]']=Wl['[object DataView]']=Wl['[object Boolean]']=Wl['[object Date]']=Wl['[object Float32Array]']=Wl['[object Float64Array]']=Wl['[object Int8Array]']=Wl['[object Int16Array]']=Wl['[object Int32Array]']=Wl['[object Map]']=Wl['[object Number]']=Wl['[object Object]']=Wl['[object RegExp]']=Wl['[object Set]']=Wl['[object String]']=Wl['[object Symbol]']=Wl['[object Uint8Array]']=Wl['[object Uint8ClampedArray]']=Wl['[object Uint16Array]']=Wl['[object Uint32Array]']=!0,Wl['[object Error]']=Wl['[object Function]']=Wl['[object WeakMap]']=!1;var Bl={'\\':'\\','\'':'\'','\n':'n','\r':'r','\u2028':'u2028','\u2029':'u2029'},Ul=parseFloat,Hl=parseInt,Gl='object'==typeof global&&global&&global.Object===Object&&global,Ql='object'==typeof self&&self&&self.Object===Object&&self,Jl=Gl||Ql||Function('return this')(),Yl='object'==typeof exports&&exports&&!exports.nodeType&&exports,Kl=Yl&&'object'==typeof module&&module&&!module.nodeType&&module,Xl=Kl&&Kl.exports===Yl,Zl=Xl&&Gl.process,zl;n:{try{zl=Zl&&Zl.binding&&Zl.binding('util');break n}catch(hs){}zl=void 0}var es=zl&&zl.isArrayBuffer,as=zl&&zl.isDate,is=zl&&zl.isMap,ls=zl&&zl.isRegExp,rs=zl&&zl.isSet,ns=zl&&zl.isTypedArray,cs=Aa('length'),us=Va({À:'A',Á:'A',Â:'A',Ã:'A',Ä:'A',Å:'A',à:'a',á:'a',â:'a',ã:'a',ä:'a',å:'a',Ç:'C',ç:'c',Ð:'D',ð:'d',È:'E',É:'E',Ê:'E',Ë:'E',è:'e',é:'e',ê:'e',ë:'e',Ì:'I',Í:'I',Î:'I',Ï:'I',ì:'i',í:'i',î:'i',ï:'i',Ñ:'N',ñ:'n',Ò:'O',Ó:'O',Ô:'O',Õ:'O',Ö:'O',Ø:'O',ò:'o',ó:'o',ô:'o',õ:'o',ö:'o',ø:'o',Ù:'U',Ú:'U',Û:'U',Ü:'U',ù:'u',ú:'u',û:'u',ü:'u',Ý:'Y',ý:'y',ÿ:'y',Æ:'Ae',æ:'ae',Þ:'Th',þ:'th',ß:'ss',Ā:'A',Ă:'A',Ą:'A',ā:'a',ă:'a',ą:'a',Ć:'C',Ĉ:'C',Ċ:'C',Č:'C',ć:'c',ĉ:'c',ċ:'c',č:'c',Ď:'D',Đ:'D',ď:'d',đ:'d',Ē:'E',Ĕ:'E',Ė:'E',Ę:'E',Ě:'E',ē:'e',ĕ:'e',ė:'e',ę:'e',ě:'e',Ĝ:'G',Ğ:'G',Ġ:'G',Ģ:'G',ĝ:'g',ğ:'g',ġ:'g',ģ:'g',Ĥ:'H',Ħ:'H',ĥ:'h',ħ:'h',Ĩ:'I',Ī:'I',Ĭ:'I',Į:'I',İ:'I',ĩ:'i',ī:'i',ĭ:'i',į:'i',ı:'i',Ĵ:'J',ĵ:'j',Ķ:'K',ķ:'k',ĸ:'k',Ĺ:'L',Ļ:'L',Ľ:'L',Ŀ:'L',Ł:'L',ĺ:'l',ļ:'l',ľ:'l',ŀ:'l',ł:'l',Ń:'N',Ņ:'N',Ň:'N',Ŋ:'N',ń:'n',ņ:'n',ň:'n',ŋ:'n',Ō:'O',Ŏ:'O',Ő:'O',ō:'o',ŏ:'o',ő:'o',Ŕ:'R',Ŗ:'R',Ř:'R',ŕ:'r',ŗ:'r',ř:'r',Ś:'S',Ŝ:'S',Ş:'S',Š:'S',ś:'s',ŝ:'s',ş:'s',š:'s',Ţ:'T',Ť:'T',Ŧ:'T',ţ:'t',ť:'t',ŧ:'t',Ũ:'U',Ū:'U',Ŭ:'U',Ů:'U',Ű:'U',Ų:'U',ũ:'u',ū:'u',ŭ:'u',ů:'u',ű:'u',ų:'u',Ŵ:'W',ŵ:'w',Ŷ:'Y',ŷ:'y',Ÿ:'Y',Ź:'Z',Ż:'Z',Ž:'Z',ź:'z',ż:'z',ž:'z',Ĳ:'IJ',ĳ:'ij',Œ:'Oe',œ:'oe',ŉ:'\'n',ſ:'s'}),gs=Va({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}),ps=Va({'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'"','&#39;':'\''}),ms=function hs(bs){function ys(iy){if(up(iy)&&!ib(iy)&&!(iy instanceof xs)){if(iy instanceof ws)return iy;if(em.call(iy,'__wrapped__'))return Mg(iy)}return new ws(iy)}function vs(){}function ws(iy,ly){this.__wrapped__=iy,this.__actions__=[],this.__chain__=!!ly,this.__index__=0,this.__values__=Ua}function xs(iy){this.__wrapped__=iy,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Cs(iy){var ly=-1,ry=null==iy?0:iy.length;for(this.clear();++ly<ry;){var ny=iy[ly];this.set(ny[0],ny[1])}}function Ss(iy){var ly=-1,ry=null==iy?0:iy.length;for(this.clear();++ly<ry;){var ny=iy[ly];this.set(ny[0],ny[1])}}function _s(iy){var ly=-1,ry=null==iy?0:iy.length;for(this.clear();++ly<ry;){var ny=iy[ly];this.set(ny[0],ny[1])}}function As(iy){var ly=-1,ry=null==iy?0:iy.length;for(this.__data__=new _s;++ly<ry;)this.add(iy[ly])}function Vs(iy){this.size=(this.__data__=new Ss(iy)).size}function js(iy,ly){var ny=ib(iy),sy=!ny&&ab(iy),oy=!ny&&!sy&&nb(iy),dy=!ny&&!sy&&!oy&&gb(iy),sy=(ny=ny||sy||oy||dy)?Ea(iy.length,Qp):[],cy=sy.length,ry;for(ry in iy)!ly&&!em.call(iy,ry)||ny&&('length'==ry||oy&&('offset'==ry||'parent'==ry)||dy&&('buffer'==ry||'byteLength'==ry||'byteOffset'==ry)||vg(ry,cy))||sy.push(ry);return sy}function Is(iy){var ly=iy.length;return ly?iy[qd(0,ly-1)]:Ua}function ks(iy,ly){return Ig(jc(iy),Ds(ly,0,iy.length))}function Es(iy){return Ig(jc(iy))}function Ts(iy,ly,ry){(ry===Ua||ap(iy[ly],ry))&&(ry!==Ua||ly in iy)||Ns(iy,ly,ry)}function Ms(iy,ly,ry){var ny=iy[ly];em.call(iy,ly)&&ap(ny,ry)&&(ry!==Ua||ly in iy)||Ns(iy,ly,ry)}function Fs(iy,ly){for(var ry=iy.length;ry--;)if(ap(iy[ry][0],ly))return ry;return-1}function Ls(iy,ly,ry,ny){return eh(iy,function(sy,oy,dy){ly(ny,sy,ry(sy),dy)}),ny}function Os(iy,ly){return iy&&Ic(ly,Vp(ly),iy)}function Rs(iy,ly){return iy&&Ic(ly,jp(ly),iy)}function Ns(iy,ly,ry){'__proto__'==ly&&wm?wm(iy,ly,{configurable:!0,enumerable:!0,value:ry,writable:!0}):iy[ly]=ry}function Ps(iy,ly){for(var ry=-1,ny=ly.length,sy=qp(ny);++ry<ny;)sy[ry]=null==iy?Ua:_p(iy,ly[ry]);return sy}function Ds(iy,ly,ry){return iy===iy&&(ry!==Ua&&(iy=iy<=ry?iy:ry),ly!==Ua&&(iy=iy>=ly?iy:ly)),iy}function Ws(iy,ly,ry,ny,sy,oy){var cy=1&ly,uy=2&ly,dy;if(ry&&(dy=sy?ry(iy,ny,sy,oy):ry(iy)),dy!==Ua)return dy;if(!cp(iy))return iy;if(!(ny=ib(iy))){var py=uh(iy),my='[object Function]'==py||'[object GeneratorFunction]'==py;if(nb(iy))return xc(iy,cy);if('[object Object]'!=py&&'[object Arguments]'!=py&&(!my||sy)){if(!Wl[py])return sy?iy:{};dy=bg(iy,py,Ws,cy)}else if(dy=uy||my?{}:hg(iy),!cy)return uy?Ec(iy,Rs(dy,iy)):kc(iy,Os(dy,iy))}else if(dy=fg(iy),!cy)return jc(iy,dy);if(oy||(oy=new Vs),sy=oy.get(iy))return sy;oy.set(iy,dy);var uy=4&ly?uy?sg:ng:uy?jp:Vp,fy=ny?Ua:uy(iy);return ra(fy||iy,function(hy,by){fy&&(by=hy,hy=iy[by]),Ms(dy,by,Ws(hy,ly,ry,by,iy,oy))}),dy}function zs(iy){var ly=Vp(iy);return function(ry){return Bs(ry,iy,ly)}}function Bs(iy,ly,ry){var ny=ry.length;if(null==iy)return!ny;for(iy=Hp(iy);ny--;){var sy=ry[ny],oy=ly[sy],dy=iy[sy];if(dy===Ua&&!(sy in iy)||!oy(dy))return!1}return!0}function Us(iy,ly,ry){if('function'!=typeof iy)throw new Jp('Expected a function');return mh(function(){iy.apply(Ua,ry)},ly)}function Hs(iy,ly,ry,ny){var sy=-1,oy=ua,dy=!0,cy=iy.length,uy=[],gy=ly.length;if(!cy)return uy;ry&&(ly=pa(ly,Ma(ry))),ny?(oy=ga,dy=!1):200<=ly.length&&(oy=La,dy=!1,ly=new As(ly));n:for(;++sy<cy;){var py=iy[sy],my=null==ry?py:ry(py),py=ny||0!==py?py:0;if(dy&&my===my){for(var fy=gy;fy--;)if(ly[fy]===my)continue n;uy.push(py)}else oy(ly,my,ny)||uy.push(py)}return uy}function Gs(iy,ly){var ry=!0;return eh(iy,function(ny,sy,oy){return ry=!!ly(ny,sy,oy)}),ry}function Qs(iy,ly,ry){for(var ny=-1,sy=iy.length;++ny<sy;){var oy=iy[ny],dy=ly(oy);if(null!=dy&&(cy===Ua?dy===dy&&!hp(dy):ry(dy,cy)))var cy=dy,uy=oy}return uy}function Js(iy,ly){var ry=[];return eh(iy,function(ny,sy,oy){ly(ny,sy,oy)&&ry.push(ny)}),ry}function Ys(iy,ly,ry,ny,sy){var oy=-1,dy=iy.length;for(ry||(ry=yg),sy||(sy=[]);++oy<dy;){var cy=iy[oy];0<ly&&ry(cy)?1<ly?Ys(cy,ly-1,ry,ny,sy):ma(sy,cy):ny||(sy[sy.length]=cy)}return sy}function Ks(iy,ly){return iy&&ah(iy,ly,Vp)}function Xs(iy,ly){return iy&&ih(iy,ly,Vp)}function Zs(iy,ly){return da(ly,function(ry){return np(iy[ry])})}function ad(iy,ly){ly=yc(ly,iy);for(var ry=0,ny=ly.length;null!=iy&&ry<ny;)iy=iy[kg(ly[ry++])];return ry&&ry==ny?iy:Ua}function ld(iy,ly,ry){return ly=ly(iy),ib(iy)?ly:ma(ly,ry(iy))}function nd(iy){if(null==iy)iy=iy===Ua?'[object Undefined]':'[object Null]';else if(vm&&vm in Hp(iy)){var ly=em.call(iy,vm),ry=iy[vm];try{iy[vm]=Ua}catch(oy){}var sy=im.call(iy);ly?iy[vm]=ry:delete iy[vm],iy=sy}else iy=im.call(iy);return iy}function sd(iy,ly){return iy>ly}function od(iy,ly){return null!=iy&&em.call(iy,ly)}function ud(iy,ly){return null!=iy&&ly in Hp(iy)}function gd(iy,ly,ry){for(var ny=ry?ga:ua,sy=iy[0].length,oy=iy.length,dy=oy,cy=qp(oy),uy=1/0,gy=[],py;dy--;)py=iy[dy],dy&&ly&&(py=pa(py,Ma(ly))),uy=Mm(py.length,uy),cy[dy]=!ry&&(ly||120<=sy&&120<=py.length)?new As(dy&&py):Ua;var py=iy[0],my=-1,fy=cy[0];n:for(;++my<sy&&gy.length<uy;){var hy=py[my],by=ly?ly(hy):hy,hy=ry||0!==hy?hy:0;if(fy?!La(fy,by):!ny(gy,by,ry)){for(dy=oy;--dy;){var vy=cy[dy];if(vy?!La(vy,by):!ny(iy[dy],by,ry))continue n}fy&&fy.push(by),gy.push(hy)}}return gy}function pd(iy,ly,ry){var ny={};return Ks(iy,function(sy,oy,dy){ly(ny,ry(sy),oy,dy)}),ny}function md(iy,ly,ry){return ly=yc(ly,iy),iy=2>ly.length?iy:ad(iy,Qd(ly,0,-1)),ly=null==iy?iy:iy[kg(Rg(ly))],null==ly?Ua:ia(ly,iy,ry)}function hd(iy){return up(iy)&&'[object Arguments]'==nd(iy)}function vd(iy,ly,ry,ny,sy){if(iy===ly)ly=!0;else if(null==iy||null==ly||!up(iy)&&!up(ly))ly=iy!==iy&&ly!==ly;else n:{var oy=ib(iy),dy=ib(ly),cy=oy?'[object Array]':uh(iy),uy=dy?'[object Array]':uh(ly),cy='[object Arguments]'==cy?'[object Object]':cy,uy='[object Arguments]'==uy?'[object Object]':uy,gy='[object Object]'==cy,dy='[object Object]'==uy;if((uy=cy==uy)&&nb(iy)){if(!nb(ly)){ly=!1;break n}oy=!0,gy=!1}if(uy&&!gy)sy||(sy=new Vs),ly=oy||gb(iy)?ig(iy,ly,ry,ny,vd,sy):lg(iy,ly,cy,ry,ny,vd,sy);else{if(!(1&ry)&&(oy=gy&&em.call(iy,'__wrapped__'),cy=dy&&em.call(ly,'__wrapped__'),oy||cy)){iy=oy?iy.value():iy,ly=cy?ly.value():ly,sy||(sy=new Vs),ly=vd(iy,ly,ry,ny,sy);break n}if(uy){t:if(sy||(sy=new Vs),oy=1&ry,cy=ng(iy),dy=cy.length,uy=ng(ly).length,dy==uy||oy){for(gy=dy;gy--;){var py=cy[gy];if(oy?!(py in ly):!em.call(ly,py)){ly=!1;break t}}if((uy=sy.get(iy))&&sy.get(ly))ly=uy==ly;else{uy=!0,sy.set(iy,ly),sy.set(ly,iy);for(var my=oy;++gy<dy;){var py=cy[gy],fy=iy[py],hy=ly[py];if(ny)var by=oy?ny(hy,fy,py,ly,iy,sy):ny(fy,hy,py,iy,ly,sy);if(by===Ua?fy!==hy&&!vd(fy,hy,ry,ny,sy):!by){uy=!1;break}my||(my='constructor'==py)}uy&&!my&&(ry=iy.constructor,ny=ly.constructor,ry!=ny&&'constructor'in iy&&'constructor'in ly&&!('function'==typeof ry&&ry instanceof ry&&'function'==typeof ny&&ny instanceof ny)&&(uy=!1)),sy.delete(iy),sy.delete(ly),ly=uy}}else ly=!1;}else ly=!1}}return ly}function xd(iy,ly,ry,ny){var sy=ry.length,oy=sy,dy=!ny;if(null==iy)return!oy;for(iy=Hp(iy);sy--;){var cy=ry[sy];if(dy&&cy[2]?cy[1]!==iy[cy[0]]:!(cy[0]in iy))return!1}for(;++sy<oy;){var cy=ry[sy],uy=cy[0],gy=iy[uy],py=cy[1];if(!(dy&&cy[2])){if(cy=new Vs,ny)var my=ny(gy,py,uy,iy,ly,cy);if(my===Ua?!vd(py,gy,3,ny,cy):!my)return!1}else if(gy===Ua&&!(uy in iy))return!1}return!0}function Cd(iy){return!(!cp(iy)||am&&am in iy)&&(np(iy)?nm:Al).test(Eg(iy))}function Vd(iy){return'function'==typeof iy?iy:null==iy?Lp:'object'==typeof iy?ib(iy)?Md(iy[0],iy[1]):Td(iy):Np(iy)}function Id(iy){if(!Sg(iy))return Em(iy);var ry=[],ly;for(ly in Hp(iy))em.call(iy,ly)&&'constructor'!=ly&&ry.push(ly);return ry}function kd(iy,ly){return iy<ly}function Ed(iy,ly){var ry=-1,ny=ip(iy)?qp(iy.length):[];return eh(iy,function(sy,oy,dy){ny[++ry]=ly(sy,oy,dy)}),ny}function Td(iy){var ly=gg(iy);return 1==ly.length&&ly[0][2]?_g(ly[0][0],ly[0][1]):function(ry){return ry===iy||xd(ry,iy,ly)}}function Md(iy,ly){return xg(iy)&&ly===ly&&!cp(ly)?_g(kg(iy),ly):function(ry){var ny=_p(ry,iy);return ny===Ua&&ny===ly?Ap(ry,iy):vd(ly,ny,3)}}function Fd(iy,ly,ry,ny,sy){iy!==ly&&ah(ly,function(oy,dy){if(cp(oy)){sy||(sy=new Vs);var cy=sy,uy=iy[dy],gy=ly[dy],py=cy.get(gy);if(py)Ts(iy,dy,py);else{var py=ny?ny(uy,gy,dy+'',iy,ly,cy):Ua,my=py===Ua;if(my){var fy=ib(gy),hy=!fy&&nb(gy),by=!fy&&!hy&&gb(gy),py=gy;fy||hy||by?ib(uy)?py=uy:lp(uy)?py=jc(uy):hy?(my=!1,py=xc(gy,!0)):by?(my=!1,py=Sc(gy,!0)):py=[]:pp(gy)||ab(gy)?(py=uy,ab(uy)?py=Cp(uy):(!cp(uy)||ry&&np(uy))&&(py=hg(gy))):my=!1}my&&(cy.set(gy,py),Fd(py,gy,ry,ny,cy),cy.delete(gy)),Ts(iy,dy,py)}}else cy=ny?ny(iy[dy],oy,dy+'',iy,ly,sy):Ua,cy===Ua&&(cy=oy),Ts(iy,dy,cy)},jp)}function Ld(iy,ly){var ry=iy.length;if(ry)return ly+=0>ly?ry:0,vg(ly,ry)?iy[ly]:Ua}function Od(iy,ly,ry){var ny=-1;return ly=pa(ly.length?ly:[Lp],Ma(cg())),iy=Ed(iy,function(sy){return{a:pa(ly,function(oy){return oy(sy)}),b:++ny,c:sy}}),Ia(iy,function(sy,oy){var dy;n:{dy=-1;for(var cy=sy.a,uy=oy.a,gy=cy.length,py=ry.length,my;++dy<gy;)if(my=_c(cy[dy],uy[dy]),my){dy=dy>=py?my:my*('desc'==ry[dy]?-1:1);break n}dy=sy.b-oy.b}return dy})}function $d(iy,ly){return Rd(iy,ly,function(ry,ny){return Ap(iy,ny)})}function Rd(iy,ly,ry){for(var ny=-1,sy=ly.length,oy={};++ny<sy;){var dy=ly[ny],cy=ad(iy,dy);ry(cy,dy)&&Hd(oy,yc(dy,iy),cy)}return oy}function Nd(iy){return function(ly){return ad(ly,iy)}}function Pd(iy,ly,ry,ny){var sy=ny?Ca:xa,oy=-1,dy=ly.length,cy=iy;for(iy===ly&&(ly=jc(ly)),ry&&(cy=pa(iy,Ma(ry)));++oy<dy;)for(var uy=0,gy=ly[oy],gy=ry?ry(gy):gy;-1<(uy=sy(cy,gy,uy,ny));)cy!==iy&&hm.call(cy,uy,1),hm.call(iy,uy,1);return iy}function Dd(iy,ly){for(var ry=iy?ly.length:0,ny=ry-1,sy;ry--;)if(sy=ly[ry],ry==ny||sy!==oy){var oy=sy;vg(sy)?hm.call(iy,sy,1):dc(iy,sy)}}function qd(iy,ly){return iy+Am(Om()*(ly-iy+1))}function Wd(iy,ly){var ry='';if(!iy||1>ly||9007199254740991<ly)return ry;do ly%2&&(ry+=iy),(ly=Am(ly/2))&&(iy+=iy);while(ly);return ry}function zd(iy,ly){return fh(Ag(iy,ly,Lp),iy+'')}function Bd(iy){return Is(kp(iy))}function Ud(iy,ly){var ry=kp(iy);return Ig(ry,Ds(ly,0,ry.length))}function Hd(iy,ly,ry,ny){if(!cp(iy))return iy;ly=yc(ly,iy);for(var sy=-1,oy=ly.length,cy=iy;null!=cy&&++sy<oy;){var uy=kg(ly[sy]),gy=ry;if(sy!=oy-1){var py=cy[uy],gy=ny?ny(py,uy,cy):Ua;gy===Ua&&(gy=cp(py)?py:vg(ly[sy+1])?[]:{})}Ms(cy,uy,gy),cy=cy[uy]}return iy}function Gd(iy){return Ig(kp(iy))}function Qd(iy,ly,ry){var ny=-1,sy=iy.length;for(0>ly&&(ly=-ly>sy?0:sy+ly),ry=ry>sy?sy:ry,0>ry&&(ry+=sy),sy=ly>ry?0:ry-ly>>>0,ly>>>=0,ry=qp(sy);++ny<sy;)ry[ny]=iy[ny+ly];return ry}function Jd(iy,ly){var ry;return eh(iy,function(ny,sy,oy){return ry=ly(ny,sy,oy),!ry}),!!ry}function Yd(iy,ly,ry){var ny=0,sy=null==iy?ny:iy.length;if('number'==typeof ly&&ly===ly&&2147483647>=sy){for(;ny<sy;){var oy=ny+sy>>>1,dy=iy[oy];null!==dy&&!hp(dy)&&(ry?dy<=ly:dy<ly)?ny=oy+1:sy=oy}return sy}return Kd(iy,ly,Lp,ry)}function Kd(iy,ly,ry,ny){ly=ry(ly);for(var sy=0,oy=null==iy?0:iy.length,dy=ly!==ly,cy=null===ly,uy=hp(ly),gy=ly===Ua;sy<oy;){var py=Am((sy+oy)/2),my=ry(iy[py]),fy=my!==Ua,hy=null===my,by=my===my,vy=hp(my);(dy?ny||by:gy?by&&(ny||fy):cy?by&&fy&&(ny||!hy):uy?by&&fy&&!hy&&(ny||!vy):hy||vy?0:ny?my<=ly:my<ly)?sy=py+1:oy=py}return Mm(oy,4294967294)}function Xd(iy,ly){for(var ry=-1,ny=iy.length,sy=0,oy=[];++ry<ny;){var dy=iy[ry],cy=ly?ly(dy):dy;if(!ry||!ap(cy,uy)){var uy=cy;oy[sy++]=0===dy?0:dy}}return oy}function Zd(iy){return'number'==typeof iy?iy:hp(iy)?Ga:+iy}function ac(iy){if('string'==typeof iy)return iy;if(ib(iy))return pa(iy,ac)+'';if(hp(iy))return Xm?Xm.call(iy):'';var ly=iy+'';return'0'==ly&&1/iy==-Ha?'-0':ly}function lc(iy,ly,ry){var ny=-1,sy=ua,oy=iy.length,dy=!0,cy=[],uy=cy;if(ry)dy=!1,sy=ga;else if(200<=oy){if(sy=ly?null:sh(iy))return qa(sy);dy=!1,sy=La,uy=new As}else uy=ly?[]:cy;n:for(;++ny<oy;){var gy=iy[ny],py=ly?ly(gy):gy,gy=ry||0!==gy?gy:0;if(dy&&py===py){for(var my=uy.length;my--;)if(uy[my]===py)continue n;ly&&uy.push(py),cy.push(gy)}else sy(uy,py,ry)||(uy!==cy&&uy.push(py),cy.push(gy))}return cy}function dc(iy,ly){return ly=yc(ly,iy),iy=2>ly.length?iy:ad(iy,Qd(ly,0,-1)),null==iy||delete iy[kg(Rg(ly))]}function cc(iy,ly,ry,ny){for(var sy=iy.length,oy=ny?sy:-1;(ny?oy--:++oy<sy)&&ly(iy[oy],oy,iy););return ry?Qd(iy,ny?0:oy,ny?oy+1:sy):Qd(iy,ny?oy+1:0,ny?sy:oy)}function gc(iy,ly){var ry=iy;return ry instanceof xs&&(ry=ry.value()),fa(ly,function(ny,sy){return sy.func.apply(sy.thisArg,ma([ny],sy.args))},ry)}function pc(iy,ly,ry){var ny=iy.length;if(2>ny)return ny?lc(iy[0]):[];for(var sy=-1,oy=qp(ny);++sy<ny;)for(var dy=iy[sy],cy=-1;++cy<ny;)cy!=sy&&(oy[sy]=Hs(oy[sy]||dy,iy[cy],ly,ry));return lc(Ys(oy,1),ly,ry)}function fc(iy,ly,ry){for(var ny=-1,sy=iy.length,oy=ly.length,dy={};++ny<sy;)ry(dy,iy[ny],ny<oy?ly[ny]:Ua);return dy}function hc(iy){return lp(iy)?iy:[]}function bc(iy){return'function'==typeof iy?iy:Lp}function yc(iy,ly){return ib(iy)?iy:xg(iy,ly)?[iy]:bh(Sp(iy))}function wc(iy,ly,ry){var ny=iy.length;return ry=ry===Ua?ny:ry,!ly&&ry>=ny?iy:Qd(iy,ly,ry)}function xc(iy,ly){if(ly)return iy.slice();var ry=iy.length,ry=um?um(ry):new iy.constructor(ry);return iy.copy(ry),ry}function Cc(iy){var ly=new iy.constructor(iy.byteLength);return new cm(ly).set(new cm(iy)),ly}function Sc(iy,ly){return new iy.constructor(ly?Cc(iy.buffer):iy.buffer,iy.byteOffset,iy.length)}function _c(iy,ly){if(iy!==ly){var ry=iy!==Ua,ny=null===iy,sy=iy===iy,oy=hp(iy),dy=ly!==Ua,cy=null===ly,uy=ly===ly,gy=hp(ly);if(!cy&&!gy&&!oy&&iy>ly||oy&&dy&&uy&&!cy&&!gy||ny&&dy&&uy||!ry&&uy||!sy)return 1;if(!ny&&!oy&&!gy&&iy<ly||gy&&ry&&sy&&!ny&&!oy||cy&&ry&&sy||!dy&&sy||!uy)return-1}return 0}function Ac(iy,ly,ry,ny){var sy=-1,oy=iy.length,dy=ry.length,cy=-1,uy=ly.length,gy=Tm(oy-dy,0),py=qp(uy+gy);for(ny=!ny;++cy<uy;)py[cy]=ly[cy];for(;++sy<dy;)(ny||sy<oy)&&(py[ry[sy]]=iy[sy]);for(;gy--;)py[cy++]=iy[sy++];return py}function Vc(iy,ly,ry,ny){var sy=-1,oy=iy.length,dy=-1,cy=ry.length,uy=-1,gy=ly.length,py=Tm(oy-cy,0),my=qp(py+gy);for(ny=!ny;++sy<py;)my[sy]=iy[sy];for(py=sy;++uy<gy;)my[py+uy]=ly[uy];for(;++dy<cy;)(ny||sy<oy)&&(my[py+ry[dy]]=iy[sy++]);return my}function jc(iy,ly){var ry=-1,ny=iy.length;for(ly||(ly=qp(ny));++ry<ny;)ly[ry]=iy[ry];return ly}function Ic(iy,ly,ry,ny){var sy=!ry;ry||(ry={});for(var oy=-1,dy=ly.length;++oy<dy;){var cy=ly[oy],uy=ny?ny(ry[cy],iy[cy],cy,ry,iy):Ua;uy===Ua&&(uy=iy[cy]),sy?Ns(ry,cy,uy):Ms(ry,cy,uy)}return ry}function kc(iy,ly){return Ic(iy,dh(iy),ly)}function Ec(iy,ly){return Ic(iy,ch(iy),ly)}function Tc(iy,ly){return function(ry,ny){var sy=ib(ry)?la:Ls,oy=ly?ly():{};return sy(ry,iy,cg(ny,2),oy)}}function Mc(iy){return zd(function(ly,ry){var ny=-1,sy=ry.length,oy=1<sy?ry[sy-1]:Ua,dy=2<sy?ry[2]:Ua,oy=3<iy.length&&'function'==typeof oy?(sy--,oy):Ua;for(dy&&wg(ry[0],ry[1],dy)&&(oy=3>sy?Ua:oy,sy=1),ly=Hp(ly);++ny<sy;)(dy=ry[ny])&&iy(ly,dy,ny,oy);return ly})}function Fc(iy,ly){return function(ry,ny){if(null==ry)return ry;if(!ip(ry))return iy(ry,ny);for(var sy=ry.length,oy=ly?sy:-1,dy=Hp(ry);(ly?oy--:++oy<sy)&&!1!==ny(dy[oy],oy,dy););return ry}}function Lc(iy){return function(ly,ry,ny){var sy=-1,oy=Hp(ly);ny=ny(ly);for(var dy=ny.length,cy;dy--&&(cy=ny[iy?dy:++sy],!1!==ry(oy[cy],cy,oy)););return ly}}function Oc(iy,ly,ry){function ny(){return(this&&this!==Jl&&this instanceof ny?oy:iy).apply(sy?ry:this,arguments)}var sy=1&ly,oy=Nc(iy);return ny}function $c(iy){return function(ly){ly=Sp(ly);var ry=Nl.test(ly)?Ba(ly):Ua,ny=ry?ry[0]:ly.charAt(0);return ly=ry?wc(ry,1).join(''):ly.slice(1),ny[iy]()+ly}}function Rc(iy){return function(ly){return fa(Mp(Tp(ly).replace(Ll,'')),iy,'')}}function Nc(iy){return function(){var ly=arguments;switch(ly.length){case 0:return new iy;case 1:return new iy(ly[0]);case 2:return new iy(ly[0],ly[1]);case 3:return new iy(ly[0],ly[1],ly[2]);case 4:return new iy(ly[0],ly[1],ly[2],ly[3]);case 5:return new iy(ly[0],ly[1],ly[2],ly[3],ly[4]);case 6:return new iy(ly[0],ly[1],ly[2],ly[3],ly[4],ly[5]);case 7:return new iy(ly[0],ly[1],ly[2],ly[3],ly[4],ly[5],ly[6]);}var ry=Zm(iy.prototype),ly=iy.apply(ry,ly);return cp(ly)?ly:ry}}function Pc(iy,ly,ry){function ny(){for(var oy=arguments.length,dy=qp(oy),cy=oy,uy=dg(ny);cy--;)dy[cy]=arguments[cy];return cy=3>oy&&dy[0]!==uy&&dy[oy-1]!==uy?[]:Da(dy,uy),oy-=cy.length,oy<ry?Yc(iy,ly,Wc,ny.placeholder,Ua,dy,cy,Ua,Ua,ry-oy):ia(this&&this!==Jl&&this instanceof ny?sy:iy,this,dy)}var sy=Nc(iy);return ny}function Dc(iy){return function(ly,ry,ny){var sy=Hp(ly);if(!ip(ly)){var oy=cg(ry,3);ly=Vp(ly),ry=function(dy){return oy(sy[dy],dy,sy)}}return ry=iy(ly,ry,ny),-1<ry?sy[oy?ly[ry]:ry]:Ua}}function qc(iy){return rg(function(ly){var ry=ly.length,ny=ry,sy=ws.prototype.thru;for(iy&&ly.reverse();ny--;){var oy=ly[ny];if('function'!=typeof oy)throw new Jp('Expected a function');if(sy&&!dy&&'wrapper'==og(oy))var dy=new ws([],!0)}for(ny=dy?ny:ry;++ny<ry;)var oy=ly[ny],sy=og(oy),cy='wrapper'==sy?oh(oy):Ua,dy=cy&&Cg(cy[0])&&424==cy[1]&&!cy[4].length&&1==cy[9]?dy[og(cy[0])].apply(dy,cy[3]):1==oy.length&&Cg(oy)?dy[sy]():dy.thru(oy);return function(){var uy=arguments,gy=uy[0];if(dy&&1==uy.length&&ib(gy))return dy.plant(gy).value();for(var py=0,uy=ry?ly[py].apply(this,uy):gy;++py<ry;)uy=ly[py].call(this,uy);return uy}})}function Wc(iy,ly,ry,ny,sy,oy,dy,cy,uy,gy){function py(){for(var xy=arguments.length,Cy=qp(xy),Sy=xy;Sy--;)Cy[Sy]=arguments[Sy];if(by){var Ay=dg(py),Sy=Cy.length,_y;for(_y=0;Sy--;)Cy[Sy]===Ay&&++_y}if(ny&&(Cy=Ac(Cy,ny,sy,by)),oy&&(Cy=Vc(Cy,oy,dy,by)),xy-=_y,by&&xy<gy)return Ay=Da(Cy,Ay),Yc(iy,ly,Wc,py.placeholder,ry,Cy,Ay,cy,uy,gy-xy);if(Ay=fy?ry:this,Sy=hy?Ay[iy]:iy,xy=Cy.length,cy){_y=Cy.length;for(var Vy=Mm(cy.length,_y),jy=jc(Cy),Iy;Vy--;)Iy=cy[Vy],Cy[Vy]=vg(Iy,_y)?jy[Iy]:Ua}else vy&&1<xy&&Cy.reverse();return my&&uy<xy&&(Cy.length=uy),this&&this!==Jl&&this instanceof py&&(Sy=wy||Nc(Sy)),Sy.apply(Ay,Cy)}var my=128&ly,fy=1&ly,hy=2&ly,by=24&ly,vy=512&ly,wy=hy?Ua:Nc(iy);return py}function zc(iy,ly){return function(ry,ny){return pd(ry,iy,ly(ny))}}function Bc(iy,ly){return function(ry,ny){var sy;if(ry===Ua&&ny===Ua)return ly;if(ry!==Ua&&(sy=ry),ny!==Ua){if(sy==Ua)return ny;'string'==typeof ry||'string'==typeof ny?(ry=ac(ry),ny=ac(ny)):(ry=Zd(ry),ny=Zd(ny)),sy=iy(ry,ny)}return sy}}function Uc(iy){return rg(function(ly){return ly=pa(ly,Ma(cg())),zd(function(ry){var ny=this;return iy(ly,function(sy){return ia(sy,ny,ry)})})})}function Hc(iy,ly){ly=ly===Ua?' ':ac(ly);var ry=ly.length;return 2>ry?ry?Wd(ly,iy):ly:(ry=Wd(ly,_m(iy/za(ly))),Nl.test(ly)?wc(Ba(ry),0,iy).join(''):ry.slice(0,iy))}function Gc(iy,ly,ry,ny){function sy(){for(var cy=-1,uy=arguments.length,gy=-1,py=ny.length,my=qp(py+uy),fy=this&&this!==Jl&&this instanceof sy?dy:iy;++gy<py;)my[gy]=ny[gy];for(;uy--;)my[gy++]=arguments[++cy];return ia(fy,oy?ry:this,my)}var oy=1&ly,dy=Nc(iy);return sy}function Qc(iy){return function(ly,ry,ny){ny&&'number'!=typeof ny&&wg(ly,ry,ny)&&(ry=ny=Ua),ly=yp(ly),ry===Ua?(ry=ly,ly=0):ry=yp(ry),ny=ny===Ua?ly<ry?1:-1:yp(ny);var sy=-1;ry=Tm(_m((ry-ly)/(ny||1)),0);for(var oy=qp(ry);ry--;)oy[iy?ry:++sy]=ly,ly+=ny;return oy}}function Jc(iy){return function(ly,ry){return'string'==typeof ly&&'string'==typeof ry||(ly=xp(ly),ry=xp(ry)),iy(ly,ry)}}function Yc(iy,ly,ry,ny,sy,oy,dy,cy,uy,gy){var py=8&ly,my=py?dy:Ua;dy=py?Ua:dy;var fy=py?oy:Ua;return oy=py?Ua:oy,ly=(ly|(py?32:64))&~(py?64:32),4&ly||(ly&=-4),sy=[iy,ly,sy,fy,my,oy,dy,cy,uy,gy],ry=ry.apply(Ua,sy),Cg(iy)&&ph(ry,sy),ry.placeholder=ny,Vg(ry,iy,ly)}function Kc(iy){var ly=Up[iy];return function(ry,ny){if(ry=xp(ry),ny=null==ny?0:Mm(vp(ny),292)){var sy=(Sp(ry)+'e').split('e'),sy=ly(sy[0]+'e'+(+sy[1]+ny)),sy=(Sp(sy)+'e').split('e');return+(sy[0]+'e'+(+sy[1]-ny))}return ly(ry)}}function Xc(iy){return function(ly){var ry=uh(ly);return'[object Map]'==ry?Na(ly):'[object Set]'==ry?Wa(ly):Ta(ly,iy(ly))}}function Zc(iy,ly,ry,ny,sy,oy,dy,cy){var uy=2&ly;if(!uy&&'function'!=typeof iy)throw new Jp('Expected a function');var gy=ny?ny.length:0;if(gy||(ly&=-97,ny=sy=Ua),dy=dy===Ua?dy:Tm(vp(dy),0),cy=cy===Ua?cy:vp(cy),gy-=sy?sy.length:0,64&ly){var py=ny,my=sy;ny=sy=Ua}var fy=uy?Ua:oh(iy);return oy=[iy,ly,ry,ny,sy,py,my,oy,dy,cy],fy&&(ry=oy[1],iy=fy[1],ly=ry|iy,ny=128==iy&&8==ry||128==iy&&256==ry&&oy[7].length<=fy[8]||384==iy&&fy[7].length<=fy[8]&&8==ry,131>ly||ny)&&(1&iy&&(oy[2]=fy[2],ly|=1&ry?0:4),(ry=fy[3])&&(ny=oy[3],oy[3]=ny?Ac(ny,ry,fy[4]):ry,oy[4]=ny?Da(oy[3],'__lodash_placeholder__'):fy[4]),(ry=fy[5])&&(ny=oy[5],oy[5]=ny?Vc(ny,ry,fy[6]):ry,oy[6]=ny?Da(oy[5],'__lodash_placeholder__'):fy[6]),(ry=fy[7])&&(oy[7]=ry),128&iy&&(oy[8]=null==oy[8]?fy[8]:Mm(oy[8],fy[8])),null==oy[9]&&(oy[9]=fy[9]),oy[0]=fy[0],oy[1]=ly),iy=oy[0],ly=oy[1],ry=oy[2],ny=oy[3],sy=oy[4],cy=oy[9]=oy[9]===Ua?uy?0:iy.length:Tm(oy[9]-gy,0),!cy&&24&ly&&(ly&=-25),Vg((fy?lh:ph)(ly&&1!=ly?8==ly||16==ly?Pc(iy,ly,cy):32!=ly&&33!=ly||sy.length?Wc.apply(Ua,oy):Gc(iy,ly,ry,ny):Oc(iy,ly,ry),oy),iy,ly)}function eg(iy,ly,ry,ny){return iy===Ua||ap(iy,Kp[ry])&&!em.call(ny,ry)?ly:iy}function tg(iy,ly,ry,ny,sy,oy){return cp(iy)&&cp(ly)&&(oy.set(ly,iy),Fd(iy,ly,Ua,tg,oy),oy.delete(ly)),iy}function ag(iy){return pp(iy)?Ua:iy}function ig(iy,ly,ry,ny,sy,oy){var dy=1&ry,cy=iy.length,uy=ly.length;if(cy!=uy&&!(dy&&uy>cy))return!1;if((uy=oy.get(iy))&&oy.get(ly))return uy==ly;var uy=-1,gy=!0,py=2&ry?new As:Ua;for(oy.set(iy,ly),oy.set(ly,iy);++uy<cy;){var my=iy[uy],fy=ly[uy];if(ny)var hy=dy?ny(fy,my,uy,ly,iy,oy):ny(my,fy,uy,iy,ly,oy);if(hy!==Ua){if(hy)continue;gy=!1;break}if(py){if(!ba(ly,function(by,vy){if(!La(py,vy)&&(my===by||sy(my,by,ry,ny,oy)))return py.push(vy)})){gy=!1;break}}else if(my!==fy&&!sy(my,fy,ry,ny,oy)){gy=!1;break}}return oy.delete(iy),oy.delete(ly),gy}function lg(iy,ly,ry,ny,sy,oy,dy){switch(ry){case'[object DataView]':if(iy.byteLength!=ly.byteLength||iy.byteOffset!=ly.byteOffset)break;iy=iy.buffer,ly=ly.buffer;case'[object ArrayBuffer]':if(iy.byteLength!=ly.byteLength||!oy(new cm(iy),new cm(ly)))break;return!0;case'[object Boolean]':case'[object Date]':case'[object Number]':return ap(+iy,+ly);case'[object Error]':return iy.name==ly.name&&iy.message==ly.message;case'[object RegExp]':case'[object String]':return iy==ly+'';case'[object Map]':var cy=Na;case'[object Set]':if(cy||(cy=qa),iy.size!=ly.size&&!(1&ny))break;return(ry=dy.get(iy))?ry==ly:(ny|=2,dy.set(iy,ly),ly=ig(cy(iy),cy(ly),ny,sy,oy,dy),dy.delete(iy),ly);case'[object Symbol]':if(Km)return Km.call(iy)==Km.call(ly);}return!1}function rg(iy){return fh(Ag(iy,Ua,Og),iy+'')}function ng(iy){return ld(iy,Vp,dh)}function sg(iy){return ld(iy,jp,ch)}function og(iy){for(var ly=iy.name+'',ry=Bm[ly],ny=em.call(Bm,ly)?ry.length:0;ny--;){var sy=ry[ny],oy=sy.func;if(null==oy||oy==iy)return sy.name}return ly}function dg(iy){return(em.call(ys,'placeholder')?ys:iy).placeholder}function cg(){var iy=ys.iteratee||Op,iy=iy===Op?Vd:iy;return arguments.length?iy(arguments[0],arguments[1]):iy}function ug(iy,ly){var ry=iy.__data__,ny=typeof ly;return('string'==ny||'number'==ny||'symbol'==ny||'boolean'==ny?'__proto__'!==ly:null===ly)?ry['string'==typeof ly?'string':'hash']:ry.map}function gg(iy){for(var ly=Vp(iy),ry=ly.length;ry--;){var ny=ly[ry],sy=iy[ny];ly[ry]=[ny,sy,sy===sy&&!cp(sy)]}return ly}function pg(iy,ly){var ry=null==iy?Ua:iy[ly];return Cd(ry)?ry:Ua}function mg(iy,ly,ry){ly=yc(ly,iy);for(var ny=-1,sy=ly.length,oy=!1,dy;++ny<sy&&(dy=kg(ly[ny]),!!(oy=null!=iy&&ry(iy,dy)));)iy=iy[dy];return oy||++ny!=sy?oy:(sy=null==iy?0:iy.length,!!sy&&op(sy)&&vg(dy,sy)&&(ib(iy)||ab(iy)))}function fg(iy){var ly=iy.length,ry=iy.constructor(ly);return ly&&'string'==typeof iy[0]&&em.call(iy,'index')&&(ry.index=iy.index,ry.input=iy.input),ry}function hg(iy){return'function'!=typeof iy.constructor||Sg(iy)?{}:Zm(gm(iy))}function bg(iy,ly,ry,ny){var sy=iy.constructor;return'[object ArrayBuffer]'===ly?Cc(iy):'[object Boolean]'===ly||'[object Date]'===ly?new sy(+iy):'[object DataView]'===ly?(ly=ny?Cc(iy.buffer):iy.buffer,new iy.constructor(ly,iy.byteOffset,iy.byteLength)):'[object Float32Array]'===ly||'[object Float64Array]'===ly||'[object Int8Array]'===ly||'[object Int16Array]'===ly||'[object Int32Array]'===ly||'[object Uint8Array]'===ly||'[object Uint8ClampedArray]'===ly||'[object Uint16Array]'===ly||'[object Uint32Array]'===ly?Sc(iy,ny):'[object Map]'===ly?(ly=ny?ry(Na(iy),1):Na(iy),fa(ly,ea,new iy.constructor)):'[object Number]'===ly||'[object String]'===ly?new sy(iy):'[object RegExp]'===ly?(ly=new iy.constructor(iy.source,Cl.exec(iy)),ly.lastIndex=iy.lastIndex,ly):'[object Set]'===ly?(ly=ny?ry(qa(iy),1):qa(iy),fa(ly,aa,new iy.constructor)):'[object Symbol]'===ly?Km?Hp(Km.call(iy)):{}:void 0}function yg(iy){return ib(iy)||ab(iy)||!!(bm&&iy&&iy[bm])}function vg(iy,ly){return ly=null==ly?9007199254740991:ly,!!ly&&('number'==typeof iy||jl.test(iy))&&-1<iy&&0==iy%1&&iy<ly}function wg(iy,ly,ry){if(!cp(ry))return!1;var ny=typeof ly;return!('number'==ny?!(ip(ry)&&vg(ly,ry.length)):!('string'==ny&&ly in ry))&&ap(ry[ly],iy)}function xg(iy,ly){if(ib(iy))return!1;var ry=typeof iy;return'number'==ry||'symbol'==ry||'boolean'==ry||null==iy||hp(iy)||sl.test(iy)||!nl.test(iy)||null!=ly&&iy in Hp(ly)}function Cg(iy){var ly=og(iy),ry=ys[ly];return'function'==typeof ry&&ly in xs.prototype&&(iy===ry||(ly=oh(ry),!!ly&&iy===ly[0]))}function Sg(iy){var ly=iy&&iy.constructor;return iy===('function'==typeof ly&&ly.prototype||Kp)}function _g(iy,ly){return function(ry){return null!=ry&&ry[iy]===ly&&(ly!==Ua||iy in Hp(ry))}}function Ag(iy,ly,ry){return ly=Tm(ly===Ua?iy.length-1:ly,0),function(){for(var ny=arguments,sy=-1,oy=Tm(ny.length-ly,0),dy=qp(oy);++sy<oy;)dy[sy]=ny[ly+sy];for(sy=-1,oy=qp(ly+1);++sy<ly;)oy[sy]=ny[sy];return oy[ly]=ry(dy),ia(iy,this,oy)}}function Vg(iy,ly,ry){var ny=ly+'';ly=fh;var oy=Tg,sy;return sy=(sy=ny.match(bl))?sy[1].split(yl):[],ry=oy(sy,ry),(oy=ry.length)&&(sy=oy-1,ry[sy]=(1<oy?'& ':'')+ry[sy],ry=ry.join(2<oy?', ':' '),ny=ny.replace(hl,'{\n/* [wrapped with '+ry+'] */\n')),ly(iy,ny)}function jg(iy){var ly=0,ry=0;return function(){var ny=Fm(),sy=16-(ny-ry);if(!(ry=ny,0<sy))ly=0;else if(800<=++ly)return arguments[0];return iy.apply(Ua,arguments)}}function Ig(iy,ly){var ry=-1,ny=iy.length;for(ly=ly===Ua?ny:ly;++ry<ly;){var ny=qd(ry,ny-1),oy=iy[ny];iy[ny]=iy[ry],iy[ry]=oy}return iy.length=ly,iy}function kg(iy){if('string'==typeof iy||hp(iy))return iy;var ly=iy+'';return'0'==ly&&1/iy==-Ha?'-0':ly}function Eg(iy){if(null!=iy){try{return Zp.call(iy)}catch(ly){}return iy+''}return''}function Tg(iy,ly){return ra(Qa,function(ry){var ny='_.'+ry[0];ly&ry[1]&&!ua(iy,ny)&&iy.push(ny)}),iy.sort()}function Mg(iy){if(iy instanceof xs)return iy.clone();var ly=new ws(iy.__wrapped__,iy.__chain__);return ly.__actions__=jc(iy.__actions__),ly.__index__=iy.__index__,ly.__values__=iy.__values__,ly}function Fg(iy,ly,ry){var ny=null==iy?0:iy.length;return ny?(ry=null==ry?0:vp(ry),0>ry&&(ry=Tm(ny+ry,0)),wa(iy,cg(ly,3),ry)):-1}function Lg(iy,ly,ry){var ny=null==iy?0:iy.length;if(!ny)return-1;var sy=ny-1;return ry!==Ua&&(sy=vp(ry),sy=0>ry?Tm(ny+sy,0):Mm(sy,ny-1)),wa(iy,cg(ly,3),sy,!0)}function Og(iy){return(null==iy?0:iy.length)?Ys(iy,1):[]}function $g(iy){return iy&&iy.length?iy[0]:Ua}function Rg(iy){var ly=null==iy?0:iy.length;return ly?iy[ly-1]:Ua}function Ng(iy,ly){return iy&&iy.length&&ly&&ly.length?Pd(iy,ly):iy}function Pg(iy){return null==iy?iy:$m.call(iy)}function Dg(iy){if(!iy||!iy.length)return[];var ly=0;return iy=da(iy,function(ry){if(lp(ry))return ly=Tm(ry.length,ly),!0}),Ea(ly,function(ry){return pa(iy,Aa(ry))})}function qg(iy,ly){if(!iy||!iy.length)return[];var ry=Dg(iy);return null==ly?ry:pa(ry,function(ny){return ia(ly,Ua,ny)})}function Wg(iy){return iy=ys(iy),iy.__chain__=!0,iy}function zg(iy,ly){return ly(iy)}function Ug(iy,ly){return(ib(iy)?ra:eh)(iy,cg(ly,3))}function Hg(iy,ly){return(ib(iy)?na:th)(iy,cg(ly,3))}function Gg(iy,ly){return(ib(iy)?pa:Ed)(iy,cg(ly,3))}function Qg(iy,ly,ry){return ly=ry?Ua:ly,ly=iy&&null==ly?iy.length:ly,Zc(iy,128,Ua,Ua,Ua,Ua,ly)}function Jg(iy,ly){var ry;if('function'!=typeof ly)throw new Jp('Expected a function');return iy=vp(iy),function(){return 0<--iy&&(ry=ly.apply(this,arguments)),1>=iy&&(ly=Ua),ry}}function Yg(iy,ly,ry){return ly=ry?Ua:ly,iy=Zc(iy,8,Ua,Ua,Ua,Ua,Ua,ly),iy.placeholder=Yg.placeholder,iy}function Kg(iy,ly,ry){return ly=ry?Ua:ly,iy=Zc(iy,16,Ua,Ua,Ua,Ua,Ua,ly),iy.placeholder=Kg.placeholder,iy}function Xg(iy,ly,ry){function ny(Cy){var Sy=uy,_y=gy;return uy=gy=Ua,by=Cy,my=iy.apply(_y,Sy)}function sy(Cy){var Sy=Cy-hy;return Cy-=by,hy===Ua||Sy>=ly||0>Sy||wy&&Cy>=py}function oy(){var Cy=Bh();if(sy(Cy))return dy(Cy);var Sy;Sy=Cy-by,Cy=ly-(Cy-hy),Sy=wy?Mm(Cy,py-Sy):Cy,fy=mh(oy,Sy)}function dy(Cy){return fy=Ua,xy&&uy?ny(Cy):(uy=gy=Ua,my)}function cy(){var Cy=Bh(),Sy=sy(Cy);if(uy=arguments,gy=this,hy=Cy,Sy){if(fy===Ua)return by=Cy=hy,fy=mh(oy,ly),vy?ny(Cy):my;if(wy)return fy=mh(oy,ly),ny(hy)}return fy===Ua&&(fy=mh(oy,ly)),my}var by=0,vy=!1,wy=!1,xy=!0,uy,gy,py,my,fy,hy;if('function'!=typeof iy)throw new Jp('Expected a function');return ly=xp(ly)||0,cp(ry)&&(vy=!!ry.leading,py=(wy='maxWait'in ry)?Tm(xp(ry.maxWait)||0,ly):py,xy='trailing'in ry?!!ry.trailing:xy),cy.cancel=function(){fy!==Ua&&nh(fy),by=0,uy=hy=gy=fy=Ua},cy.flush=function(){return fy===Ua?my:dy(Bh())},cy}function Zg(iy,ly){function ry(){var ny=arguments,sy=ly?ly.apply(this,ny):ny[0],oy=ry.cache;return oy.has(sy)?oy.get(sy):(ny=iy.apply(this,ny),ry.cache=oy.set(sy,ny)||oy,ny)}if('function'!=typeof iy||null!=ly&&'function'!=typeof ly)throw new Jp('Expected a function');return ry.cache=new(Zg.Cache||_s),ry}function ep(iy){if('function'!=typeof iy)throw new Jp('Expected a function');return function(){var ly=arguments;switch(ly.length){case 0:return!iy.call(this);case 1:return!iy.call(this,ly[0]);case 2:return!iy.call(this,ly[0],ly[1]);case 3:return!iy.call(this,ly[0],ly[1],ly[2]);}return!iy.apply(this,ly)}}function ap(iy,ly){return iy===ly||iy!==iy&&ly!==ly}function ip(iy){return null!=iy&&op(iy.length)&&!np(iy)}function lp(iy){return up(iy)&&ip(iy)}function rp(iy){if(!up(iy))return!1;var ly=nd(iy);return'[object Error]'==ly||'[object DOMException]'==ly||'string'==typeof iy.message&&'string'==typeof iy.name&&!pp(iy)}function np(iy){return!!cp(iy)&&(iy=nd(iy),'[object Function]'==iy||'[object GeneratorFunction]'==iy||'[object AsyncFunction]'==iy||'[object Proxy]'==iy)}function sp(iy){return'number'==typeof iy&&iy==vp(iy)}function op(iy){return'number'==typeof iy&&-1<iy&&0==iy%1&&9007199254740991>=iy}function cp(iy){var ly=typeof iy;return null!=iy&&('object'==ly||'function'==ly)}function up(iy){return null!=iy&&'object'==typeof iy}function gp(iy){return'number'==typeof iy||up(iy)&&'[object Number]'==nd(iy)}function pp(iy){return up(iy)&&'[object Object]'==nd(iy)&&(iy=gm(iy),null===iy||(iy=em.call(iy,'constructor')&&iy.constructor,'function'==typeof iy&&iy instanceof iy&&Zp.call(iy)==lm))}function mp(iy){return'string'==typeof iy||!ib(iy)&&up(iy)&&'[object String]'==nd(iy)}function hp(iy){return'symbol'==typeof iy||up(iy)&&'[object Symbol]'==nd(iy)}function bp(iy){if(!iy)return[];if(ip(iy))return mp(iy)?Ba(iy):jc(iy);if(ym&&iy[ym]){iy=iy[ym]();for(var ry=[],ly;!(ly=iy.next()).done;)ry.push(ly.value);return ry}return ly=uh(iy),('[object Map]'==ly?Na:'[object Set]'==ly?qa:kp)(iy)}function yp(iy){return iy?(iy=xp(iy),iy===Ha||iy===-Ha?1.7976931348623157e308*(0>iy?-1:1):iy===iy?iy:0):0===iy?iy:0}function vp(iy){iy=yp(iy);var ly=iy%1;return iy===iy?ly?iy-ly:iy:0}function wp(iy){return iy?Ds(vp(iy),0,4294967295):0}function xp(iy){if('number'==typeof iy)return iy;if(hp(iy))return Ga;if(cp(iy)&&(iy='function'==typeof iy.valueOf?iy.valueOf():iy,iy=cp(iy)?iy+'':iy),'string'!=typeof iy)return 0===iy?iy:+iy;iy=iy.replace(gl,'');var ly=_l.test(iy);return ly||Vl.test(iy)?Hl(iy.slice(2),ly?2:8):Sl.test(iy)?Ga:+iy}function Cp(iy){return Ic(iy,jp(iy))}function Sp(iy){return null==iy?'':ac(iy)}function _p(iy,ly,ry){return iy=null==iy?Ua:ad(iy,ly),iy===Ua?ry:iy}function Ap(iy,ly){return null!=iy&&mg(iy,ly,ud)}function Vp(iy){return ip(iy)?js(iy):Id(iy)}function jp(iy){if(ip(iy))iy=js(iy,!0);else if(cp(iy)){var ry=Sg(iy),ny=[],ly;for(ly in iy)('constructor'!=ly||!ry&&em.call(iy,ly))&&ny.push(ly);iy=ny}else{if(ly=[],null!=iy)for(ry in Hp(iy))ly.push(ry);iy=ly}return iy}function Ip(iy,ly){if(null==iy)return{};var ry=pa(sg(iy),function(ny){return[ny]});return ly=cg(ly),Rd(iy,ry,function(ny,sy){return ly(ny,sy[0])})}function kp(iy){return null==iy?[]:Fa(iy,Vp(iy))}function Ep(iy){return Nb(Sp(iy).toLowerCase())}function Tp(iy){return(iy=Sp(iy))&&iy.replace(Il,us).replace(Ol,'')}function Mp(iy,ly,ry){return iy=Sp(iy),ly=ry?Ua:ly,ly===Ua?Pl.test(iy)?iy.match(Rl)||[]:iy.match(vl)||[]:iy.match(ly)||[]}function Fp(iy){return function(){return iy}}function Lp(iy){return iy}function Op(iy){return Vd('function'==typeof iy?iy:Ws(iy,1))}function $p(iy,ly,ry){var ny=Vp(ly),sy=Zs(ly,ny);null!=ry||cp(ly)&&(sy.length||!ny.length)||(ry=ly,ly=iy,iy=this,sy=Zs(ly,Vp(ly)));var oy=!(cp(ry)&&'chain'in ry&&!ry.chain),dy=np(iy);return ra(sy,function(cy){var uy=ly[cy];iy[cy]=uy,dy&&(iy.prototype[cy]=function(){var gy=this.__chain__;if(oy||gy){var py=iy(this.__wrapped__);return(py.__actions__=jc(this.__actions__)).push({func:uy,args:arguments,thisArg:iy}),py.__chain__=gy,py}return uy.apply(iy,ma([this.value()],arguments))})}),iy}function Rp(){}function Np(iy){return xg(iy)?Aa(kg(iy)):Nd(iy)}function Pp(){return[]}function Dp(){return!1}bs=null==bs?Jl:ms.defaults(Jl.Object(),bs,ms.pick(Jl,Dl));var qp=bs.Array,Wp=bs.Date,zp=bs.Error,Bp=bs.Function,Up=bs.Math,Hp=bs.Object,Gp=bs.RegExp,Qp=bs.String,Jp=bs.TypeError,Yp=qp.prototype,Kp=Hp.prototype,Xp=bs['__core-js_shared__'],Zp=Bp.prototype.toString,em=Kp.hasOwnProperty,tm=0,am=function(){var iy=/[^.]+$/.exec(Xp&&Xp.keys&&Xp.keys.IE_PROTO||'');return iy?'Symbol(src)_1.'+iy:''}(),im=Kp.toString,lm=Zp.call(Hp),rm=Jl._,nm=Gp('^'+Zp.call(em).replace(cl,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$'),om=Xl?bs.Buffer:Ua,dm=bs.Symbol,cm=bs.Uint8Array,um=om?om.f:Ua,gm=Pa(Hp.getPrototypeOf,Hp),pm=Hp.create,fm=Kp.propertyIsEnumerable,hm=Yp.splice,bm=dm?dm.isConcatSpreadable:Ua,ym=dm?dm.iterator:Ua,vm=dm?dm.toStringTag:Ua,wm=function(){try{var iy=pg(Hp,'defineProperty');return iy({},'',{}),iy}catch(ly){}}(),xm=bs.clearTimeout!==Jl.clearTimeout&&bs.clearTimeout,Cm=Wp&&Wp.now!==Jl.Date.now&&Wp.now,Sm=bs.setTimeout!==Jl.setTimeout&&bs.setTimeout,_m=Up.ceil,Am=Up.floor,Vm=Hp.getOwnPropertySymbols,jm=om?om.isBuffer:Ua,Im=bs.isFinite,km=Yp.join,Em=Pa(Hp.keys,Hp),Tm=Up.max,Mm=Up.min,Fm=Wp.now,Lm=bs.parseInt,Om=Up.random,$m=Yp.reverse,Rm=pg(bs,'DataView'),Nm=pg(bs,'Map'),Pm=pg(bs,'Promise'),Dm=pg(bs,'Set'),qm=pg(bs,'WeakMap'),Wm=pg(Hp,'create'),zm=qm&&new qm,Bm={},Um=Eg(Rm),Hm=Eg(Nm),Gm=Eg(Pm),Qm=Eg(Dm),Jm=Eg(qm),Ym=dm?dm.prototype:Ua,Km=Ym?Ym.valueOf:Ua,Xm=Ym?Ym.toString:Ua,Zm=function(){function iy(){}return function(ly){return cp(ly)?pm?pm(ly):(iy.prototype=ly,ly=new iy,iy.prototype=Ua,ly):{}}}();ys.templateSettings={escape:il,evaluate:ll,interpolate:rl,variable:'',imports:{_:ys}},ys.prototype=vs.prototype,ys.prototype.constructor=ys,ws.prototype=Zm(vs.prototype),ws.prototype.constructor=ws,xs.prototype=Zm(vs.prototype),xs.prototype.constructor=xs,Cs.prototype.clear=function(){this.__data__=Wm?Wm(null):{},this.size=0},Cs.prototype.delete=function(iy){return iy=this.has(iy)&&delete this.__data__[iy],this.size-=iy?1:0,iy},Cs.prototype.get=function(iy){var ly=this.__data__;return Wm?(iy=ly[iy],'__lodash_hash_undefined__'===iy?Ua:iy):em.call(ly,iy)?ly[iy]:Ua},Cs.prototype.has=function(iy){var ly=this.__data__;return Wm?ly[iy]!==Ua:em.call(ly,iy)},Cs.prototype.set=function(iy,ly){var ry=this.__data__;return this.size+=this.has(iy)?0:1,ry[iy]=Wm&&ly===Ua?'__lodash_hash_undefined__':ly,this},Ss.prototype.clear=function(){this.__data__=[],this.size=0},Ss.prototype.delete=function(iy){var ly=this.__data__;return iy=Fs(ly,iy),!(0>iy)&&(iy==ly.length-1?ly.pop():hm.call(ly,iy,1),--this.size,!0)},Ss.prototype.get=function(iy){var ly=this.__data__;return iy=Fs(ly,iy),0>iy?Ua:ly[iy][1]},Ss.prototype.has=function(iy){return-1<Fs(this.__data__,iy)},Ss.prototype.set=function(iy,ly){var ry=this.__data__,ny=Fs(ry,iy);return 0>ny?(++this.size,ry.push([iy,ly])):ry[ny][1]=ly,this},_s.prototype.clear=function(){this.size=0,this.__data__={hash:new Cs,map:new(Nm||Ss),string:new Cs}},_s.prototype.delete=function(iy){return iy=ug(this,iy).delete(iy),this.size-=iy?1:0,iy},_s.prototype.get=function(iy){return ug(this,iy).get(iy)},_s.prototype.has=function(iy){return ug(this,iy).has(iy)},_s.prototype.set=function(iy,ly){var ry=ug(this,iy),ny=ry.size;return ry.set(iy,ly),this.size+=ry.size==ny?0:1,this},As.prototype.add=As.prototype.push=function(iy){return this.__data__.set(iy,'__lodash_hash_undefined__'),this},As.prototype.has=function(iy){return this.__data__.has(iy)},Vs.prototype.clear=function(){this.__data__=new Ss,this.size=0},Vs.prototype.delete=function(iy){var ly=this.__data__;return iy=ly.delete(iy),this.size=ly.size,iy},Vs.prototype.get=function(iy){return this.__data__.get(iy)},Vs.prototype.has=function(iy){return this.__data__.has(iy)},Vs.prototype.set=function(iy,ly){var ry=this.__data__;if(ry instanceof Ss){var ny=ry.__data__;if(!Nm||199>ny.length)return ny.push([iy,ly]),this.size=++ry.size,this;ry=this.__data__=new _s(ny)}return ry.set(iy,ly),this.size=ry.size,this};var eh=Fc(Ks),th=Fc(Xs,!0),ah=Lc(),ih=Lc(!0),lh=zm?function(iy,ly){return zm.set(iy,ly),iy}:Lp,rh=wm?function(iy,ly){return wm(iy,'toString',{configurable:!0,enumerable:!1,value:Fp(ly),writable:!0})}:Lp,nh=xm||function(iy){return Jl.clearTimeout(iy)},sh=Dm&&1/qa(new Dm([,-0]))[1]==Ha?function(iy){return new Dm(iy)}:Rp,oh=zm?function(iy){return zm.get(iy)}:Rp,dh=Vm?function(iy){return null==iy?[]:(iy=Hp(iy),da(Vm(iy),function(ly){return fm.call(iy,ly)}))}:Pp,ch=Vm?function(iy){for(var ly=[];iy;)ma(ly,dh(iy)),iy=gm(iy);return ly}:Pp,uh=nd;(Rm&&'[object DataView]'!=uh(new Rm(new ArrayBuffer(1)))||Nm&&'[object Map]'!=uh(new Nm)||Pm&&'[object Promise]'!=uh(Pm.resolve())||Dm&&'[object Set]'!=uh(new Dm)||qm&&'[object WeakMap]'!=uh(new qm))&&(uh=function(iy){var ly=nd(iy);if(iy=(iy='[object Object]'==ly?iy.constructor:Ua)?Eg(iy):'')switch(iy){case Um:return'[object DataView]';case Hm:return'[object Map]';case Gm:return'[object Promise]';case Qm:return'[object Set]';case Jm:return'[object WeakMap]';}return ly});var gh=Xp?np:Dp,ph=jg(lh),mh=Sm||function(iy,ly){return Jl.setTimeout(iy,ly)},fh=jg(rh),bh=function(iy){iy=Zg(iy,function(ry){return 500===ly.size&&ly.clear(),ry});var ly=iy.cache;return iy}(function(iy){var ly=[];return ol.test(iy)&&ly.push(''),iy.replace(dl,function(ry,ny,sy,oy){ly.push(sy?oy.replace(wl,'$1'):ny||ry)}),ly}),yh=zd(function(iy,ly){return lp(iy)?Hs(iy,Ys(ly,1,lp,!0)):[]}),vh=zd(function(iy,ly){var ry=Rg(ly);return lp(ry)&&(ry=Ua),lp(iy)?Hs(iy,Ys(ly,1,lp,!0),cg(ry,2)):[]}),wh=zd(function(iy,ly){var ry=Rg(ly);return lp(ry)&&(ry=Ua),lp(iy)?Hs(iy,Ys(ly,1,lp,!0),Ua,ry):[]}),xh=zd(function(iy){var ly=pa(iy,hc);return ly.length&&ly[0]===iy[0]?gd(ly):[]}),Ch=zd(function(iy){var ly=Rg(iy),ry=pa(iy,hc);return ly===Rg(ry)?ly=Ua:ry.pop(),ry.length&&ry[0]===iy[0]?gd(ry,cg(ly,2)):[]}),Sh=zd(function(iy){var ly=Rg(iy),ry=pa(iy,hc);return(ly='function'==typeof ly?ly:Ua)&&ry.pop(),ry.length&&ry[0]===iy[0]?gd(ry,Ua,ly):[]}),_h=zd(Ng),Ah=rg(function(iy,ly){var ry=null==iy?0:iy.length,ny=Ps(iy,ly);return Dd(iy,pa(ly,function(sy){return vg(sy,ry)?+sy:sy}).sort(_c)),ny}),Vh=zd(function(iy){return lc(Ys(iy,1,lp,!0))}),jh=zd(function(iy){var ly=Rg(iy);return lp(ly)&&(ly=Ua),lc(Ys(iy,1,lp,!0),cg(ly,2))}),Ih=zd(function(iy){var ly=Rg(iy),ly='function'==typeof ly?ly:Ua;return lc(Ys(iy,1,lp,!0),Ua,ly)}),kh=zd(function(iy,ly){return lp(iy)?Hs(iy,ly):[]}),Eh=zd(function(iy){return pc(da(iy,lp))}),Th=zd(function(iy){var ly=Rg(iy);return lp(ly)&&(ly=Ua),pc(da(iy,lp),cg(ly,2))}),Mh=zd(function(iy){var ly=Rg(iy),ly='function'==typeof ly?ly:Ua;return pc(da(iy,lp),Ua,ly)}),Fh=zd(Dg),Lh=zd(function(iy){var ly=iy.length,ly=1<ly?iy[ly-1]:Ua,ly='function'==typeof ly?(iy.pop(),ly):Ua;return qg(iy,ly)}),Oh=rg(function(iy){function ly(oy){return Ps(oy,iy)}var ry=iy.length,ny=ry?iy[0]:0,sy=this.__wrapped__;return!(1<ry||this.__actions__.length)&&sy instanceof xs&&vg(ny)?(sy=sy.slice(ny,+ny+(ry?1:0)),sy.__actions__.push({func:zg,args:[ly],thisArg:Ua}),new ws(sy,this.__chain__).thru(function(oy){return ry&&!oy.length&&oy.push(Ua),oy})):this.thru(ly)}),$h=Tc(function(iy,ly,ry){em.call(iy,ry)?++iy[ry]:Ns(iy,ry,1)}),Rh=Dc(Fg),Nh=Dc(Lg),Ph=Tc(function(iy,ly,ry){em.call(iy,ry)?iy[ry].push(ly):Ns(iy,ry,[ly])}),Dh=zd(function(iy,ly,ry){var ny=-1,oy=ip(iy)?qp(iy.length):[];return eh(iy,function(dy){oy[++ny]='function'==typeof ly?ia(ly,dy,ry):md(dy,ly,ry)}),oy}),qh=Tc(function(iy,ly,ry){Ns(iy,ry,ly)}),Wh=Tc(function(iy,ly,ry){iy[ry?0:1].push(ly)},function(){return[[],[]]}),zh=zd(function(iy,ly){if(null==iy)return[];var ry=ly.length;return 1<ry&&wg(iy,ly[0],ly[1])?ly=[]:2<ry&&wg(ly[0],ly[1],ly[2])&&(ly=[ly[0]]),Od(iy,Ys(ly,1),[])}),Bh=Cm||function(){return Jl.Date.now()},Uh=zd(function(iy,ly,ry){var ny=1;if(ry.length)var sy=Da(ry,dg(Uh)),ny=32|ny;return Zc(iy,ny,ly,ry,sy)}),Hh=zd(function(iy,ly,ry){var ny=3;if(ry.length)var sy=Da(ry,dg(Hh)),ny=32|ny;return Zc(ly,ny,iy,ry,sy)}),Gh=zd(function(iy,ly){return Us(iy,1,ly)}),Qh=zd(function(iy,ly,ry){return Us(iy,xp(ly)||0,ry)});Zg.Cache=_s;var Jh=zd(function(iy,ly){ly=1==ly.length&&ib(ly[0])?pa(ly[0],Ma(cg())):pa(Ys(ly,1),Ma(cg()));var ry=ly.length;return zd(function(ny){for(var sy=-1,oy=Mm(ny.length,ry);++sy<oy;)ny[sy]=ly[sy].call(this,ny[sy]);return ia(iy,this,ny)})}),Yh=zd(function(iy,ly){return Zc(iy,32,Ua,ly,Da(ly,dg(Yh)))}),Kh=zd(function(iy,ly){return Zc(iy,64,Ua,ly,Da(ly,dg(Kh)))}),Xh=rg(function(iy,ly){return Zc(iy,256,Ua,Ua,Ua,ly)}),Zh=Jc(sd),eb=Jc(function(iy,ly){return iy>=ly}),ab=hd(function(){return arguments}())?hd:function(iy){return up(iy)&&em.call(iy,'callee')&&!fm.call(iy,'callee')},ib=qp.isArray,rb=es?Ma(es):function(iy){return up(iy)&&'[object ArrayBuffer]'==nd(iy)},nb=jm||Dp,sb=as?Ma(as):function(iy){return up(iy)&&'[object Date]'==nd(iy)},ob=is?Ma(is):function(iy){return up(iy)&&'[object Map]'==uh(iy)},db=ls?Ma(ls):function(iy){return up(iy)&&'[object RegExp]'==nd(iy)},ub=rs?Ma(rs):function(iy){return up(iy)&&'[object Set]'==uh(iy)},gb=ns?Ma(ns):function(iy){return up(iy)&&op(iy.length)&&!!ql[nd(iy)]},pb=Jc(kd),mb=Jc(function(iy,ly){return iy<=ly}),fb=Mc(function(iy,ly){if(Sg(ly)||ip(ly))Ic(ly,Vp(ly),iy);else for(var ry in ly)em.call(ly,ry)&&Ms(iy,ry,ly[ry])}),hb=Mc(function(iy,ly){Ic(ly,jp(ly),iy)}),bb=Mc(function(iy,ly,ry,ny){Ic(ly,jp(ly),iy,ny)}),yb=Mc(function(iy,ly,ry,ny){Ic(ly,Vp(ly),iy,ny)}),vb=rg(Ps),wb=zd(function(iy){return iy.push(Ua,eg),ia(bb,Ua,iy)}),xb=zd(function(iy){return iy.push(Ua,tg),ia(Vb,Ua,iy)}),Cb=zc(function(iy,ly,ry){iy[ly]=ry},Fp(Lp)),Sb=zc(function(iy,ly,ry){em.call(iy,ly)?iy[ly].push(ry):iy[ly]=[ry]},cg),_b=zd(md),Ab=Mc(function(iy,ly,ry){Fd(iy,ly,ry)}),Vb=Mc(function(iy,ly,ry,ny){Fd(iy,ly,ry,ny)}),jb=rg(function(iy,ly){var ry={};if(null==iy)return ry;var ny=!1;ly=pa(ly,function(oy){return oy=yc(oy,iy),ny||(ny=1<oy.length),oy}),Ic(iy,sg(iy),ry),ny&&(ry=Ws(ry,7,ag));for(var sy=ly.length;sy--;)dc(ry,ly[sy]);return ry}),Ib=rg(function(iy,ly){return null==iy?{}:$d(iy,ly)}),kb=Xc(Vp),Eb=Xc(jp),Tb=Rc(function(iy,ly,ry){return ly=ly.toLowerCase(),iy+(ry?Ep(ly):ly)}),Mb=Rc(function(iy,ly,ry){return iy+(ry?'-':'')+ly.toLowerCase()}),Fb=Rc(function(iy,ly,ry){return iy+(ry?' ':'')+ly.toLowerCase()}),Lb=$c('toLowerCase'),Ob=Rc(function(iy,ly,ry){return iy+(ry?'_':'')+ly.toLowerCase()}),$b=Rc(function(iy,ly,ry){return iy+(ry?' ':'')+Nb(ly)}),Rb=Rc(function(iy,ly,ry){return iy+(ry?' ':'')+ly.toUpperCase()}),Nb=$c('toUpperCase'),Pb=zd(function(iy,ly){try{return ia(iy,Ua,ly)}catch(ry){return rp(ry)?ry:new zp(ry)}}),Db=rg(function(iy,ly){return ra(ly,function(ry){ry=kg(ry),Ns(iy,ry,Uh(iy[ry],iy))}),iy}),qb=qc(),Wb=qc(!0),zb=zd(function(iy,ly){return function(ry){return md(ry,iy,ly)}}),Bb=zd(function(iy,ly){return function(ry){return md(iy,ry,ly)}}),Ub=Uc(pa),Hb=Uc(oa),Gb=Uc(ba),Qb=Qc(),Jb=Qc(!0),Yb=Bc(function(iy,ly){return iy+ly},0),Kb=Kc('ceil'),Xb=Bc(function(iy,ly){return iy/ly},1),Zb=Kc('floor'),ey=Bc(function(iy,ly){return iy*ly},1),ty=Kc('round'),ay=Bc(function(iy,ly){return iy-ly},0);return ys.after=function(iy,ly){if('function'!=typeof ly)throw new Jp('Expected a function');return iy=vp(iy),function(){if(1>--iy)return ly.apply(this,arguments)}},ys.ary=Qg,ys.assign=fb,ys.assignIn=hb,ys.assignInWith=bb,ys.assignWith=yb,ys.at=vb,ys.before=Jg,ys.bind=Uh,ys.bindAll=Db,ys.bindKey=Hh,ys.castArray=function(){if(!arguments.length)return[];var iy=arguments[0];return ib(iy)?iy:[iy]},ys.chain=Wg,ys.chunk=function(iy,ly,ry){if(ly=(ry?wg(iy,ly,ry):ly===Ua)?1:Tm(vp(ly),0),ry=null==iy?0:iy.length,!ry||1>ly)return[];for(var ny=0,sy=0,oy=qp(_m(ry/ly));ny<ry;)oy[sy++]=Qd(iy,ny,ny+=ly);return oy},ys.compact=function(iy){for(var ly=-1,ry=null==iy?0:iy.length,ny=0,sy=[],oy;++ly<ry;)oy=iy[ly],oy&&(sy[ny++]=oy);return sy},ys.concat=function(){var iy=arguments.length;if(!iy)return[];for(var ly=qp(iy-1),ry=arguments[0];iy--;)ly[iy-1]=arguments[iy];return ma(ib(ry)?jc(ry):[ry],Ys(ly,1))},ys.cond=function(iy){var ly=null==iy?0:iy.length,ry=cg();return iy=ly?pa(iy,function(ny){if('function'!=typeof ny[1])throw new Jp('Expected a function');return[ry(ny[0]),ny[1]]}):[],zd(function(ny){for(var sy=-1,oy;++sy<ly;)if(oy=iy[sy],ia(oy[0],this,ny))return ia(oy[1],this,ny)})},ys.conforms=function(iy){return zs(Ws(iy,1))},ys.constant=Fp,ys.countBy=$h,ys.create=function(iy,ly){var ry=Zm(iy);return null==ly?ry:Os(ry,ly)},ys.curry=Yg,ys.curryRight=Kg,ys.debounce=Xg,ys.defaults=wb,ys.defaultsDeep=xb,ys.defer=Gh,ys.delay=Qh,ys.difference=yh,ys.differenceBy=vh,ys.differenceWith=wh,ys.drop=function(iy,ly,ry){var ny=null==iy?0:iy.length;return ny?(ly=ry||ly===Ua?1:vp(ly),Qd(iy,0>ly?0:ly,ny)):[]},ys.dropRight=function(iy,ly,ry){var ny=null==iy?0:iy.length;return ny?(ly=ry||ly===Ua?1:vp(ly),ly=ny-ly,Qd(iy,0,0>ly?0:ly)):[]},ys.dropRightWhile=function(iy,ly){return iy&&iy.length?cc(iy,cg(ly,3),!0,!0):[]},ys.dropWhile=function(iy,ly){return iy&&iy.length?cc(iy,cg(ly,3),!0):[]},ys.fill=function(iy,ly,ry,ny){var sy=null==iy?0:iy.length;if(!sy)return[];for(ry&&'number'!=typeof ry&&wg(iy,ly,ry)&&(ry=0,ny=sy),sy=iy.length,ry=vp(ry),0>ry&&(ry=-ry>sy?0:sy+ry),ny=ny===Ua||ny>sy?sy:vp(ny),0>ny&&(ny+=sy),ny=ry>ny?0:wp(ny);ry<ny;)iy[ry++]=ly;return iy},ys.filter=function(iy,ly){return(ib(iy)?da:Js)(iy,cg(ly,3))},ys.flatMap=function(iy,ly){return Ys(Gg(iy,ly),1)},ys.flatMapDeep=function(iy,ly){return Ys(Gg(iy,ly),Ha)},ys.flatMapDepth=function(iy,ly,ry){return ry=ry===Ua?1:vp(ry),Ys(Gg(iy,ly),ry)},ys.flatten=Og,ys.flattenDeep=function(iy){return(null==iy?0:iy.length)?Ys(iy,Ha):[]},ys.flattenDepth=function(iy,ly){return null!=iy&&iy.length?(ly=ly===Ua?1:vp(ly),Ys(iy,ly)):[]},ys.flip=function(iy){return Zc(iy,512)},ys.flow=qb,ys.flowRight=Wb,ys.fromPairs=function(iy){for(var ly=-1,ry=null==iy?0:iy.length,ny={},sy;++ly<ry;)sy=iy[ly],ny[sy[0]]=sy[1];return ny},ys.functions=function(iy){return null==iy?[]:Zs(iy,Vp(iy))},ys.functionsIn=function(iy){return null==iy?[]:Zs(iy,jp(iy))},ys.groupBy=Ph,ys.initial=function(iy){return(null==iy?0:iy.length)?Qd(iy,0,-1):[]},ys.intersection=xh,ys.intersectionBy=Ch,ys.intersectionWith=Sh,ys.invert=Cb,ys.invertBy=Sb,ys.invokeMap=Dh,ys.iteratee=Op,ys.keyBy=qh,ys.keys=Vp,ys.keysIn=jp,ys.map=Gg,ys.mapKeys=function(iy,ly){var ry={};return ly=cg(ly,3),Ks(iy,function(ny,sy,oy){Ns(ry,ly(ny,sy,oy),ny)}),ry},ys.mapValues=function(iy,ly){var ry={};return ly=cg(ly,3),Ks(iy,function(ny,sy,oy){Ns(ry,sy,ly(ny,sy,oy))}),ry},ys.matches=function(iy){return Td(Ws(iy,1))},ys.matchesProperty=function(iy,ly){return Md(iy,Ws(ly,1))},ys.memoize=Zg,ys.merge=Ab,ys.mergeWith=Vb,ys.method=zb,ys.methodOf=Bb,ys.mixin=$p,ys.negate=ep,ys.nthArg=function(iy){return iy=vp(iy),zd(function(ly){return Ld(ly,iy)})},ys.omit=jb,ys.omitBy=function(iy,ly){return Ip(iy,ep(cg(ly)))},ys.once=function(iy){return Jg(2,iy)},ys.orderBy=function(iy,ly,ry,ny){return null==iy?[]:(ib(ly)||(ly=null==ly?[]:[ly]),ry=ny?Ua:ry,ib(ry)||(ry=null==ry?[]:[ry]),Od(iy,ly,ry))},ys.over=Ub,ys.overArgs=Jh,ys.overEvery=Hb,ys.overSome=Gb,ys.partial=Yh,ys.partialRight=Kh,ys.partition=Wh,ys.pick=Ib,ys.pickBy=Ip,ys.property=Np,ys.propertyOf=function(iy){return function(ly){return null==iy?Ua:ad(iy,ly)}},ys.pull=_h,ys.pullAll=Ng,ys.pullAllBy=function(iy,ly,ry){return iy&&iy.length&&ly&&ly.length?Pd(iy,ly,cg(ry,2)):iy},ys.pullAllWith=function(iy,ly,ry){return iy&&iy.length&&ly&&ly.length?Pd(iy,ly,Ua,ry):iy},ys.pullAt=Ah,ys.range=Qb,ys.rangeRight=Jb,ys.rearg=Xh,ys.reject=function(iy,ly){return(ib(iy)?da:Js)(iy,ep(cg(ly,3)))},ys.remove=function(iy,ly){var ry=[];if(!iy||!iy.length)return ry;var ny=-1,sy=[],oy=iy.length;for(ly=cg(ly,3);++ny<oy;){var dy=iy[ny];ly(dy,ny,iy)&&(ry.push(dy),sy.push(ny))}return Dd(iy,sy),ry},ys.rest=function(iy,ly){if('function'!=typeof iy)throw new Jp('Expected a function');return ly=ly===Ua?ly:vp(ly),zd(iy,ly)},ys.reverse=Pg,ys.sampleSize=function(iy,ly,ry){return ly=(ry?wg(iy,ly,ry):ly===Ua)?1:vp(ly),(ib(iy)?ks:Ud)(iy,ly)},ys.set=function(iy,ly,ry){return null==iy?iy:Hd(iy,ly,ry)},ys.setWith=function(iy,ly,ry,ny){return ny='function'==typeof ny?ny:Ua,null==iy?iy:Hd(iy,ly,ry,ny)},ys.shuffle=function(iy){return(ib(iy)?Es:Gd)(iy)},ys.slice=function(iy,ly,ry){var ny=null==iy?0:iy.length;return ny?(ry&&'number'!=typeof ry&&wg(iy,ly,ry)?(ly=0,ry=ny):(ly=null==ly?0:vp(ly),ry=ry===Ua?ny:vp(ry)),Qd(iy,ly,ry)):[]},ys.sortBy=zh,ys.sortedUniq=function(iy){return iy&&iy.length?Xd(iy):[]},ys.sortedUniqBy=function(iy,ly){return iy&&iy.length?Xd(iy,cg(ly,2)):[]},ys.split=function(iy,ly,ry){return ry&&'number'!=typeof ry&&wg(iy,ly,ry)&&(ly=ry=Ua),ry=ry===Ua?4294967295:ry>>>0,ry?(iy=Sp(iy))&&('string'==typeof ly||null!=ly&&!db(ly))&&(ly=ac(ly),!ly&&Nl.test(iy))?wc(Ba(iy),0,ry):iy.split(ly,ry):[]},ys.spread=function(iy,ly){if('function'!=typeof iy)throw new Jp('Expected a function');return ly=null==ly?0:Tm(vp(ly),0),zd(function(ry){var ny=ry[ly];return ry=wc(ry,0,ly),ny&&ma(ry,ny),ia(iy,this,ry)})},ys.tail=function(iy){var ly=null==iy?0:iy.length;return ly?Qd(iy,1,ly):[]},ys.take=function(iy,ly,ry){return iy&&iy.length?(ly=ry||ly===Ua?1:vp(ly),Qd(iy,0,0>ly?0:ly)):[]},ys.takeRight=function(iy,ly,ry){var ny=null==iy?0:iy.length;return ny?(ly=ry||ly===Ua?1:vp(ly),ly=ny-ly,Qd(iy,0>ly?0:ly,ny)):[]},ys.takeRightWhile=function(iy,ly){return iy&&iy.length?cc(iy,cg(ly,3),!1,!0):[]},ys.takeWhile=function(iy,ly){return iy&&iy.length?cc(iy,cg(ly,3)):[]},ys.tap=function(iy,ly){return ly(iy),iy},ys.throttle=function(iy,ly,ry){var ny=!0,sy=!0;if('function'!=typeof iy)throw new Jp('Expected a function');return cp(ry)&&(ny='leading'in ry?!!ry.leading:ny,sy='trailing'in ry?!!ry.trailing:sy),Xg(iy,ly,{leading:ny,maxWait:ly,trailing:sy})},ys.thru=zg,ys.toArray=bp,ys.toPairs=kb,ys.toPairsIn=Eb,ys.toPath=function(iy){return ib(iy)?pa(iy,kg):hp(iy)?[iy]:jc(bh(Sp(iy)))},ys.toPlainObject=Cp,ys.transform=function(iy,ly,ry){var ny=ib(iy),sy=ny||nb(iy)||gb(iy);if(ly=cg(ly,4),null==ry){var oy=iy&&iy.constructor;ry=sy?ny?new oy:[]:cp(iy)&&np(oy)?Zm(gm(iy)):{}}return(sy?ra:Ks)(iy,function(dy,cy,uy){return ly(ry,dy,cy,uy)}),ry},ys.unary=function(iy){return Qg(iy,1)},ys.union=Vh,ys.unionBy=jh,ys.unionWith=Ih,ys.uniq=function(iy){return iy&&iy.length?lc(iy):[]},ys.uniqBy=function(iy,ly){return iy&&iy.length?lc(iy,cg(ly,2)):[]},ys.uniqWith=function(iy,ly){return ly='function'==typeof ly?ly:Ua,iy&&iy.length?lc(iy,Ua,ly):[]},ys.unset=function(iy,ly){return null==iy||dc(iy,ly)},ys.unzip=Dg,ys.unzipWith=qg,ys.update=function(iy,ly,ry){return null==iy?iy:Hd(iy,ly,bc(ry)(ad(iy,ly)),void 0)},ys.updateWith=function(iy,ly,ry,ny){return ny='function'==typeof ny?ny:Ua,null!=iy&&(iy=Hd(iy,ly,bc(ry)(ad(iy,ly)),ny)),iy},ys.values=kp,ys.valuesIn=function(iy){return null==iy?[]:Fa(iy,jp(iy))},ys.without=kh,ys.words=Mp,ys.wrap=function(iy,ly){return Yh(bc(ly),iy)},ys.xor=Eh,ys.xorBy=Th,ys.xorWith=Mh,ys.zip=Fh,ys.zipObject=function(iy,ly){return fc(iy||[],ly||[],Ms)},ys.zipObjectDeep=function(iy,ly){return fc(iy||[],ly||[],Hd)},ys.zipWith=Lh,ys.entries=kb,ys.entriesIn=Eb,ys.extend=hb,ys.extendWith=bb,$p(ys,ys),ys.add=Yb,ys.attempt=Pb,ys.camelCase=Tb,ys.capitalize=Ep,ys.ceil=Kb,ys.clamp=function(iy,ly,ry){return ry===Ua&&(ry=ly,ly=Ua),ry!==Ua&&(ry=xp(ry),ry=ry===ry?ry:0),ly!==Ua&&(ly=xp(ly),ly=ly===ly?ly:0),Ds(xp(iy),ly,ry)},ys.clone=function(iy){return Ws(iy,4)},ys.cloneDeep=function(iy){return Ws(iy,5)},ys.cloneDeepWith=function(iy,ly){return ly='function'==typeof ly?ly:Ua,Ws(iy,5,ly)},ys.cloneWith=function(iy,ly){return ly='function'==typeof ly?ly:Ua,Ws(iy,4,ly)},ys.conformsTo=function(iy,ly){return null==ly||Bs(iy,ly,Vp(ly))},ys.deburr=Tp,ys.defaultTo=function(iy,ly){return null==iy||iy!==iy?ly:iy},ys.divide=Xb,ys.endsWith=function(iy,ly,ry){iy=Sp(iy),ly=ac(ly);var ny=iy.length,ny=ry=ry===Ua?ny:Ds(vp(ry),0,ny);return ry-=ly.length,0<=ry&&iy.slice(ry,ny)==ly},ys.eq=ap,ys.escape=function(iy){return(iy=Sp(iy))&&al.test(iy)?iy.replace(Za,gs):iy},ys.escapeRegExp=function(iy){return(iy=Sp(iy))&&ul.test(iy)?iy.replace(cl,'\\$&'):iy},ys.every=function(iy,ly,ry){var ny=ib(iy)?oa:Gs;return ry&&wg(iy,ly,ry)&&(ly=Ua),ny(iy,cg(ly,3))},ys.find=Rh,ys.findIndex=Fg,ys.findKey=function(iy,ly){return ya(iy,cg(ly,3),Ks)},ys.findLast=Nh,ys.findLastIndex=Lg,ys.findLastKey=function(iy,ly){return ya(iy,cg(ly,3),Xs)},ys.floor=Zb,ys.forEach=Ug,ys.forEachRight=Hg,ys.forIn=function(iy,ly){return null==iy?iy:ah(iy,cg(ly,3),jp)},ys.forInRight=function(iy,ly){return null==iy?iy:ih(iy,cg(ly,3),jp)},ys.forOwn=function(iy,ly){return iy&&Ks(iy,cg(ly,3))},ys.forOwnRight=function(iy,ly){return iy&&Xs(iy,cg(ly,3))},ys.get=_p,ys.gt=Zh,ys.gte=eb,ys.has=function(iy,ly){return null!=iy&&mg(iy,ly,od)},ys.hasIn=Ap,ys.head=$g,ys.identity=Lp,ys.includes=function(iy,ly,ry,ny){return iy=ip(iy)?iy:kp(iy),ry=ry&&!ny?vp(ry):0,ny=iy.length,0>ry&&(ry=Tm(ny+ry,0)),mp(iy)?ry<=ny&&-1<iy.indexOf(ly,ry):!!ny&&-1<xa(iy,ly,ry)},ys.indexOf=function(iy,ly,ry){var ny=null==iy?0:iy.length;return ny?(ry=null==ry?0:vp(ry),0>ry&&(ry=Tm(ny+ry,0)),xa(iy,ly,ry)):-1},ys.inRange=function(iy,ly,ry){return ly=yp(ly),ry===Ua?(ry=ly,ly=0):ry=yp(ry),iy=xp(iy),iy>=Mm(ly,ry)&&iy<Tm(ly,ry)},ys.invoke=_b,ys.isArguments=ab,ys.isArray=ib,ys.isArrayBuffer=rb,ys.isArrayLike=ip,ys.isArrayLikeObject=lp,ys.isBoolean=function(iy){return!0===iy||!1===iy||up(iy)&&'[object Boolean]'==nd(iy)},ys.isBuffer=nb,ys.isDate=sb,ys.isElement=function(iy){return up(iy)&&1===iy.nodeType&&!pp(iy)},ys.isEmpty=function(iy){if(null==iy)return!0;if(ip(iy)&&(ib(iy)||'string'==typeof iy||'function'==typeof iy.splice||nb(iy)||gb(iy)||ab(iy)))return!iy.length;var ly=uh(iy);if('[object Map]'==ly||'[object Set]'==ly)return!iy.size;if(Sg(iy))return!Id(iy).length;for(var ry in iy)if(em.call(iy,ry))return!1;return!0},ys.isEqual=function(iy,ly){return vd(iy,ly)},ys.isEqualWith=function(iy,ly,ry){var ny=(ry='function'==typeof ry?ry:Ua)?ry(iy,ly):Ua;return ny===Ua?vd(iy,ly,Ua,ry):!!ny},ys.isError=rp,ys.isFinite=function(iy){return'number'==typeof iy&&Im(iy)},ys.isFunction=np,ys.isInteger=sp,ys.isLength=op,ys.isMap=ob,ys.isMatch=function(iy,ly){return iy===ly||xd(iy,ly,gg(ly))},ys.isMatchWith=function(iy,ly,ry){return ry='function'==typeof ry?ry:Ua,xd(iy,ly,gg(ly),ry)},ys.isNaN=function(iy){return gp(iy)&&iy!=+iy},ys.isNative=function(iy){if(gh(iy))throw new zp('Unsupported core-js use. Try https://npms.io/search?q=ponyfill.');return Cd(iy)},ys.isNil=function(iy){return null==iy},ys.isNull=function(iy){return null===iy},ys.isNumber=gp,ys.isObject=cp,ys.isObjectLike=up,ys.isPlainObject=pp,ys.isRegExp=db,ys.isSafeInteger=function(iy){return sp(iy)&&-9007199254740991<=iy&&9007199254740991>=iy},ys.isSet=ub,ys.isString=mp,ys.isSymbol=hp,ys.isTypedArray=gb,ys.isUndefined=function(iy){return iy===Ua},ys.isWeakMap=function(iy){return up(iy)&&'[object WeakMap]'==uh(iy)},ys.isWeakSet=function(iy){return up(iy)&&'[object WeakSet]'==nd(iy)},ys.join=function(iy,ly){return null==iy?'':km.call(iy,ly)},ys.kebabCase=Mb,ys.last=Rg,ys.lastIndexOf=function(iy,ly,ry){var ny=null==iy?0:iy.length;if(!ny)return-1;var sy=ny;if(ry!==Ua&&(sy=vp(ry),sy=0>sy?Tm(ny+sy,0):Mm(sy,ny-1)),ly===ly){for(ry=sy+1;ry--&&iy[ry]!==ly;);iy=ry}else iy=wa(iy,Sa,sy,!0);return iy},ys.lowerCase=Fb,ys.lowerFirst=Lb,ys.lt=pb,ys.lte=mb,ys.max=function(iy){return iy&&iy.length?Qs(iy,Lp,sd):Ua},ys.maxBy=function(iy,ly){return iy&&iy.length?Qs(iy,cg(ly,2),sd):Ua},ys.mean=function(iy){return _a(iy,Lp)},ys.meanBy=function(iy,ly){return _a(iy,cg(ly,2))},ys.min=function(iy){return iy&&iy.length?Qs(iy,Lp,kd):Ua},ys.minBy=function(iy,ly){return iy&&iy.length?Qs(iy,cg(ly,2),kd):Ua},ys.stubArray=Pp,ys.stubFalse=Dp,ys.stubObject=function(){return{}},ys.stubString=function(){return''},ys.stubTrue=function(){return!0},ys.multiply=ey,ys.nth=function(iy,ly){return iy&&iy.length?Ld(iy,vp(ly)):Ua},ys.noConflict=function(){return Jl._===this&&(Jl._=rm),this},ys.noop=Rp,ys.now=Bh,ys.pad=function(iy,ly,ry){iy=Sp(iy);var ny=(ly=vp(ly))?za(iy):0;return!ly||ny>=ly?iy:(ly=(ly-ny)/2,Hc(Am(ly),ry)+iy+Hc(_m(ly),ry))},ys.padEnd=function(iy,ly,ry){iy=Sp(iy);var ny=(ly=vp(ly))?za(iy):0;return ly&&ny<ly?iy+Hc(ly-ny,ry):iy},ys.padStart=function(iy,ly,ry){iy=Sp(iy);var ny=(ly=vp(ly))?za(iy):0;return ly&&ny<ly?Hc(ly-ny,ry)+iy:iy},ys.parseInt=function(iy,ly,ry){return ry||null==ly?ly=0:ly&&(ly=+ly),Lm(Sp(iy).replace(pl,''),ly||0)},ys.random=function(iy,ly,ry){if(ry&&'boolean'!=typeof ry&&wg(iy,ly,ry)&&(ly=ry=Ua),ry===Ua&&('boolean'==typeof ly?(ry=ly,ly=Ua):'boolean'==typeof iy&&(ry=iy,iy=Ua)),iy===Ua&&ly===Ua?(iy=0,ly=1):(iy=yp(iy),ly===Ua?(ly=iy,iy=0):ly=yp(ly)),iy>ly){var ny=iy;iy=ly,ly=ny}return ry||iy%1||ly%1?(ry=Om(),Mm(iy+ry*(ly-iy+Ul('1e-'+((ry+'').length-1))),ly)):qd(iy,ly)},ys.reduce=function(iy,ly,ry){var ny=ib(iy)?fa:ja,sy=3>arguments.length;return ny(iy,cg(ly,4),ry,sy,eh)},ys.reduceRight=function(iy,ly,ry){var ny=ib(iy)?ha:ja,sy=3>arguments.length;return ny(iy,cg(ly,4),ry,sy,th)},ys.repeat=function(iy,ly,ry){return ly=(ry?wg(iy,ly,ry):ly===Ua)?1:vp(ly),Wd(Sp(iy),ly)},ys.replace=function(){var iy=arguments,ly=Sp(iy[0]);return 3>iy.length?ly:ly.replace(iy[1],iy[2])},ys.result=function(iy,ly,ry){ly=yc(ly,iy);var ny=-1,sy=ly.length;for(sy||(sy=1,iy=Ua);++ny<sy;){var oy=null==iy?Ua:iy[kg(ly[ny])];oy===Ua&&(ny=sy,oy=ry),iy=np(oy)?oy.call(iy):oy}return iy},ys.round=ty,ys.runInContext=hs,ys.sample=function(iy){return(ib(iy)?Is:Bd)(iy)},ys.size=function(iy){if(null==iy)return 0;if(ip(iy))return mp(iy)?za(iy):iy.length;var ly=uh(iy);return'[object Map]'==ly||'[object Set]'==ly?iy.size:Id(iy).length},ys.snakeCase=Ob,ys.some=function(iy,ly,ry){var ny=ib(iy)?ba:Jd;return ry&&wg(iy,ly,ry)&&(ly=Ua),ny(iy,cg(ly,3))},ys.sortedIndex=function(iy,ly){return Yd(iy,ly)},ys.sortedIndexBy=function(iy,ly,ry){return Kd(iy,ly,cg(ry,2))},ys.sortedIndexOf=function(iy,ly){var ry=null==iy?0:iy.length;if(ry){var ny=Yd(iy,ly);if(ny<ry&&ap(iy[ny],ly))return ny}return-1},ys.sortedLastIndex=function(iy,ly){return Yd(iy,ly,!0)},ys.sortedLastIndexBy=function(iy,ly,ry){return Kd(iy,ly,cg(ry,2),!0)},ys.sortedLastIndexOf=function(iy,ly){if(null==iy?0:iy.length){var ry=Yd(iy,ly,!0)-1;if(ap(iy[ry],ly))return ry}return-1},ys.startCase=$b,ys.startsWith=function(iy,ly,ry){return iy=Sp(iy),ry=null==ry?0:Ds(vp(ry),0,iy.length),ly=ac(ly),iy.slice(ry,ry+ly.length)==ly},ys.subtract=ay,ys.sum=function(iy){return iy&&iy.length?ka(iy,Lp):0},ys.sumBy=function(iy,ly){return iy&&iy.length?ka(iy,cg(ly,2)):0},ys.template=function(iy,ly,ry){var ny=ys.templateSettings;ry&&wg(iy,ly,ry)&&(ly=Ua),iy=Sp(iy),ly=bb({},ly,ny,eg),ry=bb({},ly.imports,ny.imports,eg);var dy=Vp(ry),cy=Fa(ry,dy),uy=0,sy,oy;ry=ly.interpolate||kl;var gy='__p+=\'';ry=Gp((ly.escape||kl).source+'|'+ry.source+'|'+(ry===rl?xl:kl).source+'|'+(ly.evaluate||kl).source+'|$','g');var py='sourceURL'in ly?'//# sourceURL='+ly.sourceURL+'\n':'';if(iy.replace(ry,function(my,fy,hy,by,vy,wy){return hy||(hy=by),gy+=iy.slice(uy,wy).replace(El,Ra),fy&&(sy=!0,gy+='\'+__e('+fy+')+\''),vy&&(oy=!0,gy+='\';'+vy+';\n__p+=\''),hy&&(gy+='\'+((__t=('+hy+'))==null?\'\':__t)+\''),uy=wy+my.length,my}),gy+='\';',(ly=ly.variable)||(gy='with(obj){'+gy+'}'),gy=(oy?gy.replace(Ja,''):gy).replace(Ya,'$1').replace(Ka,'$1;'),gy='function('+(ly||'obj')+'){'+(ly?'':'obj||(obj={});')+'var __t,__p=\'\''+(sy?',__e=_.escape':'')+(oy?',__j=Array.prototype.join;function print(){__p+=__j.call(arguments,\'\')}':';')+gy+'return __p}',ly=Pb(function(){return Bp(dy,py+'return '+gy).apply(Ua,cy)}),ly.source=gy,rp(ly))throw ly;return ly},ys.times=function(iy,ly){if(iy=vp(iy),1>iy||9007199254740991<iy)return[];var ry=4294967295,ny=Mm(iy,4294967295);for(ly=cg(ly),iy-=4294967295,ny=Ea(ny,ly);++ry<iy;)ly(ry);return ny},ys.toFinite=yp,ys.toInteger=vp,ys.toLength=wp,ys.toLower=function(iy){return Sp(iy).toLowerCase()},ys.toNumber=xp,ys.toSafeInteger=function(iy){return iy?Ds(vp(iy),-9007199254740991,9007199254740991):0===iy?iy:0},ys.toString=Sp,ys.toUpper=function(iy){return Sp(iy).toUpperCase()},ys.trim=function(iy,ly,ry){return(iy=Sp(iy))&&(ry||ly===Ua)?iy.replace(gl,''):iy&&(ly=ac(ly))?(iy=Ba(iy),ry=Ba(ly),ly=Oa(iy,ry),ry=$a(iy,ry)+1,wc(iy,ly,ry).join('')):iy},ys.trimEnd=function(iy,ly,ry){return(iy=Sp(iy))&&(ry||ly===Ua)?iy.replace(ml,''):iy&&(ly=ac(ly))?(iy=Ba(iy),ly=$a(iy,Ba(ly))+1,wc(iy,0,ly).join('')):iy},ys.trimStart=function(iy,ly,ry){return(iy=Sp(iy))&&(ry||ly===Ua)?iy.replace(pl,''):iy&&(ly=ac(ly))?(iy=Ba(iy),ly=Oa(iy,Ba(ly)),wc(iy,ly).join('')):iy},ys.truncate=function(iy,ly){var ry=30,ny='...';if(cp(ly))var sy='separator'in ly?ly.separator:sy,ry='length'in ly?vp(ly.length):ry,ny='omission'in ly?ac(ly.omission):ny;iy=Sp(iy);var oy=iy.length;if(Nl.test(iy))var dy=Ba(iy),oy=dy.length;if(ry>=oy)return iy;if(oy=ry-za(ny),1>oy)return ny;if(ry=dy?wc(dy,0,oy).join(''):iy.slice(0,oy),sy===Ua)return ry+ny;if(dy&&(oy+=ry.length-oy),!db(sy))iy.indexOf(ac(sy),oy)!=oy&&(sy=ry.lastIndexOf(sy),-1<sy&&(ry=ry.slice(0,sy)));else if(iy.slice(oy).search(sy)){var cy=ry;for(sy.global||(sy=Gp(sy.source,Sp(Cl.exec(sy))+'g')),sy.lastIndex=0;dy=sy.exec(cy);)var uy=dy.index;ry=ry.slice(0,uy===Ua?oy:uy)}return ry+ny},ys.unescape=function(iy){return(iy=Sp(iy))&&tl.test(iy)?iy.replace(Xa,ps):iy},ys.uniqueId=function(iy){var ly=++tm;return Sp(iy)+ly},ys.upperCase=Rb,ys.upperFirst=Nb,ys.each=Ug,ys.eachRight=Hg,ys.first=$g,$p(ys,function(){var iy={};return Ks(ys,function(ly,ry){em.call(ys.prototype,ry)||(iy[ry]=ly)}),iy}(),{chain:!1}),ys.VERSION='4.17.4',ra('bind bindKey curry curryRight partial partialRight'.split(' '),function(iy){ys[iy].placeholder=ys}),ra(['drop','take'],function(iy,ly){xs.prototype[iy]=function(ry){ry=ry===Ua?1:Tm(vp(ry),0);var ny=this.__filtered__&&!ly?new xs(this):this.clone();return ny.__filtered__?ny.__takeCount__=Mm(ry,ny.__takeCount__):ny.__views__.push({size:Mm(ry,4294967295),type:iy+(0>ny.__dir__?'Right':'')}),ny},xs.prototype[iy+'Right']=function(ry){return this.reverse()[iy](ry).reverse()}}),ra(['filter','map','takeWhile'],function(iy,ly){var ry=ly+1;xs.prototype[iy]=function(sy){var oy=this.clone();return oy.__iteratees__.push({iteratee:cg(sy,3),type:ry}),oy.__filtered__=oy.__filtered__||1==ry||3==ry,oy}}),ra(['head','last'],function(iy,ly){var ry='take'+(ly?'Right':'');xs.prototype[iy]=function(){return this[ry](1).value()[0]}}),ra(['initial','tail'],function(iy,ly){var ry='drop'+(ly?'':'Right');xs.prototype[iy]=function(){return this.__filtered__?new xs(this):this[ry](1)}}),xs.prototype.compact=function(){return this.filter(Lp)},xs.prototype.find=function(iy){return this.filter(iy).head()},xs.prototype.findLast=function(iy){return this.reverse().find(iy)},xs.prototype.invokeMap=zd(function(iy,ly){return'function'==typeof iy?new xs(this):this.map(function(ry){return md(ry,iy,ly)})}),xs.prototype.reject=function(iy){return this.filter(ep(cg(iy)))},xs.prototype.slice=function(iy,ly){iy=vp(iy);var ry=this;return ry.__filtered__&&(0<iy||0>ly)?new xs(ry):(0>iy?ry=ry.takeRight(-iy):iy&&(ry=ry.drop(iy)),ly!==Ua&&(ly=vp(ly),ry=0>ly?ry.dropRight(-ly):ry.take(ly-iy)),ry)},xs.prototype.takeRightWhile=function(iy){return this.reverse().takeWhile(iy).reverse()},xs.prototype.toArray=function(){return this.take(4294967295)},Ks(xs.prototype,function(iy,ly){var ry=/^(?:filter|find|map|reject)|While$/.test(ly),ny=/^(?:head|last)$/.test(ly),sy=ys[ny?'take'+('last'==ly?'Right':''):ly],oy=ny||/^find/.test(ly);sy&&(ys.prototype[ly]=function(){function dy(by){return by=sy.apply(ys,ma([by],uy)),ny&&fy?by[0]:by}var cy=this.__wrapped__,uy=ny?[1]:arguments,gy=cy instanceof xs,py=uy[0],my=gy||ib(cy);my&&ry&&'function'==typeof py&&1!=py.length&&(gy=my=!1);var fy=this.__chain__,hy=!!this.__actions__.length,py=oy&&!fy,gy=gy&&!hy;return!oy&&my?(cy=gy?cy:new xs(this),cy=iy.apply(cy,uy),cy.__actions__.push({func:zg,args:[dy],thisArg:Ua}),new ws(cy,fy)):py&&gy?iy.apply(this,uy):(cy=this.thru(dy),py?ny?cy.value()[0]:cy.value():cy)})}),ra('pop push shift sort splice unshift'.split(' '),function(iy){var ly=Yp[iy],ry=/^(?:push|sort|unshift)$/.test(iy)?'tap':'thru',ny=/^(?:pop|shift)$/.test(iy);ys.prototype[iy]=function(){var sy=arguments;if(ny&&!this.__chain__){var oy=this.value();return ly.apply(ib(oy)?oy:[],sy)}return this[ry](function(dy){return ly.apply(ib(dy)?dy:[],sy)})}}),Ks(xs.prototype,function(iy,ly){var ry=ys[ly];if(ry){var ny=ry.name+'';(Bm[ny]||(Bm[ny]=[])).push({name:ly,func:ry})}}),Bm[Wc(Ua,2).name]=[{name:'wrapper',func:Ua}],xs.prototype.clone=function(){var iy=new xs(this.__wrapped__);return iy.__actions__=jc(this.__actions__),iy.__dir__=this.__dir__,iy.__filtered__=this.__filtered__,iy.__iteratees__=jc(this.__iteratees__),iy.__takeCount__=this.__takeCount__,iy.__views__=jc(this.__views__),iy},xs.prototype.reverse=function(){if(this.__filtered__){var iy=new xs(this);iy.__dir__=-1,iy.__filtered__=!0}else iy=this.clone(),iy.__dir__*=-1;return iy},xs.prototype.value=function(){var ly=this.__wrapped__.value(),ry=this.__dir__,ny=ib(ly),sy=0>ry,oy=ny?ly.length:0,iy;iy=oy;for(var dy=this.__views__,cy=0,uy=-1,gy=dy.length;++uy<gy;){var py=dy[uy],my=py.size;switch(py.type){case'drop':cy+=my;break;case'dropRight':iy-=my;break;case'take':iy=Mm(iy,cy+my);break;case'takeRight':cy=Tm(cy,iy-my);}}if(iy={start:cy,end:iy},dy=iy.start,cy=iy.end,iy=cy-dy,dy=sy?cy:dy-1,cy=this.__iteratees__,uy=cy.length,gy=0,py=Mm(iy,this.__takeCount__),!ny||!sy&&oy==iy&&py==iy)return gc(ly,this.__actions__);ny=[];n:for(;iy--&&gy<py;){for(dy+=ry,sy=-1,oy=ly[dy];++sy<uy;){var fy=cy[sy],my=fy.type,fy=(0,fy.iteratee)(oy);if(2==my)oy=fy;else if(!fy){if(1==my)continue n;break n}}ny[gy++]=oy}return ny},ys.prototype.at=Oh,ys.prototype.chain=function(){return Wg(this)},ys.prototype.commit=function(){return new ws(this.value(),this.__chain__)},ys.prototype.next=function(){this.__values__===Ua&&(this.__values__=bp(this.value()));var iy=this.__index__>=this.__values__.length;return{done:iy,value:iy?Ua:this.__values__[this.__index__++]}},ys.prototype.plant=function(iy){for(var ry=this,ly,ny;ry instanceof vs;){ny=Mg(ry),ny.__index__=0,ny.__values__=Ua,ly?sy.__wrapped__=ny:ly=ny;var sy=ny,ry=ry.__wrapped__}return sy.__wrapped__=iy,ly},ys.prototype.reverse=function(){var iy=this.__wrapped__;return iy instanceof xs?(this.__actions__.length&&(iy=new xs(this)),iy=iy.reverse(),iy.__actions__.push({func:zg,args:[Pg],thisArg:Ua}),new ws(iy,this.__chain__)):this.thru(Pg)},ys.prototype.toJSON=ys.prototype.valueOf=ys.prototype.value=function(){return gc(this.__wrapped__,this.__actions__)},ys.prototype.first=ys.prototype.head,ym&&(ys.prototype[ym]=function(){return this}),ys}();'function'==typeof define&&'object'==typeof define.amd&&define.amd?(Jl._=ms,define(function(){return ms})):Kl?((Kl.exports=ms)._=ms,Yl._=ms):Jl._=ms}.call(this),function(ea){var aa='object'==typeof self&&self.self==self&&self||'object'==typeof global&&global.global==global&&global;if('function'==typeof define&&define.amd)define(['underscore','jquery','exports'],function(ra,na,oa){aa.Backbone=ea(aa,oa,ra,na)});else if('undefined'!=typeof exports){var ia=require('underscore'),la;try{la=require('jquery')}catch(ra){}ea(aa,exports,ia,la)}else aa.Backbone=ea(aa,{},aa._,aa.jQuery||aa.Zepto||aa.ender||aa.$)}(function(ea,aa,ia,la){var ra=ea.Backbone,na=[].slice;aa.VERSION='1.2.1',aa.$=la,aa.noConflict=function(){return ea.Backbone=ra,this},aa.emulateHTTP=!1,aa.emulateJSON=!1;var oa=function(Ba,Ua,Ha){return 1===Ba?function(){return ia[Ua](this[Ha])}:2===Ba?function(Ga){return ia[Ua](this[Ha],Ga)}:3===Ba?function(Ga,Qa){return ia[Ua](this[Ha],Ga,Qa)}:4===Ba?function(Ga,Qa,Ja){return ia[Ua](this[Ha],Ga,Qa,Ja)}:function(){var Ga=na.call(arguments);return Ga.unshift(this[Ha]),ia[Ua].apply(ia,Ga)}},da=function(Ba,Ua,Ha){ia.each(Ua,function(Ga,Qa){ia[Qa]&&(Ba.prototype[Qa]=oa(Ga,Qa,Ha))})},ua=aa.Events={},ga=/\s+/,pa=function(Ba,Ua,Ha,Ga,Qa){var Ja=0,Ya;if(Ha&&'object'==typeof Ha)for(void 0!==Ga&&('context'in Qa)&&void 0===Qa.context&&(Qa.context=Ga),Ya=ia.keys(Ha);Ja<Ya.length;Ja++)Ua=Ba(Ua,Ya[Ja],Ha[Ya[Ja]],Qa);else if(Ha&&ga.test(Ha))for(Ya=Ha.split(ga);Ja<Ya.length;Ja++)Ua=Ba(Ua,Ya[Ja],Ga,Qa);else Ua=Ba(Ua,Ha,Ga,Qa);return Ua};ua.on=function(Ba,Ua,Ha){return ma(this,Ba,Ua,Ha)};var ma=function(Ba,Ua,Ha,Ga,Qa){if(Ba._events=pa(fa,Ba._events||{},Ua,Ha,{context:Ga,ctx:Ba,listening:Qa}),Qa){var Ja=Ba._listeners||(Ba._listeners={});Ja[Qa.id]=Qa}return Ba};ua.listenTo=function(Ba,Ua,Ha){if(!Ba)return this;var Ga=Ba._listenId||(Ba._listenId=ia.uniqueId('l')),Qa=this._listeningTo||(this._listeningTo={}),Ja=Qa[Ga];if(!Ja){var Ya=this._listenId||(this._listenId=ia.uniqueId('l'));Ja=Qa[Ga]={obj:Ba,objId:Ga,id:Ya,listeningTo:Qa,count:0}}return ma(Ba,Ua,Ha,this,Ja),this};var fa=function(Ba,Ua,Ha,Ga){if(Ha){var Qa=Ba[Ua]||(Ba[Ua]=[]),Ja=Ga.context,Ya=Ga.ctx,Ka=Ga.listening;Ka&&Ka.count++,Qa.push({callback:Ha,context:Ja,ctx:Ja||Ya,listening:Ka})}return Ba};ua.off=function(Ba,Ua,Ha){return this._events?(this._events=pa(ha,this._events,Ba,Ua,{context:Ha,listeners:this._listeners}),this):this},ua.stopListening=function(Ba,Ua,Ha){var Ga=this._listeningTo;if(!Ga)return this;for(var Qa=Ba?[Ba._listenId]:ia.keys(Ga),Ja=0,Ya;Ja<Qa.length&&(Ya=Ga[Qa[Ja]],!!Ya);Ja++)Ya.obj.off(Ua,Ha,this);return ia.isEmpty(Ga)&&(this._listeningTo=void 0),this};var ha=function(Ba,Ua,Ha,Ga){if(Ba){var Qa=0,Ya=Ga.context,Ka=Ga.listeners,Ja;if(!Ua&&!Ha&&!Ya){for(var Xa=ia.keys(Ka);Qa<Xa.length;Qa++)Ja=Ka[Xa[Qa]],delete Ka[Ja.id],delete Ja.listeningTo[Ja.objId];return}for(var Za=Ua?[Ua]:ia.keys(Ba);Qa<Za.length;Qa++){Ua=Za[Qa];var tl=Ba[Ua];if(!tl)break;for(var al=[],il=0,ll;il<tl.length;il++)ll=tl[il],Ha&&Ha!==ll.callback&&Ha!==ll.callback._callback||Ya&&Ya!==ll.context?al.push(ll):(Ja=ll.listening,Ja&&0==--Ja.count&&(delete Ka[Ja.id],delete Ja.listeningTo[Ja.objId]));al.length?Ba[Ua]=al:delete Ba[Ua]}if(ia.size(Ba))return Ba}};ua.once=function(Ba,Ua,Ha){var Ga=pa(ba,{},Ba,Ua,ia.bind(this.off,this));return this.on(Ga,void 0,Ha)},ua.listenToOnce=function(Ba,Ua,Ha){var Ga=pa(ba,{},Ua,Ha,ia.bind(this.stopListening,this,Ba));return this.listenTo(Ba,Ga)};var ba=function(Ba,Ua,Ha,Ga){if(Ha){var Qa=Ba[Ua]=ia.once(function(){Ga(Ua,Qa),Ha.apply(this,arguments)});Qa._callback=Ha}return Ba};ua.trigger=function(Ba){if(!this._events)return this;for(var Ua=Math.max(0,arguments.length-1),Ha=Array(Ua),Ga=0;Ga<Ua;Ga++)Ha[Ga]=arguments[Ga+1];return pa(ya,this._events,Ba,void 0,Ha),this};var ya=function(Ba,Ua,Ha,Ga){if(Ba){var Qa=Ba[Ua],Ja=Ba.all;Qa&&Ja&&(Ja=Ja.slice()),Qa&&wa(Qa,Ga),Ja&&wa(Ja,[Ua].concat(Ga))}return Ba},wa=function(Ba,Ua){var Ga=-1,Qa=Ba.length,Ja=Ua[0],Ya=Ua[1],Ka=Ua[2],Ha;switch(Ua.length){case 0:for(;++Ga<Qa;)(Ha=Ba[Ga]).callback.call(Ha.ctx);return;case 1:for(;++Ga<Qa;)(Ha=Ba[Ga]).callback.call(Ha.ctx,Ja);return;case 2:for(;++Ga<Qa;)(Ha=Ba[Ga]).callback.call(Ha.ctx,Ja,Ya);return;case 3:for(;++Ga<Qa;)(Ha=Ba[Ga]).callback.call(Ha.ctx,Ja,Ya,Ka);return;default:for(;++Ga<Qa;)(Ha=Ba[Ga]).callback.apply(Ha.ctx,Ua);}};ua.bind=ua.on,ua.unbind=ua.off,ia.extend(aa,ua);var xa=aa.Model=function(Ba,Ua){var Ha=Ba||{};Ua||(Ua={}),this.cid=ia.uniqueId(this.cidPrefix),this.attributes={},Ua.collection&&(this.collection=Ua.collection),Ua.parse&&(Ha=this.parse(Ha,Ua)||{}),Ha=ia.defaults({},Ha,ia.result(this,'defaults')),this.set(Ha,Ua),this.changed={},this.initialize.apply(this,arguments)};ia.extend(xa.prototype,ua,{changed:null,validationError:null,idAttribute:'id',cidPrefix:'c',initialize:function(){},toJSON:function(){return ia.clone(this.attributes)},sync:function(){return aa.sync.apply(this,arguments)},get:function(Ba){return this.attributes[Ba]},escape:function(Ba){return ia.escape(this.get(Ba))},has:function(Ba){return null!=this.get(Ba)},matches:function(Ba){return!!ia.iteratee(Ba,this)(this.attributes)},set:function(Ba,Ua,Ha){if(null==Ba)return this;var Ga;if('object'==typeof Ba?(Ga=Ba,Ha=Ua):(Ga={})[Ba]=Ua,Ha||(Ha={}),!this._validate(Ga,Ha))return!1;var Qa=Ha.unset,Ja=Ha.silent,Ya=[],Ka=this._changing;this._changing=!0,Ka||(this._previousAttributes=ia.clone(this.attributes),this.changed={});var Xa=this.attributes,Za=this.changed,tl=this._previousAttributes;for(var al in this.idAttribute in Ga&&(this.id=Ga[this.idAttribute]),Ga)Ua=Ga[al],ia.isEqual(Xa[al],Ua)||Ya.push(al),ia.isEqual(tl[al],Ua)?delete Za[al]:Za[al]=Ua,Qa?delete Xa[al]:Xa[al]=Ua;if(!Ja){Ya.length&&(this._pending=Ha);for(var il=0;il<Ya.length;il++)this.trigger('change:'+Ya[il],this,Xa[Ya[il]],Ha)}if(Ka)return this;if(!Ja)for(;this._pending;)Ha=this._pending,this._pending=!1,this.trigger('change',this,Ha);return this._pending=!1,this._changing=!1,this},unset:function(Ba,Ua){return this.set(Ba,void 0,ia.extend({},Ua,{unset:!0}))},clear:function(Ba){var Ua={};for(var Ha in this.attributes)Ua[Ha]=void 0;return this.set(Ua,ia.extend({},Ba,{unset:!0}))},hasChanged:function(Ba){return null==Ba?!ia.isEmpty(this.changed):ia.has(this.changed,Ba)},changedAttributes:function(Ba){if(!Ba)return!!this.hasChanged()&&ia.clone(this.changed);var Ua=this._changing?this._previousAttributes:this.attributes,Ha={};for(var Ga in Ba){var Qa=Ba[Ga];ia.isEqual(Ua[Ga],Qa)||(Ha[Ga]=Qa)}return!!ia.size(Ha)&&Ha},previous:function(Ba){return null!=Ba&&this._previousAttributes?this._previousAttributes[Ba]:null},previousAttributes:function(){return ia.clone(this._previousAttributes)},fetch:function(Ba){Ba=ia.extend({parse:!0},Ba);var Ua=this,Ha=Ba.success;return Ba.success=function(Ga){var Qa=Ba.parse?Ua.parse(Ga,Ba):Ga;return!!Ua.set(Qa,Ba)&&void(Ha&&Ha.call(Ba.context,Ua,Ga,Ba),Ua.trigger('sync',Ua,Ga,Ba))},za(this,Ba),this.sync('read',this,Ba)},save:function(Ba,Ua,Ha){var Ga;null==Ba||'object'==typeof Ba?(Ga=Ba,Ha=Ua):(Ga={})[Ba]=Ua,Ha=ia.extend({validate:!0,parse:!0},Ha);var Qa=Ha.wait;if(Ga&&!Qa){if(!this.set(Ga,Ha))return!1;}else if(!this._validate(Ga,Ha))return!1;var Ja=this,Ya=Ha.success,Ka=this.attributes;Ha.success=function(tl){Ja.attributes=Ka;var al=Ha.parse?Ja.parse(tl,Ha):tl;return Qa&&(al=ia.extend({},Ga,al)),al&&!Ja.set(al,Ha)?!1:void(Ya&&Ya.call(Ha.context,Ja,tl,Ha),Ja.trigger('sync',Ja,tl,Ha))},za(this,Ha),Ga&&Qa&&(this.attributes=ia.extend({},Ka,Ga));var Xa=this.isNew()?'create':Ha.patch?'patch':'update';'patch'!=Xa||Ha.attrs||(Ha.attrs=Ga);var Za=this.sync(Xa,this,Ha);return this.attributes=Ka,Za},destroy:function(Ba){Ba=Ba?ia.clone(Ba):{};var Ua=this,Ha=Ba.success,Ga=Ba.wait,Qa=function(){Ua.stopListening(),Ua.trigger('destroy',Ua,Ua.collection,Ba)};Ba.success=function(Ya){Ga&&Qa(),Ha&&Ha.call(Ba.context,Ua,Ya,Ba),Ua.isNew()||Ua.trigger('sync',Ua,Ya,Ba)};var Ja=!1;return this.isNew()?ia.defer(Ba.success):(za(this,Ba),Ja=this.sync('delete',this,Ba)),Ga||Qa(),Ja},url:function(){var Ba=ia.result(this,'urlRoot')||ia.result(this.collection,'url')||Wa();if(this.isNew())return Ba;var Ua=this.get(this.idAttribute);return Ba.replace(/[^\/]$/,'$&/')+encodeURIComponent(Ua)},parse:function(Ba){return Ba},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(Ba){return this._validate({},ia.defaults({validate:!0},Ba))},_validate:function(Ba,Ua){if(!Ua.validate||!this.validate)return!0;Ba=ia.extend({},this.attributes,Ba);var Ha=this.validationError=this.validate(Ba,Ua)||null;return!Ha||(this.trigger('invalid',this,Ha,ia.extend(Ua,{validationError:Ha})),!1)}});da(xa,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},'attributes');var Sa=aa.Collection=function(Ba,Ua){Ua||(Ua={}),Ua.model&&(this.model=Ua.model),void 0!==Ua.comparator&&(this.comparator=Ua.comparator),this._reset(),this.initialize.apply(this,arguments),Ba&&this.reset(Ba,ia.extend({silent:!0},Ua))},_a={add:!0,remove:!0,merge:!0},Aa={add:!0,remove:!1};ia.extend(Sa.prototype,ua,{model:xa,initialize:function(){},toJSON:function(Ba){return this.map(function(Ua){return Ua.toJSON(Ba)})},sync:function(){return aa.sync.apply(this,arguments)},add:function(Ba,Ua){return this.set(Ba,ia.extend({merge:!1},Ua,Aa))},remove:function(Ba,Ua){Ua=ia.extend({},Ua);var Ha=!ia.isArray(Ba);Ba=Ha?[Ba]:ia.clone(Ba);var Ga=this._removeModels(Ba,Ua);return!Ua.silent&&Ga&&this.trigger('update',this,Ua),Ha?Ga[0]:Ga},set:function(Ba,Ua){Ua=ia.defaults({},Ua,_a),Ua.parse&&!this._isModel(Ba)&&(Ba=this.parse(Ba,Ua));var Ha=!ia.isArray(Ba);Ba=Ha?Ba?[Ba]:[]:Ba.slice();var Xa=Ua.at,Ga,Qa,Ja,Ya,Ka;null!=Xa&&(Xa=+Xa),0>Xa&&(Xa+=this.length+1);for(var Za=this.comparator&&null==Xa&&!1!==Ua.sort,tl=ia.isString(this.comparator)?this.comparator:null,al=[],il=[],ll={},rl=Ua.add,nl=Ua.merge,sl=Ua.remove,ol=!Za&&rl&&sl&&[],dl=!1,cl=0;cl<Ba.length;cl++){if(Ja=Ba[cl],Ya=this.get(Ja))sl&&(ll[Ya.cid]=!0),nl&&Ja!==Ya&&(Ja=this._isModel(Ja)?Ja.attributes:Ja,Ua.parse&&(Ja=Ya.parse(Ja,Ua)),Ya.set(Ja,Ua),Za&&!Ka&&Ya.hasChanged(tl)&&(Ka=!0)),Ba[cl]=Ya;else if(rl){if(Qa=Ba[cl]=this._prepareModel(Ja,Ua),!Qa)continue;al.push(Qa),this._addReference(Qa,Ua)}Qa=Ya||Qa,Qa&&(Ga=this.modelId(Qa.attributes),ol&&(Qa.isNew()||!ll[Ga])&&(ol.push(Qa),dl=dl||!this.models[cl]||Qa.cid!==this.models[cl].cid),ll[Ga]=!0)}if(sl){for(var cl=0;cl<this.length;cl++)ll[(Qa=this.models[cl]).cid]||il.push(Qa);il.length&&this._removeModels(il,Ua)}if(al.length||dl)if(Za&&(Ka=!0),this.length+=al.length,null!=Xa)for(var cl=0;cl<al.length;cl++)this.models.splice(Xa+cl,0,al[cl]);else{ol&&(this.models.length=0);for(var ul=ol||al,cl=0;cl<ul.length;cl++)this.models.push(ul[cl])}if(Ka&&this.sort({silent:!0}),!Ua.silent){for(var gl=null==Xa?Ua:ia.clone(Ua),cl=0;cl<al.length;cl++)null!=Xa&&(gl.index=Xa+cl),(Qa=al[cl]).trigger('add',Qa,this,gl);(Ka||dl)&&this.trigger('sort',this,Ua),(al.length||il.length)&&this.trigger('update',this,Ua)}return Ha?Ba[0]:Ba},reset:function(Ba,Ua){Ua=Ua?ia.clone(Ua):{};for(var Ha=0;Ha<this.models.length;Ha++)this._removeReference(this.models[Ha],Ua);return Ua.previousModels=this.models,this._reset(),Ba=this.add(Ba,ia.extend({silent:!0},Ua)),Ua.silent||this.trigger('reset',this,Ua),Ba},push:function(Ba,Ua){return this.add(Ba,ia.extend({at:this.length},Ua))},pop:function(Ba){var Ua=this.at(this.length-1);return this.remove(Ua,Ba)},unshift:function(Ba,Ua){return this.add(Ba,ia.extend({at:0},Ua))},shift:function(Ba){var Ua=this.at(0);return this.remove(Ua,Ba)},slice:function(){return na.apply(this.models,arguments)},get:function(Ba){if(null!=Ba){var Ua=this.modelId(this._isModel(Ba)?Ba.attributes:Ba);return this._byId[Ba]||this._byId[Ua]||this._byId[Ba.cid]}},at:function(Ba){return 0>Ba&&(Ba+=this.length),this.models[Ba]},where:function(Ba,Ua){var Ha=ia.matches(Ba);return this[Ua?'find':'filter'](function(Ga){return Ha(Ga.attributes)})},findWhere:function(Ba){return this.where(Ba,!0)},sort:function(Ba){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');return Ba||(Ba={}),ia.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(ia.bind(this.comparator,this)),Ba.silent||this.trigger('sort',this,Ba),this},pluck:function(Ba){return ia.invoke(this.models,'get',Ba)},fetch:function(Ba){Ba=ia.extend({parse:!0},Ba);var Ua=Ba.success,Ha=this;return Ba.success=function(Ga){var Qa=Ba.reset?'reset':'set';Ha[Qa](Ga,Ba),Ua&&Ua.call(Ba.context,Ha,Ga,Ba),Ha.trigger('sync',Ha,Ga,Ba)},za(this,Ba),this.sync('read',this,Ba)},create:function(Ba,Ua){Ua=Ua?ia.clone(Ua):{};var Ha=Ua.wait;if(Ba=this._prepareModel(Ba,Ua),!Ba)return!1;Ha||this.add(Ba,Ua);var Ga=this,Qa=Ua.success;return Ua.success=function(Ja,Ya,Ka){Ha&&Ga.add(Ja,Ka),Qa&&Qa.call(Ka.context,Ja,Ya,Ka)},Ba.save(null,Ua),Ba},parse:function(Ba){return Ba},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(Ba){return Ba[this.model.prototype.idAttribute||'id']},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(Ba,Ua){if(this._isModel(Ba))return Ba.collection||(Ba.collection=this),Ba;Ua=Ua?ia.clone(Ua):{},Ua.collection=this;var Ha=new this.model(Ba,Ua);return Ha.validationError?(this.trigger('invalid',this,Ha.validationError,Ua),!1):Ha},_removeModels:function(Ba,Ua){for(var Ha=[],Ga=0,Qa;Ga<Ba.length;Ga++)if(Qa=this.get(Ba[Ga]),Qa){var Ja=this.indexOf(Qa);this.models.splice(Ja,1),this.length--,Ua.silent||(Ua.index=Ja,Qa.trigger('remove',Qa,this,Ua)),Ha.push(Qa),this._removeReference(Qa,Ua)}return!!Ha.length&&Ha},_isModel:function(Ba){return Ba instanceof xa},_addReference:function(Ba){this._byId[Ba.cid]=Ba;var Ha=this.modelId(Ba.attributes);null!=Ha&&(this._byId[Ha]=Ba),Ba.on('all',this._onModelEvent,this)},_removeReference:function(Ba){delete this._byId[Ba.cid];var Ha=this.modelId(Ba.attributes);null!=Ha&&delete this._byId[Ha],this===Ba.collection&&delete Ba.collection,Ba.off('all',this._onModelEvent,this)},_onModelEvent:function(Ba,Ua,Ha,Ga){if('add'!==Ba&&'remove'!==Ba||Ha===this){if('destroy'===Ba&&this.remove(Ua,Ga),'change'===Ba){var Qa=this.modelId(Ua.previousAttributes()),Ja=this.modelId(Ua.attributes);Qa!==Ja&&(null!=Qa&&delete this._byId[Qa],null!=Ja&&(this._byId[Ja]=Ua))}this.trigger.apply(this,arguments)}}});da(Sa,{forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3},'models');ia.each(['groupBy','countBy','sortBy','indexBy'],function(Ba){ia[Ba]&&(Sa.prototype[Ba]=function(Ua,Ha){var Ga=ia.isFunction(Ua)?Ua:function(Qa){return Qa.get(Ua)};return ia[Ba](this.models,Ga,Ha)})});var Ia=aa.View=function(Ba){this.cid=ia.uniqueId('view'),ia.extend(this,ia.pick(Ba,Ea)),this._ensureElement(),this.initialize.apply(this,arguments)},ka=/^(\S+)\s*(.*)$/,Ea=['model','collection','el','id','attributes','className','tagName','events'];ia.extend(Ia.prototype,ua,{tagName:'div',$:function(Ba){return this.$el.find(Ba)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(Ba){return this.undelegateEvents(),this._setElement(Ba),this.delegateEvents(),this},_setElement:function(Ba){this.$el=Ba instanceof aa.$?Ba:aa.$(Ba),this.el=this.$el[0]},delegateEvents:function(Ba){if(Ba||(Ba=ia.result(this,'events')),!Ba)return this;for(var Ua in this.undelegateEvents(),Ba){var Ha=Ba[Ua];if(ia.isFunction(Ha)||(Ha=this[Ha]),Ha){var Ga=Ua.match(ka);this.delegate(Ga[1],Ga[2],ia.bind(Ha,this))}}return this},delegate:function(Ba,Ua,Ha){return this.$el.on(Ba+'.delegateEvents'+this.cid,Ua,Ha),this},undelegateEvents:function(){return this.$el&&this.$el.off('.delegateEvents'+this.cid),this},undelegate:function(Ba,Ua,Ha){return this.$el.off(Ba+'.delegateEvents'+this.cid,Ua,Ha),this},_createElement:function(Ba){return document.createElement(Ba)},_ensureElement:function(){if(!this.el){var Ba=ia.extend({},ia.result(this,'attributes'));this.id&&(Ba.id=ia.result(this,'id')),this.className&&(Ba['class']=ia.result(this,'className')),this.setElement(this._createElement(ia.result(this,'tagName'))),this._setAttributes(Ba)}else this.setElement(ia.result(this,'el'))},_setAttributes:function(Ba){this.$el.attr(Ba)}}),aa.sync=function(Ba,Ua,Ha){var Ga=Ta[Ba];ia.defaults(Ha||(Ha={}),{emulateHTTP:aa.emulateHTTP,emulateJSON:aa.emulateJSON});var Qa={type:Ga,dataType:'json'};if(Ha.url||(Qa.url=ia.result(Ua,'url')||Wa()),null==Ha.data&&Ua&&('create'===Ba||'update'===Ba||'patch'===Ba)&&(Qa.contentType='application/json',Qa.data=JSON.stringify(Ha.attrs||Ua.toJSON(Ha))),Ha.emulateJSON&&(Qa.contentType='application/x-www-form-urlencoded',Qa.data=Qa.data?{model:Qa.data}:{}),Ha.emulateHTTP&&('PUT'===Ga||'DELETE'===Ga||'PATCH'===Ga)){Qa.type='POST',Ha.emulateJSON&&(Qa.data._method=Ga);var Ja=Ha.beforeSend;Ha.beforeSend=function(Xa){if(Xa.setRequestHeader('X-HTTP-Method-Override',Ga),Ja)return Ja.apply(this,arguments)}}'GET'===Qa.type||Ha.emulateJSON||(Qa.processData=!1);var Ya=Ha.error;Ha.error=function(Xa,Za,tl){Ha.textStatus=Za,Ha.errorThrown=tl,Ya&&Ya.call(Ha.context,Xa,Za,tl)};var Ka=Ha.xhr=aa.ajax(ia.extend(Qa,Ha));return Ua.trigger('request',Ua,Ka,Ha),Ka};var Ta={create:'POST',update:'PUT',patch:'PATCH','delete':'DELETE',read:'GET'};aa.ajax=function(){return aa.$.ajax.apply(aa.$,arguments)};var Ma=aa.Router=function(Ba){Ba||(Ba={}),Ba.routes&&(this.routes=Ba.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},Fa=/\((.*?)\)/g,La=/(\(\?)?:\w+/g,Oa=/\*\w+/g,$a=/[\-{}\[\]+?.,\\\^$|#\s]/g;ia.extend(Ma.prototype,ua,{initialize:function(){},route:function(Ba,Ua,Ha){ia.isRegExp(Ba)||(Ba=this._routeToRegExp(Ba)),ia.isFunction(Ua)&&(Ha=Ua,Ua=''),Ha||(Ha=this[Ua]);var Ga=this;return aa.history.route(Ba,function(Qa){var Ja=Ga._extractParameters(Ba,Qa);!1!==Ga.execute(Ha,Ja,Ua)&&(Ga.trigger.apply(Ga,['route:'+Ua].concat(Ja)),Ga.trigger('route',Ua,Ja),aa.history.trigger('route',Ga,Ua,Ja))}),this},execute:function(Ba,Ua){Ba&&Ba.apply(this,Ua)},navigate:function(Ba,Ua){return aa.history.navigate(Ba,Ua),this},_bindRoutes:function(){if(this.routes){this.routes=ia.result(this,'routes');for(var Ua=ia.keys(this.routes),Ba;null!=(Ba=Ua.pop());)this.route(Ba,this.routes[Ba])}},_routeToRegExp:function(Ba){return Ba=Ba.replace($a,'\\$&').replace(Fa,'(?:$1)?').replace(La,function(Ua,Ha){return Ha?Ua:'([^/?]+)'}).replace(Oa,'([^?]*?)'),new RegExp('^'+Ba+'(?:\\?([\\s\\S]*))?$')},_extractParameters:function(Ba,Ua){var Ha=Ba.exec(Ua).slice(1);return ia.map(Ha,function(Ga,Qa){return Qa===Ha.length-1?Ga||null:Ga?decodeURIComponent(Ga):null})}});var Ra=aa.History=function(){this.handlers=[],ia.bindAll(this,'checkUrl'),'undefined'!=typeof window&&(this.location=window.location,this.history=window.history)},Na=/^[#\/]|\s+$/g,Pa=/^\/+|\/+$/g,Da=/#.*$/;Ra.started=!1,ia.extend(Ra.prototype,ua,{interval:50,atRoot:function(){var Ba=this.location.pathname.replace(/[^\/]$/,'$&/');return Ba===this.root&&!this.getSearch()},matchRoot:function(){var Ba=this.decodeFragment(this.location.pathname),Ua=Ba.slice(0,this.root.length-1)+'/';return Ua===this.root},decodeFragment:function(Ba){return decodeURI(Ba.replace(/%25/g,'%2525'))},getSearch:function(){var Ba=this.location.href.replace(/#.*/,'').match(/\?.+/);return Ba?Ba[0]:''},getHash:function(Ba){var Ua=(Ba||this).location.href.match(/#(.*)$/);return Ua?Ua[1]:''},getPath:function(){var Ba=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return'/'===Ba.charAt(0)?Ba.slice(1):Ba},getFragment:function(Ba){return null==Ba&&(this._usePushState||!this._wantsHashChange?Ba=this.getPath():Ba=this.getHash()),Ba.replace(Na,'')},start:function(Ba){if(Ra.started)throw new Error('Backbone.history has already been started');if(Ra.started=!0,this.options=ia.extend({root:'/'},this.options,Ba),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange='onhashchange'in window,this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.history&&this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=('/'+this.root+'/').replace(Pa,'/'),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var Ua=this.root.slice(0,-1)||'/';return this.location.replace(Ua+'#'+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement('iframe'),this.iframe.src='javascript:0',this.iframe.style.display='none',this.iframe.tabIndex=-1;var Ha=document.body,Ga=Ha.insertBefore(this.iframe,Ha.firstChild).contentWindow;Ga.document.open(),Ga.document.close(),Ga.location.hash='#'+this.fragment}var Qa=window.addEventListener||function(Ja,Ya){return attachEvent('on'+Ja,Ya)};if(this._usePushState?Qa('popstate',this.checkUrl,!1):this._useHashChange&&!this.iframe?Qa('hashchange',this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var Ba=window.removeEventListener||function(Ua,Ha){return detachEvent('on'+Ua,Ha)};this._usePushState?Ba('popstate',this.checkUrl,!1):this._useHashChange&&!this.iframe&&Ba('hashchange',this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),Ra.started=!1},route:function(Ba,Ua){this.handlers.unshift({route:Ba,callback:Ua})},checkUrl:function(){var Ua=this.getFragment();return Ua===this.fragment&&this.iframe&&(Ua=this.getHash(this.iframe.contentWindow)),Ua!==this.fragment&&void(this.iframe&&this.navigate(Ua),this.loadUrl())},loadUrl:function(Ba){return!!this.matchRoot()&&(Ba=this.fragment=this.getFragment(Ba),ia.any(this.handlers,function(Ua){if(Ua.route.test(Ba))return Ua.callback(Ba),!0}))},navigate:function(Ba,Ua){if(!Ra.started)return!1;Ua&&!0!==Ua||(Ua={trigger:!!Ua}),Ba=this.getFragment(Ba||'');var Ha=this.root;(''===Ba||'?'===Ba.charAt(0))&&(Ha=Ha.slice(0,-1)||'/');var Ga=Ha+Ba;if(Ba=this.decodeFragment(Ba.replace(Da,'')),this.fragment!==Ba){if(this.fragment=Ba,this._usePushState)this.history[Ua.replace?'replaceState':'pushState']({},document.title,Ga);else{if(!this._wantsHashChange)return this.location.assign(Ga);if(this._updateHash(this.location,Ba,Ua.replace),this.iframe&&Ba!==this.getHash(this.iframe.contentWindow)){var Qa=this.iframe.contentWindow;Ua.replace||(Qa.document.open(),Qa.document.close()),this._updateHash(Qa.location,Ba,Ua.replace)}}return Ua.trigger?this.loadUrl(Ba):void 0}},_updateHash:function(Ba,Ua,Ha){if(Ha){var Ga=Ba.href.replace(/(javascript:|#).*$/,'');Ba.replace(Ga+'#'+Ua)}else Ba.hash='#'+Ua}}),aa.history=new Ra;xa.extend=Sa.extend=Ma.extend=Ia.extend=Ra.extend=function(Ba,Ua){var Ha=this,Ga;Ga=Ba&&ia.has(Ba,'constructor')?Ba.constructor:function(){return Ha.apply(this,arguments)},ia.extend(Ga,Ha,Ua);var Qa=function(){this.constructor=Ga};return Qa.prototype=Ha.prototype,Ga.prototype=new Qa,Ba&&ia.extend(Ga.prototype,Ba),Ga.__super__=Ha.prototype,Ga};var Wa=function(){throw new Error('A "url" property or function must be specified')},za=function(Ba,Ua){var Ha=Ua.error;Ua.error=function(Ga){Ha&&Ha.call(Ua.context,Ba,Ga,Ua),Ba.trigger('error',Ba,Ga,Ua)}};return aa}),$sessionId=void 0,$userId=void 0,Ext.define('$o',{singleton:!0,mixins:{observable:'Ext.util.Observable'},code:null,currentUser:null,objectsMap:{},actionsMap:{},constructor:function(ea){this.mixins.observable.constructor.call(this,ea),this.addEvents('afterCreateObject','beforeCommitObject','beforeRemoveObject')},load:function(ea){let aa=this,ia=ea.success,la=ea.scope;aa.initModels(),aa.initStores({success:function(ra){aa.initClasses(ra),aa.initClassAttrs(ra),aa.initViews(ra),aa.initViewAttrs(ra),aa.initClassModels(),ia.call(la||aa,ra)}})},init:function(ea){if(!ea)throw new Error('$o.init must have options: {success}');let aa=this;aa.code=ea.code;let la=ea.failure,ra=ea.scope;aa.authorized?aa.load(ea):aa.authorize(Ext.apply(ea,{success:function(na){aa.load(na)},failure:function(na){la&&la.call(ra||aa,na)}}))},authorize:function(ea){let aa=ea;Ext.Ajax.request({url:'?authorize=1',params:JSON.stringify({username:ea.login,password:ea.password}),success:function(ia){let ra=JSON.parse(ia.responseText);if(!ra||ra.error)return void(aa.failure&&aa.failure.call(aa.scope||this,ra.error));if(ra.wait)return void(aa.failure&&aa.failure.call(aa.scope||this,$o.getString('Wait')+' '+(0|ra.wait/60)+$o.getString(' ','min','and','try again')));$o.serverVersion=3,this.sessionId=$sessionId=ra.sessionId,this.userId=$userId=ra.userId,this.authorized=!0,this.currentUser=aa.login,'autologin'!=this.currentUser&&$o.util.setCookie('sessionId',$sessionId);$o.roleId=ra.roleId,$o.menuId=ra.menuId,$o.idleTimer=0;let na=function(){$o.idleTimer=0};if('autologin'!=this.currentUser){let oa=setInterval(function(){$o.idleTimer+=1,$o.maxIdleSec=$o.maxIdleSec||1800,$o.idleTimer>$o.maxIdleSec&&(clearInterval(oa),$o.logout({success:function(){Ext.Msg.alert($ptitle,$o.getString('Session disabled'),function(){location.reload()})}}))},1e3)}document.addEventListener('mousemove',na,!1),document.addEventListener('click',na,!1),document.addEventListener('scroll',na,!1),aa.success.call(aa.scope||this,Ext.apply(aa,{sessionId:$sessionId,userId:$userId}))},failure:function(ia){if(aa.failure){let ra,na;try{ra=JSON.parse(ia.responseText),na=ra.error}catch(oa){}ia.responseText||(na='Server error');aa.failure.call(aa.scope||this,na||'Authentication error')}},scope:this})},logout:function(ea){function aa(){Ext.Ajax.request({url:'?logout=1&sessionId='+ia.sessionId,params:ia.sessionId,success:function(){la&&la()},failure:function(){ra&&ra()},scope:ia})}let ia=this;ea=ea||{};let la=ea.success,ra=ea.failure;if($o.util.getCookie('esiaAuth')){$o.util.setCookie('esiaAuth','','/');let na=window.open('https://esia-portal1.test.gosuslugi.ru/profile/user/saml/Logout');setTimeout(function(){na.close(),window.open('https://esia-portal1.test.gosuslugi.ru/profile/user/saml/Logout'),aa()},3e3)}else aa()},initModels:function(){let storage=this;Ext.define('$o.Base.Model',{extend:'Ext.data.Model',constructor:function(){let aa=this;aa.callParent(arguments),aa.remove=function(){aa.removed=!0}},sync:function(){let me=this;if(me.removed){let ea=Ext.Ajax.request({async:!1,url:'?sessionId='+$sessionId,params:storage.code+'.'+me.tableName+'.remove('+me.get('id')+')'}),aa;if('Class'==me.tableName&&(aa=storage.store.classes),'ClassAttr'==me.tableName&&(aa=storage.store.classAttrs),('View'==me.tableName&&(aa=storage.store.views),'ViewAttr'==me.tableName&&(aa=storage.store.viewAttrs),'Action'==me.tableName))return void delete storage.actionsMap[me.get('id')];let ia=aa.findRecord('id',me.get('id'),0,!1,!1,!0);return aa.remove(ia),('Class'==me.tableName||'ClassAttr'==me.tableName)&&(storage.initClasses(),storage.initClassAttrs(),storage.initClassModels()),void(('View'==me.tableName||'ViewAttr'==me.tableName)&&(storage.initViews(),storage.initViewAttrs()))}let values=[];for(let ea=0;ea<me.fieldsArray.length;ea++)values.push(Ext.encode(me.get(me.fieldsArray[ea])||null));if(me.get('id')){let ea=values.join(',');'Action'!=me.tableName&&(ea=ea.split('false').join('0').split('true').join('1'));Ext.Ajax.request({async:!1,url:'?sessionId='+$sessionId,params:storage.code+'.'+me.tableName+'.set('+ea+')'})}else{values.splice(0,1);let valuesStr=values.join(',');'Action'!=me.tableName&&(valuesStr=valuesStr.split('false').join('0').split('true').join('1'));let r=Ext.Ajax.request({async:!1,url:'?sessionId='+$sessionId,params:storage.code+'.'+me.tableName+'.create('+valuesStr+')'});storage.checkException(r);let o=eval('('+r.responseText+')');me.set('id',o.data[0][0]),'Class'==me.tableName&&storage.store.classes.add(me),'ClassAttr'==me.tableName&&storage.store.classAttrs.add(me),'View'==me.tableName&&storage.store.views.add(me),'ViewAttr'==me.tableName&&storage.store.viewAttrs.add(me)}if('Class'==me.tableName&&storage.initClass(me),'ClassAttr'==me.tableName&&(storage.initClassAttr(me),me.get('class'))){let ea=$o.getClass(me.get('class'));ea&&storage.initClass(ea)}'View'==me.tableName&&storage.initView(me),'ViewAttr'==me.tableName&&storage.initViewAttr(me)},toString:function(){let ea=this,aa=ea.get('code');ea.getFullCode&&(aa=ea.getFullCode());let ia;return ia='Action'==ea.tableName?ea.get('name')+' ('+aa+':'+ea.get('id')+')'+(ea.get('class')?', '+$o.getString('Class')+': '+$o.getClass(ea.get('class')).toString():''):ea.get('name')+' ('+aa+':'+ea.get('id')+')',ia}}),Ext.define('$o.Class.Model',{extend:'$o.Base.Model',idProperty:'id',fields:[{name:'id',type:'number'},{name:'parent',type:'number',useNull:!0},{name:'name',type:'string',useNull:!0},{name:'code',type:'string',useNull:!0},{name:'description',type:'string',useNull:!0},{name:'format',type:'string',useNull:!0},{name:'view',type:'number',useNull:!0},{name:'type',type:'number',useNull:!0},{name:'system',type:'number',useNull:!0}],tableName:'Class',fieldsArray:['id','parent','name','code','description','format','view','type','system'],getFullCode:function(){let ea='';return this.get('parent')&&(ea=$o.classesMap[this.get('parent')].getFullCode()),ea&&(ea+='.'),(ea+=this.get('code'),ea)},getPath:function(){return this.getFullCode()},updateDefault:function(){storage.updateDefaultView.call(this),storage.updateDefaultActions.call(this)},hasAttrInHierarchy:function(ea){function aa(ra,na){if(ra.attrs[na])return $o.getClass(ra.attrs[na].get('class'));for(let oa=0,da;oa<ra.childs.length;oa++)if(da=aa($o.getClass(ra.childs[oa]),na),da)return da;return 0}let ia=this;let la=aa(ia,ea);return la}}),Ext.define('$o.ClassAttr.Model',{extend:'$o.Base.Model',idProperty:'id',fields:[{name:'id',type:'number'},{name:'class',type:'number',useNull:!0},{name:'name',type:'string',useNull:!0},{name:'code',type:'string',useNull:!0},{name:'type',type:'number',useNull:!0},{name:'order',type:'number',useNull:!0},{name:'notNull',type:'bool',useNull:!0},{name:'validFunc',type:'string',useNull:!0},{name:'formatFunc',type:'string',useNull:!0},{name:'description',type:'string',useNull:!0},{name:'secure',type:'bool',useNull:!0},{name:'maxString',type:'number',useNull:!0},{name:'minString',type:'number',useNull:!0},{name:'maxNumber',type:'number',useNull:!0},{name:'minNumber',type:'number',useNull:!0},{name:'maxDate',type:'date',useNull:!0},{name:'minDate',type:'date',useNull:!0},{name:'unique',type:'bool',useNull:!0},{name:'numberFormat',type:'string',useNull:!0},{name:'dateFormat',type:'string',useNull:!0},{name:'removeRule',type:'string',useNull:!0}],tableName:'ClassAttr',fieldsArray:['id','class','name','code','type','order','notNull','validFunc','formatFunc','description','secure','maxString','minString','maxNumber','minNumber','maxDate','minDate','unique','numberFormat','dateFormat','removeRule'],getDataType:function(){let ea;switch(this.get('type')){case 1:case 5:ea='string';break;case 2:ea='number';break;case 3:ea='date';break;case 4:ea='bool';break;case 6:case 7:case 8:case 9:ea='number';break;default:ea='number';}return ea},getFieldType:function(){let ea=this.getDataType(),aa='numberfield';return'string'==ea&&(aa='textfield'),'date'==ea&&(aa='datefield'),'bool'==ea&&(aa='checkbox'),1e3<=this.get('type')&&(aa='objectfield'),(5==this.get('type')&&(aa='$filefield'),aa)},getFilterDataType:function(){let ea=this.getDataType();return'number'==ea&&(ea='numeric'),ea},getVType:function(){let me=this,code;if(me.get('validFunc')){let code=$o.getClass(me.get('class')).getFullCode()+'.'+me.get('code');if(!Ext.form.VTypes[code])try{let vf=eval('('+me.get('validFunc')+')'),o={};o[code]=vf.fn,o[code+'Text']='function'==typeof vf.description?eval('('+vf.description+')'):vf.description,Ext.apply(Ext.form.VTypes,o)}catch(ea){}}return code}}),Ext.define('$o.View.Model',{extend:'$o.Base.Model',idProperty:'id',fields:[{name:'id',type:'number'},{name:'parent',type:'number',useNull:!0},{name:'name',type:'string',useNull:!0},{name:'code',type:'string',useNull:!0},{name:'description',type:'string',useNull:!0},{name:'layout',type:'string',useNull:!0},{name:'key',type:'string',useNull:!0},{name:'parentKey',type:'number',useNull:!0},{name:'class',type:'number',useNull:!0},{name:'unrelated',type:'string',useNull:!0},{name:'query',type:'string',useNull:!0},{name:'type',type:'bool',useNull:!0},{name:'system',type:'bool',useNull:!0},{name:'materialized',type:'bool',useNull:!0},{name:'order',type:'number',useNull:!0},{name:'iconCls',type:'string',useNull:!0}],tableName:'View',fieldsArray:['id','parent','name','code','description','layout','key','parentKey','class','unrelated','query','type','system','materialized','order','iconCls'],getFullCode:function(){let ea='';return this.get('parent')&&(ea=$o.viewsMap[this.get('parent')].getFullCode()),ea&&(ea+='.'),(ea+=this.get('code'),ea)},getPath:function(){return this.getFullCode()}}),Ext.define('$o.ViewAttr.Model',{extend:'$o.Base.Model',idProperty:'id',fields:[{name:'id',type:'number'},{name:'view',type:'number',useNull:!0},{name:'name',type:'string',useNull:!0},{name:'code',type:'string',useNull:!0},{name:'class',type:'number',useNull:!0},{name:'classAttr',type:'number',useNull:!0},{name:'subject',type:'number',useNull:!0},{name:'order',type:'number',useNull:!0},{name:'sort',type:'number',useNull:!0},{name:'sortOrder',type:'number',useNull:!0},{name:'operation',type:'number',useNull:!0},{name:'value',type:'string',useNull:!0},{name:'area',type:'bool',useNull:!0},{name:'width',type:'number',useNull:!0},{name:'totalType',type:'number',useNull:!0},{name:'readOnly',type:'bool',useNull:!0},{name:'group',type:'bool',useNull:!0},{name:'notNull',type:'bool',useNull:!0}],tableName:'ViewAttr',fieldsArray:['id','view','name','code','class','classAttr','subject','order','sort','sortOrder','operation','value','area','width','totalType','readOnly','group','notNull']}),Ext.define('$o.Action.Model',{extend:'$o.Base.Model',idProperty:'id',fields:[{name:'id',type:'number'},{name:'class',type:'number',useNull:!0},{name:'name',type:'string',useNull:!0},{name:'code',type:'string',useNull:!0},{name:'description',type:'string',useNull:!0},{name:'body',type:'string',useNull:!0},{name:'layout',type:'string',useNull:!0}],tableName:'Action',fieldsArray:['id','class','name','code','description','order','body','layout'],initAction:function(){let actionId=this.get('id'),a=$o.getAction(actionId),cls=$o.getClass(a.get('class')),fName=cls.getFullCode()+'.'+a.get('code');Ext.namespace(fName);let f=fName+' = function (options) {\n'+a.get('body')+'};\n',l;try{l=JSON.parse(a.get('layout'))}catch(ea){}if(!(l&&l.serverAction)){try{eval(f)}catch(ea){}if(l&&l.layout){let fl=fName+'.layout = '+JSON.stringify(l.layout,null,'\t')+';\n';try{eval(fl)}catch(ea){}}common.getConf('projectNeedBuild').used||common.setConf('projectNeedBuild',{used:1})}},getFullCode:function(){let ea=$o.getClass(this.get('class')),aa=(ea?ea.getFullCode()+'.':'')+this.get('code');return aa},getPath:function(){return this.getFullCode()},execute:function(options){let fn_=eval(this.getFullCode());'function'==typeof fn_&&fn_(options)}})},initStores:function(options){let me=this,mainOptions=options;Ext.define('$o.Class.Store',{extend:'Ext.data.Store',model:'$o.Class.Model'}),Ext.define('$o.ClassAttr.Store',{extend:'Ext.data.Store',model:'$o.ClassAttr.Model'}),Ext.define('$o.View.Store',{extend:'Ext.data.Store',model:'$o.View.Model'}),Ext.define('$o.ViewAttr.Store',{extend:'Ext.data.Store',model:'$o.ViewAttr.Model'}),me.store={classes:Ext.create('$o.Class.Store'),classAttrs:Ext.create('$o.ClassAttr.Store'),views:Ext.create('$o.View.Store'),viewAttrs:Ext.create('$o.ViewAttr.Store')},3==$o.serverVersion?Ext.Ajax.request({url:'?sessionId='+me.sessionId,params:me.code+'.Storage.getAll("")',success:function(response,options){let d=eval('('+response.responseText+')');me.store.classes.loadData(d.classes),me.store.classAttrs.loadData(d.classAttrs),me.store.views.loadData(d.views),me.store.viewAttrs.loadData(d.viewAttrs),me.visualObjectum=d.visualObjectum||{},me.visualObjectum.timeMachine=me.visualObjectum.timeMachine||{},me.visualObjectum.logo=me.visualObjectum.logo||{},me.data=d,mainOptions.data=d,mainOptions.success.call(mainOptions.scope||me,mainOptions)},scope:me}):(me.data={},mainOptions.data={},async.parallel([function(cb){Ext.Ajax.request({url:'?sessionId='+me.sessionId+'&username='+$o.currentUser,params:me.code+'.Storage.getClasses("")',success:function(response,options){let d=eval('('+response.responseText+')');me.store.classes.loadData(d.data),me.data.classes=d.data,mainOptions.data.classes=d.data,cb()},scope:me})},function(cb){Ext.Ajax.request({url:'?sessionId='+me.sessionId+'&username='+$o.currentUser,params:me.code+'.Storage.getClassAttrs("")',success:function(response,options){let d=eval('('+response.responseText+')');me.store.classAttrs.loadData(d.data),me.classAttrs={},me.data.classAttrs=d.data,mainOptions.data.classAttrs=d.data,cb()},scope:me})},function(cb){Ext.Ajax.request({url:'?sessionId='+me.sessionId+'&username='+$o.currentUser,params:me.code+'.Storage.getViews("")',success:function(response,options){let d=eval('('+response.responseText+')');me.store.views.loadData(d.data),me.data.views=d.data,mainOptions.data.views=d.data,cb()},scope:me})},function(cb){Ext.Ajax.request({url:'?sessionId='+me.sessionId+'&username='+$o.currentUser,params:me.code+'.Storage.getViewAttrs("")',success:function(response,options){let d=eval('('+response.responseText+')');me.store.viewAttrs.loadData(d.data),me.data.viewAttrs=d.data,mainOptions.data.viewAttrs=d.data,cb()},scope:me})}],function(){mainOptions.success.call(mainOptions.scope||me,mainOptions)}))},checkException:function(options){if(!$o.app){let r=eval('('+options.responseText+')');if(r&&r.header&&r.header.error)throw new Error(r.header.error)}},initClassModels:function(){Ext.define('$o.Class.Base.Model',{extend:'Ext.data.Model',storage:this,commitLocal:function(){let ea=this;if('child'!=ea.local)for(let aa in ea.local=null,ea.commit(),ea.localChilds){let ia=$o.getObject(aa);'their'==ea.localChilds[aa].place&&ia.set(ea.localChilds[aa].attr,ea.get('id')),ia.local='root',ia.commitLocal(),'mine'==ea.localChilds[aa].place&&(ea.set(ea.localChilds[aa].attr,ia.get('id')),ea.commit())}},commit:function(options){if(this.local)return void('local'==options&&this.commitLocal());if(this.removed)return void this.storage.removeObject(this.get('id'));let changes={},changedNum=0;for(let ea=0,aa;ea<this.fields.getCount();ea++){if(aa=this.fields.getAt(ea).name,'id'==aa)continue;if(!this.data.hasOwnProperty(aa)||this.data[aa]==this.originalData[aa]||''===this.data[aa]&&(!this.originalData.hasOwnProperty(aa)||null==this.originalData[aa]))continue;let ia=this.getClassAttr(aa);if('date'==ia.getDataType()&&(!this.data[aa]&&!this.originalData[aa]||this.data[aa]&&this.originalData[aa]&&this.data[aa].getTime()==this.originalData[aa].getTime()))continue;this.originalData[aa]=this.data[aa];let la=this.get(aa);if(la&&'object'==typeof la&&la.getMonth()&&2e3==la.getFullYear()&&1==la.getMonth()&&2==la.getDate()&&3==la.getHours()&&4==la.getMinutes()&&5==la.getSeconds()&&(la='$CURRENT_TIMESTAMP$'),'bool'==ia.getDataType()&&null!==la&&(la=la?1:0),'date'==ia.getDataType()&&la&&'$CURRENT_TIMESTAMP$'!=la)if(0==la.getHours()&&0==la.getMinutes()&&0==la.getSeconds()){let ra=la.getDate(),na=la.getMonth()+1;la=la.getFullYear()+'-',10>na&&(la+='0'),la+=na+'-',10>ra&&(la+='0'),la+=ra+'T00:00:00.000Z'}else la=la.toISOString();changes[aa]={value:null===la?null:la+'',classAttrId:ia.get('id'),type:ia.get('type'),classId:ia.get('class'),classCode:$o.classesMap[ia.get('class')].get('code')},changedNum++}if(changedNum||!this.get('id')||0>this.get('id')){this.storage.fireEvent('beforeCommitObject',{objectId:this.get('id'),changes:changes}),0>this.get('id')&&this.set('id',null);let a=[this.get('id'),changes,this.get('classId')],r=Ext.Ajax.request({async:!1,url:'?sessionId='+this.storage.sessionId,params:this.storage.code+'.Object.setAttrs([!'+JSON.stringify(a)+'!])'});this.storage.checkException.call(this.storage,r);let o=eval('('+r.responseText+')');for(let ea in(!this.get('id')||0>this.get('id'))&&o.data.id&&this.set('id',o.data.id||o.data),o.data)'$CURRENT_TIMESTAMP$'==this.get(ea)&&this.set(ea,new Date(o.data[ea]))}},sync:function(ea){this.commit(ea)},remove:function(){if($o.isReadOnly())throw common.message($o.getString('Can\'t change data')),new Error($o.getString('Can\'t change data'));this.removed=!0},getClassAttr:function(ea){let aa=$o.classesMap[this.get('classId')];return aa.attrs[ea]},toString:function(){let cls=$o.classesMap[this.get('classId')],ff=cls.get('format'),r=this.get('name');if(ff)try{let fn=eval('(function () {'+ff+'})');r=fn.call(this)}catch(ea){console.log('toString exception'),console.log(this)}return r},set:function(ea,aa){if('$CURRENT_TIMESTAMP$'==aa&&(aa=new Date(2e3,1,2,3,4,5)),this.getClassAttr(ea)&&1e3<=this.getClassAttr(ea).get('type'))if(aa&&0>aa){let ia=$o.getObject(aa);'root'==this.local?this.localChilds[ia.get('id')]={attr:ea,place:'mine'}:(this.get('id')||(this.set('id',$o.nextLocalId--),$o.objectsMap[this.get('id')]=this),ia.localChilds[this.get('id')]={attr:ea,place:'their'},this.local='child')}else;this.callParent(arguments)},getId:function(){return this.get('id')}});for(let ea=0;ea<this.store.classes.getCount();ea++){let aa=this.store.classes.getAt(ea),ia=[{name:'id',type:'number',useNull:!0},{name:'classId',type:'number',useNull:!0}];for(let la in aa.attrs){let ra=aa.attrs[la];ia.push({name:ra.get('code'),type:ra.getDataType(),useNull:!0})}Ext.define('$o.Class.'+aa.get('id')+'.Model',{extend:'$o.Class.Base.Model',fields:ia})}},initClass:function(ea){let aa=this;ea.stub=ea,ea.attrs=ea.attrs||{},ea.attrsArray=ea.attrsArray||[],ea.childs=ea.childs||[],aa.classesMap[ea.get('id')]=ea,ea.get('parent')&&aa.classesMap[ea.get('parent')].childs.push(ea.get('id')),this.classesCode[ea.getFullCode()]=ea;let ia=ea.getFullCode().split('.');if(3==ia.length&&(aa.classesCode[ia[0]+'.'+ia[2]]=aa.classesCode[ia[0]+'.'+ia[2]]||ea),4==ia.length&&(aa.classesCode[ia[0]+'.'+ia[3]]=aa.classesCode[ia[0]+'.'+ia[3]]||ea),ea.get('parent')){let ra=$o.getClass(ea.get('parent'));for(let na in ra.attrs)ea.attrs[na]=ra.attrs[na],ea.attrsArray.push(ra.attrs[na])}let la=[{name:'id',type:'number',useNull:!0},{name:'classId',type:'number',useNull:!0}];for(let ra in ea.attrs){let na=ea.attrs[ra];la.push({name:na.get('code'),type:na.getDataType(),useNull:!0})}if(Ext.ClassManager.get('$o.Class.'+ea.get('id')+'.Model')){let ra=Ext.ClassManager.get('$o.Class.'+ea.get('id')+'.Model').prototype.fields;_.each(la,function(na){ra.contains({name:na.name})||ra.add(na)})}else Ext.define('$o.Class.'+ea.get('id')+'.Model',{extend:'$o.Class.Base.Model',fields:la})},initClasses:function(){this.classesMap=this.classesMap||{};for(let ia=0,la;ia<this.store.classes.getCount();ia++)la=this.store.classes.getAt(ia),la.stub=la,la.childs=[],this.classesMap[la.get('id')]=la;this.classesTree=this.classesTree||{},this.classesCode=this.classesCode||{};let aa=function(ia){for(let la=0,ra;la<this.store.classes.getCount();la++)if(ra=this.store.classes.getAt(la),ra.get('parent')==ia.parent){ia.parent&&this.classesMap[ia.parent].childs.push(ra.get('id')),ia.node[ra.get('code')]={id:ra.get('id'),stub:ra};let na=ia.code?ia.code+'.'+ra.get('code'):ra.get('code');ra.attrs={},ra.attrsArray=[],this.classesCode[na]=ra;let oa=na.split('.');3==oa.length&&(this.classesCode[oa[0]+'.'+oa[2]]=this.classesCode[oa[0]+'.'+oa[2]]||ra),4==oa.length&&(this.classesCode[oa[0]+'.'+oa[3]]=this.classesCode[oa[0]+'.'+oa[3]]||ra),aa.call(this,{node:ia.node[ra.get('code')],parent:ra.get('id'),code:na})}};aa.call(this,{node:this.classesTree,parent:null})},initClassAttr:function(ea){let aa=this;if(aa.classAttrs[ea.get('id')]=ea,aa.classAttrsMap[ea.get('id')]=ea,aa.classesMap[ea.get('class')]){let ia=function(la){la.attrs[ea.get('code')]=ea,la.attrsArray.push(ea);for(let ra=0;ra<la.childs.length;ra++)ia(aa.classesMap[la.childs[ra]])};ia(aa.classesMap[ea.get('class')])}},initClassAttrs:function(){let aa=this;aa.classAttrs=aa.classAttrs||{};for(let ia=0,la;ia<aa.store.classAttrs.getCount();ia++)la=aa.store.classAttrs.getAt(ia),aa.classAttrs[la.get('id')]=la;aa.classAttrsMap=aa.classAttrsMap||{};for(let ia=0,la;ia<aa.store.classAttrs.getCount();ia++)if(la=this.store.classAttrs.getAt(ia),aa.classAttrsMap[la.get('id')]=la,aa.classesMap[la.get('class')]){let ra=function(na){na.attrs=na.attrs||{},na.attrs[la.get('code')]=la,na.attrsArray=na.attrsArray||[],na.attrsArray.push(la);for(let oa=0;oa<na.childs.length;oa++)ra(aa.classesMap[na.childs[oa]])};ra(aa.classesMap[la.get('class')])}},initView:function(ea){ea.stub=ea,ea.attrs=ea.attrs||{},ea.childs=ea.childs||[],this.viewsMap[ea.get('id')]=ea,this.viewsCode[ea.getFullCode()]=ea;let aa=ea.getFullCode().split('.');3==aa.length&&(this.viewsCode[aa[0]+'.'+aa[2]]=this.viewsCode[aa[0]+'.'+aa[2]]||ea);4==aa.length&&(this.viewsCode[aa[0]+'.'+aa[3]]=this.viewsCode[aa[0]+'.'+aa[3]]||ea);ea.get('parent')&&this.viewsMap[ea.get('parent')].childs.push(ea.get('id'))},initViews:function(){this.viewsMap=this.viewsMap||{};for(let ia=0,la;ia<this.store.views.getCount();ia++)la=this.store.views.getAt(ia),la.stub=la,la.childs=[],this.viewsMap[la.get('id')]=la;this.viewsTree=this.viewsTree||{},this.viewsCode=this.viewsCode||{};let aa=function(ia){for(let la=0,ra;la<this.store.views.getCount();la++)if(ra=this.store.views.getAt(la),ra.get('parent')==ia.parent){ia.parent&&this.viewsMap[ia.parent].childs.push(ra.get('id')),ia.node[ra.get('code')]={id:ra.get('id'),stub:ra};let na=ia.code?ia.code+'.'+ra.get('code'):ra.get('code');if(ra.attrs={},this.viewsCode[na]=ra,na){let oa=na.split('.');3==oa.length&&(this.viewsCode[oa[0]+'.'+oa[2]]=this.viewsCode[oa[0]+'.'+oa[2]]||ra),4==oa.length&&(this.viewsCode[oa[0]+'.'+oa[3]]=this.viewsCode[oa[0]+'.'+oa[3]]||ra)}aa.call(this,{node:ia.node[ra.get('code')],parent:ra.get('id'),code:na})}};aa.call(this,{node:this.viewsTree,parent:null})},initViewAttr:function(ea){let aa=this;aa.viewAttrsMap[ea.get('id')]=ea,aa.viewsMap[ea.get('view')].attrs[ea.get('code')]=ea},initViewAttrs:function(){let aa=this;aa.viewAttrsMap=aa.viewAttrsMap||{};for(let ia=0,la;ia<aa.store.viewAttrs.getCount();ia++)la=this.store.viewAttrs.getAt(ia),aa.viewAttrsMap[la.get('id')]=la,aa.viewsMap[la.get('view')]&&(aa.viewsMap[la.get('view')].attrs=aa.viewsMap[la.get('view')].attrs||{},aa.viewsMap[la.get('view')].attrs[la.get('code')]=la)},getClass:function(ea){if(!ea)return ea;if('number'==typeof ea){if(this.classesMap[ea])return this.classesMap[ea];throw new Error('getClass - Unknown classId: '+ea)}if(ea&&ea.id){if(this.classesMap[ea.id])return this.classesMap[ea.id];throw new Error('getClass - Unknown classId: '+ea.id)}let aa=ea.classCode||ea.code;if('string'==typeof ea&&(aa=ea),this.classesCode[aa])return this.classesCode[aa];throw new Error('getClass - Unknown classCode: '+aa)},getClassAttr:function(ea){if(this.classAttrsMap[ea])return this.classAttrsMap[ea];throw new Error('getClassAttr - Unknown id: '+ea)},getView:function(ea){if(!ea)return ea;if('number'==typeof ea){if(this.viewsMap[ea])return this.viewsMap[ea];throw new Error('getView - Unknown viewId: '+ea)}if(ea&&ea.id){if(this.viewsMap[ea.id])return this.viewsMap[ea.id];throw new Error('getView - Unknown viewId: '+ea.id)}let aa=ea.viewCode||ea.code;if('string'==typeof ea&&(aa=ea),this.viewsCode[aa])return this.viewsCode[aa];throw new Error('getView - Unknown viewCode: '+aa)},getViewAttr:function(ea){if(this.viewAttrsMap[ea])return this.viewAttrsMap[ea];throw new Error('getViewAttr - Unknown id: '+ea)},getAction:function(id){if(!id)return null;if('string'==typeof id&&-1<id.indexOf('.'))for(let ea in this.actionsMap)if(this.actionsMap[ea].getFullCode()==id)return this.actionsMap[ea];if(this.actionsMap[id])return this.actionsMap[id];let storage=this,r=Ext.Ajax.request({async:!1,url:'?sessionId='+$sessionId,params:storage.code+'.Action.get('+('string'==typeof id?'"'+id+'"':id)+')'});if(r=eval('('+r.responseText+')'),!r.data.length)return null;let o=Ext.create('$o.Action.Model');for(let ea=0;ea<r.data.length;ea++)o.set(o.fieldsArray[ea],r.data[ea]);return this.actionsMap[o.get('id')]=o,o},getObject:function(id){if(!id)return null;if(this.objectsMap[id])return this.objectsMap[id];let r=Ext.Ajax.request({async:!1,url:'?sessionId='+this.sessionId,params:this.code+'.Storage.getObject('+id+')'}),d=eval('('+r.responseText+')');if(d.data.id){let ea=Ext.create('$o.Class.'+d.data.classId+'.Model',Ext.apply(d.data.attrs,{id:id,classId:d.data.classId}));return ea.originalData=$o.util.clone(d.data.attrs),this.objectsMap[id]=ea,ea}return null},startTransaction:function(options){let description=options?options.description:'',tr=Ext.Ajax.request({async:!1,url:'?sessionId='+this.sessionId,params:this.code+'.Storage.startTransaction("'+description+'")'});return tr=eval('('+tr.responseText+')').data,$o.inTransaction=!0,tr},commitTransaction:function(ea){Ext.Ajax.request({async:!1,url:'?sessionId='+this.sessionId,params:this.code+'.Storage.commitTransaction('+(ea||1)+')'}),$o.inTransaction=!1},rollbackTransaction:function(ea){Ext.Ajax.request({async:!1,url:'?sessionId='+this.sessionId,params:this.code+'.Storage.rollbackTransaction('+(ea||1)+')'}),$o.inTransaction=!1},execute:function(options){if(options=options||{},options.fn)Ext.Ajax.request({url:'plugins/?sessionId='+this.sessionId,params:JSON.stringify(options),success:function(response,opts){let o=eval('('+response.responseText+')');options.success&&options.success(o)},failure:function(ea){this.checkException(ea.responseText)}});else{let asArray=options.asArray;delete options.asArray;let sql=options.sql||options.query||options,r=Ext.Ajax.request({async:!1,url:'?sessionId='+this.sessionId,params:this.code+'.Storage.execute([!'+JSON.stringify(sql)+'!])',paramsEncode:!1});options.noException||this.checkException(r);let o=eval('('+r.responseText+')');if(o.header&&o.header.error)return o.header;if(asArray){let ea=[];return _.each(o.data,function(aa,ia){let la={};for(let ra=0;ra<sql.select.length/2;ra++)la[sql.select[2*ra+1]]=o.data[ia][ra];ea.push(la)}),ea}o.data.fields={};for(let ea=0;ea<sql.select.length/2;ea++)o.data.fields[sql.select[2*ea+1]]=ea,o.data.fields[ea]=ea;return o.data.get=function(ea,aa){let ia=this.fields[aa];if(null==ia)throw new Error('result.get: col unknown (row:'+ea+',col:'+aa+')');let la=this[ea][ia];return void 0==la&&(la=null),la},o.data}},updateViewAttrsType:function(options){let view=options.view,query=view.get('query'),va=view.attrs;if(query){query=eval('('+query+')');let attrs={};for(let ea=0,aa;ea<query.select.length;ea++)if(aa=query.select[ea],'object'==typeof aa){for(var ia in aa)break;attrs[query.select[ea+1]]={alias:ia,attr:aa[ia]}}let aliasClass={};for(let ea=0,aa;ea<query.from.length;ea++)if(aa=query.from[ea],'object'==typeof aa){for(var ia in aa)break;ea&&'left-join'!=query.from[ea-1]&&'inner-join'!=query.from[ea-1]||(aliasClass[ia]=aa[ia])}for(let ea in attrs){let aa=attrs[ea],ia=$o.getClass({code:aliasClass[aa.alias]});va[ea]&&(va[ea].set('class',ia.get('id')),va[ea].set('classAttr','id'!=aa.attr&&ia.attrs[aa.attr]?ia.attrs[aa.attr].get('id'):null))}}},createObject:function(ea,aa){if(this.isReadOnly())throw common.message($o.getString('Can\'t change data')),new Error($o.getString('Can\'t change data'));let ia=this.getClass(ea).get('id'),la='local'==aa?'root':null;this.nextLocalId=this.nextLocalId||-1;let ra=Ext.create('$o.Class.'+ia+'.Model',{id:la?this.nextLocalId:null,classId:ia});return ra.local=la,ra.localChilds={},ra.originalData={classId:ia},la&&(this.objectsMap[this.nextLocalId]=ra,this.nextLocalId--),(this.fireEvent('afterCreateObject',{classId:ia,object:ra}),ra)},removeObject:function(ea){if(this.isReadOnly())throw common.message($o.getString('Can\'t change data')),new Error($o.getString('Can\'t change data'));ea&&(this.fireEvent('beforeRemoveObject',{objectId:ea}),Ext.Ajax.request({async:!1,url:'?sessionId='+this.sessionId,params:this.code+'.Object.remove('+ea+')'}),delete this.objectsMap[ea])},createClass:function(ea){let aa=this,ia=Ext.create('$o.Class.Model');for(let la in ea)ia.set(la,ea[la]);return ia},createClassAttr:function(ea){let aa=this,ia=Ext.create('$o.ClassAttr.Model');for(let la in ea){let ra=la;'typeId'==ra&&(ra='type');'classId'==ra&&(ra='class');ia.set(ra,ea[la])}return ia},createView:function(ea){let aa=this,ia=Ext.create('$o.View.Model');for(let la in ea)ia.set(la,ea[la]);return ia},createViewAttr:function(ea){let aa=this,ia=Ext.create('$o.ViewAttr.Model');for(let la in ea)ia.set(la,ea[la]);return ia},createAction:function(ea){let aa=this,ia=Ext.create('$o.Action.Model');for(let la in ea)ia.set(la,ea[la]);return ia},updateDefaultView:function(){let ea=this,aa;if(ea.get('view'))try{aa=$o.getView(ea.get('view'))}catch(ua){}aa||(aa=$o.createView(),aa.set('class',ea.get('id')),aa.set('system',1),aa.set('name',ea.get('name')),aa.set('code','classView.'+ea.getFullCode()),aa.sync(),ea.set('view',aa.get('id')),ea.sync());let ia=1;for(let ua in aa.attrs)aa.attrs[ua].order&&aa.attrs[ua].order>=ia&&(ia=aa.attrs[ua].order+1);let la=['id'],ra={select:[{a:'id'},'id'],from:[{a:ea.getFullCode()}],order:[{a:'id'}]};if(!aa.attrs.id){let ua=$o.createViewAttr({name:'id',code:'id',view:aa.get('id'),area:1,width:50,'class':ea.get('id'),order:ia++,classAttr:null});ua.sync()}for(let ua in ea.attrs){let ga=ea.attrs[ua];if(la.push(ua),!aa.attrs[ua]){let pa=$o.createViewAttr({name:ga.get('name'),code:ua,view:aa.get('id'),area:1,width:75,'class':ea.get('id'),order:ia++,classAttr:ga.get('id')});pa.sync()}ra.select.push({a:ua}),ra.select.push(ua)}let da={olap:{id:'cmp-1',classView:ea.getFullCode()}};for(let ua in ra=JSON.stringify(ra,null,'\t'),da=JSON.stringify(da,null,'\t'),(aa.get('query')!=ra||aa.get('layout')!=da)&&(aa.set('query',ra),aa.set('layout',da),aa.sync()),aa.attrs)if(-1==la.indexOf(ua)){let ga=aa.attrs[ua];ga.remove(),ga.sync()}},updateDefaultActions:function(){let ea=this,aa=common.execSQL({select:[{a:'___fid'},'id',{a:'___fcode'},'code'],from:[{a:'system.action'}],where:[{a:'___fend_id'},'=',2147483647,'and',{a:'___fclass_id'},'=',ea.get('id')],order:[{a:'___fid'}]}),ia={};for(let ga=0;ga<aa.length;ga++)ia[aa.get(ga,'code')]=aa.get(ga,'id');let ra='var me = this;\\nvar id = options.id || me.getValue ("id");\\ncommon.tpl.show.call (this, {\\n\\tid: id,\\n\\tasWindow: 1,\\n\\treadOnly: options.readOnly,\\n\\tlayout: common.tpl.updateTags (\\n\\t\\t'+ea.getFullCode()+'.card.layout, {\n\t\t\tid: id\n\t\t}\n\t)\n});\n';if(!ia.card){let ga=$o.createAction();ga.set('class',ea.get('id')),ga.set('name',$o.getString('Open')),ga.set('code','card'),ga.set('layout',JSON.stringify({type:'card',layout:{card:{id:'card',items:[],object:[{cls:ea.getFullCode(),tag:'[#id]'}]}}},null,'\t')),ga.set('body',ra),ga.sync(),ga.initAction()}let na,oa='common.tpl.create.call (this, {\\n\\tasWindow: 1,\\n\\tclassCode: "'+ea.getFullCode()+'",\n\tfn: function (o, options) {\n\t\toptions.layout = common.tpl.updateTags (\n\t\t\t'+ea.getFullCode()+'.card.layout, {\n\t\t\t\tid: o.get ("id")\n\t\t\t}\n\t\t)\n\t}\n});\n';ia.create||(na=$o.createAction(),na.set('class',ea.get('id')),na.set('name',$o.getString('Add')),na.set('code','create'),na.set('layout','{"type": "create"}'),na.set('body',oa),na.sync(),na.initAction());let da;ia.remove||(da=$o.createAction(),da.set('class',ea.get('id')),da.set('name',$o.getString('Remove')),da.set('code','remove'),da.set('layout','{"type": "remove"}'),da.set('body','common.tpl.remove.call (this);\n'),da.sync(),da.initAction())},getConfObject:function(ea,aa){let ia;return'class'===ea?ia=$o.getClass(aa):'classAttr'===ea?ia=$o.getClassAttr(aa):'view'===ea?ia=$o.getView(aa):'viewAttr'===ea?ia=$o.getViewAttr(aa):'action'===ea?ia=$o.getAction(aa):void 0,ia},getRevisions:function(){let r=Ext.Ajax.request({async:!1,url:'get_revisions?sessionId='+$sessionId,params:'getRevisions ()'});return r=eval('('+r.responseText+')'),r},setRevision:function(revisionId){revisionId=revisionId||'';let r=Ext.Ajax.request({async:!1,url:'set_revision?sessionId='+$sessionId+'&id='+revisionId,params:'setRevision ('+revisionId+')'});return r=eval('('+r.responseText+')'),this.objectsMap={},this.revision=revisionId,this.app.tp.removeAll(),this.app.tp.doLayout(),r},copyFile:function(ea){Ext.Ajax.request({async:!1,url:'copy_file?sessionId='+$sessionId+'&src_object_id='+ea.src.objectId+'&src_class_attr_id='+ea.src.classAttrId+'&dst_object_id='+ea.dst.objectId+'&dst_class_attr_id='+ea.dst.classAttrId+'&filename='+ea.filename})},saveToFile:function(ea){Ext.Ajax.request({async:!1,params:ea.data,url:'save_to_file?sessionId='+$sessionId+'&object_id='+ea.objectId+'&class_attr_id='+ea.classAttrId+'&filename='+ea.filename})},isReadOnly:function(){if($o.userId){let ea=$o.getObject($o.userId);return ea.get('readOnly')}return!1},getString:function(ea){return $o.locale.getString(ea)},queueFn:[],pushFn:function(ea){let aa=this;aa.queueFn.push(ea)},executeQueueFunctions:function(){let aa=this;_.each(aa.queueFn,function(ia){ia()})}}),$o.util={},$o.util.clone=function(ea){if(!ea||'object'!=typeof ea)return ea;if('object'==typeof ea&&ea&&ea.getMonth)return new Date(ea.getTime());let aa='function'==typeof ea.pop?[]:{},ia,la;for(ia in ea)ea.hasOwnProperty(ia)&&(la=ea[ia],aa[ia]=la&&'object'==typeof la?$o.util.clone(la):la);return aa},$o.util.setCookie=function(ea,aa,ia,la,ra,na){let oa=ea+'='+escape(aa),da=new Date;da.setDate(da.getDate()+30),la=la||da,la&&(oa+='; expires='+la.toStringOriginal());ia&&(oa+='; path='+escape(ia));ra&&(oa+='; domain='+escape(ra));na&&(oa+='; secure');document.cookie=oa},$o.util.removeCookie=function(ea){let aa=new Date;aa.setTime(aa.getTime()-1),document.cookie=ea+='=; expires=-1'},$o.util.getCookie=function(ea){let aa=document.cookie.match('(^|;) ?'+ea+'=([^;]*)(;|$)');return aa?unescape(aa[2]):null},$o.util.getStyle=function(ea){let aa=document.styleSheets[0].rules||document.styleSheets[0].cssRules,ia;for(let la=0;la<aa.length;la++)if(aa[la].selectorText==ea){ia=aa[la].cssText?aa[la].cssText:aa[la].style.cssText;break}return ia},$o.util.isEmptyObject=function(ea){if(!ea)return!0;for(let aa in ea)if(Object.prototype.hasOwnProperty.call(ea,aa))return!1;return!0},$o.util.loadCSS=function(ea,aa){let ia=document.createElement('link');ia.setAttribute('rel','stylesheet'),ia.setAttribute('type','text/css'),ia.setAttribute('href',ea),aa&&(ia.onreadystatechange===void 0?ia.onload=aa:ia.onreadystatechange=function(){('complete'==this.readyState||'loaded'==this.readyState)&&aa()}),document.getElementsByTagName('head')[0].appendChild(ia)},$o.util.loadJS=function(ea,aa){let ia=document.createElement('script');ia.src=ea,ia.type='text/javascript',ia.language='javascript';let la=document.getElementsByTagName('head')[0];aa&&(ia.onreadystatechange===void 0?ia.onload=aa:ia.onreadystatechange=function(){('complete'==this.readyState||'loaded'==this.readyState)&&aa()}),la.appendChild(ia)},$o.util.sha1=hex_sha1,$zu=$o.util,'object'!=typeof JSON&&(JSON={}),function(){'use strict';function f(ea){return 10>ea?'0'+ea:ea}function quote(ea){return escapable.lastIndex=0,escapable.test(ea)?'"'+ea.replace(escapable,function(aa){var ia=meta[aa];return'string'==typeof ia?ia:'\\u'+('0000'+aa.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+ea+'"'}function str(ea,aa){var oa=gap,ua=aa[ea],ia,la,ra,na,da;switch(ua&&'object'==typeof ua&&'function'==typeof ua.toJSON&&(ua=ua.toJSON(ea)),'function'==typeof rep&&(ua=rep.call(aa,ea,ua)),typeof ua){case'string':return quote(ua);case'number':return isFinite(ua)?ua+'':'null';case'boolean':case'null':return ua+'';case'object':if(!ua)return'null';if(gap+=indent,da=[],'[object Array]'===Object.prototype.toString.apply(ua)){for(na=ua.length,ia=0;ia<na;ia+=1)da[ia]=str(ia,ua)||'null';return ra=0===da.length?'[]':gap?'[\n'+gap+da.join(',\n'+gap)+'\n'+oa+']':'['+da.join(',')+']',gap=oa,ra}if(rep&&'object'==typeof rep)for(na=rep.length,ia=0;ia<na;ia+=1)'string'==typeof rep[ia]&&(la=rep[ia],ra=str(la,ua),ra&&da.push(quote(la)+(gap?': ':':')+ra));else for(la in ua)Object.prototype.hasOwnProperty.call(ua,la)&&(ra=str(la,ua),ra&&da.push(quote(la)+(gap?': ':':')+ra));return ra=0===da.length?'{}':gap?'{\n'+gap+da.join(',\n'+gap)+'\n'+oa+'}':'{'+da.join(',')+'}',gap=oa,ra;}}'function'!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null},_Stringprototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},gap,indent,rep;'function'!=typeof JSON.stringify&&(JSON.stringify=function(ea,aa,ia){var la;if(gap='',indent='','number'==typeof ia)for(la=0;la<ia;la+=1)indent+=' ';else'string'==typeof ia&&(indent=ia);if(rep=aa,aa&&'function'!=typeof aa&&('object'!=typeof aa||'number'!=typeof aa.length))throw new Error('JSON.stringify');return str('',{'':ea})}),'function'!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(ea,aa){var ra=ea[aa],ia,la;if(ra&&'object'==typeof ra)for(ia in ra)Object.prototype.hasOwnProperty.call(ra,ia)&&(la=walk(ra,ia),void 0===la?delete ra[ia]:ra[ia]=la);return reviver.call(ea,aa,ra)}var j;if(text+='',cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(ea){return'\\u'+('0000'+ea.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,'')))return j=eval('('+text+')'),'function'==typeof reviver?walk({'':j},''):j;throw new SyntaxError('JSON.parse')})}(),Ext.define('$o.Base.Grid',{createButton:function(action){let me=this,item={scope:me,handler:function(){if(action.type&&'report'==action.type)me.report(action);else if(_fn){item.noTransaction=item.noTransaction||(item.arguments?item.arguments.noTransaction:null);try{_fn='string'==typeof _fn?eval('('+_fn+')'):_fn}catch(ea){throw common.message($o.getString('Function not exists')+': '+_fn),new Error('action.fn exception: '+_fn+'\nexception: '+ea)}item.noTransaction||$o.startTransaction({description:'***prepare_transaction*** action started'});let a=$o.util.clone(item.arguments);if($o.debug||a&&a.debug)_fn.call(me,a||{}),item.noTransaction||$o.commitTransaction();else try{_fn.call(me,a||{}),item.noTransaction||$o.commitTransaction()}catch(ea){throw item.noTransaction||$o.rollbackTransaction(),console.log(ea.stack),new Error(ea)}}}};if(Ext.apply(item,action),action.code&&(item.text=$o.locale.getString(action.code),item.iconCls=action.code),(item.iconCls=item.iconCls||item.icon,item.text=$o.locale.getString(action.text||action.caption),action.actions)){item.menu={items:[]};for(let ea=0;ea<action.actions.length;ea++)item.menu.items.push(me.createButton(action.actions[ea]))}let _fn=item.fn||item.id;return item.id=void 0,item},report:function(ea){let aa=this,ia=function(){let la='report?',ra;for(ra in ea.arguments)la+=Ext.isArray(ea.arguments[ra])?ra+'='+aa.zview.getCurrentValue(ea.arguments[ra][0],ea.arguments[ra][1])+'&':ra+'='+ea.arguments[ra]+'&';la+='storage='+$o.code+'&sessionId='+$sessionId+'&username='+$o.currentUser+'&time_offset_min='+new Date().getTimezoneOffset();let na=window.open(la);na.focus()};if(ea.fn){ea.arguments.success=function(){ia()};try{ea.fn.call(aa,ea.arguments)}catch(la){return void alert(la)}}ea.arguments.hasCallback||ia(aa)},createViewModel:function(ea){let aa=ea.view,ia=aa.get('id');$o.updateViewAttrsType({view:aa});let la=[];for(let ra in aa.attrs){let na=aa.attrs[ra],oa=null==na.get('classAttr')?'number':$o.classAttrsMap[na.get('classAttr')].getDataType(),da=null==na.get('classAttr')?'numeric':$o.classAttrsMap[na.get('classAttr')].getFilterDataType();la.push({name:na.get('code'),header:na.get('name'),type:oa,filterType:da,order:na.get('order'),id:na.get('id'),area:na.get('area'),width:na.get('width'),useNull:!0})}return la.sort(function(ra,na){return null!==ra.order&&null!==na.order&&ra.order<na.order?-1:null!=ra.order&&null==na.order?-1:ra.order==na.order&&ra.id<na.id?-1:null!==ra.order&&null!==na.order&&ra.order>na.order?1:null==ra.order&&null!=na.order?1:ra.order==na.order&&ra.id>na.id?1:0}),aa.orderedFields=$o.util.clone(la),la},beforeSelectListener:function(){},selectionChangeListener:function(){for(let aa in this.targets){let ia=this.targets[aa];ia.refresh&&ia.refresh({moveFirst:1})}this.checkActions()},checkActions:function(){let tbar=this.getDockedItems('toolbar[dock=\'top\']')[0];if(tbar)for(let i=0,b;i<tbar.items.getCount();i++)if(b=tbar.items.getAt(i),b.active){let fn,args;'function'==typeof b.active?fn=b.active:'string'==typeof b.active?fn=eval(b.active):'object'==typeof b.active&&(fn=b.active.fn,args=b.active.arguments);let active=fn.call(this,args);active?b.enable():b.disable()}},buildToolbar:function(){let ea=this;if(ea.actions){let aa=[];for(let ia=0;ia<ea.actions.length;ia++)aa.push(ea.createButton(ea.actions[ia]));aa.length&&(ea.dockedItems=ea.dockedItems||[],ea.dockedItems.push({xtype:'toolbar',dock:ea.actionsDock||'top',items:aa}))}},getCurrentValue:function(ea){let aa;if(this.getSelectionModel().hasSelection()){let ia=this.getSelectionModel().getSelection()[0];aa=ia.get(ea)}return aa},getValue:function(ea){return this.getCurrentValue(ea)},getCurrentValues:function(ea){let aa=[];if(this.getSelectionModel().hasSelection()){let ia=this.getSelectionModel().getSelection();for(let la=0;la<ia.length;la++)aa.push(ia[la].get(ea))}return aa},getValues:function(ea){return this.getCurrentValues(ea)},getUserFilter:function(){let ea=this;if(!ea.filters)return[];let aa=ea.filters.getFilterData(),ia=[],la={eq:'=',lt:'<',gt:'>',neq:'<>',lte:'<=',gte:'>='};for(let ra=0;ra<aa.length;ra++){ra&&ia.push('and');let na=aa[ra];if('object'==typeof na.data.value&&na.data.value.isNotNull)ia.push(na.field),ia.push('is not null');else if('object'==typeof na.data.value&&na.data.value.isNull)ia.push(na.field),ia.push('is null');else if(na.data.type&&'boolean'==na.data.type)na.data.value?ia.push([na.field,'=',1]):ia.push([na.field,'=',0,'or',na.field,'is null']);else{ia.push(na.field);let oa='like';na.data.comparison&&(oa=la[na.data.comparison]);let da=na.data.value;'like'==oa&&da&&('object'==typeof da?(da.notLike&&(oa='not like'),-1<da.value.indexOf(',')?(oa=da.notLike?'not in':'in',na.data.value=da.value.split(',').join('.,.').split('.')):na.data.value=da.value+'%'):na.data.value+='%');ia.push(oa),ia.push(na.data.value)}}return ia},getFilter:function(){let me=this,cf=[],uf=me.getUserFilter();if(!me.filter)return uf;'string'==typeof me.filter&&(me.filter={fn:eval(me.filter)}),'function'==typeof me.filter&&(me.filter={fn:me.filter});let disabled=!1,get=function(ea){if('[object Array]'===Object.prototype.toString.apply(ea)){let aa=[];for(let ia=0;ia<ea.length;ia++)aa.push(get(ea[ia]));return aa}if('object'==typeof ea&&ea.id){me.relatives[ea.id].targets[me.zid]=me;let aa=me.zview.getCurrentValue(ea.id,ea.attr);return void 0==aa?(me.setDisabled(!0),disabled=!0,void 0):(me.setDisabled(!1),aa)}return ea};if(me.filter.fn){if(cf=me.filter.fn.call(me,me.filter.arguments),cf=get(cf),disabled&&(cf=void 0),void 0==cf)return me.setDisabled(!0),void 0;me.setDisabled(!1)}else cf=get(me.filter),disabled&&(cf=void 0);return'[object Array]'===Object.prototype.toString.apply(cf)&&(cf.length&&uf.length&&cf.push('and'),cf=cf.concat(uf)),cf},getFullFilter:function(){return this.getFilter()},cellRenderer:function(value,metaData,record,rowIndex,colIndex,store){if(metaData.userStyle=void 0,this.lconfig&&this.lconfig.listeners&&this.lconfig.listeners.cellRenderer){'string'==typeof this.lconfig.listeners.cellRenderer&&(this.lconfig.listeners.cellRenderer=eval(this.lconfig.listeners.cellRenderer));let scope=this.lconfig.listeners.cellRenderer.scope||this.lconfig.listeners.scope||this;'view'==scope&&(scope=this.zview),'this'===scope&&(scope=this);let _fn=this.lconfig.listeners.cellRenderer.fn||this.lconfig.listeners.cellRenderer;'string'==typeof _fn&&(_fn=eval(_fn)),value=_fn.call(scope,value,metaData,record,rowIndex,colIndex,store,this.lconfig.listeners.cellRenderer.arguments)}if(value){let ea=value;'string'==typeof ea&&(ea=ea.split('"').join('\'')),metaData.tdAttr='data-qtip="'+ea+'"'}if(metaData.userStyle){let ea='';ea+=metaData.userStyle||'',metaData.tdAttr+=' style="'+ea+'"'}return this.wordWrap&&(metaData.style='white-space: normal;'),value},userEventListener:function(options){if(!this.lconfig)return;let listeners=this.lconfig.listeners,scope=this;if(listeners&&listeners.scope&&(scope=listeners.scope),listeners&&listeners[options.event])if(listeners[options.event].fn){listeners[options.event].scope&&(scope=listeners[options.event].scope);let fn='string'==typeof listeners[options.event].fn?eval('('+listeners[options.event].fn+')'):listeners[options.event].fn,args=$o.util.clone(listeners[options.event].arguments);fn.call(scope,args||{})}else{let fn='string'==typeof listeners[options.event]?eval('('+listeners[options.event]+')'):listeners[options.event];fn.call(scope,{})}},getGroupedColumns:function(ea){let la=function(na){let oa=function(ga){let pa=0;for(let ma=0,fa;ma<ga.length;ma++)fa=ga[ma].split(':'),fa.length>pa&&(pa=fa.length);return pa}(na),da=[];for(let ga=0,pa;ga<na.length;ga++){pa=na[ga].split(':');for(let ma=0;ma<pa.length;ma++)pa[ma]={text:pa[ma].trim(),colspan:1,rowspan:1};for(let ma=0,fa=oa-pa.length;ma<fa;ma++)pa.push({text:null,colspan:1,rowspan:1});da.push(pa)}for(let ga=1;ga<na.length;ga++)for(let pa=0,ma;pa<oa;pa++)ma=da[ga-1][pa].hasOwnProperty('ref')?da[ga-1][pa].ref:ga-1,null!=da[ga][pa].text&&da[ga][pa].text==da[ma][pa].text&&(da[ma][pa].colspan++,da[ga][pa].ref=ma);for(let ga=0;ga<na.length;ga++)for(let pa=1,ma;pa<oa;pa++)ma=da[ga][pa-1].hasOwnProperty('refR')?da[ga][pa-1].refR:pa-1,null==da[ga][pa].text&&(da[ga][ma].rowspan++,da[ga][pa].refR=ma);let ua=[];for(let ga=0;ga<oa;ga++){let pa=[],ma=1;for(let fa=0;fa<na.length;fa++){if(da[fa][ga].hasOwnProperty('refR')){ma+=da[fa][ga].colspan;continue}da[fa][ga].hasOwnProperty('ref')||(pa.push({text:da[fa][ga].text,colspan:da[fa][ga].colspan,rowspan:da[fa][ga].rowspan,index:ma}),ma+=da[fa][ga].colspan)}ua.push(pa)}return ua}(_.map(ea,function(na){return na.header})),ra=function(na,oa){let da=function(ga,pa){let ma=[];return _.each(na[ga],function(fa){if(!pa||fa.index>=pa.index&&fa.index<pa.index+pa.colspan){let ha=[];ga+1<na.length&&(ha=da(ga+1,fa)),ha.length?ma.push({text:fa.text,columns:ha}):(oa[fa.index-1].header=fa.text,oa[fa.index-1].tooltip=fa.text,ma.push(oa[fa.index-1]))}}),ma},ua=da(0);return ua}(la,ea);return ra}}),Ext.define('$o.Grid.Widget',{extend:'Ext.grid.Panel',mixins:{baseGrid:'$o.Base.Grid'},alias:['widget.$o.grid'],columnLines:!0,rowLines:!0,total:{},totalValues:{},groupedColumns:!0,initComponent:function(){let ea=this,aa,ia;if(ea.classView){function na(){let da=$o.inTransaction;da||$o.startTransaction(),oa.updateDefault(),da||$o.commitTransaction()}let oa=$o.getClass(ea.classView);if(oa.get('view')||na(),aa=$o.getView(oa.get('view')),ea.recreateView||-1<aa.get('query').indexOf('left-join')){let da=$o.inTransaction;da||$o.startTransaction(),aa.remove(),aa.sync(),oa.set('view',null),oa.sync(),na(),da||$o.commitTransaction()}ia=oa.get('view')}else aa=ea.queryId?$o.viewsMap[ea.queryId]:$o.getView({code:ea.$query}),ia=ea.viewId=aa.get('id');ea.$view=aa;aa.get('query');delete ea.query;let ra=ea.createViewModel({view:aa});ea.columns=[];for(let na=0;na<ra.length;na++){let oa=ra[na],da={header:$o.getString(oa.header),tooltip:$o.getString(oa.header),dataIndex:oa.name,hidden:1!=oa.area,width:oa.width,filter:{type:oa.filterType},$field:oa,renderer:ea.cellRenderer,scope:ea,summaryType:'count',summaryRenderer:ea.summaryRenderer};'bool'==oa.type&&(da.renderer=function(ua,ga,pa,ma,fa,ha){return ua=ua?$o.getString('Yes'):$o.getString('No'),ea.cellRenderer(ua,ga,pa,ma,fa,ha)}),ea.columns.push(da)}if(ea.groupedColumns&&(ea.columns=ea.getGroupedColumns(ea.columns)),_.each(ea.fields,function(na){na.header=''}),Ext.define('$o.View.'+ia+'.Model',{extend:'Ext.data.Model',fields:ra}),ea.store=Ext.create('Ext.data.Store',{model:'$o.View.'+ia+'.Model',pageSize:30,remoteSort:!0,clearOnPageLoad:!0,proxy:{type:'ajax',api:{create:'view?create=1&id='+ia+'&cmpId='+ea.id,read:'view?read=1&id='+ia+'&cmpId='+ea.id,update:'view?update=1&id='+ia+'&cmpId='+ea.id,'delete':'view?delete=1&id='+ia+'&cmpId='+ea.id},reader:{type:'json',root:'data'}},listeners:{load:function(){ea.down('*[name=rowsNum]')&&ea.down('*[name=rowsNum]').setText($o.getString('Amount')+': '+(ea.countOverflow?'>':'')+this.totalCount),ea.needReconfigureColumns&&(ea.needReconfigureColumns=!1,ea.reconfigureColumns())}}}),ea.dockedItems=ea.dockedItems||[],!ea.hideBottomToolbar){let na=[];ea.hidePrint||na.push({iconCls:'gi_print',tooltip:'\u041F\u0435\u0447\u0430\u0442\u044C',menu:{items:[{text:'*.xml ('+$o.getString('Table')+' XML - Microsoft Excel)',iconCls:'gi_print',handler:function(){ea.printOlap.call(this,'xmlss')}},{text:'*.csv (CSV - '+$o.getString('encoding')+' win-1251)',iconCls:'gi_print',handler:function(){ea.printOlap.call(this,'csv','win1251')}},{text:'*.csv (CSV - '+$o.getString('encoding')+' utf-8)',iconCls:'gi_print',handler:function(){ea.printOlap.call(this,'csv','utf8')}},{text:'*.xlsx (XLSX - Microsoft Excel)',iconCls:'gi_print',handler:function(){ea.printOlap.call(this,'xlsx')}},{text:'*.pdf (PDF)',iconCls:'gi_print',hidden:!common.getConf({code:'reportPDF'}).used,handler:function(){ea.printOlap.call(this,'pdf')}},{text:'*.ods (ODF - Open Document Format)',iconCls:'gi_print',handler:function(){ea.printOlap.call(this,'ods')}}]}}),ea.hideHeaders||(na.push({iconCls:'gi_restart',tooltip:$o.getString('Reset filters and totals'),handler:function(){ea.filters.clearFilters(),ea.total={},ea.totalValues={};let oa=ea.down('*[itemId=summaryBar]');oa.hide(),ea.refresh()}}),na.push({xtype:'label',name:'rowsNum',text:''})),ea.dockedItems.push({xtype:'pagingtoolbar',store:ea.store,dock:'bottom',beforePageText:'',afterPageText:$o.getString('of')+' {0}',items:na})}ea.filters={ftype:'filters',encode:!0,local:!1},ea.features=[ea.filters,{ftype:'summary',dock:'bottom',name:'summary'}],ea.buildToolbar(),ea.on('beforerender',ea.beforeRenderListener,ea),ea.on('render',ea.renderListener,ea),ea.on('itemdblclick',function(){ea.userEventListener({event:'dblclick'})},ea),ea.selModel=ea.selModel||Ext.create('Ext.selection.RowModel',{mode:!1==ea.singleSelect?'MULTI':'SINGLE',listeners:{beforeselect:{fn:ea.beforeSelectListener,scope:ea},selectionchange:{fn:ea.selectionChangeListener,scope:ea}}}),ea.relatives=ea.relatives||{},ea.relatives[ea.zid]=ea,ea.targets={},Ext.ux.grid.FiltersFeature.prototype.menuFilterText=$o.getString('Filter'),Ext.ux.grid.filter.BooleanFilter.prototype.yesText=$o.getString('Yes'),Ext.ux.grid.filter.BooleanFilter.prototype.noText=$o.getString('No'),Ext.ux.grid.filter.DateFilter.prototype.beforeEqText=$o.getString('Less or equal'),Ext.ux.grid.filter.DateFilter.prototype.beforeText=$o.getString('Less'),Ext.ux.grid.filter.DateFilter.prototype.afterEqText=$o.getString('More or equal'),Ext.ux.grid.filter.DateFilter.prototype.afterText=$o.getString('More'),Ext.ux.grid.filter.DateFilter.prototype.nonText=$o.getString('Not equal'),Ext.ux.grid.filter.DateFilter.prototype.onText=$o.getString('Equal'),Ext.ux.grid.filter.DateFilter.prototype.dateFormat='d.m.Y',Ext.ux.grid.menu.RangeMenu.prototype.menuItemCfgs.emptyText=$o.getString('Enter number')+' ...',ea.on('columnshow',function(){ea.needReconfigureColumns=!0}),ea.addEvents('refresh'),ea.callParent(arguments)},beforeRenderListener:function(){this.getFilter()&&this.store.load()},renderListener:function(){let ea=this;if(ea.checkActions(),$o.util.isEmptyObject(ea.total)){let la=ea.down('*[itemId=summaryBar]');la&&la.hide()}let aa=function(){this.down('*[name=totals]')&&this.remove(this.down('*[name=totals]'));let la=ea.query('gridcolumn'),ra=0;for(let na=0;na<la.length;na++)if(la[na].$field&&la[na].$field.name==ia.activeHeader.dataIndex){'number'==la[na].$field.type&&(ra=1);break}ra&&this.add([{text:$o.getString('Totals'),name:'totals',iconCls:'gi_calculator',menu:{defaults:{handler:function(){ea.total[ia.activeHeader.dataIndex]=this.name,ea.refresh();let na=ea.down('*[itemId=summaryBar]');na.show()}},items:[{text:$o.getString('Sum'),iconCls:'gi_calculator',name:'sum'},{text:$o.getString('Average'),iconCls:'gi_calculator',name:'avg'},{text:$o.getString('Max'),iconCls:'gi_calculator',name:'max'},{text:$o.getString('Min'),iconCls:'gi_calculator',name:'min'}]}}])},ia=ea.headerCt.getMenu();ia.on('activate',aa),ea.on('reconfigure',function(){ia=ea.headerCt.getMenu(),ia.on('activate',aa)})},summaryRenderer:function(ea,aa){let la=aa.column.dataIndex;return this.totalValues[la]},refresh:function(ea){let aa=this;if(aa.getFilter()){if(ea&&ea.moveFirst){let ia=aa.getDockedItems('pagingtoolbar');ia&&ia.length&&ia[0].moveFirst()}aa.store.reload(ea),aa.checkActions()}for(let ia in aa.targets){let la=aa.targets[ia];la.refresh&&la.refresh({moveFirst:1})}aa.fireEvent('refresh')},reconfigureColumns:function(){let ea=this,aa=[],ia=ea.down('headercontainer').getGridColumns();for(let la=0;la<ia.length;la++){let ra=ia[la],na={header:ra.text,tooltip:ra.tooltip,dataIndex:ra.dataIndex,hidden:ra.hidden,width:ra.width,filter:{type:ra.filter.type},$field:ra.$field,renderer:ra.renderer,scope:ra.scope};aa.push(na)}ea.reconfigure(null,aa)},selectRow:function(options){let me=this,viewFilter=me.getFilter(),r=Ext.Ajax.request({url:'?sessionId='+$sessionId,params:$o.code+'.View.selectRows('+me.viewId+', null, [!'+Ext.encode({viewFilter:viewFilter,selectFilter:options.filter})+'!])',async:!1}),rows=eval('('+r.responseText+')').data;0<rows.length&&(me.store.getProxy().extraParams={start:_Mathfloor(rows[0]/me.store.pageSize)*me.store.pageSize,limit:me.store.pageSize},me.store.load(function(){me.getSelectionModel().deselectAll(),me.getSelectionModel().select(rows[0]%me.store.pageSize)}))},printOlap:function(ea,aa){let ia=this,la=ia.up('grid').viewId;!la&&ia.up('grid').classView&&(la=$o.getClass(ia.up('grid').classView).get('view'));let ra='report?';ra+='format='+ea+'&view='+la+'&storage='+$o.code,aa&&(ra+='&coding='+aa);let na=ia.up('grid'),oa=ia.up('tabpanel'),da;if(oa&&(da=oa.getActiveTab().title),da||na.title){let ba='';da&&(ba+=da),na.title&&(ba&&(ba+=' - '),ba+=na.title),ra+='&filename='+ba,ra+='xmlss'==ea?'.xml':'.'+ea}let ua=na.getStore(),ga=JSON.stringify(na.getFilter()),pa;pa=ua.sorters.getCount()?'["'+ua.sorters.getAt(0).property+'","'+ua.sorters.getAt(0).direction+'"]':'null';let ma=new Date;ra+='&sessionId='+$sessionId+'&username='+$zp.currentUser+'&time_offset_min='+ma.getTimezoneOffset();let fa=ia.up('grid').query('gridcolumn'),ha=[];for(let ba=0,ya;ba<fa.length;ba++)if(ya=fa[ba].$field,ya){let wa={attrId:ya.id,attr:ya.name,header:ya.header,code:ya.id,hidden:fa[ba].hidden?1:0,width:fa[ba].width||75};ha.push(wa)}document.getElementById('loading').innerHTML='<form name=\'form_report\' method=\'post\' action=\''+ra+'\'><textarea style=\'display: none\' name=\'cols\'>'+JSON.stringify(ha)+'</textarea><textarea style=\'display: none\' name=\'filter\'>'+ga+'</textarea><textarea style=\'display: none\' name=\'total\'>'+JSON.stringify(na.total)+'</textarea><textarea style=\'display: none\' name=\'order\'>'+pa+'</textarea><textarea style=\'display: none\' name=\'options\'>'+JSON.stringify({dateAttrs:na.dateAttrs})+'</textarea></form>',document.forms.form_report.submit()}}),$o.pushFn(function(){Ext.define('$o.CompositeField.Widget',{extend:'Ext.form.FieldContainer',alias:'widget.compositefield',layout:'hbox',initComponent:function(){this.callParent(arguments)}}),Ext.define('$o.ObjectField.Widget',{extend:'Ext.form.FieldContainer',alias:['widget.objectfield','widget.$objectfield','widget.$o.objectfield'],layout:'hbox',initComponent:function(){let me=this;me.items=[{xtype:'button',iconCls:'gi_edit',style:{marginRight:1},handler:function(){let me=this;if(me.ro)return;me.choose=me.choose||{};let winWidth=me.choose.width||800,winHeight=me.choose.height||600;if(me.choose.fn&&'custom'==me.choose.type)return void me.choose.fn.call(me);me.choose.fn&&me.choose.fn.call(me);me.choose.listeners&&me.choose.listeners.beforeShow&&me.choose.listeners.beforeShow.call(me);let layout,view;if('layout'==me.choose.type)layout=$o.util.clone(me.choose.layout);else if(me.choose.id)view=$o.getView({code:me.choose.id}),layout=view.get('layout')||{olap:{id:'olap',view:me.choose.id}};else{let ea=$o.getObject(me.objectId),aa=$o.getClass(ea.get('classId')),ia=aa.attrs[me.attr];layout={olap:{id:'olap',classView:ia.get('type')}},me.choose.attr='olap.id'}'string'==typeof layout&&(layout=eval('('+layout+')'));me.fireEvent('beforechoose',{layout:layout});let attrs=me.choose.attr.split('.'),olap;view=Ext.create('$o.Layout.Widget',{record:view||$zs.views.ser.card,$layout:layout,listeners:{afterrender:function(){let ea;if(!(1<attrs.length))olap=view.items.items[0];else if(olap=view.relatives[attrs[0]],olap)ea=olap.getDockedItems('toolbar[dock=\'top\']')[0],ea&&(ea.insert(0,[btnChoose,btnCancel]),ea.doLayout());else return void common.message('\u042D\u043B\u0435\u043C\u0435\u043D\u0442 \''+attrs[0]+'\' \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D.');if(olap.selModel.on('selectionchange',function(){olap.getCurrentValue(attrs[attrs.length-1])?btnChoose.setDisabled(!1):btnChoose.setDisabled(!0)},this),olap.lconfig&&olap.lconfig.listeners&&olap.lconfig.listeners.dblclick&&delete olap.lconfig.listeners.dblclick,(olap.on('itemdblclick',function(){me.onChoose(view),setTimeout(function(){win.close()},100)},me),ea||(ea=win.getDockedItems('toolbar[dock=\'top\']')[0],ea.add([btnChoose,btnCancel]),ea.doLayout(),ea.setVisible(!0)),me.choose.hideActions)){let aa=win.query('button');for(let ia=0;ia<aa.length;ia++)-1<[$o.getString('Add'),$o.getString('Open'),$o.getString('Remove')].indexOf(aa[ia].text)&&aa[ia].hide()}},scope:me}});let btnChoose=Ext.create('Ext.Button',{text:$o.getString('Choose'),iconCls:'ok',disabled:!0,handler:function(){me.onChoose(view),win.close()},scope:me}),btnCancel=Ext.create('Ext.Button',{text:$o.getString('Cancel'),iconCls:'cancel',handler:function(){win.close()}}),win=Ext.create('Ext.Window',{title:$o.getString('Choose object'),resizable:!0,closable:!0,height:winHeight,width:winWidth,layout:'fit',modal:!0,tbar:Ext.create('Ext.Toolbar',{hidden:!0}),items:[view]});win.show()},scope:me},{xtype:'button',iconCls:'gi_remove',style:{marginRight:1},handler:function(){me.setValue(null),me.choose.listeners&&me.choose.listeners.afterChoose&&me.choose.listeners.afterChoose.call(me);me.fireEvent('change',null)}},{xtype:'textfield',flex:1,readOnly:!0,objectField:me,listeners:{render:function(ea){me.valueField=ea,me.value&&me.setValue(me.value);ea.getEl().on('mousedown',function(){me.down('button[iconCls=gi_edit]')&&me.down('button[iconCls=gi_edit]').handler.call(me)}),me.getActiveError=function(){return me.valueField.getActiveError.call(me.valueField,arguments)}},focus:function(){me.fireEvent('focus',me)}}}],me.hasOwnProperty('allowBlank')&&(me.items[me.items.length-1].allowBlank=me.allowBlank);me.readOnly&&(me.items.splice(0,2),me.addCls('readonly-field'));this.hasOwnProperty('allowBlank')&&!this.allowBlank&&this.fieldLabel&&(this.fieldLabel+='<span style=\'color: red !important\'>*</span>');me.addEvents('change','beforechoose'),me.listeners&&me.listeners.beforechoose&&'string'==typeof me.listeners.beforechoose&&(me.listeners.beforechoose=eval(me.listeners.beforechoose));me.callParent(arguments)},onChoose:function(ea){let aa=this,ia=(aa.choose.attr?aa.choose.attr:'olap.id').split('.'),la,ra,na;if(1==ia.length){for(la in ea.relatives)break;ra=ia[0]}else la=ia[0],ra=ia[1];let oa=aa.getValue();na=ea.relatives[la].getCurrentValue(ra),aa.setValue(na),aa.choose.listeners&&aa.choose.listeners.afterChoose&&aa.choose.listeners.afterChoose.call(aa,oa,na)},setValue:function(ea){let aa=this;if(aa.value=ea,ea){let ia=$o.getObject(ea);ea=ia?ia.toString():null}aa.valueField&&(aa.valueField.setValue(ea),ea?Ext.tip.QuickTipManager.register({target:aa.valueField.id,text:ea,width:300,dismissDelay:3e3}):Ext.tip.QuickTipManager.unregister(aa.valueField.getEl())),aa.fireEvent('change',aa.value)},getValue:function(){return this.value},setReadOnly:function(ea){let aa=this;aa.ro=ea,ea?(aa.items.getAt(0).hide(),aa.items.getAt(1).hide(),aa.addCls('readonly-field')):(aa.items.getAt(0).show(),aa.items.getAt(1).show(),aa.removeCls('readonly-field'))},validate:function(){return this.valueField.validate.call(this.valueField,arguments)},isValid:function(){return this.valueField.isValid.call(this.valueField,arguments)}}),Ext.define('$o.DateTimeField.Widget',{extend:'Ext.form.FieldContainer',alias:['widget.datetimefield','widget.$datetimefield'],layout:'hbox',initComponent:function(){let ea=this;ea.items=[{xtype:'datefield',width:90,readOnly:ea.readOnly,listeners:{render:function(aa){ea.dateField=aa,ea.value&&ea.setValue(ea.value)},focus:function(){ea.fireEvent('focus',ea)}}},{xtype:'timefield',width:80,readOnly:ea.readOnly,style:{marginLeft:1},listeners:{render:function(aa){ea.timeField=aa,ea.value&&ea.setValue(ea.value)},focus:function(){ea.fireEvent('focus',ea)}}}],ea.callParent(arguments)},setValue:function(ea){let aa=this;aa.value=ea,aa.dateField&&aa.timeField&&(aa.dateField.setValue(ea),aa.timeField.setValue(ea))},getValue:function(){let ea=this.dateField.getValue(),aa=this.timeField.getValue();return aa&&(ea.setHours(aa.getHours()),ea.setMinutes(aa.getMinutes()),ea.setSeconds(aa.getSeconds())),ea}}),Ext.define('$o.MultiSelect.Widget',{extend:'Ext.panel.Panel',alias:'widget.$multiselect',border:!0,layout:'fit',initComponent:function(){let ea=this;ea.title=ea.fieldLabel||ea.title;let aa={render:function(ia){ea.$multiselect=ia}};ea.listeners&&ea.listeners.change&&(aa.change=ea.listeners.change);ea.items={xtype:'multiselect',store:ea.store,valueField:ea.valueField,displayField:ea.displayField,ddReorder:ea.ddReorder,listeners:aa},ea.callParent(arguments)},getStore:function(){return this.$multiselect.getStore()},getValue:function(){return this.$multiselect.getValue()}}),Ext.define('$o.FileField.Widget',{extend:'Ext.form.FieldContainer',alias:'widget.$filefield',layout:'hbox',initComponent:function(){let ea=this;ea.items=[{xtype:'button',iconCls:'gi_upload',tooltip:$o.getString('Choose and upload file'),disabled:ea.readOnly,style:{marginRight:1},handler:function(){let aa=Ext.create('Ext.form.field.File',{fieldLabel:$o.getString('File'),buttonText:$o.getString('Choose'),name:'file-path'}),ia=Ext.create('Ext.form.Panel',{defaults:{anchor:'95%'},bodyStyle:'padding: 10px 10px 0 10px;',items:[{hidden:!0,xtype:'textfield',name:'objectId',value:ea.objectId},{hidden:!0,xtype:'textfield',name:'classAttrId',value:ea.ca.get('id')},aa],buttons:[{text:$o.getString('Upload'),iconCls:'gi_upload',handler:function(){ea.card.save({autoSave:!0}),ia.down('textfield[name=objectId]').setValue(ea.objectId),ia.getForm().submit({url:'upload?sessionId='+$sessionId+'&username='+$o.currentUser,waitMsg:$o.getString('File uploading')+' ...',success:function(ra,na){na.result.success?(ea.setValue(na.result.file),ea.card.save(),la.close(),common.message($o.getString('File')+' '+na.result.file+' '+$o.getString('uploaded'))):common.message($o.getString('File')+' '+na.result.file+' '+$o.getString('failed to send'))},failure:function(ra,na){common.message($o.getString('File','failed to send','.','Error',': ')+na.result.error)}})}},{text:$o.getString('Remove'),iconCls:'gi_remove',handler:function(){ea.getValue()&&common.confirm({message:$zr.getString('Are you sure?'),scope:this,fn:function(ra){'yes'==ra&&(ea.setValue(null),ea.card.save({filefield:!0}))}})}}]}),la=new Ext.Window({title:$o.getString('File uploading'),resizable:!1,closable:!0,height:114,width:500,layout:'fit',modal:!0,items:ia});la.show()},scope:ea},{xtype:'button',iconCls:'gi_download',tooltip:$o.getString('Download'),disabled:ea.readOnly,style:{marginRight:1},handler:function(){ea.download()}},{xtype:'textfield',flex:1,readOnly:!0,listeners:{render:function(){ea.value&&ea.setValue(ea.value)}}}],ea.callParent(arguments)},setValue:function(ea){this.down('field').setValue(ea)},getValue:function(){return this.down('field').getValue()},setReadOnly:function(ea){let aa=this;ea?(aa.items.getAt(0).hide(),aa.items.getAt(1).hide(),aa.addCls('readonly-field')):(aa.items.getAt(0).show(),aa.items.getAt(1).show(),aa.removeCls('readonly-field'))},download:function(){let ea=this,aa=ea.getValue();if(aa){let ia='files/'+ea.objectId+'-'+ea.ca.get('id')+'-'+aa,la=window.open(ia);la.focus()}}}),Ext.define('$o.ConfField.Widget',{extend:'$o.ObjectField.Widget',alias:['widget.conffield','widget.$conffield'],initComponent:function(){let ea=this;ea.addEvents('change'),ea.callParent(arguments),ea.setValue=function(aa){let ia=this;if(ia.value=aa,aa){let la=$o.getConfObject(ia.confRef,aa);aa=la.toString()}ia.valueField&&ia.valueField.setValue(aa),ia.fireEvent('change',ia.value)}}}),Ext.define('$o.CodeMirrorTextArea.Widget',{extend:'Ext.panel.Panel',alias:['widget.codemirrortextarea'],layout:'fit',border:0,initComponent:function(){let ea=this;ea.items={xtype:'textarea',width:'100%',height:'100%',value:ea.value,listeners:{afterrender:function(){let aa=this;dom=aa.inputEl.dom;let ia=function(){ea.editor=CodeMirror.fromTextArea(dom,{lineNumbers:!0,indentUnit:4,readOnly:!1,mode:ea.mode||'javascript',viewportMargin:Infinity}),ea.editor.setSize(aa.getWidth(),aa.getHeight()),ea.editor.on('change',function(){ea.fireEvent('change')})};window.CodeMirror?ia():$o.util.loadCSS('/third-party/codemirror/codemirror-4.3.css',function(){$o.util.loadJS('/third-party/codemirror/codemirror-4.3.min.js',function(){ia()})})},resize:function(aa,ia,la){ea.editor&&ea.editor.setSize(ia,la)}}},ea.addEvents('change'),ea.callParent(arguments)},setValue:function(ea){let aa=this;ea=ea||'',aa.editor?aa.editor.setValue(ea):aa.down('textarea').setValue(ea)},getValue:function(){let ea=this;return ea.editor?this.editor.getValue():ea.down('textarea').getValue()},setReadOnly:function(ea){let aa=this;ea?aa.disable():aa.enable()}}),Ext.define('$o.IconSelector.Widget',{extend:'Ext.form.FieldContainer',alias:['widget.$o.iconselector','widget.$iconselector'],layout:'hbox',fieldLabel:$o.getString('Icon'),initComponent:function(){let ea=this;ea.items=[{xtype:'button',iconCls:'gi_edit',name:'choose',height:22,handler:ea.choose,scope:ea,style:{marginRight:1}},{xtype:'button',iconCls:'gi_remove',height:22,style:{marginRight:5},handler:function(){ea.setValue(null),ea.fireEvent('change',null)}},{xtype:'button',name:'icon',width:22,height:22,iconCls:ea.value,handler:ea.choose,scope:ea,style:{marginRight:1}},{xtype:'textfield',name:'name',flex:1,value:ea.value?ea.value:'',listeners:{change:function(){ea.value=this.getValue()}}}],ea.addEvents('change'),ea.callParent(arguments)},getValue:function(){let ea=this;return ea.value},setValue:function(ea){let aa=this;aa.value=ea,aa.down('button[name=\'icon\']').setIconCls(ea?ea:''),aa.down('textfield[name=\'name\']').setValue(ea?ea:'')},getIconData:function(){let ea=[],aa=document.styleSheets;for(let la=0,ra;la<aa.length;la++)if(ra=aa[la].href,ra&&-1!=ra.indexOf('images.css')){let na=aa[la].cssRules;na||(na=aa[la].rules);for(let oa=0,da;oa<na.length;oa++){if(da=na[oa].selectorText,!da)continue;if(da.length&&(da=da.substr(1)),'gi_'!=da.substr(0,3))continue;let ua={},ga=na[oa].cssText;ga=ga.split('(')[1].split(')')[0],ua.url=ga,ua.iconCls=da,ea.push(ua)}}return ea.sort(function(la,ra){let na=la.iconCls,oa=ra.iconCls;return na>oa?1:na<oa?-1:0}),ea},setReadOnly:function(ea){let aa=this;ea?aa.down('button[name=\'choose\']').disable():aa.down('button[name=\'choose\']').enable()},choose:function(){let ea=this,aa=ea.getIconData(),ia=function(){na.close(),ea.setValue(this.iconCls),ea.fireEvent('change',this.iconCls)},la=[],ra=[];for(let oa=0;oa<aa.length;oa++)ra.push({iconCls:aa[oa].iconCls}),20<ra.length&&(la.push({layout:'hbox',defaults:{xtype:'button',handler:ia,style:'margin-right: 1px; margin-bottom: 1px'},items:ra}),ra=[]);ra.length&&la.push({layout:'hbox',defaults:{xtype:'button',handler:ia,style:'margin-right: 1px; margin-bottom: 1px'},items:ra});let na=Ext.create('Ext.Window',{width:500,height:570,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Choose icon'),bodyPadding:5,modal:1,items:{layout:'vbox',border:0,defaults:{border:0},items:la}});na.show()}})}),Ext.define('$o.Card.Widget',{extend:'Ext.panel.Panel',layout:'vbox',objectumCmp:'card',defaults:{width:'100%'},alias:['widget.$o.card','widget.$card'],bodyPadding:5,autoScroll:!0,initComponent:function(){let ea=this;ea.items=ea.items||ea.fields,ea.on('beforerender',ea.beforeRenderListener,ea),ea.on('afterrender',ea.afterRenderListener,ea),ea.on('beforedestroy',ea.beforeDestroyListener,ea),ea.$items=ea.items,ea.items=void 0,ea.relatives=ea.relatives||{},ea.relatives[ea.zid]=ea,ea.targets={},ea.$source=null,ea.buildToolbar(),ea.addEvents('beforeSave','aftersave','refresh'),ea.processListeners(),ea.readOnly=ea.readOnly||$o.isReadOnly(),ea.on('destroy',function(){ea.disableUnloadMessage()}),ea.callParent(arguments)},setFieldValues:function(){let ea=this;_.each(ea.items,function(aa){if(aa.objectId&&aa.attr&&!aa.value)try{aa.value=$o.getObject(aa.objectId).get(aa.attr)}catch(ia){}})},processListeners:function(){let me=this;for(let i in me.listeners=me.listeners||{},me.listeners.scope=me.listeners.scope||me,me.listeners){if('scope'==i)continue;let l=me.listeners[i];if('string'==typeof l)try{l=me.listeners[i]=eval(l)}catch(ea){}if('function'==typeof l)me.on(i,l,me.listeners.scope);else if(l.fn)if('string'==typeof l.fn)try{let fn=eval(l.fn),args=l.arguments||{};args.card=me,l.fn=_.bind(fn,me,args)}catch(ea){console.error(l.fn,ea)}else me.on(i,l.fn,l.scope||me.listeners.scope)}},beforeRenderListener:function(){this.createFields()},afterRenderListener:function(){let ea=this;_.each(ea.getItems(),function(ia){ia.on('change',function(){ea.autoSave||this.originalValue!=this.getValue()&&ea.enableUnloadMessage()})}),ea.refresh();let aa=ea.up('window')||ea.up('*[isTab=1]');if(aa){let ia=function(){if(ea.enabledUnloadMessage)return common.confirm({message:$o.getString('Data is not saved. Close?'),scope:this,fn:function(la){'yes'==la&&(aa.un('beforeclose',ia),aa.close())}}),!1};aa.on('beforeclose',ia)}},beforeDestroyListener:function(){this.autoSave&&this.save({autoSave:!0})},getClassAttr:function(ea){let aa=this,ia;if(ea.objectId){let la=$o.getObject(ea.objectId);la||console.error('bad objectId',ea);ia=la.getClassAttr(ea.attr),ia?ea.$attr=ea.attr:ia=-1}else if(ea.id&&ea.attr){let la=ea.attr.split('.')[0],ra=ea.attr.split('.')[1];aa.$source=aa.relatives[ea.id],aa.relatives[ea.id].targets[aa.zid]=aa;let na=aa.relatives[ea.id].$view.attrs,oa;if(na[la].get('classAttr')){let da=na[la].get('classAttr'),ua=$o.classAttrsMap[da];oa=$o.classesMap[ua.get('type')]}else oa=$o.classesMap[na[la].get('class')];ia=oa.attrs[ra],ia?(ea.$relative=aa.relatives[ea.id],ea.$objAttr=la,ea.$attr=ra,ea.id=void 0):ia=-1}return ia},updateItem:function(ea,aa,ia){let la=this,ra=aa.getFieldType(),na={fieldLabel:ea.caption||ea.fieldLabel||aa.get('name'),xtype:ra,card:this,ca:aa};if(la.readOnly&&(na.readOnly=!0),aa.get('secure')&&(na.inputType='password'),(aa.get('notNull')&&(ea.allowBlank=!1),ea.objectId)){let oa=$o.getObject(ea.objectId);na.value=na.originalValue=oa.get(ea.attr)}('textfield'==ra||'objectfield'==ra||'$filefield'==ra)&&(ea.width||(na.anchor='-20')),'textfield'==ra&&ea.height&&(na.xtype='textarea'),'numberfield'==ra&&(na.keyNavEnabled=!1,na.decimalPrecision=3),'datefield'==ra&&(!ea.hasOwnProperty('timefield')||ea.timefield)&&(na.xtype='datetimefield'),ia&&'compositefield'==ia.xtype&&(na.style={marginRight:5},delete na.fieldLabel),ea.listeners=ea.listeners||{},ea.listeners.focus=function(){la.down('*[name=fieldChanges]')&&la.down('*[name=fieldChanges]').enable(),la.focusedField=this},!1==ea.allowBlank&&(ea.listeners.afterrender||(ea.listeners.afterrender=function(){this.validate&&this.validate()})),na.vtype=aa.getVType(),Ext.applyIf(ea,na),ea.fieldLabel=$o.getString(ea.fieldLabel)},createFields:function(){let ea=this,aa=function(ia,la){ia||console.log(ia,la);let ra=ea.getClassAttr(ia);if(-1==ra?Ext.apply(ia,{xtype:'textfield',anchor:'-20',fieldLabel:$o.getString(ia.caption||ia.fieldLabel||'unknown'),labelStyle:'color: red;',style:'color: red;',readOnly:!0,value:$o.getString('Attribute not exists in storage')}):ra&&ea.updateItem(ia,ra,la),ia.items)for(let na=0;na<ia.items.length;na++)aa(ia.items.getAt?ia.items.getAt(na):ia.items[na],ia)};for(let ia=0;ia<ea.$items.length;ia++)aa(ea.$items[ia],null);ea.add(ea.$items),ea.doLayout()},getItems:function(ea){let aa=this,ia=[],la=function(ra){if(ra.$attr&&(ea&&ea.hidden||ra.isVisible&&ra.isVisible())&&ia.push(ra),ra.items)for(let na=0;na<ra.items.getCount();na++)la(ra.items.getAt(na))};for(let ra=0;ra<aa.items.getCount();ra++)la(aa.items.getAt(ra));return ia},getFields:function(ea){let aa=this,ia={},la=aa.getItems(ea);for(let ra=0,na;ra<la.length;ra++)na=la[ra],na.$attr&&(ia[na.$attr]=na);return ia},updateFields:function(){let ea=this,aa=ea.getItems();for(let ia=0,la;ia<aa.length;ia++){if(la=aa[ia],!la.$attr)continue;let ra=la.objectId=la.$relative?la.$relative.getCurrentValue(la.$objAttr):la.objectId,na=$o.getObject(ra);la.setValue||console.log(la),la.setValue(na.get(la.$attr)),la.originalValue=na.get(la.$attr)}},activeCondition:function(){let ea=this;if(ea.active){let aa=ea.active.fn.call(ea,ea.active.arguments),ia=ea.getItems();for(i=0;i<ia.length;i++){let la=ia[i];la.readOnly||la.setReadOnly(!aa)}if(!ea.readOnly&&!ea.hideToolbar&&!ea.autoSave){let la=ea.getDockedItems('toolbar[dock=\'top\']');la&&la.length&&la[0].setDisabled(!aa)}}},refresh:function(){let ea=this,aa=ea.$source;for(let ia in aa?aa.getSelectionModel().hasSelection()?(ea.setDisabled(!1),ea.updateFields()):ea.setDisabled(!0):ea.updateFields(),ea.activeCondition(),this.targets){let la=this.targets[ia];la.refresh&&la.refresh({moveFirst:1})}ea.disableUnloadMessage(),ea.fireEvent('refresh')},save:function(ea){ea=ea||{};let aa=this,ia=function(){let la=aa.getItems(),ra={},na=!1;for(let oa=0,da;oa<la.length;oa++){if(da=la[oa],ea.filefield&&'$filefield'!=da.xtype)continue;let ua=da.objectId;if(!ua)continue;let ga=$o.getObject(ua);if(!ga)continue;ra[ua]=ga;let pa=da.getValue();ga.get(da.$attr)!=pa&&(ga.getClassAttr(da.$attr).get('secure')&&(pa=$o.util.sha1(pa)),ga.set(da.$attr,pa),na=!0)}if(na||aa.hasListener('beforeSave')||aa.hasListener('aftersave')){$o.startTransaction({description:'Card saving'});try{try{aa.fireEvent('beforeSave',{card:aa})}catch(oa){console.error(oa)}for(let oa in ra){let da=ra[oa];da.commit('local'),0>oa&&_.each(la,function(ua){ua.objectId==oa&&(ua.objectId=da.get('id'))})}try{aa.fireEvent('aftersave',{card:aa})}catch(oa){console.error(oa),console.error(oa.stack)}$o.commitTransaction(),aa.$source&&aa.$source.refresh()}catch(oa){throw aa.getEl()&&aa.getEl().unmask(!0),common.message('<font color=red>'+$o.getString('Could not save data')+'</font><br>Error: '+oa+'<br>Stack: '+oa.stack),$o.rollbackTransaction(),oa}}for(let oa in ea.autoSave||(aa.getEl()&&aa.getEl().unmask(!0),aa.disableUnloadMessage()),aa.targets){let da=aa.targets[oa];da.refresh&&da.refresh({moveFirst:1})}ea&&ea.success&&ea.success.call(ea.scope||aa),aa.up('window')&&common.getConf({code:'closeWindowAfterSave'}).used&&(aa.up('window').close(),common.message($o.getString('Information saved')))};if(ea.autoSave)ia();else{let la=aa.getItems(),ra='';for(let na=0,oa;na<la.length;na++)if(oa=la[na],oa.getActiveError&&oa.getActiveError()){let da=oa.fieldLabel;!da&&oa.ownerCt&&oa.ownerCt.fieldLabel&&(da=oa.ownerCt.fieldLabel),ra+='<b>'+da+': '+(null==oa.getValue()?'':oa.getValue())+'</b> '+oa.getActiveError()+'<br>'}ra?common.message('<font color=red>'+$o.getString('Form contains errors')+':</font><br><br>'+ra):(aa.getEl()&&aa.getEl().mask('\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435 ...'),setTimeout(ia,300))}},onHighlight:function(){let ea=this,aa=[];_.each(ea.query('*'),function(ra){ra.objectId&&aa.push(ra.objectId)}),aa=_.uniq(aa);let ia=$o.execute({asArray:!0,select:[{a:'___fobject_id'},'objectId',{b:'___fcode'},'classAttrCode'],from:[{a:'system.object_attr'},'left-join',{b:'system.class_attr'},'on',[{a:'___fclass_attr_id'},'=',{b:'___fid'}]],where:[{a:'___fobject_id'},'in',aa.join('.,.').split('.')]}),la={};_.each(ia,function(ra){la[ra.objectId]=la[ra.objectId]||{},la[ra.objectId][ra.classAttrCode]=la[ra.objectId][ra.classAttrCode]||0,la[ra.objectId][ra.classAttrCode]++}),_.each(ea.query('*'),function(ra){ra.objectId&&la[ra.objectId]&&1<la[ra.objectId][ra.attr]&&ra.setFieldStyle('border: 2px solid orange')})},onFieldChanges:function(ea,aa){let ia=this,la='number'==typeof ea?ea:ia.focusedField.objectId,ra='number'==typeof ea?aa:ia.focusedField.$attr,na=$o.getObject(la),oa=$o.getClass(na.get('classId')),da=oa.attrs[ra],ua=$o.execute({select:[{a:'___fid'},'fid',{a:'___fstring'},'fstring',{a:'___fnumber'},'fnumber',{a:'___ftime'},'ftime',{b:'___fdate'},'fdate',{b:'___fsubject_id'},'fsubject_id',{b:'___fremote_addr'},'fremote_addr',{b:'___fdescription'},'fdescription',{c:'name'},'subject'],from:[{a:'system.object_attr'},'left-join',{b:'system.revision'},'on',[{a:'___fstart_id'},'=',{b:'___fid'}],'left-join',{c:'subject'},'on',[{b:'___fsubject_id'},'=',{c:'id'}]],where:[{a:'___fobject_id'},'=',la,'and',{a:'___fclass_attr_id'},'=',da.get('id')],order:[{b:'___fdate'},'desc']}),ga=[];for(let ba=0;ba<ua.length;ba++){let ya;if(ua.get(ba,'fsubject_id')){let Ca=$o.getObject(ua.get(ba,'fsubject_id')),Sa=_.filter(_.map(['login','surname','forename','patronymic','email','phone'],function(_a){return Ca.get(_a)}),function(_a){if(_a)return!0}).join(', ')}else ya='admin';let wa={date:ua.get(ba,'fdate'),subject:ya,ip:ua.get(ba,'fremote_addr'),description:ua.get(ba,'fdescription')},xa='';if(ua.get(ba,'fstring'))xa=ua.get(ba,'fstring');else if(ua.get(ba,'ftime'))xa=common.getTimestamp(ua.get(ba,'ftime'));else if(ua.get(ba,'fnumber')&&(xa=ua.get(ba,'fnumber'),1e3<=da.get('type'))){let Ca=$o.getObject(ua.get(ba,'fnumber'));xa=Ca.toString()}wa.value=xa,ga.push(wa)}let pa=Ext.create('Ext.data.Store',{data:ga,fields:[{name:'date',type:'string'},{name:'value',type:'string'},{name:'subject',type:'string'},{name:'ip',type:'string'},{name:'description',type:'string'}]}),ma=function(ba,ya){if(ba){let _a=ba;_a=_a.split('"').join('\''),ya.tdAttr='data-qtip="'+_a+'"'}return ya.style='white-space: normal;',ba},fa=Ext.create('Ext.grid.Panel',{store:pa,columns:[{header:$o.getString('Date'),width:100,dataIndex:'date',renderer:ma},{header:$o.getString('Value'),width:150,dataIndex:'value',renderer:ma},{header:$o.getString('User'),width:150,dataIndex:'subject',renderer:ma},{header:'IP',width:100,dataIndex:'ip',renderer:ma},{header:$o.getString('Revision comment'),width:150,dataIndex:'description',renderer:ma,hidden:!0}],forceFit:!0,frame:!1,deferRowRender:!1}),ha=new Ext.Window({title:$o.getString('Revision History'),resizable:!0,closable:!0,modal:!0,width:600,height:600,border:!1,iconCls:'gi_history',layout:'fit',items:fa});ha.show()},buildToolbar:function(){let ea=this;ea.tbarUser=ea.tbar||[],ea.tbar=[];ea.hideToolbar||ea.readOnly||ea.autoSave||$o.isReadOnly()||(ea.tbar=[{text:$o.getString('Save'),iconCls:'save',handler:ea.save,scope:ea},{text:$o.getString('Refresh'),iconCls:'refresh',handler:ea.refresh,scope:ea}],ea.showSaveAndClose&&ea.tbar.push({text:$o.getString('Save and close'),iconCls:'ok',handler:function(){this.save({success:function(){this.up('window').close()}})},scope:ea}),$o.visualObjectum&&$o.visualObjectum.timeMachine&&$o.visualObjectum.timeMachine.cardButton&&($o.visualObjectum.timeMachine.cardHighlight||window.monu?ea.tbar.push({text:$o.getString('Changes'),iconCls:'gi_history',menu:[{text:$o.getString('Revision History'),iconCls:'gi_history',name:'fieldChanges',disabled:1,handler:ea.onFieldChanges,scope:ea},{text:$o.getString('Show changed fields'),iconCls:'gi_history',handler:ea.onHighlight,scope:ea}]}):ea.tbar.push({text:$o.getString('Changes'),iconCls:'gi_history',name:'fieldChanges',disabled:1,handler:ea.onFieldChanges,scope:ea})));for(let aa=0;aa<ea.tbarUser.length;aa++)ea.tbar.push(ea.tbarUser[aa])},getChanged:function(){let ea=this,aa=[],ia=ea.getItems();for(i=0;i<ia.length;i++){let la=ia[i];if(la.isDirty()){let ra=la.getValue();la.ca.get('secure')&&(ra=$o.util.sha1(ra));let na={};na.attr=la.$attr,na.oldValue=la.originalValue,na.newValue=ra,na.fieldLabel=la.fieldLabel,na.xtype=la.xtype,aa.push(na)}}return aa},enableUnloadMessage:function(){this.enabledUnloadMessage=!0,window.onbeforeunload=function(ea){let aa=$o.getString('Data is not saved. You will lose changes if you leave the page');return'undefined'==typeof ea&&(ea=window.event),ea&&(ea.returnValue=aa),aa}},disableUnloadMessage:function(){this.enabledUnloadMessage=!1,window.onbeforeunload=void 0}}),Ext.define('$o.CardConf.Widget',{extend:'$o.Card.Widget',alias:['widget.$o.cardConf','widget.$cardConf'],initComponent:function(){let ea=this;ea.callParent(arguments)},updateItem:function(ea,aa){let ia=this,la={fieldLabel:ea.fieldLabel||ea.attr,xtype:'textfield',anchor:'-20',card:ia,conf:ea.conf};if(ia.readOnly&&(la.readOnly=!0),ea.confRef&&(la.xtype='conffield'),'number'==typeof ea.id){la.confId=ea.id;let ra=$o.getConfObject(ea.conf,ea.id);ra&&(la.value=la.originalValue=ra.get(ea.attr),ea.$attr=ea.attr)}else if('string'==typeof ea.id){let ra=ea.attr.split('.')[0],na=ea.attr.split('.')[1];ia.$source=ia.relatives[ea.id],ia.relatives[ea.id].targets[ia.zid]=ia,la.$relative=ia.relatives[ea.id],la.$idAttr=ra,la.$attr=na}aa&&'compositefield'==aa.xtype&&(la.style={marginRight:5},delete la.fieldLabel),delete ea.id,Ext.applyIf(ea,la)},createFields:function(){let ea=this,aa=function(ia,la){if(ia.conf&&ia.id&&ia.attr&&ea.updateItem(ia,la),ia.items)for(let ra=0;ra<ia.items.length;ra++)aa(ia.items.getAt?ia.items.getAt(ra):ia.items[ra],ia)};for(let ia=0;ia<ea.$items.length;ia++)aa(ea.$items[ia],null);ea.add(ea.$items),ea.doLayout()},updateFields:function(){let ea=this,aa=ea.getItems();for(let ia=0,la;ia<aa.length;ia++){if(la=aa[ia],!la.$attr)continue;let ra=la.confId=la.$relative?la.$relative.getCurrentValue(la.$idAttr):la.confId;if(ra){let na=$o.getConfObject(la.conf,ra);la.setValue||console.log(la),la.setValue(na.get(la.$attr)),la.originalValue=na.get(la.$attr)}}},save:function(ea){ea=ea||{};let aa=this,la=aa.getItems(),ra='';for(let na=0,oa;na<la.length;na++)if(oa=la[na],oa.getActiveError&&oa.getActiveError()){let da=oa.fieldLabel;!da&&oa.ownerCt&&oa.ownerCt.fieldLabel&&(da=oa.ownerCt.fieldLabel),ra+='<b>'+da+': '+(null==oa.getValue()?'':oa.getValue())+'</b> '+oa.getActiveError()+'<br>'}ra?common.message('<font color=red>'+$o.getString('Form contains errors')+':</font><br><br>'+ra):(aa.getEl()&&aa.getEl().mask($o.getString('Saving')+' ...'),setTimeout(function(){let na=aa.getItems(),oa={},da=!1;for(let ua=0;ua<na.length;ua++){let ga=na[ua],pa=ga.confId;if(!pa)continue;let ma=$o.getConfObject(ga.conf,pa);if(!ma)continue;oa[pa]=ma;let fa=ga.getValue();ma.get(ga.$attr)!=fa&&(ma.set(ga.$attr,fa),da=!0)}if(da){aa.fireEvent('beforeSave'),$o.startTransaction({description:'CardConf saving'});try{for(let ua in oa){let ga=oa[ua];ga.sync()}aa.fireEvent('afterSave'),$o.commitTransaction(),aa.$source&&aa.$source.refresh()}catch(ua){aa.getEl()&&aa.getEl().unmask(!0);throw $o.rollbackTransaction(),ua}}aa.getEl()&&aa.getEl().unmask(!0);ea&&ea.success&&ea.success.call(ea.scope||aa)},100))}}),Ext.define('$o.Tree.Widget',{extend:'Ext.tree.Panel',mixins:{baseGrid:'$o.Base.Grid'},alias:['widget.$o.tree'],useArrows:!0,rootVisible:!1,multiSelect:!0,columnLines:!0,rowLines:!0,scroll:!0,layout:'anchor',initComponent:function(){let ea=this,aa=ea.$view=ea.queryId?$o.viewsMap[ea.queryId]:$o.getView({code:ea.$query}),ia=ea.viewId=aa.get('id'),la=aa.get('query');delete ea.query;let ra=ea.createViewModel({view:aa});Ext.define('$o.View.'+ia+'.Model',{extend:'Ext.data.Model',fields:ra}),ea.columns=[],ea.$opened=[];for(let na=0;na<ra.length;na++){let oa=ra[na],da={text:$o.getString(oa.header),tooltip:$o.getString(oa.header),dataIndex:oa.name,hidden:1!=oa.area,width:oa.width,renderer:ea.cellRenderer,scope:ea};na||(da.xtype='treecolumn',da.locked=!0);'bool'==oa.type&&(da.renderer=function(ua,ga,pa,ma,fa,ha){return ua=ua?'\u0414\u0430':'\u041D\u0435\u0442',ea.cellRenderer(ua,ga,pa,ma,fa,ha)});ea.columns.push(da)}ea.store=Ext.create('Ext.data.TreeStore',{model:'$o.View.'+ia+'.Model',autoLoad:!1,root:{expanded:!1},proxy:{type:'ajax',api:{create:'treegrid?create=1&id='+ia+'&cmpId='+ea.id+'&fieldParent='+ea.fields.parent+'&fieldId='+ea.fields.id,read:'treegrid?read=1&id='+ia+'&cmpId='+ea.id+'&fieldParent='+ea.fields.parent+'&fieldId='+ea.fields.id,update:'treegrid?update=1&id='+ia+'&cmpId='+ea.id+'&fieldParent='+ea.fields.parent+'&fieldId='+ea.fields.id,'delete':'treegrid?delete=1&id='+ia+'&cmpId='+ea.id+'&fieldParent='+ea.fields.parent+'&fieldId='+ea.fields.id}},listeners:{load:ea.loadListener,expand:ea.expandListener,collapse:ea.collapseListener,scope:ea}}),ea.selModel=Ext.create('Ext.selection.TreeModel',{mode:!1==ea.singleSelect?'MULTI':'SINGLE',listeners:{beforeselect:{fn:ea.beforeSelectListener,scope:ea},selectionchange:{fn:ea.selectionChangeListener,scope:ea}}}),ea.bbar=[{iconCls:'refresh',handler:ea.refresh,scope:ea}],ea.on('beforerender',ea.beforeRenderListener,ea),ea.on('render',ea.renderListener,ea),ea.on('itemdblclick',function(){ea.userEventListener({event:'dblclick'})},ea),ea.on('cellcontextmenu',function(){ea.getSelectionModel().deselectAll()},ea),ea.buildToolbar(),ea.relatives=ea.relatives||{},ea.relatives[ea.zid]=ea,ea.targets={},ea.callParent(arguments)},beforeRenderListener:function(){this.getFilter()&&this.store.getRootNode().expand()},renderListener:function(){this.checkActions()},expandListener:function(ea){ea.isRoot()||-1==this.$opened.indexOf(ea.get(this.fields.id))&&this.$opened.push(ea.get(this.fields.id))},collapseListener:function(ea){ea.isRoot()||this.$opened.splice(this.$opened.indexOf(ea.get(this.fields.id)),1)},refresh:function(ea){let aa=this;ea=ea||{};let ia=ea.callback,la;aa.getSelectionModel().hasSelection()&&(la=aa.getSelectionModel().getSelection(),la=la[0]);aa.getFilter()&&(aa.store.getRootNode().isExpanded()?aa.store.load({callback:function(){if(la&&aa.getRootNode().findChild(aa.fields.id,la.get(aa.fields.id)))for(let ra=0,na;ra<aa.records.length;ra++)if(na=aa.records[ra],na.get(aa.fields.id)==la.get(aa.fields.id)){aa.getSelectionModel().deselectAll(),aa.getSelectionModel().select(na);break}ia&&ia.call(aa,la,aa.getStore(),!0)}}):aa.store.getRootNode().expand(),this.checkActions())},loadListener:function(ea,aa,ia){let na=this;na.records=na.records||[];let oa=na.fields.id,da=function(ua){for(let ga=0;ga<ua.length;ga++){let pa=ua[ga],ma=!1;for(let fa=0,ha;fa<na.records.length;fa++)if(ha=na.records[fa],pa.get(oa)==ha.get(oa)){na.records[fa]=pa,ma=!0;break}ma||na.records.push(pa);pa.childNodes&&da(pa.childNodes)}};da(ia)},selectRow:function(ea){let aa=this;if(ea.filter){let ia=ea.filter[2];for(let la=0,ra;la<aa.records.length;la++)if(ra=aa.records[la],ra.get(aa.fields.id)==ia){aa.getSelectionModel().deselectAll(),aa.getSelectionModel().select(ra);break}}}}),Ext.define('$o.Chart.Widget',{extend:'Ext.chart.Chart',alias:['widget.$o.chart'],style:'background:#fff',animate:!0,shadow:!0,overflowY:'auto',initComponent:function(){let ea=this,aa=ea.$view=ea.queryId?$o.viewsMap[ea.queryId]:$o.getView({code:ea.$query}),ia=ea.viewId=aa.get('id'),la=aa.get('query');delete ea.query;let ra=[ea.attrMark],na=[ea.attrValue],oa=ea.getData();ea.store=Ext.create('Ext.data.Store',{fields:['___name',ea.attrMark,ea.attrValue],data:oa}),ea.axes=[{type:'Numeric',position:'bottom',fields:na,minimum:0,label:{renderer:Ext.util.Format.numberRenderer('0,0')},grid:!0,title:ea.titleValue},{type:'Category',position:'left',fields:['___name'],title:ea.titleMark}],ea.series=[{type:'bar',axis:'bottom',xField:ea.attrMark,yField:na,title:ra,tips:{trackMouse:!0,width:300,height:50,renderer:function(da,ua){this.setTitle(ua.value[0]+' ('+da.get('n'+ua.yField.substr(1))+'): '+(null==ua.value[1]?'':ua.value[1]))}},label:{display:'insideEnd',field:ra}}],ea.relatives=ea.relatives||{},ea.relatives[ea.zid]=ea,ea.targets={},ea.callParent(arguments)},getData:function(){let ea=this,aa=ea.$view.get('query');if(aa=JSON.parse(aa),ea.filter){aa.where=aa.where||[],aa.where.length&&aa.where.push('and');let ra=$o.util.clone(ea.filter);for(let na=0;na<ra.length;na++){for(let oa=1;oa<aa.select.length;oa+=2)ra[na]==aa.select[oa]&&(ra[na]=aa.select[oa-1]);if(ra[na]&&'object'==typeof ra[na]&&ra[na].id&&ra[na].attr){if(ea.relatives[ra[na].id].targets[ea.zid]=ea,ra[na]=ea.relatives[ra[na].id].getValue(ra[na].attr),void 0==ra[na])return ea.disable(),[];ea.enable()}}aa.where.push(ra)}let ia=$o.execute({sql:aa}),la=[];for(let ra=0,na;ra<ia.length;ra++)na={},na[ea.attrMark]=ia.get(ra,ea.attrMark),na[ea.attrValue]=ia.get(ra,ea.attrValue),na.___name='',la.push(na);return la},refresh:function(ea){let aa=this;aa.refreshing||(aa.refreshing=1,ea=ea||{},aa.store.loadData(aa.getData()),aa.redraw(),aa.refreshing=0)}}),Ext.define('$o.Image.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.image'],border:0,initComponent:function(){let ea=this;ea.relatives=ea.relatives||{},ea.relatives[ea.zid]=ea,ea.targets={},ea.items={xtype:'image',src:ea.url,width:ea.width,height:ea.height,shrinkWrap:!0},ea.on('afterrender',ea.refresh,ea),ea.callParent(arguments)},refresh:function(){let aa=this;if(aa.attr){let ia=aa.relatives[aa.attr.split('.')[0]],la=aa.attr.split('.')[1];if(ia)if(ia.targets[aa.zid]=aa,'$o.card'==ia.xtype){let ra=ia.getItems(),na;for(let oa=0;oa<ra.length;oa++)if(ra[oa].objectId){na=ra[oa].objectId;break}if(na){let oa=$o.getObject(na);if(oa.get(la)){let da=$o.getClass(oa.get('classId')).attrs[la],ua='files/'+na+'-'+da.get('id')+'-'+oa.get(la);aa.down('image').setSrc(ua)}else aa.down('image').setSrc(null)}}else{let ra=ia.getValue(la);aa.down('image').setSrc(ra)}}}}),Ext.define('$o.Frame.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.frame'],border:0,initComponent:function(){let ea=this;ea.relatives=ea.relatives||{},ea.relatives[ea.zid]=ea,ea.targets={},ea.html='<iframe src="'+ea.url+'" frameborder="0" width="100%" height="100%">',ea.on('afterrender',ea.refresh,ea),ea.callParent(arguments)},refresh:function(){let aa=this;if(aa.attr){let ia=aa.relatives[aa.attr.split('.')[0]],la=aa.attr.split('.')[1];if(ia){ia.targets[aa.zid]=aa;let ra=ia.getValue(la);aa.update('<iframe src="'+ra+'" frameborder="0" width="100%" height="100%">')}}}}),Ext.define('$o.Layout.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.layout','widget.$layout'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){this.relatives={};let layout=this.$layout;!layout&&this.record&&this.record.stub&&(layout=this.record.stub.get('layout'),!layout&&this.record.get('query')&&(layout={olap:{id:'olap',view:this.record.getFullCode()}}));'object'!=typeof layout&&(layout=eval('('+layout+')'),'function'==typeof layout&&(layout=layout()));delete this.layout,this.addEvents('load'),this.on('afterrender',function(){this.fireEvent('load')},this),this.record=this.record||{},this.record.stub=this.record.stub||{},this.record.stub.get=this.record.stub.get||function(){},$o.app.fireEvent('viewLayout',{record:this.record,layout:layout}),this.items=this.process(layout);try{this.viewFullCode=$o.getView(this.record.get('id')).getFullCode()}catch(ea){}this.callParent(arguments)},processTab:function(ea){let aa={xtype:'tabpanel',zid:ea.id,items:[]};ea.items=ea.pages||ea.items;for(let ia=0;ia<ea.items.length;ia++)aa.items.push(this.process(ea.items[ia]));return delete ea.id,aa},processSplit:function(ea){let aa={layout:'border',border:!1,zid:ea.id,defaults:{border:!1}};return aa.items='horizontal'==ea.orientation?[{split:!0,region:'west',width:ea.width,layout:'fit',items:this.process(ea.pages?ea.pages[0]:ea.items[0])},{region:'center',layout:'fit',items:this.process(ea.pages?ea.pages[1]:ea.items[1])}]:[{split:!0,region:'north',height:ea.height||ea.width,layout:'fit',items:this.process(ea.pages?ea.pages[0]:ea.items[0])},{region:'center',layout:'fit',items:this.process(ea.pages?ea.pages[1]:ea.items[1])}],delete ea.id,aa},processOlap:function(ea){let aa={xtype:'$o.grid',zview:this,relatives:this.relatives,$query:ea.view,zid:ea.id,lconfig:{listeners:{}}};return ea.listeners&&ea.listeners.dblclick&&(aa.lconfig.listeners.dblclick=$o.util.clone(ea.listeners.dblclick),delete ea.listeners.dblclick),ea.listeners&&ea.listeners.cellRenderer&&(aa.lconfig.listeners.cellRenderer=$o.util.clone(ea.listeners.cellRenderer),delete ea.listeners.cellRenderer),(delete ea.view,delete ea.id,aa)},processChart:function(ea){let aa={xtype:'$o.chart',zview:this,relatives:this.relatives,$query:ea.view,zid:ea.id};return delete ea.view,delete ea.id,aa},processImage:function(ea){let aa={xtype:'$o.image',zview:this,relatives:this.relatives,url:ea.url,attr:ea.attr,width:ea.width,height:ea.height,zid:ea.id};return delete ea.id,aa},processFrame:function(ea){let aa={xtype:'$o.frame',zview:this,relatives:this.relatives,url:ea.url,attr:ea.attr,zid:ea.id};return delete ea.id,aa},processTreegrid:function(ea){let aa={xtype:'$o.tree',zview:this,relatives:this.relatives,$query:ea.view,zid:ea.id,lconfig:{listeners:{}}};return ea.listeners&&ea.listeners.dblclick&&(aa.lconfig.listeners.dblclick=$o.util.clone(ea.listeners.dblclick),delete ea.listeners.dblclick),ea.listeners&&ea.listeners.cellRenderer&&(aa.lconfig.listeners.cellRenderer=$o.util.clone(ea.listeners.cellRenderer),delete ea.listeners.cellRenderer),(delete ea.view,delete ea.id,aa)},processCard:function(ea){let aa={xtype:'$o.card',zview:this,relatives:this.relatives,zid:ea.id};return delete ea.id,aa},processCardConf:function(ea){let aa={xtype:'$o.cardConf',zview:this,relatives:this.relatives,zid:ea.id};return delete ea.id,aa},processPanel:function(ea){let aa={xtype:'panel',zview:this,relatives:this.relatives,zid:ea.id};return delete ea.id,aa},process:function(ea){let aa={};for(let ia in ea){let la=ea[ia];switch(ia){case'tab':aa=this.processTab(la);break;case'split':aa=this.processSplit(la);break;case'olap':aa=this.processOlap(la);break;case'treegrid':aa=this.processTreegrid(la);break;case'card':aa=this.processCard(la);break;case'cardConf':aa=this.processCardConf(la);break;case'panel':aa=this.processPanel(la);break;case'chart':aa=this.processChart(la);break;case'image':aa=this.processImage(la);break;case'frame':aa=this.processFrame(la);break;case'calendar':break;case'designer':break;default:return ea;}la.title=$o.locale.getString(la.title)||$o.locale.getString(la.caption),Ext.applyIf(aa,la)}return aa},getCurrentValue:function(ea,aa){let la=this.relatives[ea],ia;return la&&(ia=la.getCurrentValue(aa)),ia}}),Ext.define('$o.Classes.Widget',{extend:'$o.Layout.Widget',alias:['widget.$o.classes','widget.$classes'],initComponent:function(){let ea=this;ea.$layout={split:{orientation:'horizontal',width:290,pages:[{treegrid:{id:'olap',view:'system.classes',fields:{id:'id',parent:'parent_id'},filter:{fn:function(){return['end_id','=',2147483647,'and','id','>=',1000]},all:!0},actions:[{fn:function(){let aa=this;$zu.dialog.getNameAndCode({title:$o.getString('Class',':','Adding'),success:function(ia,la){let ra=!1;async.series([function(na){let oa=$o.getClass(aa.getCurrentValue('id'));oa&&'spr'==oa.getFullCode().split('.')[0]?common.confirm({message:$o.getString('Create standard dictionary (card, view)?'),scope:this,fn:function(da){'yes'==da&&(ra=!0),na()}}):na()}],function(){let oa=$o.startTransaction({description:'Create class '}),da=$o.createClass();da.set('parent',aa.getCurrentValue('id')),da.set('name',ia),da.set('code',la),da.sync(),da.updateDefault(),ra&&ea.createSpr(da),$o.commitTransaction(oa),aa.refresh({callback:function(ua,ga,pa){pa&&aa.selectRow({filter:['&id','=',da.get('id')]})},scope:aa})})}})},caption:'create',icon:'new'},{fn:function(){common.confirm({message:$zr.getString('Are you sure?'),scope:this,fn:function(aa){if('yes'==aa){let ia=this.getCurrentValue('id'),la=$o.startTransaction({description:'Remove class '+ia}),ra=$o.getClass(ia);ra.remove(),ra.sync(),$o.commitTransaction(la),this.refresh()}}})},active:{fn:function(){let aa=this.getCurrentValue('id')&&!this.getCurrentValue('schema_id');return aa}},caption:'delete',icon:'delete'},{fn:function(){ea.showObjects({classId:this.getCurrentValue('id')})},active:{fn:function(){let aa=this.getCurrentValue('id');return aa}},caption:$o.getString('Objects'),iconCls:'gi_file'}],listeners:{afterrender:function(){ea.olapClasses=this}}}},{tab:{pages:[{cardConf:{id:'commonCard',title:$o.getString('Commons'),iconCls:'gi_edit',items:[{conf:'class',id:'olap',attr:'id.name',fieldLabel:$o.getString('Name')},{conf:'class',id:'olap',attr:'id.code',allowBlank:!1,fieldLabel:$o.getString('Code'),readOnly:!0,maskRe:/[A-Za-z0-9\_]/},{conf:'class',id:'olap',attr:'id.description',fieldLabel:$o.getString('Description'),xtype:'textarea',height:150},{conf:'class',id:'olap',attr:'id.format',fieldLabel:$o.getString('Format function (default: return this.get (\'name\');)'),xtype:'textarea',height:200}],active:{fn:function(){return!this.relatives.olap.getCurrentValue('schema_id')}}}},{split:{title:$o.getString('Attributes'),iconCls:'gi_file',orientation:'vertical',height:400,pages:[{olap:{id:'olapAttrs',view:'system.classAttrs',filter:['class_id','=',{id:'olap',attr:'id'}],actions:[{fn:function(){$zu.dialog.getNameAndCodeAndType({title:$o.getString('Class attribute',':','Adding'),success:function(aa,ia,la){let ra=$o.getClass(this.relatives.olap.getCurrentValue('id')),na=ra.hasAttrInHierarchy(ia);if(na)return void common.message($o.getString('Attribute already exists in class')+': '+na.toString());let oa=$o.startTransaction({description:'Create class attr'}),da=$o.createClassAttr();da.set('class',this.relatives.olap.getCurrentValue('id')),da.set('name',aa),da.set('code',ia),da.set('type',la),da.set('removeRule','set null'),da.sync(),$o.getClass(da.get('class')).updateDefault(),$o.commitTransaction(oa),this.refresh({callback:function(ua,ga,pa){pa&&this.selectRow({filter:['&id','=',da.get('id')]})},scope:this})},scope:this})},arguments:{debug:1},caption:'create',icon:'new',active:{fn:function(){return!this.relatives.olap.getCurrentValue('schema_id')}}},{fn:function(){common.confirm({message:$zr.getString('Are you sure?'),scope:this,fn:function(aa){if('yes'==aa){let ia=this.getCurrentValue('id'),la=$o.startTransaction({description:'Remove class attr '+ia}),ra=$o.getClassAttr(ia),na=ra.get('class');ra.remove(),ra.sync(),$o.getClass(na).updateDefault(),$o.commitTransaction(la),this.refresh()}}})},active:{fn:function(){return this.getCurrentValue('id')&&!this.relatives.olap.getCurrentValue('schema_id')}},caption:'delete',icon:'delete'}],cellRenderer:function(aa,ia,la){if('type'==ia.column.dataIndex&&la.get('type_id')){let da=$o.getClass(la.get('type_id'));da&&(aa=da.toString())}return aa}}},{cardConf:{id:'attrCard',items:[{conf:'classAttr',id:'olapAttrs',attr:'id.name',fieldLabel:$o.getString('Name')},{conf:'classAttr',id:'olapAttrs',attr:'id.code',fieldLabel:$o.getString('Code'),allowBlank:!1,readOnly:!0,maskRe:/[A-Za-z0-9\_]/},{conf:'classAttr',id:'olapAttrs',attr:'id.type',fieldLabel:$o.getString('Type'),confRef:'class',readOnly:!0},{anchor:'100%',xtype:'fieldcontainer',layout:'hbox',items:[{conf:'classAttr',id:'olapAttrs',attr:'id.secure',fieldLabel:$o.getString('Password'),xtype:'checkbox'},{conf:'classAttr',id:'olapAttrs',attr:'id.unique',fieldLabel:$o.getString('Unique'),xtype:'checkbox',style:'margin-left: 10px'},{conf:'classAttr',id:'olapAttrs',attr:'id.notNull',fieldLabel:$o.getString('Not null'),xtype:'checkbox',style:'margin-left: 10px'},{xtype:'compositefield',fieldLabel:$o.getString('Remove rule'),style:'margin-left: 10px',items:[{xtype:'combo',conf:'classAttr',id:'olapAttrs',attr:'id.removeRule',width:200,triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['set null','Set null)'],['cascade','Cascade']]}),valueField:'id',displayField:'text'}]}]},{conf:'classAttr',id:'olapAttrs',attr:'id.formatFunc',fieldLabel:$o.getString('Options')+' (JSON)',xtype:'textarea',height:50},{conf:'classAttr',id:'olapAttrs',attr:'id.validFunc',fieldLabel:$o.getString('Validation function'),xtype:'textarea',height:30},{conf:'classAttr',id:'olapAttrs',attr:'id.description',fieldLabel:$o.getString('Description'),xtype:'textarea',height:30}],active:{fn:function(){if(this.relatives.olapAttrs.getValue('id')){let aa=$o.getClassAttr(this.relatives.olapAttrs.getValue('id'));1e3<=aa.get('type')?this.down('*[attr=id.removeRule]').enable():this.down('*[attr=id.removeRule]').disable();1==aa.get('type')?this.down('*[attr=id.secure]').enable():this.down('*[attr=id.secure]').disable()}return!this.relatives.olap.getCurrentValue('schema_id')}}}}]}},{split:{title:$o.getString('Actions'),iconCls:'gi_wrench',orientation:'vertical',width:400,pages:[{olap:{id:'olapActions',view:'system.actions',filter:['class_id','=',{id:'olap',attr:'id'}],actions:[{fn:function(){$zu.dialog.getNameAndCode({title:$o.getString('Action',':','Adding'),success:function(aa,ia){let la=$o.startTransaction({description:'Create action'}),ra=$o.createAction();ra.set('class',this.relatives.olap.getCurrentValue('id')),ra.set('name',aa),ra.set('code',ia),ra.sync(),$o.commitTransaction(la),this.refresh({callback:function(na,oa,da){da&&this.selectRow({filter:['&id','=',ra.get('id')]})},scope:this})},scope:this})},caption:'create',icon:'new',active:{fn:function(){return!this.relatives.olap.getCurrentValue('schema_id')}}},{fn:function(){common.confirm({message:$zr.getString('Are you sure?'),scope:this,fn:function(aa){if('yes'==aa){let ia=this.getCurrentValue('id'),la=$o.startTransaction({description:'Remove action '+ia}),ra=$o.getAction(ia);ra.remove(),ra.sync(),$o.commitTransaction(la),this.refresh()}}})},active:{fn:function(){return this.getCurrentValue('id')&&!this.relatives.olap.getCurrentValue('schema_id')}},caption:'delete',icon:'delete'},{fn:function(){let aa=$o.getAction(this.getCurrentValue('id')),ia=aa.get('body'),la=Ext.create('Ext.Window',{width:800,height:600,layout:'fit',frame:!1,border:!1,bodyPadding:1,modal:!1,maximizable:!0,title:$o.getString('Action source code')+': '+aa.toString(),iconCls:'gi_notes',items:{name:'body',xtype:'codemirrortextarea',listeners:{afterrender:function(){this.setValue(ia)}}},tbar:[{text:$o.getString('Save'),iconCls:'gi_floppy_save',disabled:this.relatives.olap.getCurrentValue('schema_id'),handler:function(){aa.set('body',la.down('*[name=body]').getValue()),aa.sync(),aa.initAction(),la.close()}},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){la.close()}}]});la.show()},active:{fn:function(){return this.getCurrentValue('id')}},text:$o.getString('Source code'),iconCls:'gi_notes'},{fn:function(){let aa=this.getCurrentValue('class_id'),ia=$o.getAction(this.getCurrentValue('id')),la=ia.get('layout');la=la||'{}',la=JSON.parse(la);let ra=la.layout,na=Ext.create('Ext.Window',{width:800,height:600,layout:'fit',frame:!1,border:!1,bodyPadding:1,modal:!1,maximizable:!0,title:$o.getString('Action layout')+': '+ia.toString(),iconCls:'gi_table',items:{xtype:'$layoutdesigner',name:'layout',listeners:{afterrender:function(){this.setValue(la.layout),this.classId=aa}}},tbar:[{text:$o.getString('Save'),iconCls:'gi_floppy_save',disabled:this.relatives.olap.getCurrentValue('schema_id'),handler:function(){let oa=na.down('*[name=layout]').getValue();if(oa){if('string'==typeof oa)try{la.layout=JSON.parse(oa)}catch(da){return common.message($o.getString('Parsing layout ended with an error')),void na.close()}'object'==typeof oa&&(la.layout=oa)}else delete la.layout;ia.set('layout',JSON.stringify(la,null,'\t')),ia.sync(),ia.initAction(),ea.actionCard.down('*[attr=id.layout]').originalValue=JSON.stringify(la,null,'\t'),na.close()}},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){na.close()}}]});na.show()},active:{fn:function(){return this.getCurrentValue('id')}},text:$o.getString('Layout'),iconCls:'gi_table'}],listeners:{afterrender:function(){ea.olapActions=this}}}},{cardConf:{id:'actionCard',listeners:{afterrender:function(){ea.actionCard=this},afterSave:function(){let aa=this.relatives.olapActions.getValue('id'),ia=$o.getAction(aa),la=ea.actionCard.down('*[attr=id.layout]'),ra=la.originalValue;ra=JSON.parse(ra),ra&&'object'==typeof ra||(ra={});ra.type=ea.actionCard.down('*[name=type]').getValue(),ra.serverAction=ea.actionCard.down('*[name=serverAction]').getValue(),ra.noAuth=ea.actionCard.down('*[name=noAuth]').getValue(),ia.set('layout',JSON.stringify(ra,null,'\t')),ia.sync(),ia.initAction()}},items:[{conf:'action',id:'olapActions',attr:'id.name',fieldLabel:$o.getString('Name'),labelWidth:150},{conf:'action',id:'olapActions',attr:'id.code',fieldLabel:$o.getString('Code'),allowBlank:!1,labelWidth:150,maskRe:/[A-Za-z0-9\_]/},{xtype:'combo',name:'type',fieldLabel:$o.getString('Type'),triggerAction:'all',lazyRender:!0,mode:'local',labelWidth:150,queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[[null,'-'],['create',$o.getString('Adding')],['remove',$o.getString('Removing')],['card',$o.getString('Card')]]}),valueField:'id',displayField:'text',listeners:{select:function(){ea.actionCard.down('*[attr=id.layout]').setValue(ea.actionCard.down('*[attr=id.layout]').counter++)}}},{xtype:'compositefield',fieldLabel:$o.getString('Server action'),labelWidth:150,items:[{xtype:'checkbox',name:'serverAction',listeners:{change:function(){ea.actionCard.down('*[attr=id.layout]').setValue(ea.actionCard.down('*[attr=id.layout]').counter++),this.getValue()?(ea.actionCard.down('*[name=noAuth]').enable(),ea.actionCard.down('*[name=displayNoAuth]').enable()):(ea.actionCard.down('*[name=noAuth]').disable(),ea.actionCard.down('*[name=displayNoAuth]').disable())}}},{xtype:'displayfield',name:'displayNoAuth',value:$o.getString('Execute no authentication')+':',style:'margin-left: 10px; margin-right: 5px'},{xtype:'checkbox',name:'noAuth',labelWidth:150,listeners:{change:function(){ea.actionCard.down('*[attr=id.layout]').setValue(ea.actionCard.down('*[attr=id.layout]').counter++)}}}]},{conf:'action',id:'olapActions',attr:'id.body',xtype:'textarea',hideLabel:!0,style:'display: none'},{conf:'action',id:'olapActions',attr:'id.layout',xtype:'textarea',hideLabel:!0,style:'display: none'}],active:{fn:function(){if(this.relatives.olapActions.getValue('id')){let aa=$o.getAction(this.relatives.olapActions.getValue('id')),ia=aa.get('layout');ia=ia||'{}',ia=JSON.parse(ia),this.down('*[name=type]').setValue(ia.type),this.down('*[name=serverAction]').setValue(ia.serverAction),this.down('*[name=noAuth]').setValue(ia.noAuth),ia.serverAction?(this.down('*[name=noAuth]').enable(),this.down('*[name=displayNoAuth]').enable()):(this.down('*[name=noAuth]').disable(),this.down('*[name=displayNoAuth]').disable());ia.system?this.down('*[iconCls=save]').disable():this.down('*[iconCls=save]').enable();this.down('*[attr=id.layout]').originalValue=aa.get('layout'),this.down('*[attr=id.layout]').counter=1}return!this.relatives.olap.getCurrentValue('schema_id')}}}}]}},{olap:{id:'olapDependency',title:$o.getString('Dependencies'),iconCls:'gi_link',view:'system.typeClassAttrs',filter:['type_id','=',{id:'olap',attr:'id'}],cellRenderer:function(aa,ia,la){if('classCode'==ia.column.dataIndex){let da=$o.getClass(la.get('class_id'));da&&(aa=da.getFullCode())}return aa}}}]}}]}},ea.callParent(arguments)},showObjects:function(ea){let aa=$o.getClass(ea.classId);if(!aa.attrsArray.length)return void common.message($o.getString('Class has no attributes'));let ia=Ext.create('Ext.Window',{title:$o.getString('Class objects')+': '+aa.toString(),iconCls:'gi_file',width:800,height:600,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',bodyPadding:1,modal:!0,items:{xtype:'$o.layout',$layout:{olap:{id:'olap',classView:ea.classId,recreateView:!0,singleSelect:!1,actions:[{fn:function(){let la=this;common.confirm({message:$o.getString('Are you sure?'),fn:function(ra){'yes'==ra&&($o.startTransaction({description:'Remove by admin'}),_.each(la.getSelectionModel().getSelection(),function(na){$o.removeObject(na.get('id')),la.getStore().remove(na)}),$o.commitTransaction())}})},text:$o.getString('Remove'),iconCls:'gi_circle_minus',active:'common.recordSelected'},{fn:function(){let la=this,ra=JSON.parse(la.$view.get('query')),na=la.getFilter();na&&na.length&&(_.each(na,function(da,ua){let ga=ra.select.indexOf(da);-1<ga&&(na[ua]=ra.select[ga-1])}),ra.where=ra.where||[],ra.where.length&&ra.where.push('and'),ra.where.push(na)),ra.asArray=!0;let oa=$o.execute(ra);common.confirm({message:$o.getString('Entries will be deleted')+': '+oa.length+'. '+$o.getString('Are you sure?'),fn:function(da){'yes'==da&&(Ext.MessageBox.show({title:$o.getString('Please wait'),msg:$o.getString('Action in progress')+' ...',progressText:'',width:300,progress:1,closable:!1}),setTimeout(function(){$o.startTransaction(),async.reduce(oa,0,function(ua,ga,pa){Ext.MessageBox.updateProgress(ua/oa.length,ua+' / '+oa.length),$o.removeObject(ga.id),setTimeout(function(){pa(null,ua+1)},1)},function(){$o.commitTransaction(),Ext.MessageBox.hide(),la.refresh()})},100))}})},text:$o.getString('Remove all'),iconCls:'gi_circle_minus'},{fn:function(){let la=this,ra=JSON.parse(la.$view.get('query')),na=la.getFilter();na&&na.length&&(_.each(na,function(ua,ga){let pa=ra.select.indexOf(ua);-1<pa&&(na[ga]=ra.select[pa-1])}),ra.where=ra.where||[],ra.where.length&&ra.where.push('and'),ra.where.push(na)),ra.asArray=!0;let oa=$o.execute(ra),da=Ext.create('Ext.window.Window',{title:$o.getString('Changing the value of'),iconCls:'edit',closable:!0,width:600,height:400,layout:'vbox',modal:!0,style:'background-color: #fff',bodyStyle:'background-color: #fff',bodyPadding:5,items:[{xtype:'textfield',disabled:!0,fieldLabel:$o.getString('Entries will be changed'),value:oa.length},{xtype:'combo',fieldLabel:$o.getString('Attribute'),name:'attr',triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',store:{type:'json',fields:['id','name'],data:_.map(aa.attrsArray,function(ua){return{id:ua.get('code'),name:ua.toString()}})},width:'100%',valueField:'id',displayField:'name',editable:!1},{xtype:'textfield',name:'value',fieldLabel:$o.getString('Value'),width:'100%'}],buttons:[{text:$o.getString('Change'),iconCls:'ok',handler:function(){let ua=da.down('*[name=attr]').getValue(),ga=da.down('*[name=value]').getValue()||null;return ua?void(Ext.MessageBox.show({title:$o.getString('Please wait'),msg:$o.getString('Action in progress')+' ...',progressText:'',width:300,progress:1,closable:!1}),setTimeout(function(){$o.startTransaction(),async.reduce(oa,0,function(pa,ma,fa){Ext.MessageBox.updateProgress(pa/oa.length,pa+' / '+oa.length);let ha=$o.getObject(ma.id);ha.set(ua,ga),ha.sync(),setTimeout(function(){fa(null,pa+1)},1)},function(){$o.commitTransaction(),Ext.MessageBox.hide(),da.close(),la.refresh()})},100)):common.message($o.getString('Choose attribute'))}}]});da.show()},text:$o.getString('Change all'),iconCls:'edit'},{text:$o.getString('Import')+' CSV',iconCls:'gi_disk_import',fn:function(){let la=this,ra=Ext.create('Ext.window.Window',{title:$o.getString('import')+' CSV',iconCls:'gi_disk_import',closable:!0,width:800,height:600,layout:'fit',modal:!0,style:'background-color: #fff',bodyStyle:'background-color: #fff',items:{xtype:'importcsvobjects',classId:ea.classId,listeners:{imported:function(){ra.close(),la.refresh()}}}});ra.show()}}]}}}});ia.show()},createSpr:function(ea){let aa=this,ia={type:'card',layout:{designer:1,card:{id:'card',items:[{anchor:'100%',fieldLabel:$o.getString('Name'),attr:'name',objectId:'[#id]'},{fieldLabel:$o.getString('N'),attr:'npp',objectId:'[#id]',width:200},{anchor:'100%',fieldLabel:$o.getString('Code'),attr:'code',objectId:'[#id]'}],object:[{cls:ea.getFullCode(),tag:'[#id]'}]}}},la=$o.execute({asArray:!0,select:[{a:'___fid'},'id'],from:[{a:'system.action'}],where:[{a:'___fend_id'},'=',2147483647,'and',{a:'___fclass_id'},'=',ea.get('id'),'and',{a:'___fcode'},'=','card']}),ra=$o.getAction(la[0].id);ra.set('layout',JSON.stringify(ia,null,'\t')),ra.sync();let na=null,oa=ea.getFullCode().split('.');for(let ga=0;ga<oa.length-1;ga++){let pa=oa.slice(0,ga+1).join('.'),ma=$o.getClass(pa),fa=na?na.get('id'):null;try{na=$o.getView(pa)}catch(ha){na=$o.createView(),na.set('parent',fa),na.set('name',ma.get('name')),na.set('code',ma.get('code')),na.sync()}}let da=ea.getFullCode(),ua=$o.createView();ua.set('parent',na.get('id')),ua.set('name',ea.get('name')),ua.set('code',ea.get('code')),ua.set('query',JSON.stringify({designer:1,select:[{a:'id'},'id',{a:'name'},'name',{a:'code'},'code',{a:'npp'},'npp'],from:[{a:da}],order:[{a:'npp'},',',{a:'name'}]},null,'\t')),ua.set('layout',JSON.stringify({designer:1,olap:{id:'olap',view:da,actions:[{fn:da+'.card',text:$o.getString('Open'),iconCls:'gi_edit',active:'common.recordSelected'},{fn:da+'.create',text:$o.getString('Add'),iconCls:'gi_circle_plus'},{fn:da+'.remove',text:$o.getString('Remove'),iconCls:'gi_circle_minus',active:'common.recordSelected'}]}},null,'\t')),ua.set('iconCls','gi_book'),ua.sync(),_.each([{code:'id',name:'id',width:75,area:0},{code:'name',name:$o.getString('Name'),width:500,area:1},{code:'code',name:$o.getString('Code'),width:75,area:0},{code:'npp',name:$o.getString('N'),width:75,area:0}],function(ga,pa){let ma=$o.createViewAttr();ma.set('view',ua.get('id')),ma.set('code',ga.code),ma.set('name',ga.name),ma.set('width',ga.width),ma.set('area',ga.area),ma.set('order',pa+1),ma.sync()})}}),Ext.define('$o.Views.Widget',{extend:'$o.Layout.Widget',alias:['widget.$o.views','widget.$views'],initComponent:function(){let me=this;me.$layout={split:{orientation:'horizontal',width:290,pages:[{treegrid:{id:'olap',view:'system.views',fields:{id:'id',parent:'parent_id'},filter:{fn:function(){return['system','is null','and','end_id','=',2147483647]},all:!0},actions:[{fn:function(){$zu.dialog.getNameAndCode({title:$o.getString('View',':','Adding'),success:function(ea,aa){let ia=$o.startTransaction({description:'Create view'}),la=$o.createView();la.set('parent',this.getCurrentValue('id')),la.set('name',ea),la.set('code',aa),la.sync(),$o.commitTransaction(ia),this.refresh({callback:function(ra,na,oa){oa&&this.selectRow({filter:['&id','=',la.get('id')]})},scope:this})},scope:this})},caption:'create',icon:'new'},{fn:function(){common.confirm({message:$zr.getString('Are you sure?'),scope:this,fn:function(ea){if('yes'==ea){let aa=this.getCurrentValue('id'),ia=$o.startTransaction({description:'Remove view '+aa}),la=$o.getView(aa);la.remove(),la.sync(),$o.commitTransaction(ia),this.refresh()}}})},active:{fn:function(){let ea=this.getCurrentValue('id')&&!this.getCurrentValue('schema_id');return ea}},caption:'delete',icon:'delete'},{fn:function(){let ea=$o.viewsMap[this.getCurrentValue('id')];$o.app.show.call($o.app,{record:ea})},active:{fn:function(){let ea=this.getCurrentValue('id');return ea}},caption:$o.getString('Review'),iconCls:'gi_eye_open'}]}},{tab:{listeners:{tabchangeTODO:function(ea,aa){let ia=this;if(aa.title==$o.getString('Query')||aa.title==$o.getString('Layout')){let la=aa.getItems()[0],ra=la.getValue(),na=Ext.getDom(la.inputEl);ia.editor&&ia.editor.toTextArea();let oa=aa.getHeight(!0);Ext.util.CSS.updateRule('.CodeMirror-scroll','height',oa+'px'),ia.editor=CodeMirror.fromTextArea(na,{lineNumbers:!0,indentUnit:4,readOnly:!1,mode:{name:'javascript',json:!0}}),ia.editor.setValue(ra)}}},pages:[{cardConf:{id:'commonCard',title:$o.getString('Commons'),iconCls:'gi_edit',tbar:[{text:$o.getString('Dependencies'),iconCls:'gi_link',handler:function(){let ea=this.up('*[name=views]').relatives.olap.getValue('id'),aa=$o.getView(ea).getFullCode(),ia=[];_.each($o.viewsMap,function(ra){ra.get('layout')&&-1<ra.get('layout').indexOf(aa)&&ia.push({id:ra.get('id'),path:ra.getFullCode(),name:ra.get('name')})});let la=Ext.create('Ext.Window',{width:600,height:600,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Dependencies')+': '+$o.getString('Views'),iconCls:'gi_link',bodyPadding:5,modal:1,items:{xtype:'grid',name:'grid',store:{type:'json',fields:['id','path','name'],data:ia},columns:[{text:'id',dataIndex:'id'},{text:$o.getString('Code'),dataIndex:'path'},{text:$o.getString('Name'),dataIndex:'name'}],width:'100%',forceFit:!0,columnLines:!0,rowLines:!0}});la.show()}}],items:[{conf:'view',id:'olap',attr:'id.name',fieldLabel:$o.getString('Name')},{conf:'view',id:'olap',attr:'id.code',fieldLabel:$o.getString('Code'),allowBlank:!1,maskRe:/[A-Za-z0-9\_]/},{conf:'view',id:'olap',attr:'id.parent',fieldLabel:$o.getString('Parent'),confRef:'view',choose:{type:'view',id:'system.views',attr:'olap.id',width:500,height:400}},{conf:'view',id:'olap',attr:'id.description',fieldLabel:$o.getString('Description'),xtype:'textarea',height:150},{conf:'view',id:'olap',attr:'id.iconCls',fieldLabel:$o.getString('Icon'),xtype:'$iconselector'}],active:{fn:function(){return!this.relatives.olap.getCurrentValue('schema_id')}}}},{cardConf:{id:'queryCard',title:$o.getString('Query'),iconCls:'gi_cogwheel',tbar:[{text:$o.getString('Setting the table columns'),iconCls:'gi_table',handler:function(){let ea=Ext.create('Ext.Window',{width:800,height:600,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Setting the table columns'),bodyPadding:5,modal:1,maximizable:!0,items:{xtype:'$querycolumns',viewId:this.up('*[name=views]').relatives.olap.getValue('id'),schemaId:this.up('*[name=views]').relatives.olap.getCurrentValue('schema_id')}});ea.show()}}],listeners:{beforeSave:function(){let me=this,query=me.down('*[attr=id.query]').getValue();query=eval('('+query+')'),query.limit=1;let r=$o.execute({sql:query,noException:1});r.error&&common.message($o.getString('Error in query')+':\n'+r.error)}},items:[{flex:1,width:'100%',border:0,layout:'fit',items:[{conf:'view',id:'olap',attr:'id.query',hideLabel:!0,xtype:'$querydesigner'}]}],active:{fn:function(){return!this.relatives.olap.getCurrentValue('schema_id')}}}},{cardConf:{id:'layoutCard',title:$o.getString('Layout'),iconCls:'gi_table',items:[{flex:1,width:'100%',border:0,layout:'fit',items:[{conf:'view',id:'olap',attr:'id.layout',hideLabel:!0,xtype:'$layoutdesigner'}]}],active:{fn:function(){return!this.relatives.olap.getCurrentValue('schema_id')}}}}]}}]}},me.callParent(arguments)}}),Ext.define('$o.LayoutEditor',{extend:'Ext.panel.Panel',layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.tbar=[{text:'\u041E\u043A',name:'ok',iconCls:'gi_ok',handler:ea.save,scope:ea},{text:$o.getString('Cancel'),name:'cancel',iconCls:'gi_remove',handler:function(){ea.up('window').close()}},{text:$o.getString('Convert to splitter'),name:'make_split',iconCls:'gi_share_alt',handler:function(){let aa=ea.down('codemirrortextarea[name=\'json\']'),ia={split:{id:'cmp-'+ea.layoutDesigner.counter++,orientation:'horizontal',width:'50%',items:[JSON.parse(aa.getValue()),ea.layoutDesigner.createEmpty()]}};aa.setValue(JSON.stringify(ia,null,'\t')),ea.save({convertion:1})},scope:ea},{text:$o.getString('Convert to tabs'),name:'make_tab',iconCls:'gi_bookmark',handler:function(){let aa=ea.down('codemirrortextarea[name=\'json\']'),ia=JSON.parse(aa.getValue());ia[ea.cmpCode].title=ia[ea.cmpCode].title||'\u0417\u0430\u043A\u043B\u0430\u0434\u043A\u0430';let la={tab:{id:'cmp-'+ea.layoutDesigner.counter++,items:[ia]}};aa.setValue(JSON.stringify(la,null,'\t')),ea.save({convertion:1})},scope:ea}],ea.addEvents('beforesave','aftersave','change'),this.callParent(arguments)},changeAttr:function(ea,aa){let ia=this,la=ia.down('codemirrortextarea[name=\'json\']'),ra=la.getValue();ra=JSON.parse(ra);let na=ea.split('.'),oa=ra[ia.cmpCode];for(let da=0;da<na.length;da++){if(oa[na[da]]=oa[na[da]]||{},da==na.length-1){oa[na[da]]=aa;break}oa=oa[na[da]]}'title'!=ea||aa||delete ra[ia.cmpCode][ea];'filter'!=ea||aa&&0!=aa.length||delete ra[ia.cmpCode][ea];ia.value=ra,la.setValue(JSON.stringify(ra,null,'\t'))},save:function(ea){let aa=this;aa.fireEvent('beforesave',ea);let ia=aa.down('codemirrortextarea[name=\'json\']'),la=JSON.parse(ia.getValue());aa.value=la,aa.fireEvent('aftersave',la),aa.fireEvent('change',la)},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.LayoutOlap.Widget',{extend:'$o.LayoutEditor',alias:['widget.$o.layoutolap','widget.$layoutolap'],cmpCode:'olap',initComponent:function(){let ea=this;ea.value=ea.value||{olap:{id:'cmp-'+ea.layoutDesigner.counter++}};let aa=null;ea.value.olap.filter&&'string'==typeof ea.value.olap.filter&&(aa=$o.getAction(ea.value.olap.filter).get('id'));ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:[{xtype:'textfield',width:'100%',labelWidth:150,fieldLabel:$o.getString('Identifier'),name:'id',style:'margin-top: 5px;',value:ea.value.olap.id,listeners:{change:function(){ea.changeAttr('id',this.getValue()),ea.down('*[name=filter]').setCmpId(this.getValue())}}},{xtype:'textfield',labelWidth:150,width:'100%',fieldLabel:$o.getString('Title'),name:'title',value:ea.value.olap.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}}},{xtype:'$iconselector',labelWidth:150,width:'100%',name:'iconCls',value:ea.value.olap.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}},{xtype:'$conffield',fieldLabel:$o.getString('Query'),labelWidth:150,name:'view',value:ea.value.olap.view,width:'100%',confRef:'view',choose:{type:'custom',fn:function(){let ia=this;dialog.getView({hasQuery:1,success:function(la){ia.setValue(la.id)}})}},listeners:{afterrender:function(){ea.validator()},change:function(){ea.validator();let ia=this.getValue()?$o.getView(this.getValue()).getFullCode():void 0;ea.changeAttr('view',ia),ea.down('*[name=filter]').setViewId(ia?$o.getView(ia).get('id'):null),ea.down('*[name=total]').setViewId(ia?$o.getView(ia).get('id'):null)}}},{xtype:'checkbox',width:'100%',name:'wordWrap',labelWidth:150,fieldLabel:$o.getString('Word wrap'),checked:ea.value.olap.wordWrap,listeners:{change:function(){ea.changeAttr('wordWrap',this.getValue())}}},{xtype:'checkbox',width:'100%',name:'groupedColumns',labelWidth:150,fieldLabel:$o.getString('Grouped header'),checked:ea.value.olap.groupedColumns,listeners:{change:function(){ea.changeAttr('groupedColumns',this.getValue())}}},{fieldLabel:$o.getString('Filter from action'),xtype:'$conffield',labelWidth:150,name:'filterAction',value:aa,width:'100%',confRef:'action',choose:{type:'custom',fn:function(){let ia=this;dialog.getAction({success:function(la){ia.setValue(la.id)}})}},listeners:{change:function(ia){ia?(ia=$o.getAction(ia).getFullCode(),ea.down('*[name=filter]').setValue(null),ea.down('*[name=filter]').disable()):ea.down('*[name=filter]').enable();ea.changeAttr('filter',ia)}}},{layout:'hbox',width:'100%',border:0,flex:1,items:[{layout:'fit',width:'30%',height:'100%',title:$o.getString('Menu'),iconCls:'gi_list',bodyPadding:2,items:{xtype:'$actiondesigner',name:'actions',value:ea.value.olap.actions,listeners:{change:function(ia){ea.changeAttr('actions',ia)}}}},{layout:'fit',width:'40%',height:'100%',title:$o.getString('Filter'),iconCls:'gi_filter',bodyPadding:2,style:'margin-left: 1px',items:{xtype:'$layoutfilter',name:'filter',layoutDesigner:ea.layoutDesigner,disabled:!!aa,value:aa?null:ea.value.olap.filter,$cmpId:ea.value.olap.id,$viewId:ea.value.olap.view,listeners:{change:function(ia){ea.changeAttr('filter',ia),ea.validator.call(this)}}}},{layout:'fit',width:'30%',height:'100%',title:$o.getString('Totals'),iconCls:'gi_calculator',bodyPadding:2,style:'margin-left: 1px',items:{xtype:'$layouttotal',name:'total',layoutDesigner:ea.layoutDesigner,value:ea.value.olap.total,viewId:ea.value.olap.view?$o.getView(ea.value.olap.view).get('id'):null,listeners:{change:function(ia){ea.changeAttr('total',ia)}}}}]}]},{layout:'fit',title:$o.getString('Events'),iconCls:'gi_wifi_alt',border:0,items:{xtype:'$eventdesigner',name:'events',value:ea.value.olap.listeners,$events:['afterrender','dblclick','cellRenderer'],listeners:{changeevent:function(ia){ea.changeAttr('listeners',ia)}}}},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)},validator:function(){let ea=this,aa=ea.down('*[name=\'view\']');return aa.getValue()?$o.getView(aa.getValue()).get('query')?ea.down('button[name=\'ok\']').enable():(common.message($o.getString('Selected view does not contain a query')),ea.down('button[name=\'ok\']').disable()):ea.down('button[name=\'ok\']').disable(),!0}}),Ext.define('$o.LayoutTreegrid.Widget',{extend:'$o.LayoutEditor',alias:['widget.$o.layouttreegrid','widget.$layouttreegrid'],cmpCode:'treegrid',initComponent:function(){let ea=this;ea.value=ea.value||{treegrid:{id:'cmp-'+ea.layoutDesigner.counter++}};let aa=ea.getData();ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:[{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Identifier'),name:'id',style:'margin-top: 5px;',value:ea.value.treegrid.id,listeners:{change:function(){ea.changeAttr('id',this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Title'),name:'title',value:ea.value.treegrid.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}},validator:ea.validator},{xtype:'$iconselector',width:'100%',name:'iconCls',value:ea.value.treegrid.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}},{xtype:'$conffield',fieldLabel:$o.getString('Query'),name:'view',value:ea.value.treegrid.view,width:'100%',confRef:'view',choose:{type:'custom',fn:function(){let ia=this;dialog.getView({hasQuery:1,success:function(la){ia.setValue(la.id),ea.changeAttr('view',la.id?$o.getView(la.id).getFullCode():void 0);let ra=ea.getData();ea.down('*[name=\'idAttr\']').getStore().loadData(ra),ea.down('*[name=\'idAttr\']').setValue(null),ea.down('*[name=\'parent\']').getStore().loadData(ra),ea.down('*[name=\'parent\']').setValue(null),ea.validator.call(ia)}})}},listeners:{afterrender:function(){ea.validator.call(this)}}},{xtype:'combo',fieldLabel:$o.getString('Node identifier'),name:'idAttr',width:'100%',mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:aa}),valueField:'id',displayField:'text',value:ea.value.treegrid.fields?ea.value.treegrid.fields.id:null,validator:ea.validator},{xtype:'combo',fieldLabel:$o.getString('Parent node identifier'),name:'parent',width:'100%',mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:aa}),valueField:'id',displayField:'text',value:ea.value.treegrid.fields?ea.value.treegrid.fields.parent:null,validator:ea.validator},{layout:'fit',width:'100%',flex:1,title:$o.getString('Menu'),iconCls:'gi_list',bodyPadding:2,items:{xtype:'$actiondesigner',name:'actions',value:ea.value.treegrid.actions,listeners:{change:function(ia){ea.changeAttr('actions',ia)}}}}]},{layout:'fit',title:$o.getString('Events'),iconCls:'gi_wifi_alt',border:0,items:{xtype:'$eventdesigner',name:'events',value:ea.value.treegrid.listeners,$events:['dblclick'],listeners:{changeevent:function(ia){ea.changeAttr('listeners',ia)}}}},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)},getData:function(){let ea=this,aa=[];if(ea.value.treegrid.view){let ia=$o.getView(ea.value.treegrid.view);for(let la in ia.attrs){let ra=ia.attrs[la];if(ra.get('classAttr')){let na=$o.getClassAttr(ra.get('classAttr'));if(!(2==na.get('type')||12==na.get('type')||1e3<=na.get('type')))continue}aa.push([la,ra.toString()])}}return aa},validator:function(){let ea=this.up('panel[cmpCode=\'treegrid\']'),aa=ea.down('*[name=\'view\']'),ia=ea.down('*[name=\'idAttr\']'),la=ea.down('*[name=\'parent\']');return ia.getValue()&&la.getValue()&&ia.getValue()!=la.getValue()?(ia.getValue()&&la.getValue()&&ea.changeAttr('fields',{id:ia.getValue(),parent:la.getValue()}),aa.getValue()?$o.getView(aa.getValue()).get('query')?ea.down('button[name=\'ok\']').enable():(common.message($o.getString('Selected view does not contain a query')),ea.down('button[name=\'ok\']').disable()):ea.down('button[name=\'ok\']').disable(),!0):(ea.down('button[name=\'ok\']').disable(),!0)}}),Ext.define('$o.LayoutSplit.Widget',{extend:'$o.LayoutEditor',alias:['widget.$o.layoutsplit'],cmpCode:'split',initComponent:function(){let ea=this;ea.value=ea.value||{split:{id:'cmp-'+ea.layoutDesigner.counter++,orientation:'horizontal',width:'50%',items:[ea.layoutDesigner.createEmpty(),ea.layoutDesigner.createEmpty()]}};let aa=ea.value.split.width||ea.value.split.height,ia;'string'==typeof aa?(ia='%',aa=aa.substr(0,aa.length-1)):ia='px';ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:[{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Identifier'),name:'id',style:'margin-top: 5px;',value:ea.value.split.id,listeners:{change:function(){ea.changeAttr('id',this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Title'),name:'title',value:ea.value.split.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}}},{xtype:'$iconselector',width:'100%',name:'iconCls',value:ea.value.split.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}},{xtype:'combo',fieldLabel:$o.getString('Orientation'),name:'orientation',width:'100%',triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['horizontal',$o.getString('Horizontal')],['vertical',$o.getString('Vertical')]]}),valueField:'id',displayField:'text',style:'margin-top: 5px;',value:ea.value.split.orientation,listeners:{select:function(){ea.changeAttr('orientation',this.getValue())}}},{xtype:'compositefield',fieldLabel:$o.getString('Width (height) of left (top) component'),items:[{xtype:'numberfield',name:'width',value:aa,width:100,validator:function(){return this.getValue()?ea.down('button[name=\'ok\']').enable():ea.down('button[name=\'ok\']').disable(),'%'==ea.down('*[name=ed]').getValue()?ea.changeAttr('width',this.getValue()+'%'):ea.changeAttr('width',+this.getValue()),!0}},{xtype:'combo',name:'ed',width:50,triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['%','%'],['px','px']]}),valueField:'id',displayField:'text',style:'margin-left: 2px;',value:ia,listeners:{select:function(){'%'==this.getValue()?(90<ea.down('*[name=width]').getValue()&&ea.down('*[name=width]').setValue(90),ea.changeAttr('width',ea.down('*[name=width]').getValue()+'%')):ea.changeAttr('width',+ea.down('*[name=width]').getValue())}}}]}]},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)}}),Ext.define('$o.LayoutTab.Widget',{extend:'$o.LayoutEditor',alias:['widget.$o.layouttab'],cmpCode:'tab',initComponent:function(){let ea=this,aa=ea.layoutDesigner.createEmpty();aa.panel.title=$o.getString('Tab'),ea.value=ea.value||{tab:{id:'cmp-'+ea.layoutDesigner.counter++,items:[aa]}},ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:[{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Identifier'),name:'id',style:'margin-top: 5px;',value:ea.value.tab.id,listeners:{change:function(){ea.changeAttr('id',this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Title'),name:'title',value:ea.value.tab.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}}},{xtype:'$iconselector',width:'100%',name:'iconCls',value:ea.value.tab.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}}]},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)}}),Ext.define('$o.LayoutCondition.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.layoutcondition','widget.$layoutcondition'],layout:'vbox',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.filter=ea.filter||[],ea.value={},ea.tbar=[{text:'\u041E\u043A',iconCls:'gi_ok',name:'save',disabled:1,handler:ea.save,scope:ea},{text:$o.getString('Cancel'),iconCls:'gi_remove',name:'cancel',handler:function(){ea.up('window').close()}}];let aa=[];for(let ia in ea.$view.attrs){let la=ea.$view.attrs[ia];aa.push([ia,la.toString()])}ea.items=[{xtype:'combo',fieldLabel:$o.getString('And','/','Or'),labelWidth:200,name:'and_or',width:350,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['and',$o.getString('And')],['or',$o.getString('Or')]]}),valueField:'id',displayField:'text'},{xtype:'combo',fieldLabel:$o.getString('Attribute of this component'),name:'attr',width:'100%',labelWidth:200,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:aa}),valueField:'id',displayField:'text',validator:ea.validator},{xtype:'combo',fieldLabel:$o.getString('Operator'),labelWidth:200,name:'oper',width:350,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['=',$o.getString('equal')+' (=)'],['<>',$o.getString('not equal')+' (<>)'],['<',$o.getString('less')+' (<)'],['>',$o.getString('more')+' (>)'],['<=',$o.getString('less or equal')+' (<=)'],['>=',$o.getString('more or equal')+' (>=)'],['is null',$o.getString('empty')+' (is null)'],['is not null',$o.getString('not null')+' (is not null)'],['in',$o.getString('one of list')+' (in)']]}),valueField:'id',displayField:'text',listeners:{select:function(){let ia=this.getValue();'is null'==ia||'is not null'==ia?(ea.down('*[name=\'value\']').disable(),ea.down('*[name=\'attrValue\']').disable()):(ea.down('*[name=\'value\']').enable(),'in'==ia?ea.down('*[name=\'attrValue\']').disable():ea.down('*[name=\'attrValue\']').enable())}},validator:ea.validator},{xtype:'textfield',fieldLabel:$o.getString('Value'),labelWidth:200,width:'100%',name:'value',validator:ea.validator},{xtype:'combo',fieldLabel:$o.getString('Attribute of another component'),name:'attrValue',width:'100%',labelWidth:200,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:ea.getOtherAttrs()}),valueField:'id',displayField:'text',validator:ea.validator}],ea.filter.length||ea.items.splice(0,1);ea.items[0].style='margin-top: 5px;',ea.addEvents('aftersave'),this.callParent(arguments)},validator:function(){let aa=this.up('panel'),ia=aa.down('*[name=\'and_or\']'),la=aa.down('*[name=\'attr\']'),ra=aa.down('*[name=\'oper\']'),na=aa.down('*[name=\'value\']'),oa=aa.down('*[name=\'attrValue\']');if(ia&&!ia.getValue())return aa.down('button[name=\'save\']').disable(),!0;if(la.getValue()&&ra.getValue()&&('is null'==ra.getValue()||'is not null'==ra.getValue()||na.getValue()||oa.getValue())){if(aa.down('button[name=\'save\']').enable(),'is null'==ra.getValue()||'is not null'==ra.getValue())aa.value=[la.getValue(),ra.getValue()];else{let da=na.getValue();if(oa.getValue()){let ua=oa.getValue();da={id:ua.split(':')[0],attr:ua.split(':')[1]}}aa.value=[la.getValue(),ra.getValue(),da]}ia&&(aa.value=[ia.getValue()].concat(aa.value))}else aa.down('button[name=\'save\']').disable(),aa.value=[];return!0},getOtherAttrs:function(){let ea=this,aa=[],ia=function(la){if('object'==typeof la)for(let ra in la)if(la[ra]){if(la[ra].id&&la[ra].view&&la[ra].id!=ea.$cmpId){let na=$o.getView(la[ra].view);for(let oa in na.attrs)aa.push([la[ra].id+':'+oa,la[ra].id+':'+na.attrs[oa].toString()])}ia(la[ra])}};return ia(ea.layoutDesigner.value),aa},save:function(){let ea=this;ea.fireEvent('aftersave',ea.value)},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.LayoutFilter.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.layoutfilter','widget.$layoutfilter'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.value=ea.value||[],ea.classMode||(ea.$view=$o.getView(ea.$viewId));let aa=ea.getItems();aa.width='100%',aa.flex=1,ea.items=aa,ea.tbar=[{text:$o.getString('Add'),name:'create',iconCls:'gi_circle_plus',handler:ea.createCondition,scope:ea},{text:$o.getString('Clear'),name:'delete',iconCls:'gi_circle_minus',scope:ea,handler:function(){ea.value=[],ea.build(),ea.fireEvent('change',ea.value)}}],ea.addEvents('change'),this.callParent(arguments)},build:function(){let ea=this,aa=ea.getItems();ea.removeAll(),ea.add(aa),ea.doLayout()},createCondition:function(){let ea=this,aa='$o.layoutcondition';ea.classMode&&(aa='$o.querycondition');ea.reportMode&&(aa='$o.reportcondition');let ia=Ext.create('Ext.Window',{width:600,height:400,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Condition'),iconCls:'gi_filter',bodyPadding:5,modal:1,items:{xtype:aa,filter:ea.value,$cmpId:ea.$cmpId,$view:ea.$view,$classes:ea.$classes,$classAliases:ea.$classAliases,$aliases:ea.$aliases,layoutDesigner:ea.layoutDesigner,listeners:{aftersave:function(la){ia.close(),ea.value=ea.value||[],ea.value=ea.value.concat(la),ea.build(),ea.fireEvent('change',ea.value)}}}});ia.show()},getItems:function(){function ea(na,oa){for(let da=0;da<na.length;da++){let ua=(oa?oa:'')+(da+1)+'.',ga='';if(2<ua.split('.').length)for(let pa=0;pa<ua.length;pa++)ga+='_';Ext.isArray(na[da])?ea(na[da],ua):('and'==na[da+2]||'or'==na[da+2]||da==na.length-2?(ia.push({attr:ga+aa.getAttrName(na[da]),oper:aa.getOperName(na[da+1])}),da+=2):(ia.push({attr:ga+aa.getAttrName(na[da]),oper:aa.getOperName(na[da+1]),value:aa.getValueName(na[da+2])}),da+=3),da<na.length&&ia.push({attr:ga+('and'==na[da]?'\u0418':'\u0418\u041B\u0418')}))}}let aa=this,ia=[];aa.value&&ea(aa.value);let la=Ext.create('Ext.data.Store',{data:ia,fields:[{name:'attr',type:'string'},{name:'oper',type:'string'},{name:'value',type:'string'}]}),ra=Ext.create('Ext.grid.Panel',{store:la,columns:[{header:$o.getString('Attribute'),width:100,dataIndex:'attr',renderer:aa.cellRenderer},{header:$o.getString('Operator'),width:100,dataIndex:'oper',renderer:aa.cellRenderer},{header:$o.getString('Value'),width:100,dataIndex:'value',renderer:aa.cellRenderer}],forceFit:!0,frame:!1,deferRowRender:!1});return ra},getAttrName:function(ea,aa){let ia=this,la=ea;if(aa&&$o.getView(aa).attrs[ea])la=$o.getView(aa).attrs[ea].toString();else if(!ia.classMode&&ia.$view.attrs[ea])la=ia.$view.attrs[ea].toString();else if(ia.classMode&&'object'==typeof ea){for(var na in ea)break;for(let oa=0;oa<ia.$aliases.length;oa++)if(ia.$aliases[oa]==na){let da=$o.getClass(ia.$classes[oa]);if(da.attrs[ea[na]]){la=na+':'+da.attrs[ea[na]].toString();break}}}return la},getOperName:function(ea){let aa={'=':$o.getString('equal')+' (=)','<>':$o.getString('not equal')+' (<>)','<':$o.getString('less')+' (<)','>':$o.getString('more')+' (>)','<=':$o.getString('less or equal')+' (<=)','>=':$o.getString('more or equal')+' (>=)','is null':$o.getString('empty')+' (is null)','is not null':$o.getString('not null')+' (is not null)','in':$o.getString('one of list')+' (in)'};return aa[ea]},getValueName:function(ea){let aa=this;if(Ext.isArray(ea))return ea.join(', ');if('object'==typeof ea){if(aa.classMode)return aa.getAttrName(ea);let ia=aa.layoutDesigner.getCmp(ea.id),la=aa.layoutDesigner.getCmpCode(ea.id),ra=ia[la].view;return aa.getAttrName(ea.attr,ra)}return ea},cellRenderer:function(ea,aa){if(ea){let oa=ea;'string'==typeof oa&&(oa=oa.split('"').join('\'')),aa.tdAttr='data-qtip="'+oa+'"'}return ea},setValue:function(ea){let aa=this;aa.value=ea,aa.build()},setViewId:function(ea){let aa=this;aa.$viewId=ea,aa.$view=$o.getView(aa.$viewId)},setCmpId:function(ea){let aa=this;aa.$cmpId=ea},setClasses:function(ea,aa,ia){let la=this;la.$classes=ea,la.$classAliases=aa,la.$aliases=ia},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.LayoutCard.Widget',{extend:'$o.LayoutEditor',layout:'fit',border:!1,defaults:{border:!1},alias:['widget.$o.layoutcard','widget.$layoutcard'],cmpCode:'card',initComponent:function(){let ea=this,aa=ea.layoutDesigner?'cmp-'+ea.layoutDesigner.counter++:'card';ea.value=ea.value||{card:{id:aa,items:[]}},ea.value.card.object=ea.value.card.object||[],Ext.isArray(ea.value.card.object)||(ea.value.card.object=[ea.value.card.object]);let ia=[{layout:'column',border:0,width:'100%',items:[{columnWidth:0.5,border:0,items:[{xtype:'compositefield',width:375,labelWidth:100,fieldLabel:$o.getString('Identifier'),style:'margin-top: 5px;',items:[{xtype:'textfield',name:'id',value:ea.value.card.id,listeners:{change:function(){ea.changeAttr('id',this.getValue())}}},{xtype:'displayfield',value:$o.getString('Read only')+':',style:'margin-left: 5px;'},{xtype:'checkbox',name:'readOnly',value:ea.value.card.readOnly,listeners:{change:function(){ea.changeAttr('readOnly',this.getValue())}}}]},{xtype:'textfield',labelWidth:100,width:375,fieldLabel:$o.getString('Title'),name:'title',value:ea.value.card.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}}},{xtype:'$iconselector',labelWidth:100,width:375,name:'iconCls',value:ea.value.card.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}}]},{columnWidth:0.5,border:0,style:'margin-left: 5px',items:[{xtype:'grid',name:'tags',store:{xtype:'store',fields:['clsName','cls','tag','cmpAttrName','cmpAttr'],data:[]},columns:[{text:$o.getString('Class of object'),dataIndex:'clsName',flex:2},{text:$o.getString('Tag of object'),dataIndex:'tag',flex:1},{text:$o.getString('Object by attribute of component'),dataIndex:'cmpAttrName',flex:2},{text:'cls',dataIndex:'cls',hidden:!0},{text:'cmpAttr',dataIndex:'cmpAttr',hidden:!0}],tbar:[{text:$o.getString('Add'),iconCls:'gi_circle_plus',handler:function(){let la=Ext.create('Ext.Window',{title:$o.getString('Tag',':','Adding'),width:600,height:400,layout:'vbox',bodyPadding:5,border:!1,resizable:!0,closable:!0,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',tbar:[{text:$o.getString('Add'),iconCls:'gi_circle_plus',handler:function(){let ra=ea.down('*[name=tags]').getStore(),na=la.down('*[name=cls]').getValue(),oa=la.down('*[name=tag]').getValue();ra.insert(ra.getCount(),{cls:na,clsName:na?$o.getClass(na).toString():null,tag:oa,cmpAttr:la.down('*[name=cmpAttr]').getValue()}),na?ea.value.card.object.push({cls:$o.getClass(na).getFullCode(),tag:oa}):ea.value.card.object.push({tag:oa});la.close()}}],items:[{xtype:'$conffield',fieldLabel:$o.getString('Object class'),labelWidth:200,name:'cls',width:'100%',confRef:'class',choose:{type:'custom',fn:function(){let ra=this;dialog.getClass({success:function(na){ra.setValue(na.id)}})}}},{xtype:'textfield',fieldLabel:$o.getString('Tag of object'),labelWidth:200,width:'100%',name:'tag'},{xtype:'combo',fieldLabel:$o.getString('Object by attribute of component'),name:'cmpAttr',anchor:'100%',labelWidth:200,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:ea.layoutDesigner?ea.getViewCmpAttrs(JSON.parse(ea.layoutDesigner.getValue())):[]}),width:'100%',valueField:'id',displayField:'text'}]});la.show()}},{text:$o.getString('Remove'),iconCls:'gi_circle_minus',handler:function(){let la=ea.down('*[name=tags]');if(la.getSelectionModel().hasSelection()){let ra=la.getSelectionModel().getSelection()[0];for(let na=0;na<ea.value.card.object.length;na++){if(ra.get('cls')){let oa=$o.getClass(ra.get('cls'));if(oa.getFullCode()==ea.value.card.object[na].cls){ea.value.card.object.splice(na,1);break}}if(ra.get('cmpAttr')&&ra.get('cmpAttr')==ea.value.card.object[na].cmpAttr){ea.value.card.object.splice(na,1);break}}la.getStore().remove(ra)}}}],width:'100%',forceFit:!0,height:90,border:1,selModel:Ext.create('Ext.selection.RowModel',{mode:'SINGLE',listeners:{selectionchange:function(la,ra){if(ra.length){let na=ra[0].get('cls');ea.down('*[name=cardDesigner]').setClassId(na,ra[0].get('tag')),ea.down('*[name=cardDesigner]').down('*[name=tree]').getSelectionModel().deselectAll()}},scope:ea}}),listeners:{afterrender:function(){if(ea.value.card.object){Ext.isArray(ea.value.card.object)||(ea.value.card.object=[ea.value.card.object]);for(let la=0,ra;la<ea.value.card.object.length;la++)ra=$o.getClass(ea.value.card.object[la].cls),ea.value.card.object[la].cls=ra.get('id'),ea.value.card.object[la].clsName=ra.toString();this.getStore().loadData(ea.value.card.object)}}}}]}]}];ia.push({layout:'fit',title:$o.getString('Card',':','Attributes'),name:'cardDesigner',width:'100%',border:1,flex:1,xtype:'$carddesigner',layoutCard:ea,value:ea.value.card.items}),ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:ia},{layout:'fit',title:$o.getString('Events'),iconCls:'gi_wifi_alt',border:0,items:{xtype:'$eventdesigner',name:'events',value:ea.value.card.listeners,$events:['aftersave','afterrender','beforerender'],listeners:{changeevent:function(la){ea.changeAttr('listeners',la)}}}},{layout:'fit',title:'\u0418\u0441\u0445\u043E\u0434\u043D\u044B\u0439 \u043A\u043E\u0434',iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},ea.addEvents('change'),ea.on('beforesave',function(la){if(!la.convertion){ea.value.card.items=ea.down('*[name=cardDesigner]').getValue();for(let ra=0;ra<ea.value.card.object.length;ra++)delete ea.value.card.object[ra].clsName,ea.value.card.object[ra].cls=$o.getClass(ea.value.card.object[ra].cls).getFullCode();ea.down('*[name=json]').setValue(JSON.stringify(ea.value,null,'\t'))}}),this.callParent(arguments)},validator:function(){let ea=this.up('panel');return ea.down('*[name=cls]').getValue()&&(ea.down('*[name=tag]').getValue()||ea.down('*[name=cmpAttr]').getValue())?ea.up('window').down('button[name=ok]').enable():ea.up('window').down('button[name=ok]').disable(),!0},getViewCmpAttrs:function(layout){let me=this;try{'string'==typeof layout&&(layout=eval('('+layout+')'))}catch(ea){}if(!layout)return[];let data=[];me.cmpAttrId={};let get=function(ea){if('object'==typeof ea)for(let aa in ea)if(ea[aa]){if(ea[aa].id&&ea[aa].view)for(let ia in v=$o.getView(ea[aa].view),v.attrs){let la=v.attrs[ia];if(la.get('classAttr')){let ra=$o.getClassAttr(la.get('classAttr'));if(!(2==ra.get('type')||12==ra.get('type')||1e3<=ra.get('type')))continue}data.push([ea[aa].id+'.'+ia,ea[aa].id+':'+la.toString()]),me.cmpAttrId[ea[aa].id+'.'+ia]=la.get('id')}get(ea[aa])}};return get(layout),data},setValue:function(ea){let aa=this;aa.value=ea,aa.value.card.object=aa.value.card.object||[],Ext.isArray(aa.value.card.object)||(aa.value.card.object=[aa.value.card.object]);aa.down('*[name=json]').setValue(JSON.stringify(ea,null,'\t')),aa.build()},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.LayoutTotal.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.layouttotal','widget.$layouttotal'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.value=ea.value||{},ea.tbar=[{text:$o.getString('Clear'),name:'delete',iconCls:'gi_circle_minus',scope:ea,handler:function(){ea.value={},ea.build(),ea.fireEvent('change',ea.value)}}],ea.store=Ext.create('Ext.data.Store',{data:[],autoSync:!0,fields:[{name:'attr',type:'string'},{name:'total',type:'string'}],listeners:{datachanged:ea.datachanged,scope:ea}});let aa=new Ext.grid.plugin.CellEditing({clicksToEdit:1});ea.grid=Ext.create('Ext.grid.Panel',{store:ea.store,columns:[{header:$o.getString('Attribute'),dataIndex:'attr'},{header:$o.getString('Total'),width:100,dataIndex:'total',editor:{xtype:'combo',mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['sum',$o.getString('Sum')],['avg',$o.getString('Average')],['max',$o.getString('Max')],['min',$o.getString('Min')]]}),valueField:'id',displayField:'text'},renderer:function(ia,la){return la.tdAttr+=' style=";border: 1px gray solid;"','sum'===ia?ia=$o.getString('Sum'):'avg'===ia?ia=$o.getString('Average'):'max'===ia?ia=$o.getString('Max'):'min'===ia?ia=$o.getString('Min'):void 0,ia}}],plugins:[aa],forceFit:!0,frame:!1,deferRowRender:!1}),ea.items=ea.grid,ea.addEvents('change'),ea.build(),this.callParent(arguments)},datachanged:function(){let ea=this;if(ea.store){ea.value={};for(let aa=0;aa<ea.store.getCount();aa++)ea.store.getAt(aa).get('total')&&(ea.value[ea.store.getAt(aa).get('attr')]=ea.store.getAt(aa).get('total'));ea.fireEvent('change',ea.value)}},setViewId:function(ea){let aa=this;aa.viewId!=ea&&(aa.value={});aa.viewId=ea,aa.build()},build:function(){let ea=this,aa=$o.getView(ea.viewId)||{},ia=[];for(let la in aa.attrs){let ra=aa.attrs[la];ra.get('classAttr')&&2!=$o.getClassAttr(ra.get('classAttr')).get('type')||ia.push([la,ea.value[la]])}ea.store.loadData(ia)}}),Ext.define('$o.LayoutChart.Widget',{extend:'$o.LayoutEditor',alias:['widget.$o.layoutchart','widget.$layoutchart'],cmpCode:'chart',border:1,initComponent:function(){let ea=this;ea.value=ea.value||{chart:{id:'cmp-'+ea.layoutDesigner.counter++}},ea.storeMark=new Ext.data.ArrayStore({fields:['id','text'],data:[]}),ea.storeValue=new Ext.data.ArrayStore({fields:['id','text'],data:[]}),ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:[{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Identifier'),name:'id',style:'margin-top: 5px;',value:ea.value.chart.id,listeners:{change:function(){ea.changeAttr('id',this.getValue()),ea.down('*[name=filter]').setCmpId(this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Title'),name:'title',value:ea.value.chart.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}}},{xtype:'$iconselector',width:'100%',name:'iconCls',value:ea.value.chart.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}},{xtype:'$conffield',fieldLabel:$o.getString('Query'),name:'view',value:ea.value.chart.view,width:'100%',confRef:'view',choose:{type:'custom',fn:function(){let aa=this;system.view.selectQuery({success:function(ia){aa.setValue(ia.value),aa.fireEvent('change',ia.value)}})}},listeners:{afterrender:function(){ea.validator()},change:function(){ea.validator.call(this);let aa=this.getValue()?$o.getView(this.getValue()).getFullCode():void 0;ea.changeAttr('view',aa),ea.down('*[name=filter]').setViewId(aa?$o.getView(aa).get('id'):null),ea.updateStores(this.getValue())}}},{xtype:'combo',fieldLabel:$o.getString('Mark',':','Attribute'),name:'attrMark',width:'100%',mode:'local',queryMode:'local',editable:!1,store:ea.storeMark,value:ea.value.chart.attrMark,valueField:'id',displayField:'text',validator:ea.validator,listeners:{select:function(){ea.changeAttr('attrMark',this.getValue())}}},{xtype:'combo',fieldLabel:$o.getString('Value',':','Attribute'),name:'attrValue',width:'100%',mode:'local',queryMode:'local',editable:!1,store:ea.storeValue,value:ea.value.chart.attrValue,valueField:'id',displayField:'text',validator:ea.validator,listeners:{select:function(){ea.changeAttr('attrValue',this.getValue())}}},{xtype:'textfield',fieldLabel:$o.getString('Title of marks'),width:'100%',name:'titleMark',validator:ea.validator,value:ea.value.chart.titleMark,listeners:{change:function(){ea.changeAttr('titleMark',this.getValue())}}},{xtype:'textfield',fieldLabel:$o.getString('Title of values'),width:'100%',name:'titleValue',validator:ea.validator,value:ea.value.chart.titleValue,listeners:{change:function(){ea.changeAttr('titleValue',this.getValue())}}},{layout:'fit',width:'100%',flex:1,title:$o.getString('Filter'),iconCls:'gi_filter',bodyPadding:2,items:{xtype:'$layoutfilter',name:'filter',layoutDesigner:ea.layoutDesigner,value:ea.value.chart.filter,$cmpId:ea.value.chart.id,$viewId:ea.value.chart.view,listeners:{change:function(aa){ea.changeAttr('filter',aa),ea.validator.call(this)}}}}]},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)},updateStores:function(ea){let aa=this;aa.down('*[name=attrMark]').setValue(null),aa.down('*[name=attrValue]').setValue(null);let ia=[];if(ea){let la=$o.getView(ea);for(let ra in la.attrs)ia.push([ra,la.attrs[ra].toString()])}if(aa.storeMark.loadData(ia),ia=[],ea){let la=$o.getView(ea);for(let ra in la.attrs){let na=la.attrs[ra];na.get('classAttr')&&2!=$o.getClassAttr(na.get('classAttr')).get('type')||ia.push([ra,na.toString()])}}aa.storeValue.loadData(ia)},validator:function(){let ea=this.up('window');return ea.down('*[name=view]').getValue()&&ea.down('*[name=attrMark]').getValue()&&ea.down('*[name=attrValue]').getValue()?ea.down('button[name=\'ok\']').enable():ea.down('button[name=\'ok\']').disable(),!0}}),Ext.define('$o.LayoutImage.Widget',{extend:'$o.LayoutEditor',alias:['widget.$o.layoutimage','widget.$layoutimage'],cmpCode:'image',border:1,initComponent:function(){let ea=this;ea.value=ea.value||{image:{id:'cmp-'+ea.layoutDesigner.counter++}},ea.store=new Ext.data.ArrayStore({fields:['id','text'],data:ea.getOtherAttrs()}),ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:[{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Identifier'),name:'id',style:'margin-top: 5px;',value:ea.value.image.id,validator:ea.validator,listeners:{change:function(){ea.changeAttr('id',this.getValue()),ea.down('*[name=filter]').setCmpId(this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Title'),name:'title',value:ea.value.image.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}}},{xtype:'$iconselector',width:'100%',name:'iconCls',value:ea.value.image.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Reference')+' (URL)',name:'url',value:ea.value.image.url,validator:ea.validator,listeners:{change:function(){ea.changeAttr('url',this.getValue()),ea.down('*[name=attr]').setValue(null)}}},{xtype:'combo',fieldLabel:$o.getString('Component attribute'),name:'attr',width:'100%',mode:'local',queryMode:'local',editable:!1,store:ea.store,value:ea.value.image.attr,valueField:'id',displayField:'text',validator:ea.validator,listeners:{select:function(){ea.changeAttr('attr',this.getValue()),ea.down('*[name=url]').setValue(null)}}},{xtype:'numberfield',width:300,fieldLabel:$o.getString('Width'),name:'width',value:ea.value.image.width,validator:ea.validator,listeners:{change:function(){ea.changeAttr('width',this.getValue())}}},{xtype:'numberfield',width:300,fieldLabel:$o.getString('Height'),name:'height',value:ea.value.image.height,validator:ea.validator,listeners:{change:function(){ea.changeAttr('height',this.getValue())}}}]},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)},getOtherAttrs:function(){let ea=this,aa=[],ia=function(la){if('object'==typeof la)for(let ra in la)if(la[ra]){if(la[ra].id&&la[ra].id!=ea.$cmpId){if(la[ra].view){let na=$o.getView(la[ra].view);for(let oa in na.attrs){let da=na.attrs[oa];da.get('classAttr')&&5==$o.getClassAttr(da.get('classAttr')).get('type')&&aa.push([la[ra].id+'.'+oa,la[ra].id+':'+da.toString()])}}if('card'==ra&&la[ra].object&&la[ra].object.cls){function na(da){if(da)for(let ua=0;ua<da.length;ua++){let ga=da[ua],pa=oa.attrs[ga.attr];ga.objectId&&ga.attr&&pa&&5==pa.get('type')&&aa.push([la[ra].id+'.'+ga.attr,la[ra].id+':'+pa.toString()]),ga.items&&na(ga.items)}}let oa=$o.getClass(la[ra].object.cls);na(la[ra].items)}}ia(la[ra])}};return ia(ea.layoutDesigner.value),aa},validator:function(){let ea=this.up('window');return ea.down('*[name=id]').getValue()&&(ea.down('*[name=url]').getValue()||ea.down('*[name=attr]').getValue())?ea.down('button[name=\'ok\']').enable():ea.down('button[name=\'ok\']').disable(),!0}}),Ext.define('$o.LayoutFrame.Widget',{extend:'$o.LayoutEditor',alias:['widget.$o.layoutframe','widget.$layoutframe'],cmpCode:'frame',border:0,initComponent:function(){let ea=this;ea.value=ea.value||{frame:{id:'cmp-'+ea.layoutDesigner.counter++}},ea.store=new Ext.data.ArrayStore({fields:['id','text'],data:ea.getOtherAttrs()}),ea.items={xtype:'tabpanel',items:[{layout:'vbox',title:$o.getString('Commons'),iconCls:'gi_edit',bodyPadding:5,items:[{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Identifier'),name:'id',style:'margin-top: 5px;',value:ea.value.frame.id,validator:ea.validator,listeners:{change:function(){ea.changeAttr('id',this.getValue()),ea.down('*[name=filter]').setCmpId(this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Title'),name:'title',value:ea.value.frame.title,listeners:{change:function(){ea.changeAttr('title',this.getValue())}}},{xtype:'$iconselector',width:'100%',name:'iconCls',value:ea.value.frame.iconCls,listeners:{change:function(){ea.changeAttr('iconCls',this.getValue())}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Reference')+' (URL)',name:'url',value:ea.value.frame.url,validator:ea.validator,listeners:{change:function(){ea.changeAttr('url',this.getValue()),ea.down('*[name=attr]').setValue(null)}}},{xtype:'combo',fieldLabel:$o.getString('Component attribute'),name:'attr',width:'100%',mode:'local',queryMode:'local',editable:!1,store:ea.store,value:ea.value.frame.attr,valueField:'id',displayField:'text',validator:ea.validator,listeners:{select:function(){ea.changeAttr('attr',this.getValue()),ea.down('*[name=url]').setValue(null)}}}]},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',border:0,items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)},getOtherAttrs:function(){let ea=this,aa=[],ia=function(la){if('object'==typeof la)for(let ra in la)if(la[ra]){if(la[ra].id&&la[ra].view&&la[ra].id!=ea.$cmpId){let na=$o.getView(la[ra].view);for(let oa in na.attrs){let da=na.attrs[oa];('olap'==ra||'treegrid'==ra)&&da.get('classAttr')&&1==$o.getClassAttr(da.get('classAttr')).get('type')&&aa.push([la[ra].id+'.'+oa,la[ra].id+':'+da.toString()])}}ia(la[ra])}};return ia(ea.layoutDesigner.value),aa},validator:function(){let ea=this.up('window');return ea.down('*[name=id]').getValue()&&(ea.down('*[name=url]').getValue()||ea.down('*[name=attr]').getValue())?ea.down('button[name=\'ok\']').enable():ea.down('button[name=\'ok\']').disable(),!0}}),Ext.define('$o.ActionDesigner.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.actiondesigner','widget.$actiondesigner'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.tbar=[{text:$o.getString('Open'),iconCls:'gi_edit',handler:ea.edit,scope:ea},{text:$o.getString('Add'),iconCls:'gi_circle_plus',handler:ea.create,scope:ea},{text:$o.getString('Remove'),iconCls:'gi_circle_minus',handler:ea.remove,scope:ea}],ea.store=Ext.create('Ext.data.Store',{data:[],fields:[{name:'action',type:'string'},{name:'id',type:'string'}]}),ea.grid=Ext.create('Ext.grid.Panel',{store:ea.store,columns:[{header:$o.getString('Action'),width:100,dataIndex:'action',renderer:ea.cellRenderer},{header:'id',width:100,dataIndex:'id',hidden:!0}],forceFit:!0,frame:!1,deferRowRender:!1,viewConfig:{plugins:{ptype:'gridviewdragdrop'},listeners:{drop:function(){let na=[];for(let oa=0;oa<ea.store.getCount();oa++)for(let da=0;da<ea.value.length;da++)if(ea.value[da].actionId==ea.store.getAt(oa).get('id')){na.push(ea.value[da]);break}ea.value=na,ea.fireEvent('change',ea.value)}}}}),ea.items=ea.grid,ea.on('afterrender',function(){ea.value&&ea.setValue(ea.value)}),this.callParent(arguments)},create:function(){let ea=this;dialog.getObject({title:$o.getString('Select','actions'),width:800,height:600,layout:{split:{orientation:'horizontal',width:300,items:[{treegrid:{id:'olapClasses',title:$o.getString('Classes'),view:'system.classes',fields:{id:'id',parent:'parent_id'},filter:['id','>=',1000]}},{olap:{id:'olap',title:$o.getString('Actions'),view:'system.actions',singleSelect:!1,filter:['class_id','=',{id:'olapClasses',attr:'id'}]}}]}},attr:'olap.id',success:function(aa){let ia=aa.values;for(let la=0;la<ia.length;la++){let ra=$o.getAction(ia[la]),na=$o.getClass(ra.get('class')),oa=na.getFullCode()+'.'+ra.get('code'),da={actionId:ra.get('id'),fn:oa,text:ra.get('name')};if(ra.get('layout')){let ua=JSON.parse(ra.get('layout'));'create'==ua.type&&(da.iconCls='gi_circle_plus');'remove'==ua.type&&(da.iconCls='gi_circle_minus',da.active='common.recordSelected');'card'==ua.type&&(da.iconCls='gi_edit',da.active='common.recordSelected')}ea.value=ea.value||[],ea.value.push(da)}ea.build(),ea.fireEvent('change',ea.value)}})},edit:function(){let ea=this,aa,ia;if(ea.grid.getSelectionModel().hasSelection()){let ra=ea.grid.getSelectionModel().getSelection()[0],na=ra.get('id');for(ia=0;ia<ea.value.length;ia++)if(ea.value[ia].actionId==na||ea.value[ia].fn==na){aa=ea.value[ia];break}}else return;let la=Ext.create('Ext.Window',{width:600,height:600,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Action'),bodyPadding:5,modal:1,items:{xtype:'$actioncard',value:aa,listeners:{aftersave:function(ra){if(la.close(),ea.value[ia]=ra,ea.build(),ra.actionId){let na=$o.getAction(ra.actionId);na.initAction()}ea.fireEvent('change',ea.value)}}}});la.show()},remove:function(){let ea=this;if(ea.grid.getSelectionModel().hasSelection()){let aa=ea.grid.getSelectionModel().getSelection()[0],ia=aa.get('id');for(let la=0;la<ea.value.length;la++)if(ea.value[la].actionId==ia||ea.value[la].fn==ia){ea.value.splice(la,1);break}ea.build(),ea.fireEvent('change',ea.value)}},build:function(){let ea=this,aa=[];for(let ia=0;ia<ea.value.length;ia++)if(ea.value[ia].actionId){let la=$o.getAction(ea.value[ia].actionId);aa.push({action:la.toString(),id:ea.value[ia].actionId})}else aa.push({action:ea.value[ia].text,id:ea.value[ia].fn});ea.store.loadData(aa)},setValue:function(ea){let aa=this;aa.value=ea,aa.build()},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.ActionCard.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.actioncard','widget.$actioncard'],layout:'vbox',border:!1,defaults:{border:!1},bodyPadding:1,initComponent:function(){let ea=this;ea.value=ea.value||{},ea.tbar=[{text:'\u041E\u043A',iconCls:'gi_ok',handler:ea.save,name:'save',disabled:1,scope:ea},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){ea.up('window').close()},name:'cancel'}],ea.items=[{xtype:'$conffield',fieldLabel:$o.getString('Action'),name:'action',width:'100%',confRef:'action',style:'margin-top: 5px',choose:{type:'layout',attr:'olap.id',width:600,height:400,layout:{split:{orientation:'horizontal',width:300,items:[{treegrid:{id:'olapClasses',view:'system.classes',fields:{id:'id',parent:'parent_id'},filter:{fn:function(){return['id','>=',1000]}}}},{olap:{id:'olap',view:'system.actions',filter:['class_id','=',{id:'olapClasses',attr:'id'}]}}]}}},listeners:{change:function(){if(this.getValue()){let aa=$o.getAction(this.getValue()),ia=$o.getClass(aa.get('class'));if(ea.down('*[name=name]').setValue(aa.get('name')),aa.get('layout')){let la=JSON.parse(aa.get('layout'));'create'==la.type&&ea.down('*[name=iconCls]').setValue('gi_circle_plus'),'remove'==la.type&&(ea.down('*[name=iconCls]').setValue('gi_circle_minus'),ea.down('*[name=activeRecordSelected]').setValue(1)),'card'==la.type&&(ea.down('*[name=iconCls]').setValue('gi_edit'),ea.down('*[name=activeRecordSelected]').setValue(1))}}ea.validator()}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Function'),name:'fn',value:ea.value.actionId?'':ea.value.fn,validator:ea.validator},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Name'),name:'name',value:ea.value.text},{xtype:'$iconselector',width:'100%',name:'iconCls',value:ea.value.iconCls},{xtype:'checkbox',name:'activeRecordSelected',fieldLabel:$o.getString('Active when record selected'),checked:'common.recordSelected'==ea.value.active},{title:$o.getString('Options'),width:'100%',flex:1,xtype:'$actionargs',value:ea.value.arguments,listeners:{change:function(aa){ea.value.arguments=aa}}}],ea.on('afterrender',function(){ea.down('*[name=action]').setValue(ea.value.actionId)}),ea.addEvents('aftersave'),this.callParent(arguments)},validator:function(){let ea=this.up('panel');return ea.down('*[name=action]').getValue()||ea.down('*[name=fn]').getValue()?ea.down('*[name=save]').enable():ea.down('*[name=save]').disable(),!0},save:function(){let ea=this,aa=ea.down('*[name=action]').getValue(),ia,la=ea.value;if(aa){la.actionId=aa;let ra=$o.getAction(aa),na=$o.getClass(ra.get('class'));ia=na.getFullCode()+'.'+ra.get('code')}else ia=ea.down('*[name=fn]').getValue();la.fn=ia,ea.down('*[name=name]').getValue()&&(la.text=ea.down('*[name=name]').getValue());ea.down('*[name=iconCls]').getValue()&&(la.iconCls=ea.down('*[name=iconCls]').getValue());ea.down('*[name=activeRecordSelected]').getValue()&&(la.active='common.recordSelected');ea.fireEvent('aftersave',la)}}),Ext.define('$o.ActionArgs.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.actionargs','widget.$actionargs'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.value=ea.value||{},ea.tbar=[{text:$o.getString('Add'),iconCls:'gi_circle_plus',handler:ea.create,scope:ea},{text:$o.getString('Remove'),iconCls:'gi_circle_minus',handler:ea.remove,scope:ea}],ea.store=Ext.create('Ext.data.Store',{autoSync:!0,data:ea.getData(),fields:[{name:'arg',type:'string'},{name:'value',type:'string'}],listeners:{datachanged:ea.datachanged,scope:ea}}),ea.grid=Ext.create('Ext.grid.Panel',{store:ea.store,columns:[{header:$o.getString('Option'),width:150,dataIndex:'arg',renderer:ea.cellRenderer,editor:{xtype:'textfield'}},{header:$o.getString('Value'),flex:1,dataIndex:'value',renderer:ea.cellRenderer,editor:{xtype:'textfield'}}],plugins:[Ext.create('Ext.grid.plugin.CellEditing',{clicksToEdit:1})],forceFit:!0,frame:!1,deferRowRender:!1}),ea.items=ea.grid,ea.addEvents('change'),this.callParent(arguments)},getData:function(){let ea=this,aa=[];for(let ia in ea.value)aa.push({arg:ia,value:ea.value[ia]});return aa},cellRenderer:function(ea,aa){let oa=this,da=aa.column.dataIndex;return aa.tdAttr+=' style=";border: 1px gray solid;"',ea},datachanged:function(){let ea=this;if(ea.store){let aa={};for(let ia=0,la;ia<ea.store.getCount();ia++)la=ea.store.getAt(ia),la.get('arg')&&la.get('value')&&(aa[la.get('arg')]=la.get('value'));ea.value=aa,ea.fireEvent('change',ea.value)}},create:function(){let ea=this;ea.store.insert(ea.store.getCount(),{})},remove:function(){let ea=this;if(ea.grid.getSelectionModel().hasSelection()){let aa=ea.grid.getSelectionModel().getSelection()[0];ea.store.remove(aa);let ia=aa.get('arg');delete ea.value[ia]}}}),Ext.define('$o.EventDesigner.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.eventdesigner','widget.$eventdesigner'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.tbar=[{text:$o.getString('Open'),iconCls:'gi_edit',handler:ea.edit,scope:ea},{text:$o.getString('Add'),iconCls:'gi_circle_plus',handler:ea.create,scope:ea},{text:$o.getString('Remove'),iconCls:'gi_circle_minus',handler:ea.remove,scope:ea}],ea.store=Ext.create('Ext.data.Store',{data:[],fields:[{name:'event',type:'string'},{name:'action',type:'string'},{name:'fn',type:'string'}]}),ea.grid=Ext.create('Ext.grid.Panel',{store:ea.store,columns:[{header:$o.getString('Event'),flex:1,dataIndex:'event',renderer:ea.cellRenderer},{header:$o.getString('Action'),flex:2,dataIndex:'action',renderer:ea.cellRenderer},{header:'fn',width:100,dataIndex:'fn',hidden:!0}],forceFit:!0,frame:!1,deferRowRender:!1}),ea.items=ea.grid,ea.on('afterrender',function(){ea.setValue(ea.value)}),ea.addEvents('changeevent'),this.callParent(arguments)},create:function(){let ea=this,aa=Ext.create('Ext.Window',{width:600,height:400,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:'\u0421\u043E\u0431\u044B\u0442\u0438\u0435',bodyPadding:5,modal:1,items:{xtype:'$eventcard',$events:ea.$events,listeners:{aftersave:function(ia){aa.close(),ea.value[ia.event]=ia,delete ia.event,ea.build(),ea.fireEvent('changeevent',ea.value)}}}});aa.show()},edit:function(){let ea=this,aa;if(ea.grid.getSelectionModel().hasSelection()){let la=ea.grid.getSelectionModel().getSelection()[0];aa=ea.value[la.get('event')],aa.event=la.get('event')}else return;let ia=Ext.create('Ext.Window',{width:600,height:400,layout:'fit',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Event'),bodyPadding:5,modal:1,items:{xtype:'$eventcard',value:aa,$events:ea.$events,listeners:{aftersave:function(la){ia.close(),ea.value[la.event]=la,delete la.event,ea.build(),ea.fireEvent('changeevent',ea.value)}}}});ia.show()},remove:function(){let ea=this;if(ea.grid.getSelectionModel().hasSelection()){let aa=ea.grid.getSelectionModel().getSelection()[0];delete ea.value[aa.get('event')],ea.build(),ea.fireEvent('changeevent',ea.value)}},build:function(){let ea=this,aa=[];for(let ia in ea.value){let la=$o.getAction(ea.value[ia].fn);aa.push({event:ia,action:la?la.toString():ea.value[ia].fn,fn:ea.value[ia].fn})}ea.store.loadData(aa)},setValue:function(ea){let aa=this;for(let ia in ea=ea||{},ea)'string'==typeof ea[ia]&&(ea[ia]={fn:ea[ia]});aa.value=ea,aa.build()},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.EventCard.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.eventcard','widget.$eventcard'],layout:'vbox',border:!1,defaults:{border:!1},bodyPadding:1,initComponent:function(){let ea=this;ea.value=ea.value||{},ea.tbar=[{text:'\u041E\u043A',iconCls:'gi_ok',handler:ea.save,name:'save',disabled:1,scope:ea},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){ea.up('window').close()},name:'cancel'}];let aa=$o.getAction(ea.value.fn),ia=[];for(let la=0;la<ea.$events.length;la++)ia.push([ea.$events[la],ea.$events[la]]);ea.items=[{xtype:'combo',name:'event',fieldLabel:$o.getString('Event'),width:'100%',triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:ia}),value:ea.value.event,validator:ea.validator,style:'margin-top: 5px',valueField:'id',displayField:'text'},{xtype:'$conffield',fieldLabel:$o.getString('Action'),name:'action',width:'100%',confRef:'action',choose:{type:'layout',attr:'olap.id',width:600,height:400,layout:{split:{orientation:'horizontal',width:300,items:[{treegrid:{id:'olapClasses',view:'system.classes',fields:{id:'id',parent:'parent_id'},filter:{fn:function(){return['id','>=',1000]}}}},{olap:{id:'olap',view:'system.actions',filter:['class_id','=',{id:'olapClasses',attr:'id'}]}}]}}},listeners:{change:function(){if(this.getValue()){let la=$o.getAction(this.getValue()),ra=$o.getClass(la.get('class'))}ea.validator()}}},{xtype:'textfield',width:'100%',fieldLabel:$o.getString('Function'),name:'fn',value:aa?'':ea.value.fn,validator:ea.validator},{title:$o.getString('Options'),width:'100%',flex:1,xtype:'$actionargs',value:ea.value.arguments,listeners:{change:function(la){ea.value.arguments=la}}}],ea.on('afterrender',function(){aa&&ea.down('*[name=action]').setValue(aa.get('id'))}),ea.addEvents('aftersave'),this.callParent(arguments)},validator:function(){let ea=this.up('panel');return ea.down('*[name=event]').getValue()&&(ea.down('*[name=action]').getValue()||ea.down('*[name=fn]').getValue())?ea.down('*[name=save]').enable():ea.down('*[name=save]').disable(),!0},save:function(){let ea=this,aa,ia=ea.down('*[name=action]').getValue();if(ia){let ra=$o.getAction(ia),na=$o.getClass(ra.get('class'));aa=na.getFullCode()+'.'+ra.get('code')}else aa=ea.down('*[name=fn]').getValue();let la=ea.value;la.fn=aa,la.event=ea.down('*[name=event]').getValue(),ea.fireEvent('aftersave',la)}}),Ext.define('$o.LayoutDesigner.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.layoutdesigner','widget.$layoutdesigner'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.initCounter(ea.value),ea.value=ea.value||ea.createEmpty(),ea.treeStore=Ext.create('Ext.data.TreeStore',{root:{expanded:!0,children:[]}}),ea.items={xtype:'tabpanel',items:[{title:$o.getString('Constructor'),iconCls:'gi_adjust_alt',layout:'border',name:'constructor',border:!1,items:[{split:!0,width:230,region:'east',layout:'fit',items:{xtype:'treepanel',store:ea.treeStore,rootVisible:!1,title:$o.getString('Navigator'),iconCls:'gi_search',border:0,tbar:[{text:$o.getString('Open'),iconCls:'gi_edit',name:'edit',handler:ea.edit,scope:ea,disabled:1},{text:$o.getString('Add'),iconCls:'gi_circle_plus',name:'create',handler:function(){let aa=ea.createEmpty();aa.panel.title='\u0417\u0430\u043A\u043B\u0430\u0434\u043A\u0430';let ia=ea.getCmp(ea.selected.id);ia.tab.items.push(aa),ea.addCmp(aa.panel.id)},scope:ea,disabled:1},{text:$o.getString('Remove'),iconCls:'gi_circle_minus',name:'delete',handler:function(){common.confirm({message:'\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B?',scope:this,fn:function(aa){if('yes'==aa){if(!ea.removeTab(ea.selected.id)){let ia=ea.createEmpty(),la=ea.getCmp(ea.selected.id);for(let ra in la)delete la[ra];Ext.apply(la,ia),ea.value.designer=1}ea.down('button[name=\'delete\']').disable(),ea.build()}}})},scope:ea,disabled:1}],bbar:[{text:$o.getString('Cancel action'),iconCls:'gi_history',name:'prevValue',disabled:1,handler:function(){ea.value=JSON.parse(ea.prevValue.pop()),ea.prevValue.length||ea.down('button[name=\'prevValue\']').disable();ea.build({back:1})}}],listeners:{select:function(aa,ia){if(ia){let na=ia.get('text').split('(id:')[1].split(')')[0],oa=ea.getCmpCode(na);'panel'==oa?ea.down('button[name=\'edit\']').disable():(ea.down('button[name=\'edit\']').enable(),ea.selected={record:ia,id:na,code:oa});'tab'==oa?ea.down('button[name=\'create\']').enable():ea.down('button[name=\'create\']').disable();'panel'==oa?ea.down('button[name=\'delete\']').disable():ea.down('button[name=\'delete\']').enable()}}}}},{region:'center',layout:'fit',border:0,style:'border: 1px solid #00ff00; margin: 1px',bodyPadding:1,items:{xtype:'$o.layout',$layout:$o.util.clone(ea.value)}}]},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',name:'source',items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},ea.addEvents('change'),ea.on('afterrender',ea.setHandlers),this.callParent(arguments)},edit:function(){let ea=this,aa=ea.selected.id,ia=ea.selected.code,la=Ext.create('Ext.Window',{width:ea.getCmpWidth(ia),height:ea.getCmpHeight(ia),resizeable:!1,border:!1,title:ea.getCmpName(ia),iconCls:ea.getCmpIconCls(ia),style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',modal:1,layout:'fit',items:{xtype:'$o.layout'+ia,layoutDesigner:ea,value:ea.getCmpValue(aa),listeners:{aftersave:function(){la.close(),ea.replaceCmp(aa,this.getValue()),ea.build(),ea.fireEvent('change',ea.getValue())}}}});la.show()},getCmpCode:function(ea){let aa=this,ia=function(la){if('object'==typeof la)for(let ra in la)if(la[ra]){if(la[ra].id==ea)return ra;let na=ia(la[ra]);if(na)return na}if(la.items)for(let ra=0,na;ra<la.items.length;ra++)if(na=ia(la.items[ra]),na)return na};return ia(aa.value)},getCmpValue:function(ea){let aa=this,ia=function(la){if('object'==typeof la)for(let ra in la)if(la[ra]){if(la[ra].id==ea)return la;let na=ia(la[ra]);if(na)return na}if(la.items)for(let ra=0,na;ra<la.items.length;ra++)if(na=ia(la.items[ra]),na)return na};return ia(aa.value)},getCmpName:function(ea){switch(ea){case'split':return $o.getString('Splitter');break;case'tab':return $o.getString('Tabs');break;case'olap':return $o.getString('Table');break;case'treegrid':return $o.getString('Tree');break;case'card':return $o.getString('Card');break;case'chart':return $o.getString('Chart');break;case'image':return $o.getString('Image');break;case'frame':return $o.getString('Frame');break;case'panel':return $o.getString('Empty');}},getCmpIconCls:function(ea){switch(ea){case'split':return'gi_share_alt';break;case'tab':return'gi_share_alt';break;case'olap':return'gi_table';break;case'treegrid':return'gi_leaf';break;case'card':return'gi_edit';break;case'chart':return'gi_charts';break;case'image':return'gi_picture';break;case'frame':return'gi_globe_af';break;case'panel':return'gi_file';}},getCmpWidth:function(ea){switch(ea){case'split':return 600;break;case'tab':return 600;break;case'olap':return 800;break;case'treegrid':return 600;break;case'card':return 800;break;case'chart':return 600;break;case'image':return 600;break;case'frame':return 600;}},getCmpHeight:function(ea){switch(ea){case'split':return 400;break;case'tab':return 400;break;case'olap':return 600;break;case'treegrid':return 600;break;case'card':return 600;break;case'chart':return 600;break;case'image':return 600;break;case'frame':return 600;}},getTreeRecord:function(ea){let aa=this;ea=ea||aa.value;for(var ia in ea)if('designer'!=ia)break;let la=ea[ia],ra={text:aa.getCmpName(ia)+(la.title?': '+la.title:'')+' (id:'+la.id+')'};if(la.items&&'panel'!=ia&&'card'!=ia){ra.expanded=0,ra.children=[];for(let na=0;na<la.items.length;na++)ra.children.push(aa.getTreeRecord(la.items[na]))}else ra.leaf=1;return ra},initCounter:function(ea){let aa=this;if(ea=ea||{},aa.counter=aa.counter||1,'object'==typeof ea)for(let ia in ea)ea[ia]&&aa.initCounter(ea[ia]);if(ea.items)for(let ia=0;ia<ea.items.length;ia++)aa.initCounter(ea.items[ia]);if(ea.id){let ia=ea.id.split('-');1<ia.length&&+ia[1]>=aa.counter&&(aa.counter=+ia[1]+1)}},createEmpty:function(){let ea=this,aa='cmp-'+ea.counter++,ia={panel:{id:aa,layout:{type:'vbox',align:'center',pack:'center'},items:[{xtype:'button',text:$o.getString('Select','component'),iconCls:'gi_edit',name:'selectCmp',cmpId:aa}]}};return ia},build:function(ea){let aa=this;ea=ea||{};let ia=aa.down('*[region=\'center\']');ia.removeAll(),ia.add({xtype:'$o.layout',$layout:aa.updateLayoutTags($o.util.clone(aa.value))}),ia.doLayout(),aa.setHandlers(),aa.treeStore.getRootNode().removeAll(),aa.treeStore.getRootNode().appendChild(aa.getTreeRecord()),aa.down('button[name=\'edit\']').disable(),ea.back||(aa.prevValue=aa.prevValue||[],aa.prevValue.push(aa.down('codemirrortextarea[name=\'json\']').getValue()),aa.down('button[name=\'prevValue\']').enable());aa.down('codemirrortextarea[name=\'json\']').setValue(JSON.stringify(aa.value,null,'\t'))},selectCmp:function(ea){let aa=this,ia=function(){ea.success(this.cmpCode),la.close()},la=Ext.create('Ext.Window',{width:560,height:100,bodyPadding:5,resizeable:!1,border:!1,title:$o.getString('Select','component'),style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',modal:1,layout:'hbox',items:[{xtype:'button',text:$o.getString('Table'),cmpCode:'olap',iconCls:'gib_table',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia},{xtype:'button',text:$o.getString('Tree'),cmpCode:'treegrid',iconCls:'gib_leaf',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia},{xtype:'button',text:$o.getString('Card'),cmpCode:'card',iconCls:'gib_edit',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia},{xtype:'button',text:$o.getString('Chart'),cmpCode:'chart',iconCls:'gib_charts',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia},{xtype:'button',text:$o.getString('Image'),cmpCode:'image',iconCls:'gib_picture',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia},{xtype:'button',text:$o.getString('Frame'),cmpCode:'frame',iconCls:'gib_globe_af',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia},{xtype:'button',text:$o.getString('Splitter'),cmpCode:'split',iconCls:'gib_share_alt',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia},{xtype:'button',text:$o.getString('Tabs'),cmpCode:'tab',iconCls:'gib_bookmark',iconAlign:'top',scale:'large',style:'margin-left: 5px;',handler:ia}]});la.show()},getCmp:function(ea){let aa=this,ia=function(la){if('object'==typeof la)for(let ra in la)if(la[ra]){if(la[ra].id==ea)return la;let na=ia(la[ra]);if(na)return na}};return ia(aa.value)},removeTab:function(ea){let aa=this,ia=function(la){if('object'==typeof la)for(let ra in la)if(la[ra]){if('tab'==ra&&1<la[ra].items.length)for(let oa=0;oa<la[ra].items.length;oa++){for(var da in la[ra].items[oa])break;if(la[ra].items[oa][da].id==ea)return la[ra].items.splice(oa,1),1}let na=ia(la[ra]);if(na)return na}};return ia(aa.value)},replaceCmp:function(ea,aa){let ia=this,la=function(ra){if('object'==typeof ra)for(let na in ra)if(ra[na]){if(ra[na].id==ea&&-1<['split','tab','olap','treegrid','card','cardConf','chart','image','frame','panel'].indexOf(na))return delete ra[na],void Ext.apply(ra,aa);la(ra[na])}};la(ia.value)},addCmp:function(ea){let aa=this;aa.addCmpActive=1,aa.selectCmp({success:function(ia){let la=Ext.create('Ext.Window',{width:aa.getCmpWidth(ia),height:aa.getCmpHeight(ia),resizeable:!1,border:!1,title:aa.getCmpName(ia),iconCls:aa.getCmpIconCls(ia),style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',modal:1,layout:'fit',items:{xtype:'$o.layout'+ia,layoutDesigner:aa,listeners:{aftersave:function(){aa.addCmpActive=0,la.close(),aa.replaceCmp(ea,this.getValue()),aa.build(),aa.fireEvent('change',aa.getValue())}}}});la.show()}})},getValue:function(){let ea=this,aa=ea.down('codemirrortextarea[name=\'json\']').getValue();return aa},setValue:function(ea){let aa=this;if(!ea)aa.counter=1,ea=aa.createEmpty(),ea.designer=1;else if('string'==typeof ea)try{if(ea=JSON.parse(ea),!ea.designer)throw'invalid'}catch(ia){let la=aa.down('*[region=\'center\']');return la.removeAll(),la.add({layout:{type:'vbox',align:'center',pack:'center'},items:[{xtype:'label',text:$o.getString('Sorry, we could not decode the source code layout')}]}),aa.treeStore.getRootNode().removeAll(),aa.down('button[name=\'edit\']').disable(),aa.down('button[name=\'create\']').disable(),aa.down('button[name=\'delete\']').disable(),aa.down('button[name=\'prevValue\']').disable(),aa.value=ea,aa.down('codemirrortextarea[name=\'json\']').setValue(ea),void aa.down('tabpanel').setActiveTab(aa.down('panel[name=source]'))}aa.value=ea,aa.initCounter(aa.value),aa.build(),aa.prevValue=[],aa.down('button[name=\'prevValue\']').disable()},setReadOnly:function(){this},updateLayoutTags:function(ea){let aa=this,ia=null,la=function(ra){if('object'==typeof ra){for(let na in ra)if(ra[na])if('card'==na&&ra[na].object){function oa(ga){for(let pa=0,ma;pa<ga.length;pa++)ma=ga[pa],ma.objectId&&ma.objectId.substr&&'[#'==ma.objectId.substr(0,2)&&(da[ma.objectId]?ma.objectId=da[ma.objectId]:ia=ra[na].id),ma.items&&oa(ma.items)}ra[na].readOnly=1;let da={},ua=ra[na].object.length?ra[na].object:[ra[na].object];for(let ga=0,pa;ga<ua.length;ga++)pa=$o.createObject(ua[ga].cls,'local'),da[ua[ga].tag]=pa.get('id');oa(ra[na].items)}else'card'!=na||ra[na].object?'string'==typeof ra[na]?'[#'==ra[na].substr(0,2)&&(ra[na]=0):la(ra[na]):ra[na].items=[];if(ra.items)for(let na=0;na<ra.items.length;na++)la(ra.items[na])}};return la(ea),ia&&common.message($o.getString('Class of object in the card is not defined')+': '+ia),ea},setHandlers:function(){let ea=this,aa=ea.query('button[name=\'selectCmp\']');for(let ia=0;ia<aa.length;ia++)aa[ia].on('click',function(){ea.addCmpActive||ea.addCmp(this.cmpId)})}}),Ext.define('$o.QuerySort.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.querysort','widget.$querysort'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.value=ea.value||[],ea.tbar=[{text:$o.getString('Add'),handler:ea.create,iconCls:'gi_circle_plus',scope:ea},{text:$o.getString('Clear'),iconCls:'gi_circle_minus',handler:ea.clear,scope:ea}],ea.store=Ext.create('Ext.data.Store',{data:[],fields:[{name:'attr',type:'string'},{name:'dir',type:'string'},{name:'alias',type:'string'},{name:'dir_id',type:'string'}]}),ea.grid=Ext.create('Ext.grid.Panel',{store:ea.store,columns:[{header:$o.getString('Attribute'),width:100,dataIndex:'attr',renderer:ea.cellRenderer},{header:$o.getString('Sort'),width:100,dataIndex:'dir',renderer:ea.cellRenderer},{header:'alias',width:100,dataIndex:'attr_id',hidden:!0},{header:'dir_id',width:100,dataIndex:'dir_id',hidden:!0}],forceFit:!0,frame:!1,deferRowRender:!1}),ea.items=ea.grid,ea.addEvents('change'),this.callParent(arguments)},cellRenderer:function(ea,aa){if(ea){let oa=ea;'string'==typeof oa&&(oa=oa.split('"').join('\'')),aa.tdAttr='data-qtip="'+oa+'"'}return ea},setClasses:function(ea,aa,ia){let la=this;la.$classes=ea,la.$classAliases=aa,la.$aliases=ia},create:function(){let ea=this,aa=[];for(let la=0,ra;la<ea.$classes.length;la++)for(let na in ra=$o.getClass(ea.$classes[la]),aa.push([ea.$aliases[la]+':id',ea.$aliases[la]+':id']),ra.attrs)aa.push([ea.$aliases[la]+':'+na,ea.$aliases[la]+':'+ra.attrs[na].toString()]);let ia=Ext.create('Ext.Window',{width:400,height:150,layout:'vbox',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Select','attribute'),iconCls:'gi_file',bodyPadding:5,modal:1,tbar:[{text:'\u041E\u043A',iconCls:'gi_ok',name:'create',disabled:1,handler:function(){let la=ia.down('*[name=attr]').getValue();ea.value=ea.value||[],ea.value.length&&ea.value.push(',');let ra={};ra[la.split(':')[0]]=la.split(':')[1],ea.value.push(ra),'DESC'==ia.down('*[name=dir]').getValue()?ea.value.push('DESC'):ea.value.push('ASC');ea.build(),ia.close(),ea.fireEvent('change',ea.value)}},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){ia.close()}}],items:[{xtype:'combo',fieldLabel:$o.getString('Attribute'),name:'attr',width:'100%',mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:aa}),valueField:'id',displayField:'text',listeners:{select:function(){this.getValue()?ia.down('*[name=create]').enable():ia.down('*[name=create]').disable()}}},{xtype:'combo',fieldLabel:$o.getString('Sort'),name:'dir',width:'100%',mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['ASC',$o.getString('Sort ascending')],['DESC',$o.getString('Sort descending')]]}),valueField:'id',displayField:'text'}]});ia.show()},clear:function(){let ea=this;ea.setValue([])},build:function(){let ea=this,aa=[];if(ea.value)for(let ia=0;ia<ea.value.length;ia+=2){','==ea.value[ia]&&ia++;let la={};'DESC'==ea.value[ia+1]?(la.dir=$o.getString('Sort descending'),la.dir_id='DESC'):(la.dir=$o.getString('Sort ascending'),la.dir_id='ASC');for(var ra in ea.value[ia])break;let na=ea.value[ia][ra];for(let oa=0;oa<ea.$aliases.length;oa++)if(ea.$aliases[oa]==ra){let da=$o.getClass(ea.$classes[oa]);la.attr=ra+':'+da.attrs[na].toString(),la.alias=ra;break}aa.push(la)}ea.store.loadData(aa)},setValue:function(ea){let aa=this;aa.value=ea,aa.build(),aa.fireEvent('change',ea)},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.QuerySelect.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.queryselect','widget.$queryselect'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.value=ea.value||[],ea.tbar=[{text:$o.getString('Choose'),iconCls:'gi_edit',handler:ea.addAttrs,scope:ea}],ea.store=Ext.create('Ext.data.Store',{data:[],fields:[{name:'name',type:'string'},{name:'clsName',type:'string'},{name:'clsFrom',type:'string'},{name:'clsId',type:'number'},{name:'attr',type:'string'},{name:'alias',type:'string'}],sorters:[{property:'name',direction:'ASC'}]}),ea.grid=Ext.create('Ext.grid.Panel',{store:ea.store,columns:[{header:$o.getString('Attribute'),width:100,dataIndex:'name',renderer:ea.cellRenderer},{header:$o.getString('Alias'),width:100,dataIndex:'alias',renderer:ea.cellRenderer},{header:$o.getString('Class'),width:100,dataIndex:'clsName',renderer:ea.cellRenderer},{header:'clsFrom',width:100,dataIndex:'clsFrom',hidden:!0},{header:'clsId',width:100,dataIndex:'clsId',hidden:!0},{header:'attr',width:100,dataIndex:'attr',hidden:!0}],forceFit:!0,frame:!1,deferRowRender:!1}),ea.items=ea.grid,ea.addEvents('change'),this.callParent(arguments)},cellRenderer:function(ea,aa){if(ea){let oa=ea;'string'==typeof oa&&(oa=oa.split('"').join('\'')),aa.tdAttr='data-qtip="'+oa+'"'}return ea},updateSelect:function(){let ea=this;ea.value=[];for(let aa=0,ia;aa<ea.store.getCount();aa++)ia={},ia[ea.store.getAt(aa).get('clsFrom')]=ea.store.getAt(aa).get('attr'),ea.value.push(ia),ea.value.push(ea.store.getAt(aa).get('alias'));ea.fireEvent('change',ea.value)},addAttrs:function(){let ea=this;if(!ea.$classes.length)return void common.message($o.getString('Select','class'));let aa=[];for(let la=0;la<ea.$classes.length;la++){let ra=$o.getClass(ea.$classes[la]),na=[{attr:'id',name:'id',alias:la?ea.$aliases[la]+'_id':'id'}],oa=[];for(let fa=0;fa<ea.store.getCount();fa++)ea.store.getAt(fa).get('clsFrom')==ea.$aliases[la]&&'id'==ea.store.getAt(fa).get('attr')&&(oa.push('id'),na[0].alias=ea.store.getAt(fa).get('alias'));for(let fa in ra.attrs){let ha=ra.attrs[fa],ba={attr:fa,name:ha.toString(),clsName:$o.getClass(ha.get('class')).toString(),alias:la?ea.$aliases[la]+'_'+fa:fa};for(let ya=0;ya<ea.store.getCount();ya++)ea.store.getAt(ya).get('clsFrom')==ea.$aliases[la]&&ea.store.getAt(ya).get('attr')==fa&&(oa.push(fa),ba.alias=ea.store.getAt(ya).get('alias'));na.push(ba)}let da=Ext.create('Ext.data.Store',{data:na,fields:[{name:'name',type:'string'},{name:'clsName',type:'string'},{name:'attr',type:'string'},{name:'alias',type:'string'}],sorters:[{property:'name',direction:'ASC'}]}),ua=new Ext.grid.plugin.CellEditing({clicksToEdit:1}),pa=Ext.create('Ext.selection.CheckboxModel',{mode:'MULTI',valueSelected:oa,checkOnly:!0}),ma=Ext.create('Ext.grid.Panel',{tbar:la?[{text:$o.getString('Aliases by attribute code'),iconCls:'gi_sort-by-alphabet',handler:function(){let fa=this.up('grid').getStore();for(let ha=0;ha<fa.getCount();ha++){let ba=fa.getAt(ha),ya=ba.get('alias');2==ya.split('_').length&&ba.set('alias',ya.split('_')[1])}}}]:[],store:da,columns:[{header:$o.getString('Attribute'),width:100,dataIndex:'name',renderer:ea.cellRenderer},{header:$o.getString('Alias'),width:100,dataIndex:'alias',renderer:ea.cellRenderer,editor:{xtype:'textfield'}},{header:$o.getString('Class'),width:100,dataIndex:'clsName',renderer:ea.cellRenderer},{header:'attr',width:100,dataIndex:'attr',hidden:!0}],plugins:[ua],selModel:pa,forceFit:!0,frame:!1,deferRowRender:!1,listeners:{afterrender:function(){for(let fa=0;fa<this.getSelectionModel().valueSelected.length;fa++)this.getSelectionModel().select(this.getStore().findRecord('attr',this.getSelectionModel().valueSelected[fa],0,!1,!1,!0),!0)}}});aa.push({title:ea.$aliases[la]+':'+ra.toString(),alias:ea.$aliases[la],name:'tab',cls:ra,layout:'fit',selModel:pa,items:ma})}let ia=Ext.create('Ext.Window',{width:600,height:600,resizeable:!1,border:!1,title:$o.getString('Select attributes (use mouse and Shift, Ctrl)'),style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',modal:1,layout:'fit',items:{xtype:'tabpanel',deferredRender:!1,items:aa},tbar:[{text:'\u041E\u043A',iconCls:'gi_ok',handler:function(){let la=[],ra=ia.down('tabpanel').query('panel[name=tab]');for(let na=0;na<ra.length;na++){let oa=ra[na],da=[];oa.selModel.hasSelection()&&(da=oa.selModel.getSelection());for(let ua=0;ua<da.length;ua++)la.push({name:ra[na].alias+':'+(oa.cls.attrs[da[ua].get('attr')]?oa.cls.attrs[da[ua].get('attr')].toString():da[ua].get('attr')),clsName:oa.cls.toString(),clsFrom:ea.$aliases[na],clsId:oa.cls.get('id'),attr:da[ua].get('attr'),alias:da[ua].get('alias')})}ea.store.loadData(la),ia.close(),ea.updateSelect()}},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){ia.close()}}]});ia.show()},setClasses:function(ea,aa,ia){let la=this;la.$classes=ea,la.$classAliases=aa,la.$aliases=ia},build:function(){let ea=this,aa=[];if(ea.value)for(let ia=0;ia<ea.value.length;ia+=2){let ra,na;for(na in ea.value[ia])break;let oa=ea.value[ia][na];for(let da=0;da<ea.$aliases.length;da++)ea.$aliases[da]==na&&(ra=$o.getClass(ea.$classes[da]));aa.push({name:na+':'+(ra.attrs[oa]?ra.attrs[oa].toString():oa),clsName:ra.toString(),clsFrom:na,clsId:ra.get('id'),attr:oa,alias:ea.value[ia+1]})}ea.store.loadData(aa)},setValue:function(ea){let aa=this;aa.value=ea,aa.build(),aa.fireEvent('change',ea)},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.QueryCondition.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.querycondition','widget.$querycondition'],layout:'vbox',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.filter=ea.filter||[],ea.value={},ea.tbar=[{text:'\u041E\u043A',iconCls:'gi_ok',name:'save',disabled:1,handler:ea.save,scope:ea},{text:$o.getString('Cancel'),iconCls:'gi_remove',name:'cancel',handler:function(){ea.up('window').close()}}];let aa=[];for(let ia=0,la;ia<ea.$classes.length;ia++)for(let ra in la=$o.getClass(ea.$classes[ia]),aa.push([ea.$aliases[ia]+':id',ea.$aliases[ia]+':id']),la.attrs)aa.push([ea.$aliases[ia]+':'+ra,ea.$aliases[ia]+':'+la.attrs[ra].toString()]);ea.items=[{xtype:'combo',fieldLabel:$o.getString('And/or'),name:'and_or',width:250,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['and',$o.getString('and')],['or',$o.getString('or')]]}),valueField:'id',displayField:'text',validator:ea.validator},{xtype:'combo',fieldLabel:$o.getString('Attribute')+' 1',name:'attr1',width:'100%',mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:aa}),valueField:'id',displayField:'text',validator:ea.validator},{xtype:'combo',fieldLabel:$o.getString('Operator'),name:'oper',width:250,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['=',$o.getString('equal')+' (=)'],['<>',$o.getString('not equal')+' (<>)'],['<',$o.getString('less')+' (<)'],['>',$o.getString('more')+' (>)'],['<=',$o.getString('less or equal')+' (<=)'],['>=',$o.getString('more  or equal')+' (>=)'],['is null',$o.getString('null')+' (is null)'],['is not null',$o.getString('not null')+' (is not null)'],['in',$o.getString('one of list')+' (in)']]}),valueField:'id',displayField:'text',listeners:{select:function(){let ia=this.getValue();'is null'==ia||'is not null'==ia?(ea.down('*[name=\'value\']').disable(),ea.down('*[name=\'attr2\']').disable()):(ea.down('*[name=\'value\']').enable(),'in'==ia?ea.down('*[name=\'attr2\']').disable():ea.down('*[name=\'attr2\']').enable())}},validator:ea.validator},{xtype:'textfield',fieldLabel:$o.getString('Value'),width:'100%',name:'value',validator:ea.validator},{xtype:'combo',fieldLabel:$o.getString('Attribute')+' 2',name:'attr2',width:'100%',mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:aa}),valueField:'id',displayField:'text',listeners:{select:function(){this.getValue()?ea.down('*[name=save]').enable():ea.down('*[name=save]').disable();ea.validator()}}}],ea.filter.length||ea.items.splice(0,1);ea.items[0].style='margin-top: 5px;',ea.addEvents('aftersave'),this.callParent(arguments)},validator:function(){let aa=this.up('panel'),ia=aa.down('*[name=\'and_or\']'),la=aa.down('*[name=\'attr1\']'),ra=aa.down('*[name=\'oper\']'),na=aa.down('*[name=\'value\']'),oa=aa.down('*[name=\'attr2\']');if(ia&&!ia.getValue())return aa.down('button[name=\'save\']').disable(),!0;if(la.getValue()&&ra.getValue()&&('is null'==ra.getValue()||'is not null'==ra.getValue()||na.getValue()||oa.getValue())){aa.down('button[name=\'save\']').enable();let da=la.getValue(),ua={};if(ua[da.split(':')[0]]=da.split(':')[1],'is null'==ra.getValue()||'is not null'==ra.getValue())aa.value=[ua,ra.getValue()];else{let ga=na.getValue();if(oa.getValue()){let pa=oa.getValue();ga={},ga[pa.split(':')[0]]=pa.split(':')[1]}aa.value=[ua,ra.getValue(),ga]}ia&&(aa.value=[ia.getValue()].concat(aa.value))}else aa.down('button[name=\'save\']').disable(),aa.value=[];return!0},save:function(){let ea=this;ea.fireEvent('aftersave',ea.value)},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.QueryDesigner.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.querydesigner','widget.$querydesigner'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.store=new Ext.data.ArrayStore({fields:['id','text'],data:[]}),ea.items={xtype:'tabpanel',items:[{title:$o.getString('Constructor'),iconCls:'gi_adjust_alt',layout:'border',name:'constructor',border:!1,items:[{split:!0,region:'north',height:315,layout:'fit',border:0,items:{layout:'vbox',bodyPadding:5,items:[{xtype:'compositefield',items:[{xtype:'$conffield',fieldLabel:$o.getString('Class'),name:'class',width:400,confRef:'class',choose:{type:'custom',fn:function(){let aa=this;dialog.getClass({success:function(ia){aa.setValue(ia.id)}})}},listeners:{change:function(){ea.updateAttrsStore(),ea.validator(),ea.updateFrom(),ea.updateClasses()}}},{xtype:'displayfield',value:$o.getString('Alias')+':',style:'margin-left: 5px',width:70},{xtype:'textfield',name:'alias',width:100,listeners:{change:function(){ea.updateAttrsStore(),ea.validator(),ea.updateFrom(),ea.updateClasses()}}}]},{title:$o.getString('Additional classes'),iconCls:'gi_cogwheels',flex:1,width:'100%',layout:'hbox',name:'classes',autoScroll:!0,bodyPadding:5,tbar:[{text:$o.getString('Add'),iconCls:'gi_circle_plus',handler:ea.addClass,scope:ea}]}]}},{region:'center',layout:'border',border:0,items:[{split:!0,width:300,region:'west',layout:'fit',border:1,bodyPadding:1,items:{title:$o.getString('Attributes'),iconCls:'gi_file',xtype:'$queryselect',name:'attrs',listeners:{change:function(aa){let ia=ea.decodeQuery();ia&&(ia.select=aa,ea.down('codemirrortextarea[name=\'json\']').setValue(JSON.stringify(ia,null,'\t')))}}}},{region:'center',layout:'fit',border:0,items:{layout:'border',border:0,items:[{split:!0,width:300,region:'west',layout:'fit',border:1,bodyPadding:1,items:{title:$o.getString('Filter'),iconCls:'gi_filter',xtype:'$layoutfilter',name:'filter',classMode:1,listeners:{change:ea.updateFilter,scope:ea}}},{region:'center',layout:'fit',border:1,bodyPadding:1,items:{title:$o.getString('Sort'),iconCls:'gi_sort-by-order',name:'sort',xtype:'$querysort',listeners:{change:function(aa){let ia=ea.decodeQuery();ia&&(ia.order=aa,ea.down('codemirrortextarea[name=\'json\']').setValue(JSON.stringify(ia,null,'\t')))}}}}]}}]}]},{layout:'fit',title:$o.getString('Source code'),iconCls:'gi_notes',name:'source',items:{xtype:'codemirrortextarea',mode:'application/ld+json',name:'json',value:JSON.stringify(ea.value,null,'\t')}}]},this.callParent(arguments)},decodeQuery:function(){let ea=this,aa=ea.down('*[name=constructor]');aa.getEl().unmask(!0);let ia=ea.down('codemirrortextarea[name=\'json\']').getValue();try{return ia=JSON.parse(ia),ia}catch(la){aa.getEl().mask($o.getString('Sorry, we could not decode the source code layout')),ea.down('tabpanel').setActiveTab(ea.down('panel[name=source]'))}},updateFrom:function(){let ea=this,aa=ea.down('*[name=class]').getValue();if(aa){let ia=$o.getClass(aa).getFullCode(),la=ea.decodeQuery();if(la){la.from=[{a:ia}];let ra=ea.down('*[name=classes]').query('panel');for(let na=0;na<ra.length;na++){let oa=ra[na].n,da=ea.down('*[name=class_'+oa+']').getValue(),ua=ea.down('*[name=attr1_'+oa+']').getValue(),ga=ea.down('*[name=attr2_'+oa+']').getValue(),pa=ea.down('*[name=join_'+oa+']').getValue();if(da&&ua&&ga&&pa){let ma={};ma[oa]=$o.getClass(da).getFullCode(),la.from=la.from.concat(pa,ma,'on');let fa={};fa[ua.split(':')[0]]=ua.split(':')[1];let ha={};ha[ga.split(':')[0]]=ga.split(':')[1],la.from.push([fa,'=',ha])}}ea.down('codemirrortextarea[name=\'json\']').setValue(JSON.stringify(la,null,'\t'))}}},addClass:function(ea){'object'==typeof ea&&(ea=null);let aa=this,ia=aa.down('*[name=classes]');if(!ea){let la=ia.query('panel'),ra='abcdefghijklmnopqrstuvwxyz';for(let na=0,oa;na<ra.length;na++){oa=0;for(let da=0;da<la.length;da++)if(la[da].n==ra[na]){oa=1;break}if(!oa&&ra[na]!=aa.down('*[name=alias]').getValue()){ea=ra[na];break}}}ia.add({layout:'vbox',bodyPadding:5,width:300,n:ea,style:'margin-right: 5px',items:[{xtype:'$conffield',fieldLabel:$o.getString('Class'),width:'100%',labelWidth:100,name:'class_'+ea,confRef:'class',choose:{type:'layout',attr:'olap.id',width:500,height:400,layout:{treegrid:{id:'olap',view:'system.classes',fields:{id:'id',parent:'parent_id'},filter:{fn:function(){return['id','>=',1000,'and','end_id','=',2147483647]}}}}},listeners:{change:function(){aa.updateAttrsStore();let la=this.up('*').down('*[fieldLabel=\''+$o.getString('Attribute')+' 1\']'),ra=this.up('*').down('*[fieldLabel=\''+$o.getString('Attribute')+' 2\']');if(!la.getValue()&&!ra.getValue()){let na=aa.down('*[name=class]').getValue(),oa=this.getValue();if(na&&oa){let da=$o.getClass(na).attrs,ua=aa.down('*[name=alias]').getValue(),ga=this.up('*').down('*[fieldLabel=\''+$o.getString('Alias')+'\']').getValue();for(let pa in da){let ma=da[pa];if(ma.get('type')==oa){la.setValue(ua+':'+pa),ra.setValue(ga+':id');break}}}}aa.validator(),aa.updateFrom(),aa.updateClasses()}}},{xtype:'textfield',fieldLabel:$o.getString('Alias'),name:'alias_'+ea,value:ea,listeners:{change:function(){aa.updateAttrsStore(),aa.validator(),aa.updateFrom(),aa.updateClasses()}}},{xtype:'combo',fieldLabel:$o.getString('Attribute')+' 1',name:'attr1_'+ea,width:'100%',labelWidth:100,mode:'local',queryMode:'local',editable:!1,store:aa.store,valueField:'id',displayField:'text',listeners:{select:function(){aa.validator(),aa.updateFrom()}}},{xtype:'combo',fieldLabel:$o.getString('Attribute')+' 2',name:'attr2_'+ea,width:'100%',labelWidth:100,mode:'local',queryMode:'local',editable:!1,store:aa.store,valueField:'id',displayField:'text',listeners:{select:function(){aa.validator(),aa.updateFrom()}}},{xtype:'combo',fieldLabel:$o.getString('Union'),name:'join_'+ea,width:'100%',labelWidth:100,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['left-join',$o.getString('External')],['inner-join',$o.getString('Internal')]]}),value:'left-join',valueField:'id',displayField:'text',listeners:{select:function(){aa.validator(),aa.updateFrom()}}},{xtype:'button',text:$o.getString('Remove'),iconCls:'gi_circle_minus',style:'margin-top: 5px',handler:function(){let la=this.up('panel');ia.remove(la),ia.doLayout(),aa.updateAttrsStore(),aa.validator(),aa.updateFrom(),aa.updateClasses()}}]}),ia.doLayout()},updateFilter:function(ea){let aa=this,ia=aa.decodeQuery();ia&&(ia.where=ea,aa.down('codemirrortextarea[name=\'json\']').setValue(JSON.stringify(ia,null,'\t')))},updateClasses:function(){function ea(ua,ga){la[ua]=ga;let pa=$o.getClass(ua);pa.get('parent')&&ea(pa.get('parent'),ga)}let aa=this,ia=[],la={},ra=[];let na=aa.down('*[name=class]').getValue();na&&(ia.push(na),ea(na,aa.down('*[name=alias]').getValue()),ra.push(aa.down('*[name=alias]').getValue()));let da=aa.down('*[name=classes]').query('panel');for(let ua=0;ua<da.length;ua++){let ga=aa.down('*[name=class_'+da[ua].n+']').getValue(),pa=aa.down('*[name=alias_'+da[ua].n+']').getValue();ga&&(ia.push(ga),ea(ga,pa),ra.push(pa))}aa.down('*[name=attrs]').setClasses(ia,la,ra),aa.down('*[name=filter]').setClasses(ia,la,ra),aa.down('*[name=sort]').setClasses(ia,la,ra)},validator:function(){this},clear:function(){let ea=this;ea.down('*[name=class]').setValue(null),ea.down('*[name=classes]').removeAll(),ea.down('*[name=attrs]').setValue(null),ea.down('*[name=filter]').setValue(null),ea.down('*[name=sort]').setValue(null)},buildForm:function(ea){let aa=this;if(ea=ea||{},aa.down('*[name=alias]').setValue('a'),ea.from&&ea.from.length){for(var ia in ea.from[0])break;aa.down('*[name=alias]').setValue(ia),ia=ea.from[0][ia];let la=$o.getClass(ia);aa.down('*[name=class]').setValue(la.get('id'));for(let ra=1;ra<ea.from.length;ra+=4){for(var na in ea.from[ra+1])break;let oa=na;aa.addClass(oa);let da=$o.getClass(ea.from[ra+1][na]);aa.down('*[name=class_'+oa+']').setValue(da.get('id'));let ua=ea.from[ra+3][0];for(na in ua){aa.down('*[name=attr1_'+oa+']').setValue(na+':'+ua[na]);break}let ga=ea.from[ra+3][2];for(na in ga){aa.down('*[name=attr2_'+oa+']').setValue(na+':'+ga[na]);break}'left-join'==ea.from[ra]?aa.down('*[name=join_'+oa+']').setValue('left-join'):aa.down('*[name=join_'+oa+']').setValue('inner-join')}}ea.select&&aa.down('*[name=attrs]').setValue(ea.select),ea.where&&aa.down('*[name=filter]').setValue(ea.where),ea.order&&aa.down('*[name=sort]').setValue(ea.order)},getValue:function(){let ea=this;return ea.down('codemirrortextarea[name=\'json\']').getValue()},updateAliases:function(ea){if(!ea)return;let aa=this,ia={},la;if(ea.from){function ra(oa){if(oa)if(Ext.isArray(oa))for(let da=0;da<oa.length;da++)ra(oa[da]);else if('object'==typeof oa){for(la in oa)break;la!=ia[la]&&(oa[ia[la]]=oa[la],delete oa[la])}}for(la in ea.from[0])break;ia[la]='a';let na=1;for(let oa=1;oa<ea.from.length;oa+=4){for(la in ea.from[oa+1])break;ia[la]='c'+na,na++}ra(ea.select),ra(ea.from),ra(ea.where),ra(ea.order)}},setValue:function(ea){let aa=this,ia=aa.down('*[name=constructor]');ia.getEl().unmask(!0),ea||(ea={designer:1});let la='object'==typeof ea?JSON.stringify(ea,null,'\t'):ea;if(aa.down('codemirrortextarea[name=\'json\']').setValue(la),'string'==typeof ea)try{if(ea=JSON.parse(ea),!ea.designer)throw'invalid'}catch(ra){return ia.getEl().mask($o.getString('Sorry, we could not decode the source code layout')),void aa.down('tabpanel').setActiveTab(aa.down('panel[name=source]'))}aa.clear(),aa.buildForm(ea),aa.down('codemirrortextarea[name=\'json\']').setValue(la)},setReadOnly:function(){this},updateAttrsStore:function(){let ea=this,aa=[],ia=ea.query('*[confRef=class]'),la=[ea.down('*[name=alias]')].concat(ea.query('*[fieldLabel='+$o.getString('Alias')+']'));for(let ra=0;ra<ia.length;ra++){if(!ia[ra].getValue()||!la[ra].getValue())continue;let na;for(let ua=0;ua<la.length;ua++)if(1==ia[ra].name.split('_')&&1==la[ua].name.split('_')||ia[ra].name.split('_')[1]==la[ua].name.split('_')[1]){na=la[ua].getValue();break}aa.push([na+':id',na+':id']);let oa=ia[ra].getValue(),da=$o.getClass(oa);for(let ua in da.attrs){let ga=da.attrs[ua];(2==ga.get('type')||12==ga.get('type')||1e3<=ga.get('type'))&&aa.push([na+':'+ua,na+':'+ga.toString()])}}ea.store.loadData(aa)}}),Ext.define('$o.QueryColumns.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.querycolumns','widget.$querycolumns'],layout:'fit',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.$view=$o.getView(ea.viewId),ea.updateAttrs()&&(ea.items={xtype:'$o.layout',border:1,$layout:{split:{orientation:'vertical',height:100,items:[{layout:'fit',xtype:'$o.layout',$layout:{olap:{id:'olap',view:ea.$view.getFullCode(),hideBottomToolbar:1,groupedColumns:!0,listeners:{columnresize:ea.onColumnResize,columnmove:ea.onColumnMove,columnhide:ea.onColumnHide,columnshow:ea.onColumnShow,scope:ea}}},listeners:{afterrender:function(){ea.olapContainer=this}}},{split:{title:$o.getString('Columns'),iconCls:'gi_file',orientation:'vertical',height:185,pages:[{olap:{id:'olapAttrs',view:'system.viewAttrs',filter:['view_id','=',ea.viewId],listeners:{afterrender:function(){ea.olapAttrs=this}}}},{cardConf:{id:'attrCard',items:[{conf:'viewAttr',id:'olapAttrs',attr:'id.name',fieldLabel:$o.getString('Name')},{conf:'viewAttr',id:'olapAttrs',attr:'id.code',fieldLabel:$o.getString('Code'),allowBlank:!1,maskRe:/[A-Za-z0-9\_]/},{xtype:'compositefield',fieldLabel:$o.getString('Visible'),items:[{conf:'viewAttr',id:'olapAttrs',attr:'id.area',xtype:'checkbox',width:100}]},{xtype:'compositefield',fieldLabel:$o.getString('N'),items:[{conf:'viewAttr',id:'olapAttrs',attr:'id.order',xtype:'numberfield',width:100}]},{xtype:'compositefield',fieldLabel:$o.getString('Width'),items:[{conf:'viewAttr',id:'olapAttrs',attr:'id.width',xtype:'numberfield',width:100}]}],active:{fn:function(){return!ea.schemaId}},listeners:{afterSave:function(){ea.olapContainer.removeAll(),ea.olapContainer.add({layout:'fit',xtype:'$o.layout',$layout:{olap:{id:'olap',view:ea.$view.getFullCode(),hideBottomToolbar:1,groupedColumns:!0,listeners:{columnresize:ea.onColumnResize,columnmove:ea.onColumnMove,columnhide:ea.onColumnHide,columnshow:ea.onColumnShow}}}}),ea.olapContainer.updateLayout()}}}}]}}]}}},ea.dockedItems={dock:'top',height:60,layout:'vbox',border:0,bodyPadding:5,defaults:{width:'100%'},items:[{xtype:'label',text:'- '+$o.getString('To hide / show a column use context menu of any column')},{xtype:'label',text:'- '+$o.getString('Drag the column to modify its location')},{xtype:'label',text:'- '+$o.getString('Width of columns set in the header of table at the column boundaries')}]});this.callParent(arguments)},getClassAndClassAttr:function(ea,aa){let ia=this,la={},ra;for(ra in aa.from[0])break;la[ra]=$o.getClass(aa.from[0][ra]);for(let na=1;na<aa.from.length;na+=4){for(ra in aa.from[na+1])break;la[ra]=$o.getClass(aa.from[na+1][ra])}for(let na=1;na<aa.select.length;na+=2)if(aa.select[na]==ea){for(ra in aa.select[na-1])break;let oa=aa.select[na-1][ra];return[la[ra],la[ra].attrs[oa]]}},updateAttrs:function(){let ea=this,aa,ia=[];try{aa=JSON.parse(ea.$view.get('query'));let la=1;for(let ra in ea.$view.attrs)ea.$view.attrs[ra].order&&ea.$view.attrs[ra].order>=la&&(la=ea.$view.attrs[ra].order+1);for(let ra=1,na;ra<aa.select.length;ra+=2)if(na=aa.select[ra],ia.push(na),!ea.$view.attrs[na]){let oa=ea.getClassAndClassAttr(na,aa),da=oa[1]?oa[1].get('name'):na;('a_id'==na||'c'==na[0]&&'_id'==na.substr(na.length-3,3))&&(da='id');let ua=$o.createViewAttr({name:da,code:na,view:ea.viewId,area:1,width:75,'class':oa[0].get('id'),order:la++,classAttr:oa[1]?oa[1].get('id'):null});ua.sync()}for(let ra in ea.$view.attrs)if(-1==ia.indexOf(ra)){let na=ea.$view.attrs[ra];na.remove(),na.sync()}return 1}catch(la){ea.items={layout:{type:'vbox',align:'center',pack:'center'},items:[{xtype:'label',text:$o.getString('Sorry, we could not decode the source code query')}]}}},onColumnResize:function(ea,aa,ia){if(aa.$field){let la=aa.$field.id,ra=$o.getViewAttr(la);ra.set('width',ia),ra.sync(),this.olapAttrs&&this.olapAttrs.refresh()}},onColumnMove:function(ea){let ra=this,na=ea.getGridColumns();for(let oa=0;oa<na.length;oa++){if(!na[oa].$field)continue;let da=$o.getViewAttr(na[oa].$field.id);da.get('order')!=oa+1&&(da.set('order',oa+1),da.sync())}this.olapAttrs&&this.olapAttrs.refresh()},onColumnHide:function(ea,aa){if(aa.$field){let ia=aa.$field.id,la=$o.getViewAttr(ia);la.set('area',0),la.sync(),this.olapAttrs&&this.olapAttrs.refresh()}},onColumnShow:function(ea,aa){if(aa.$field){let ia=aa.$field.id,la=$o.getViewAttr(ia);la.set('area',1),la.sync(),this.olapAttrs&&this.olapAttrs.refresh()}}}),Ext.define('$o.ReportDesigner.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.reportdesigner','widget.$reportdesigner'],layout:'vbox',border:0,initComponent:function(){let ea=this;ea.startRowsNum=10,ea.startColsNum=50;let aa=[];for(let la=0,ra;la<ea.startRowsNum;la++){ra=[];for(let na=0;na<ea.startColsNum;na++)ra.push({text:'',style:'s1'});aa.push({height:20,cells:ra})}let ia=[];for(let la=0;la<ea.startColsNum;la++)ia.push(50);ea.value=ea.value||{name:void 0,code:void 0,query:[],styles:{s1:{hAlign:'Left',vAlign:'Top',wrap:!0,fontSize:10}},sheets:[{name:'\u041B\u0438\u0441\u04421',columns:ia,rows:aa}]},ea.divId='div-'+ ++Ext.Component.AUTO_ID,ea.items=[{xtype:'tabpanel',width:'100%',deferredRender:!1,flex:1,items:[{title:'\u0428\u0430\u0431\u043B\u043E\u043D',iconCls:'gi_edit',autoScroll:!0,tbar:[{text:'\u041E\u0431\u044A\u0435\u0434\u0438\u043D\u0438\u0442\u044C',iconCls:'gi_resize_small',handler:function(){ea.selectedRange&&(ea.ht.mergeCells.mergeOrUnmergeSelection(ea.selectedRange),ea.ht.render())}},{iconCls:'gi_bold',tooltip:'\u041F\u043E\u043B\u0443\u0436\u0438\u0440\u043D\u044B\u0439',handler:function(){ea.updateProp('bold','bool')}},{iconCls:'gi_italic',tooltip:'\u041A\u0443\u0440\u0441\u0438\u0432',handler:function(){ea.updateProp('italic','bool')}},{iconCls:'gi_unchecked',tooltip:'\u0420\u0430\u043C\u043A\u0430',handler:function(){ea.updateProp('borders','bool')}},'-',{iconCls:'gi_align_left',tooltip:'\u0413\u043E\u0440\u0438\u0437\u043E\u043D\u0442\u0430\u043B\u044C\u043D\u043E: \u0421\u043B\u0435\u0432\u0430',handler:function(){ea.updateProp('hAlign','Left')}},{iconCls:'gi_align_center',tooltip:'\u0413\u043E\u0440\u0438\u0437\u043E\u043D\u0442\u0430\u043B\u044C\u043D\u043E: \u041F\u043E \u0446\u0435\u043D\u0442\u0440\u0443',handler:function(){ea.updateProp('hAlign','Center')}},{iconCls:'gi_align_right',tooltip:'\u0413\u043E\u0440\u0438\u0437\u043E\u043D\u0442\u0430\u043B\u044C\u043D\u043E: \u0421\u043F\u0440\u0430\u0432\u0430',handler:function(){ea.updateProp('hAlign','Right')}},'-',{iconCls:'gi_up_arrow',tooltip:'\u0412\u0435\u0440\u0442\u0438\u043A\u0430\u043B\u044C\u043D\u043E: \u0421\u0432\u0435\u0440\u0445\u0443',handler:function(){ea.updateProp('vAlign','Top')}},{iconCls:'gi_minus',tooltip:'\u0412\u0435\u0440\u0442\u0438\u043A\u0430\u043B\u044C\u043D\u043E: \u041F\u043E \u0446\u0435\u043D\u0442\u0440\u0443',handler:function(){ea.updateProp('vAlign','Middle')}},{iconCls:'gi_down_arrow',tooltip:'\u0412\u0435\u0440\u0442\u0438\u043A\u0430\u043B\u044C\u043D\u043E: \u0412\u043D\u0438\u0437\u0443',handler:function(){ea.updateProp('vAlign','Bottom')}}],html:'<div id=\''+ea.divId+'\' style=\'width: 100%; height: 100%;\'></div>'},{title:'\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430',iconCls:'gi_settings',layout:'vbox',bodyPadding:3,border:!1,items:[{xtype:'textfield',name:'name',fieldLabel:'\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435',width:'100%',value:ea.value.name},{xtype:'textfield',name:'code',fieldLabel:'\u041A\u043E\u0434',width:'100%',value:ea.value.code},{xtype:'combo',fieldLabel:'\u041E\u0440\u0438\u0435\u043D\u0442\u0430\u0446\u0438\u044F',name:'orientation',width:250,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['portrait','\u041A\u043D\u0438\u0436\u043D\u0430\u044F'],['landscape','\u0410\u043B\u044C\u0431\u043E\u043C\u043D\u0430\u044F']]}),value:ea.value.sheets[0].orientation?ea.value.sheets[0].orientation:'portrait',valueField:'id',displayField:'text'},{xtype:'$o.reportquery',width:'100%',flex:1,value:ea.value.query,listeners:{change:function(la){ea.value.query=la}}}]}]}],ea.on('afterrender',function(){window.Handsontable?ea.make():$o.util.loadJS('/third-party/js/jquery-2.1.1.min.js',function(){$o.util.loadCSS('/third-party/handsontable/jquery.handsontable.full.css',function(){$o.util.loadJS('/third-party/handsontable/jquery.handsontable.full.min.js',function(){$(document).ready(function(){ea.make()})})})})},ea),ea.addEvents('change'),ea.callParent(arguments)},updateProp:function(ea,aa){let ia=this,la=ia.selectedArea;if(la){for(let ra=la.row;ra<la.row+la.rowspan;ra++)for(let na=la.col;na<la.col+la.colspan;na++)if('bool'==aa){let oa=!0;ia.styleObjects[ia.cellStyle[ra+'_'+na]]&&(oa=!ia.styleObjects[ia.cellStyle[ra+'_'+na]][ea]);let da=ia.createStyle(ia.cellStyle[ra+'_'+na],ea,oa);ia.cellStyle[ra+'_'+na]=da}else{let oa=ia.createStyle(ia.cellStyle[ra+'_'+na],ea,aa);ia.cellStyle[ra+'_'+na]=oa}ia.ht.selectCell(la.row,la.col,la.row+la.rowspan-1,la.col+la.colspan-1),ia.ht.render()}},addCol:function(){let ea=this;ea.ht.alter('insert_col',ea.selectedArea.col,1)},removeCol:function(){let ea=this;ea.ht.alter('remove_col',ea.selectedArea.col,1)},addRow:function(){let ea=this;ea.ht.alter('insert_row',ea.selectedArea.row,1)},removeRow:function(){let ea=this;ea.ht.alter('remove_row',ea.selectedArea.row,1)},createStyle:function(ea,aa,ia){let la=this,ra=ea?$o.util.clone(la.styleObjects[ea]):{};ra[aa]=ia;let oa=0,na;for(let da in la.styleObjects){let ua=la.styleObjects[da];if(JSON.stringify(ua).length==JSON.stringify(ra).length){let ga=1;for(let pa in ra)if(ra[pa]!=ua[pa]){ga=0;break}if(ga){na=da;break}}oa<+da.substr(1)&&(oa=+da.substr(1))}return na?na:(la.styleObjects['s'+(oa+1)]=ra,'s'+(oa+1))},getData:function(){let ea=this,aa=ea.value.sheets[0].rows,ia=[],la;for(ea.cellStyle={},la=0;la<aa.length;la++){let ra={},na=aa[la].cells,oa;for(oa=0;oa<na.length;oa++)ra['c'+oa]=na[oa].text,ea.cellStyle[la+'_'+oa]=na[oa].style;for(;oa<ea.startColsNum;oa++)ra['c'+oa]='';ia.push(ra)}return ia},getColWidths:function(){let ea=this,aa=ea.value.sheets[0].columns;for(let ia=aa.length;ia<ea.startColsNum;ia++)aa.push(50);return aa},getColumns:function(){let ea=this,aa=ea.value.sheets[0].rows,ia=ea.startColsNum;for(let ra=0;ra<aa.length;ra++)aa[ra].cells.length>ia&&(ia=aa[ra].cells.length);let la=[];for(let ra=0;ra<ia;ra++)la.push({data:'c'+ra,renderer:ea.cellRenderer});return la},setStyles:function(){let ea=this;ea.styleObjects=ea.value.styles},getRowHeights:function(){let ea=this,aa=[],ia=ea.value.sheets[0].rows;for(let la=0;la<ia.length;la++)aa.push(ia[la].height);return aa},getMergeCells:function(){let ea=this,aa=ea.value.sheets[0].mergeCells;return aa||!0},make:function(){let ea=this;Handsontable.cmp=Handsontable.cmp||{},Handsontable.cmp[ea.divId]=ea,ea.setStyles();let aa={data:ea.getData(),colWidths:ea.getColWidths(),columns:ea.getColumns(),rowHeights:ea.getRowHeights(),mergeCells:ea.getMergeCells(),manualColumnResize:!0,manualRowResize:!0,rowHeaders:!0,colHeaders:!0,minSpareRows:1,minSpareCols:1,contextMenu:!0,beforeRender:function(){this.cmp=ea,ea.ht=this},afterSelectionEnd:function(ia,la,ra,na){ea.selectedArea={row:ia,col:la,rowspan:ra-ia+1,colspan:na-la+1},ea.selectedRange=this.getSelectedRange()}};$('#'+ea.divId).handsontable(aa)},cellRenderer:function(ea,aa,ia,la){let ra=ea.cmp;Handsontable.renderers.TextRenderer.apply(this,arguments),aa.style.fontFamily='sans-serif';let na=ra.styleObjects[ra.cellStyle[ia+'_'+la]]||{};return aa.style.fontSize=na.fontSize?na.fontSize+'pt':'10pt',aa.style.textAlign=na.hAlign?na.hAlign.toLowerCase():'left',aa.style.verticalAlign=na.vAlign?na.vAlign.toLowerCase():'top',na.bold&&(aa.style.fontWeight='bold'),na.italic&&(aa.style.fontStyle='italic'),(na.borders&&(aa.style.border='1px solid black'),aa)},getValue:function(){let ea=this,aa=ea.ht.getData(),ia=[];for(let na=0,oa;na<aa.length;na++){oa=[];for(let da=0;da<ea.ht.countCols();da++)oa.push({text:aa[na]['c'+da],style:ea.cellStyle[na+'_'+da]});ia.push({height:ea.ht.getRowHeight(na),cells:oa})}let la=[];for(let na=0;na<ea.ht.countCols();na++)la.push(ea.ht.getColWidth(na));let ra={name:ea.down('textfield[name=name]').getValue(),code:ea.down('textfield[name=code]').getValue(),query:ea.value.query,styles:ea.styleObjects,sheets:[{name:'Sheet1',orientation:ea.down('*[name=orientation]').getValue(),columns:la,rows:ia,mergeCells:ea.ht.mergeCells.mergedCellInfoCollection,countEmptyRows:ea.ht.countEmptyRows(!0),countEmptyCols:ea.ht.countEmptyCols(!0)}]};return ra},build:function(ea){let aa=this;if(aa.processTags(ea),ea.preview)aa.generateXMLSS().preview();else if(ea.html){let ia=aa.generateHTML();aa.previewHTML(ia)}else{let ia=aa.generateXMLSS();ea.pdf?ia.createPDF():ia.create()}},generateXMLSS:function(){let ea=this,aa=[],ia=ea.value.sheets[0].rows,la=ea.value.sheets[0].mergeCells;for(let ga=0;ga<ia.length;ga++){let pa=[],ma=ia[ga].cells;for(let fa=0;fa<ma.length;fa++){let ha=1,ba=1,ya=0;for(let wa=0;wa<la.length;wa++)if(la[wa].row==ga&&la[wa].col==fa){ha=la[wa].colspan,ba=la[wa].rowspan;break}else if(ga>=la[wa].row&&ga<la[wa].row+la[wa].rowspan&&fa>=la[wa].col&&fa<la[wa].col+la[wa].colspan){ya=1;break}ya||pa.push({text:ma[fa].text,style:ma[fa].style,colspan:ha,rowspan:ba,startIndex:fa+1})}aa.push({height:0.75*ia[ga].height,cells:pa})}let ra={'default':'hAlign:Left,vAlign:Center,wrap:true,fontSize:10'},na=ea.value.styles;for(let ga in na){let pa=na[ga],ma=['wrap:true'];pa.fontSize&&ma.push('fontSize:'+pa.fontSize),pa.hAlign&&ma.push('hAlign:'+pa.hAlign),pa.vAlign&&ma.push('vAlign:'+('Middle'==pa.vAlign?'Center':pa.vAlign)),pa.bold&&ma.push('bold:true'),pa.italic&&ma.push('italic:true'),pa.borders&&ma.push('borders:All'),ra[ga]=ma.join(',')}let oa=[],da=ea.value.sheets[0].columns;for(let ga=0;ga<da.length;ga++)oa.push(da[ga]/7);let ua=new $report.xmlss;return ua.styles=ra,ua.sheets=[new $report.sheet({name:'\u041B\u0438\u0441\u04421',orientation:ea.value.sheets[0].orientation,margins:{left:15,top:15,right:15,bottom:15},columns:oa,rows:aa})],ua},generateHTML:function(){let aa=this,ia='',la=aa.value.sheets[0].rows,ra=aa.value.sheets[0].columns,na=aa.value.sheets[0].mergeCells,oa={};for(let da=0;da<la.length;da++){let ua=la[da],ga=ua.cells,pa='<tr style=\'height:'+ua.height+'px\'>';for(let ma=0;ma<ga.length;ma++){let fa=1,ha=1,ba=0;for(let Sa=0;Sa<na.length;Sa++)if(na[Sa].row==da&&na[Sa].col==ma){fa=na[Sa].colspan,ha=na[Sa].rowspan;break}else if(da>=na[Sa].row&&da<na[Sa].row+na[Sa].rowspan&&ma>=na[Sa].col&&ma<na[Sa].col+na[Sa].colspan){ba=1;break}if(ba)continue;let ya='',wa=ga[ma],xa=wa.text;(xa===void 0||null===xa||''===xa)&&(xa='<img width=1 height=1>');let Ca=aa.value.styles[wa.style];Ca=Ca||{},-1<Ca.bold&&(ya='font-weight:bold;');-1<Ca.italic&&(ya='font-style:italic;');Ca.hAlign&&(ya+='text-align:'+Ca.hAlign.toLowerCase()+';');Ca.vAlign&&(ya+='vertical-align:'+Ca.vAlign.toLowerCase()+';');Ca.borders&&(oa[da]=oa[da]||{},oa[da][ma]=1,oa[da-1]&&oa[da-1][ma]||(ya+='border-top:1px solid black;'),oa[da][ma-1]||(ya+='border-left:1px solid black;'),ya+='border-right:1px solid black;',ya+='border-bottom:1px solid black;');ya+='width:'+ra[ma]+'px;padding:2px;',pa+='<td class=\'tb-text\' colspan='+fa+' rowspan='+ha+' style=\''+ya+'\'>'+xa+'</td>'}pa+='</tr>\n',ia+=pa}return ia},previewHTML:function(ea){let aa=this;r='<style type=\\\'text/css\\\'>\\n* {\\n   font-family: Tahoma;\\n   font-size: 8pt;\\n}\\n<\\/style>\\n','landscape'==aa.value.sheets[0].orientation&&(r+='<style type="text/css" media="print">\\n\\t@page { size: landscape; }\\n<\\/style>\\n');r+='<table cellpadding=0 cellspacing=0>'+ea+'</table>',w=window.open('','window1','width=800, height=600, resizable=yes, scrollbars=yes, status=yes, top=10, left=10'),w.document.open(),w.document.write(r),w.document.close(),w.print()},processObject:function(ea,aa,ia,la,ra){let na=this,oa=[],da=aa.cells,ua=ia[ea],ga=0;for(let pa in ua){let ma=[];for(let fa=0,ha;fa<da.length;fa++){ha=da[fa].text;for(let ba=0;ba<la.length;ba++){let ya=la[ba],wa=ia[ya]==void 0?'':ia[ya],xa=ya.split('.');if(xa[0]==ea&&1<xa.length)for(let Ca=1,Sa=ua[pa];Ca<xa.length;Ca++)Sa=Sa?Sa[xa[Ca]]:void 0;wa==void 0&&(wa='');ha=ha.split('[#'+la[ba]+']').join(wa)}ma.push({text:ha,style:da[fa].style})}oa.push({height:aa.height,cells:ma}),ga++,1<ga&&na.moveMergeCells(ra)}return oa},processQuery:function(ea,aa,ia,la,ra,na){let oa=this,da=[],ua=ia.cells,ga=$o.getView(aa.view),pa=JSON.parse(ga.get('query'));if(aa.filter&&aa.filter.length){let ha=aa.filter;for(let ba=0,ya;ba<ha.length;ba++){ya=ha[ba],'['==ya[0]&&'#'==ya[1]&&(ha[ba]=la[ya.substr(2,ya.length-3)]);for(let wa=1;wa<pa.select.length;wa+=2)pa.select[wa]==ya&&(ha[ba]=pa.select[wa-1])}pa.where=pa.where||[],pa.where.length&&(pa.where=[pa.where,'and']);pa.where.push(ha)}let ma=$o.execute(pa),fa=0;for(let ha=0,ba;ha<ma.length;ha++){ba=[];for(let ya=0,wa;ya<ua.length;ya++){wa=ua[ya].text;for(let xa=0;xa<ra.length;xa++){let Ca=ra[xa],Sa=la[Ca]==void 0?'':la[Ca],_a=Ca.split('.');_a[0]==ea&&1<_a.length&&(Sa=ma.get(ha,_a[1]));wa=wa.split('[#'+ra[xa]+']').join(Sa)}ba.push({text:wa,style:ua[ya].style})}da.push({height:ia.height,cells:ba}),fa++,1<fa&&oa.moveMergeCells(na)}return da},moveMergeCells:function(ea){let aa=this,ia=aa.value.sheets[0].mergeCells;for(let la=0;la<ia.length;la++)ia[la].row>=ea&&ia[la].row++},processTags:function(ea){let aa=this,ia=[],la=aa.value.sheets[0].rows,ra={};for(let na=0;na<aa.value.query.length;na++)ra[aa.value.query[na].alias]=aa.value.query[na];for(let na=0;na<la.length;na++){let oa=la[na].cells,da=[],ua='',ga='';for(let pa=0,ma;pa<oa.length;pa++){ma=oa[pa].text||'';for(let fa=1;fa<ma.length;fa++)if('#'==ma[fa]&&'['==ma[fa-1]){let ha='';for(fa++;fa<ma.length&&']'!=ma[fa];fa++)ha+=ma[fa];-1==da.indexOf(ha)&&(da.push(ha),Ext.isArray(ea[ha.split('.')[0]])&&(ua=ha.split('.')[0]),ra[ha.split('.')[0]]&&(ga=ha.split('.')[0]))}}if(ga)ia=ia.concat(aa.processQuery(ga,ra[ga],la[na],ea,da,ia.length));else if(ua)ia=ia.concat(aa.processObject(ua,la[na],ea,da,ia.length));else{let pa=[];for(let ma=0,fa;ma<oa.length;ma++){fa=oa[ma].text||'';for(let ha=0;ha<da.length;ha++){let ba=da[ha],ya=ba.split('.');for(let wa=0,xa=ea;wa<ya.length;wa++)xa=xa?xa[ya[wa]]||'':'';fa=fa.split('[#'+ba+']').join(v)}pa.push({text:fa,style:oa[ma].style})}ia.push({height:la[na].height,cells:pa})}}aa.value.sheets[0].rows=ia}}),Ext.define('$o.ReportQuery.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.reportquery','widget.$reportquery'],layout:'fit',border:!1,initComponent:function(){let ea=this;ea.store=Ext.create('Ext.data.Store',{data:ea.getData(),fields:[{name:'alias',type:'string'},{name:'view',type:'string'}]}),ea.grid=Ext.create('Ext.grid.Panel',{store:ea.store,columns:[{header:'\u041F\u0441\u0435\u0432\u0434\u043E\u043D\u0438\u043C',width:100,dataIndex:'alias'},{header:'\u0417\u0430\u043F\u0440\u043E\u0441',dataIndex:'view',flex:1}],forceFit:!0,frame:!1,deferRowRender:!1,listeners:{afterrender:function(){let aa=this.getSelectionModel();aa.on('selectionchange',function(){if(aa.hasSelection()){let ia=aa.getSelection()[0];ea.down('*[name=filter]').enable(),ea.down('*[name=filter]').setViewId(ea.data[ia.get('alias')].view),ea.down('*[name=filter]').setValue(ea.data[ia.get('alias')].filter)}})}}}),ea.items={layout:'border',border:!1,items:[{split:!0,region:'west',width:'50%',layout:'fit',tbar:[{text:'\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C',name:'create',iconCls:'gi_circle_plus',handler:ea.create,scope:ea},{text:'\u0423\u0434\u0430\u043B\u0438\u0442\u044C',name:'delete',iconCls:'gi_circle_minus',handler:ea.remove,scope:ea}],title:'\u0417\u0430\u043F\u0440\u043E\u0441\u044B',iconCls:'gi_cogwheel',border:!1,items:ea.grid},{region:'center',layout:'fit',title:'\u0424\u0438\u043B\u044C\u0442\u0440',iconCls:'gi_filter',border:!1,items:{xtype:'$layoutfilter',name:'filter',disabled:!0,reportMode:1,listeners:{change:ea.updateFilter,scope:ea}}}]},ea.addEvents('change'),ea.callParent(arguments)},getData:function(){let ea=this,aa=[];ea.data={};for(let ia=0;ia<ea.value.length;ia++)aa.push({alias:ea.value[ia].alias,view:$o.getView(ea.value[ia].view).toString()}),ea.data[ea.value[ia].alias]={alias:ea.value[ia].alias,filter:ea.value[ia].filter,view:ea.value[ia].view};return aa},create:function(){let ea=this;dialog.getView({hasQuery:1,success:function(aa){let ia=0;for(let na=0,oa;na<ea.store.getCount();na++)oa=ea.store.getAt(na).get('alias'),+oa.substr(1)>ia&&(ia=+oa.substr(1));let la='q'+(ia+1),ra={alias:la,view:$o.getView(aa.id).toString()};ea.store.add(ra),ea.data[la]={alias:la,view:$o.getView(aa.id).getFullCode()},ea.fireEvent('change',ea.getValue())}})},remove:function(){let ea=this,aa=ea.grid.getSelectionModel();if(aa.hasSelection()){let ia=aa.getSelection()[0];ea.store.remove(ia),ea.down('*[name=filter]').disable(),ea.fireEvent('change',ea.getValue())}},getValue:function(){let ea=this,aa=[];for(let ia=0,la;ia<ea.store.getCount();ia++)la=ea.store.getAt(ia).get('alias'),aa.push(ea.data[la]);return aa},updateFilter:function(ea){let aa=this,ia=aa.grid.getSelectionModel(),la=ia.getSelection()[0];aa.data[la.get('alias')].filter=ea,aa.fireEvent('change',aa.getValue())}}),Ext.define('$o.ReportCondition.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.reportcondition','widget.$reportcondition'],layout:'vbox',border:!1,defaults:{border:!1},initComponent:function(){let ea=this;ea.filter=ea.filter||[],ea.value={},ea.tbar=[{text:'\u041E\u043A',iconCls:'gi_ok',name:'save',disabled:1,handler:ea.save,scope:ea},{text:'\u041E\u0442\u043C\u0435\u043D\u0430',iconCls:'gi_remove',name:'cancel',handler:function(){ea.up('window').close()}}];let aa=[];for(let ia in ea.$view.attrs){let la=ea.$view.attrs[ia];aa.push([ia,la.toString()])}ea.items=[{xtype:'combo',fieldLabel:'\u0418/\u0418\u041B\u0418',labelWidth:200,name:'and_or',width:350,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['and','\u0418'],['or','\u0418\u041B\u0418']]}),valueField:'id',displayField:'text'},{xtype:'combo',fieldLabel:'\u0410\u0442\u0440\u0438\u0431\u0443\u0442',name:'attr',width:'100%',labelWidth:200,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:aa}),valueField:'id',displayField:'text',validator:ea.validator},{xtype:'combo',fieldLabel:'\u041E\u043F\u0435\u0440\u0430\u0442\u043E\u0440',labelWidth:200,name:'oper',width:350,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['=','\u0440\u0430\u0432\u043D\u043E (=)'],['<>','\u043D\u0435 \u0440\u0430\u0432\u043D\u043E (<>)'],['<','\u043C\u0435\u043D\u044C\u0448\u0435 (<)'],['>','\u0431\u043E\u043B\u044C\u0448\u0435 (>)'],['<=','\u043C\u0435\u043D\u044C\u0448\u0435 \u0438\u043B\u0438 \u0440\u0430\u0432\u043D\u043E (<=)'],['>=','\u0431\u043E\u043B\u044C\u0448\u0435 \u0438\u043B\u0438 \u0440\u0430\u0432\u043D\u043E (>=)'],['is null','\u043F\u0443\u0441\u0442\u043E (is null)'],['is not null','\u043D\u0435 \u043F\u0443\u0441\u0442\u043E (is not null)'],['in','\u043E\u0434\u043D\u043E \u0438\u0437 \u043F\u0435\u0440\u0435\u0447\u043D\u044F (in)']]}),valueField:'id',displayField:'text',listeners:{select:function(){let ia=this.getValue();'is null'==ia||'is not null'==ia?ea.down('*[name=\'value\']').disable():ea.down('*[name=\'value\']').enable()}},validator:ea.validator},{xtype:'textfield',fieldLabel:'\u0417\u043D\u0430\u0447\u0435\u043D\u0438\u0435',labelWidth:200,width:'100%',name:'value',validator:ea.validator}],ea.filter.length||ea.items.splice(0,1);ea.items[0].style='margin-top: 5px;',ea.addEvents('aftersave'),this.callParent(arguments)},validator:function(){let aa=this.up('panel'),ia=aa.down('*[name=\'and_or\']'),la=aa.down('*[name=\'attr\']'),ra=aa.down('*[name=\'oper\']'),na=aa.down('*[name=\'value\']');if(ia&&!ia.getValue())return aa.down('button[name=\'save\']').disable(),!0;if(la.getValue()&&ra.getValue()&&('is null'==ra.getValue()||'is not null'==ra.getValue()||na.getValue())){if(aa.down('button[name=\'save\']').enable(),'is null'==ra.getValue()||'is not null'==ra.getValue())aa.value=[la.getValue(),ra.getValue()];else{let oa=na.getValue();aa.value=[la.getValue(),ra.getValue(),oa]}ia&&(aa.value=[ia.getValue()].concat(aa.value))}else aa.down('button[name=\'save\']').disable(),aa.value=[];return!0},save:function(){let ea=this;ea.fireEvent('aftersave',ea.value)},getValue:function(){let ea=this;return ea.value}}),Ext.define('$o.ProjectDesigner.Widget',{extend:'Ext.tab.Panel',alias:['widget.$o.projectdesigner','widget.$projectdesigner'],layout:'fit',border:!1,defaults:{border:!1},bodyPadding:5,deferredRender:!1,initComponent:function(){let ea=this,aa=Ext.create('Ext.data.Store',{fields:['action','line','msg','src'],data:[]}),ia=Ext.create('Ext.grid.Panel',{name:'errors',store:aa,columns:[{text:$o.getString('Message'),dataIndex:'msg',flex:3,renderer:ea.cellRenderer},{text:$o.getString('Action'),dataIndex:'action',width:250,renderer:ea.cellRenderer},{text:$o.getString('String'),dataIndex:'line',width:80},{text:$o.getString('Source code'),dataIndex:'src',flex:2,renderer:ea.cellRenderer}],width:'100%',forceFit:!0,flex:1,selModel:Ext.create('Ext.selection.RowModel',{mode:'SINGLE',listeners:{selectionchange:function(){ea.down('*[name=showAction]').enable()}}}),tbar:[{text:$o.getString('Action',':','Source code'),iconCls:'gi_notes',name:'showAction',disabled:1,handler:function(){let la=ea.down('*[name=errors]');if(la.getSelectionModel().hasSelection()){let ra=la.getSelectionModel().getSelection()[0],na=ra.get('action'),oa=$o.getAction(na),da=oa.get('body'),ua=Ext.create('Ext.Window',{width:800,height:600,layout:'fit',frame:!1,border:!1,bodyPadding:1,modal:!1,maximizable:!0,title:$o.getString('Action',':','Source code')+': '+oa.toString(),iconCls:'gi_notes',items:{name:'body',xtype:'codemirrortextarea',listeners:{afterrender:function(){this.setValue(da)}}},tbar:[{text:$o.getString('Save'),iconCls:'gi_floppy_save',handler:function(){oa.set('body',ua.down('*[name=body]').getValue()),oa.sync(),oa.initAction(),ua.close()}},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){ua.close()}}]});ua.show()}}}]});ea.listeners={afterrender:function(){$o.execute({fn:'vo.getProjectInfo',success:function(la){if(ea.down('*[name=revision]').setValue(la.revision),ea.down('*[name=name]').setValue(la.name),la.smtp=la.smtp||{},ea.down('*[name=smtpHost]').setValue(la.smtp.host),ea.down('*[name=smtpUsername]').setValue(la.smtp.username),ea.down('*[name=smtpPassword]').setValue(la.smtp.password),ea.down('*[name=smtpSender]').setValue(la.smtp.sender),ea.down('*[name=timeMachineCardButton]').setValue($o.visualObjectum.timeMachine.cardButton),ea.down('*[name=logoLeft]').setValue($o.visualObjectum.logo.left),ea.down('*[name=logoRight]').setValue($o.visualObjectum.logo.right),ea.down('*[name=logoHeight]').setValue($o.visualObjectum.logo.height),$o.visualObjectum.initAction&&ea.down('*[name=initAction]').setValue($o.getAction($o.visualObjectum.initAction).get('id')),la.scripts&&la.scripts.client){let ra=[];for(let na=0;na<la.scripts.client.length;na++)ra.push({name:la.scripts.client[na]});ea.down('*[name=clientScripts]').getStore().loadData(ra)}}})}},ea.items=[{title:$o.getString('Commons'),iconCls:'gi_file',layout:'vbox',items:[{xtype:'textfield',fieldLabel:$o.getString('Project revision'),name:'revision',labelWidth:200,width:355,style:'margin-top: 5px',disabled:!0},{xtype:'textfield',fieldLabel:$o.getString('Project name'),labelWidth:200,name:'name',width:'100%'},{xtype:'compositefield',fieldLabel:$o.getString('Admin password'),labelWidth:200,items:[{xtype:'textfield',name:'password',inputType:'password',width:150},{xtype:'displayfield',value:$o.getString('Enter password again')+':',style:'margin-left: 5px; margin-right: 2px'},{xtype:'textfield',name:'password2',inputType:'password',width:150}]},{xtype:'fieldset',title:'SMTP',width:'100%',items:{layout:'hbox',border:0,bodyPadding:5,items:[{xtype:'textfield',name:'smtpHost',fieldLabel:$o.getString('Host')},{xtype:'textfield',name:'smtpUsername',style:'margin-left: 10px',fieldLabel:$o.getString('User')},{xtype:'textfield',name:'smtpPassword',style:'margin-left: 10px',fieldLabel:$o.getString('Password'),inputType:'password'},{xtype:'textfield',name:'smtpSender',style:'margin-left: 10px',fieldLabel:$o.getString('Sender')}]}},{xtype:'fieldset',title:'Time machine',width:'100%',items:{layout:'hbox',border:0,bodyPadding:5,items:[{xtype:'checkbox',name:'timeMachineCardButton',fieldLabel:$o.getString('Show button \'Changes\' in card'),labelWidth:250}]}},{layout:'hbox',border:0,style:'padding-top: 5px; padding-bottom: 5px',width:'100%',items:[{xtype:'button',text:$o.getString('Build project'),iconCls:'gi_settings',handler:function(){ea.down('*[name=time]').setValue($o.getString('building')+' ...'),ea.down('*[name=errNum]').setValue($o.getString('building')+' ...'),ea.down('*[name=showAction]').disable(),$o.app.name=$ptitle=ea.down('*[name=name]').getValue();let la={name:ea.down('*[name=name]').getValue(),build:ea.down('radiogroup').getValue().rgBuild};if(ea.down('*[name=password]').getValue()){if(ea.down('*[name=password]').getValue()!=ea.down('*[name=password2]').getValue())return void common.message($o.getString('Passwords not equal'));la.password=$o.util.sha1(ea.down('*[name=password]').getValue())}la.smtp={host:ea.down('*[name=smtpHost]').getValue(),username:ea.down('*[name=smtpUsername]').getValue(),password:ea.down('*[name=smtpPassword]').getValue(),sender:ea.down('*[name=smtpSender]').getValue()};la.timeMachine={cardButton:ea.down('*[name=timeMachineCardButton]').getValue()?1:0,showDates:0},la.logo={left:ea.down('*[name=logoLeft]').getValue(),right:ea.down('*[name=logoRight]').getValue(),height:ea.down('*[name=logoHeight]').getValue()},ea.down('*[name=initAction]').getValue()&&(la.initAction=$o.getAction(ea.down('*[name=initAction]').getValue()).getFullCode());$o.visualObjectum.timeMachine.cardButton=la.timeMachine.cardButton,$o.visualObjectum.timeMachine.showDates=la.timeMachine.showDates,$o.visualObjectum.timeMachine.buildTime=la.timeMachine.buildTime;let na=[],oa=ea.down('*[name=clientScripts]').getStore();for(let da=0;da<oa.getCount();da++)na.push(oa.getAt(da).get('name'));la.scripts={client:na},$o.execute({fn:'vo.build',args:la,success:function(da){(ea.showBuildResults(da),!(da.err&&da.err.length))&&(common.setConf('projectNeedBuild',{used:0}),$o.app.projectNeedBuildTooltip&&$o.app.projectNeedBuildTooltip.destroy(),ea.down('*[name=revision]').setValue(da.revision),$o.execute({fn:'vo.getActions',success:function(ua){ea.down('*[name=actions]').setValue(ua.actions)}}))}})}},{xtype:'radiogroup',columns:2,style:'margin-left: 25px',items:[{boxLabel:$o.getString('Test'),name:'rgBuild',inputValue:'test',width:90,checked:!0,hidden:!0},{boxLabel:$o.getString('Production'),name:'rgBuild',inputValue:'prod',hidden:!0}]}]},{layout:'hbox',border:0,style:'padding-top: 5px; padding-bottom: 5px',width:'100%',items:[{xtype:'textfield',labelWidth:200,disabled:1,name:'errNum',width:300,fieldLabel:$o.getString('Errors num')},{xtype:'textfield',disabled:1,name:'time',style:'margin-left: 10px',width:200,fieldLabel:$o.getString('Building duration')}]},ia]},{title:$o.getString('Additional'),iconCls:'gi_file',layout:'vbox',items:[{xtype:'grid',title:$o.getString('Client scripts'),name:'clientScripts',store:Ext.create('Ext.data.Store',{fields:['name'],data:[]}),columns:[{text:$o.getString('Script location on server'),dataIndex:'name'}],width:'100%',forceFit:!0,height:150,tbar:[{text:$o.getString('Add'),iconCls:'gi_circle_plus',handler:function(){let la=this.up('grid');dialog.getString({fieldLabel:$o.getString('Enter script location on server'),success:function(ra){la.getStore().add({name:ra})}})}},{text:$o.getString('Remove'),iconCls:'gi_circle_minus',handler:function(){let la=this.up('grid'),ra=la.getSelectionModel();if(ra.hasSelection()){let na=ra.getSelection()[0];la.getStore().remove(na)}}}]},{fieldLabel:$o.getString('Action of client initialization'),labelWidth:200,width:600,xtype:'$conffield',name:'initAction',anchor:'100%',confRef:'action',style:'margin-top: 5px',choose:{type:'custom',fn:function(){let la=this;dialog.getAction({success:function(ra){la.setValue(ra.id)}})}}},{xtype:'fieldset',title:$o.getString('Logo'),width:'100%',items:{layout:'vbox',border:0,bodyPadding:5,items:[{xtype:'textfield',name:'logoLeft',fieldLabel:$o.getString('Left image'),width:'100%'},{xtype:'textfield',name:'logoRight',fieldLabel:$o.getString('Right image'),width:'100%'},{xtype:'numberfield',name:'logoHeight',fieldLabel:$o.getString('Strip height')}]}}]},{title:$o.getString('Server actions'),iconCls:'gi_notes',layout:'fit',tbar:[{text:$o.getString('Refresh'),iconCls:'gi_refresh',handler:function(){$o.execute({fn:'vo.getActions',success:function(la){ea.down('*[name=actions]').setValue(la.actions)}})}}],items:{xtype:'codemirrortextarea',name:'actions',listeners:{afterrender:function(){let la=this;$o.execute({fn:'vo.getActions',success:function(ra){la.setValue(ra.actions)}})}}}}],this.callParent(arguments)},showBuildResults:function(ea){let aa=this;aa.down('*[name=time]').setValue((ea.time/1e3).toFixed(3)+' \u0441\u0435\u043A.'),ea.err=ea.err||[],aa.down('*[name=errNum]').setValue(ea.err.length),aa.down('*[name=errors]').getStore().loadData(ea.err)},cellRenderer:function(ea,aa){return aa.style='white-space: normal;',ea}}),Ext.define('$o.CardDesigner.Widget',{extend:'Ext.panel.Panel',alias:['widget.$o.carddesigner','widget.$carddesigner'],layout:'fit',border:0,defaults:{border:0},initComponent:function(){let ea=this;ea.counter=1,ea.data={},ea.treeStore=Ext.create('Ext.data.TreeStore',{autoSync:!0,root:{expanded:!0,children:[]}}),ea.storeAttrs=new Ext.data.ArrayStore({fields:['id','text'],data:[]}),ea.storeViewAttrs=new Ext.data.ArrayStore({fields:['id','text'],data:[]}),ea.items={layout:'border',border:!1,style:'margin: 2px',defaults:{border:!1},items:[{split:!0,region:'west',width:'50%',layout:'fit',items:{title:$o.getString('Navigator'),iconCls:'gi_search',xtype:'treepanel',name:'tree',store:ea.treeStore,selModel:Ext.create('Ext.selection.TreeModel',{mode:'SINGLE',listeners:{selectionchange:{fn:ea.selectionChange,scope:ea}}}),rootVisible:!1,viewConfig:{plugins:{ptype:'treeviewdragdrop',containerScroll:!0},listeners:{beforedrop:function(aa,ia,la){return'\u041F\u043E\u043B\u0435:'!=ia.records[0].get('text').substr(0,5)&&'\u0421\u043E\u0441\u0442\u0430\u0432\u043D\u043E\u0435:'==la.parentNode.get('text').substr(0,10)?!1:!0}}},listeners:{cellcontextmenu:function(){ea.down('treepanel').getSelectionModel().deselectAll()}}}},{region:'center',layout:'fit',items:{title:$o.getString('Options'),iconCls:'gi_file',layout:'vbox',name:'card',hidden:!0,bodyPadding:5,items:[{xtype:'combo',fieldLabel:$o.getString('Attribute'),name:'attr',width:'100%',mode:'local',queryMode:'local',editable:!1,store:ea.storeAttrs,valueField:'id',displayField:'text',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'textfield',fieldLabel:$o.getString('Name'),width:'100%',name:'name',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'numberfield',fieldLabel:$o.getString('Name width'),width:200,name:'labelWidth',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'fieldcontainer',layout:'hbox',width:'100%',items:[{xtype:'numberfield',fieldLabel:$o.getString('Width'),width:200,name:'width',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'numberfield',fieldLabel:$o.getString('Height'),width:150,labelWidth:50,style:'margin-left: 5px',name:'height',cardDesigner:ea,listeners:{change:ea.onChange}}]},{xtype:'numberfield',fieldLabel:$o.getString('Min value'),width:200,name:'minValue',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'numberfield',fieldLabel:$o.getString('Max value'),width:200,name:'maxValue',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'checkbox',fieldLabel:$o.getString('Read only'),name:'readOnly',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'checkbox',fieldLabel:$o.getString('Show time'),name:'showTime',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'checkbox',fieldLabel:$o.getString('Editor')+' HTML',name:'htmlEditor',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'fieldset',title:$o.getString('Object selection'),name:'choose',width:'100%',collapsible:1,items:[{xtype:'$conffield',fieldLabel:$o.getString('View'),labelWidth:135,name:'view',anchor:'100%',confRef:'view',choose:{type:'custom',fn:function(){let aa=this;dialog.getView({success:function(ia){aa.setValue(ia.id)}})}},cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'combo',fieldLabel:$o.getString('View attribute'),labelWidth:135,name:'viewAttr',anchor:'100%',mode:'local',queryMode:'local',editable:!1,store:ea.storeViewAttrs,valueField:'id',displayField:'text',cardDesigner:ea,listeners:{change:ea.onChange}},{fieldLabel:$o.getString('Action before selection'),labelWidth:135,xtype:'$conffield',name:'filterAction',anchor:'100%',confRef:'action',choose:{type:'custom',fn:function(){let aa=this;dialog.getAction({success:function(ia){aa.setValue(ia.id)}})}},cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'fieldcontainer',layout:'hbox',width:'100%',items:[{xtype:'numberfield',fieldLabel:$o.getString('Width'),width:190,labelWidth:90,name:'viewWidth',cardDesigner:ea,listeners:{change:ea.onChange}},{xtype:'numberfield',fieldLabel:$o.getString('Height'),width:150,labelWidth:50,style:'margin-left: 5px',name:'viewHeight',cardDesigner:ea,listeners:{change:ea.onChange}}]},{xtype:'checkbox',fieldLabel:$o.getString('Hide actions'),name:'hideActions',cardDesigner:ea,listeners:{change:ea.onChange}}]}]}}]},ea.tbar=[{text:$o.getString('Add field'),name:'addField',iconCls:'gi_circle_plus',handler:ea.addField,scope:ea},{text:$o.getString('Add composite field'),name:'addComposite',iconCls:'gi_circle_plus',handler:ea.addComposite,scope:ea},{text:$o.getString('Add group'),name:'addGroup',iconCls:'gi_circle_plus',handler:ea.addGroup,scope:ea},{text:$o.getString('Remove'),disabled:!0,name:'remove',iconCls:'gi_circle_minus',handler:ea.remove,scope:ea}],ea.bbar=[{text:$o.getString('Preview'),iconCls:'gi_search',handler:ea.preview,scope:ea}],ea.on('afterrender',function(){ea.setClassId(ea.classId),ea.setValue(ea.value)}),this.callParent(arguments)},addField:function(){let ea=this,aa=ea.down('treepanel'),ia=aa.getSelectionModel(),la;ia.hasSelection()?(la=ia.getSelection()[0],la.get('text').substr(0,5)==$o.getString('Field')+':'&&(la=la.parentNode),la.set('leaf',!1)):la=aa.getStore().getRootNode();la.expand();let ra={id:ea.counter++,text:$o.getString('Field')+':',leaf:!0};la.appendChild(ra)},addComposite:function(){let ea=this,aa=ea.down('treepanel'),ia=aa.getSelectionModel(),la;ia.hasSelection()?(la=ia.getSelection()[0],la.set('leaf',!1)):la=aa.getStore().getRootNode();la.expand();let ra={id:ea.counter++,text:$o.getString('Composite')+':',leaf:!0};la.appendChild(ra)},addGroup:function(){let ea=this,aa=ea.down('treepanel'),ia=aa.getSelectionModel(),la;ia.hasSelection()?(la=ia.getSelection()[0],la.set('leaf',!1)):la=aa.getStore().getRootNode();la.expand();let ra={id:ea.counter++,text:$o.getString('Group')+':',leaf:!0};la.appendChild(ra)},selectionChange:function(){let ea=this,aa=ea.down('treepanel'),ia=aa.getSelectionModel();if(ea.down('*[name=addField]').enable(),ea.down('*[name=addComposite]').enable(),ea.down('*[name=addGroup]').enable(),ia.hasSelection()){ea.down('*[name=remove]').enable(),ea.down('*[name=card]').show();let la=ia.getSelection()[0],ra='field';la.get('text').substr(0,10)==$o.getString('Composite')+':'&&(ra='composite'),la.get('text').substr(0,7)==$o.getString('Group')+':'&&(ra='group'),'xtype:'==la.get('text').substr(0,6)&&(ra='xtype'),'field'==ra&&(ea.down('*[name=addComposite]').disable(),ea.down('*[name=addGroup]').disable()),'composite'==ra&&(ea.down('*[name=addComposite]').disable(),ea.down('*[name=addGroup]').disable()),'field'==ra&&ea.down('*[name=attr]').show(),'composite'==ra&&(ea.down('*[name=attr]').hide(),ea.down('*[name=name]').show(),ea.down('*[name=labelWidth]').show(),ea.down('*[name=width]').show(),ea.down('*[name=height]').hide(),ea.down('*[name=showTime]').hide(),ea.down('*[name=minValue]').hide(),ea.down('*[name=maxValue]').hide(),ea.down('*[name=htmlEditor]').hide(),ea.down('*[name=readOnly]').hide(),ea.down('*[name=choose]').hide()),'group'==ra&&(ea.down('*[name=attr]').hide(),ea.down('*[name=name]').show(),ea.down('*[name=labelWidth]').hide(),ea.down('*[name=width]').show(),ea.down('*[name=height]').show(),ea.down('*[name=showTime]').hide(),ea.down('*[name=minValue]').hide(),ea.down('*[name=maxValue]').hide(),ea.down('*[name=htmlEditor]').hide(),ea.down('*[name=readOnly]').hide(),ea.down('*[name=choose]').hide()),ea.updateCard(la.get('id'),ra)}else ea.down('*[name=remove]').disable(),ea.down('*[name=card]').hide()},updateCard:function(ea,aa){let ia=this;ia.selectedId=ea,ia.data[ea]=ia.data[ea]||{};let la=ia.data[ea];return la.attr&&(!ia.tag||la.tag!=ia.tag)?void ia.down('*[name=card]').disable():(ia.down('*[name=card]').enable(),'xtype'==aa)?void ia.down('*[name=card]').disable():void(ia.down('*[name=name]').setValue(la.name),ia.down('*[name=width]').setValue(la.width),ia.down('*[name=labelWidth]').setValue(la.labelWidth),ia.down('*[name=height]').setValue(la.height),'field'==aa&&(ia.down('*[name=attr]').setValue(la.attr),ia.down('*[name=showTime]').setValue(la.showTime),ia.down('*[name=minValue]').setValue(la.minValue),ia.down('*[name=maxValue]').setValue(la.maxValue),ia.down('*[name=htmlEditor]').setValue(la.htmlEditor),ia.down('*[name=readOnly]').setValue(la.readOnly),la.attr?(ia.down('*[name=name]').show(),ia.down('*[name=labelWidth]').show(),ia.down('*[name=width]').show(),ia.down('*[name=readOnly]').show(),1e3<=ia.attrs[la.attr].get('type')?(ia.down('*[name=choose]').show(),ia.down('*[name=view]').setValue(la.view?$o.getView(la.view).get('id'):null),ia.down('*[name=viewAttr]').setValue(la.viewAttr),ia.down('*[name=filterAction]').setValue(la.filterAction?$o.getAction(la.filterAction).get('id'):null),ia.down('*[name=viewWidth]').setValue(la.viewWidth),ia.down('*[name=viewHeight]').setValue(la.viewHeight),ia.down('*[name=hideActions]').setValue(la.hideActions)):ia.down('*[name=choose]').hide(),3==ia.attrs[la.attr].get('type')?(ia.down('*[name=showTime]').show(),ia.down('*[name=width]').hide()):(ia.down('*[name=showTime]').hide(),ia.down('*[name=width]').show()),2==ia.attrs[la.attr].get('type')?(ia.down('*[name=minValue]').show(),ia.down('*[name=maxValue]').show()):(ia.down('*[name=minValue]').hide(),ia.down('*[name=maxValue]').hide()),1==ia.attrs[la.attr].get('type')?(ia.down('*[name=height]').show(),ia.down('*[name=htmlEditor]').show()):(ia.down('*[name=height]').hide(),ia.down('*[name=htmlEditor]').hide())):(ia.down('*[name=name]').hide(),ia.down('*[name=labelWidth]').hide(),ia.down('*[name=width]').hide(),ia.down('*[name=height]').hide(),ia.down('*[name=showTime]').hide(),ia.down('*[name=minValue]').hide(),ia.down('*[name=maxValue]').hide(),ia.down('*[name=htmlEditor]').hide(),ia.down('*[name=readOnly]').hide(),ia.down('*[name=choose]').hide())))},onChange:function(){let ea=this.cardDesigner,aa=this;ea.data[ea.selectedId]=ea.data[ea.selectedId]||{};let ia=ea.data[ea.selectedId];if(ia.tag=ea.tag,ia.classId=ea.classId,'name'==aa.name){ia.name=aa.getValue();let la=ea.down('treepanel').getSelectionModel().getSelection()[0],ra=la.get('text').split(':');la.set('text',ra[0]+': '+ia.name)}if('labelWidth'==aa.name&&(ia.labelWidth=aa.getValue()),'width'==aa.name&&(ia.width=aa.getValue()),'height'==aa.name&&(ia.height=aa.getValue()),'showTime'==aa.name&&(ia.showTime=aa.getValue()),'minValue'==aa.name&&(ia.minValue=aa.getValue()),'maxValue'==aa.name&&(ia.maxValue=aa.getValue()),'htmlEditor'==aa.name&&(ia.htmlEditor=aa.getValue()),'readOnly'==aa.name&&(ia.readOnly=aa.getValue()),'viewWidth'==aa.name&&(ia.viewWidth=aa.getValue()),'viewHeight'==aa.name&&(ia.viewHeight=aa.getValue()),('hideActions'==aa.name&&(ia.hideActions=aa.getValue()),'attr'==aa.name)){ia.attr=aa.getValue(),ea.updateCard(ea.selectedId,'field');let la=$o.getClass(ea.classId),ra=[];for(let na=0;na<la.attrsArray.length;na++){let oa=la.attrsArray[na],da=0;for(let ua in ea.data)ea.data[ua].attr==oa.get('code')&&ea.data[ua].tag==ea.tag&&(da=1);da||ra.push([oa.get('code'),oa.toString()])}ea.storeAttrs.loadData(ra),ea.down('*[name=name]').getValue()||ea.down('*[name=name]').setValue(ia.attr?ea.attrs[ia.attr].get('name'):null)}if('view'==aa.name){let la=ia.view;ia.view=aa.getValue()?$o.getView(aa.getValue()).getFullCode():null,la!=ia.view&&ea.down('*[name=viewAttr]').setValue(null);let ra=[];if(aa.getValue()){let na=$o.getView(aa.getValue());if(na.get('layout'))ra=ea.layoutCard.getViewCmpAttrs(na.get('layout'));else for(let oa in na.attrs)ra.push([oa,na.attrs[oa].toString()])}ea.storeViewAttrs.loadData(ra)}'viewAttr'==aa.name&&(ia.viewAttr=aa.getValue()),'filterAction'==aa.name&&(ia.filterAction=aa.getValue()?$o.getAction(aa.getValue()).getFullCode():null)},setClassId:function(ea,aa){let ia=this;ia.classId=ea,ia.tag=aa;let la=[];if(ea){let ra=$o.getClass(ea);ia.attrs=ra.attrs;for(let na=0,oa;na<ra.attrsArray.length;na++)oa=ra.attrsArray[na],la.push([oa.get('code'),oa.toString()])}ia.storeAttrs.loadData(la)},getValue:function(ea){ea=ea||{};let aa=this,ia=[],la=function(ra,na){for(let oa=0;oa<ra.childNodes.length;oa++){let da=ra.childNodes[oa],ua=aa.data[da.get('id')]||{},ga={};switch(ua.width?ga.width=ua.width:ga.anchor='100%',da.get('text').split(':')[0]){case $o.getString('Field'):if(ua.attr){let pa=aa.getClsByTag(ua.tag),ma=pa.attrs,fa=ma[ua.attr].get('type');if(ga.fieldLabel=ua.name,ga.attr=ua.attr,ea.preview)ga.objectId=$o.createObject(ua.classId,'local').get('id');else if(aa.layoutCard.value.card.object.cmpAttr){let ha=ua.tag.split('.');ga.id=ha[0],ga.attr=ha[1]+'.'+ua.attr}else ga.objectId=ua.tag;1==fa&&(ua.height&&(ga.xtype='textarea',ga.height=ua.height),ua.htmlEditor&&(ga.xtype='htmleditor',ga.height=ga.height||100)),ua.labelWidth&&(ga.labelWidth=ua.labelWidth),ga.readOnly=ua.readOnly||void 0,3==fa&&(ga.timefield=!!ua.showTime,ga.width=ga.labelWidth?ga.labelWidth+100:200,ua.showTime&&(ga.width+=100),delete ga.anchor),2==fa&&(ga.minValue=ua.minValue,ga.maxValue=ua.maxValue,ga.width=ua.width?ua.width:ga.labelWidth?ga.labelWidth+100:200,delete ga.anchor),1e3<=fa&&(ga.choose={type:'view',id:ua.view,attr:ua.viewAttr,width:ua.viewWidth||void 0,height:ua.viewHeight||void 0,hideActions:!!ua.hideActions},ua.filterAction&&(ga.listeners=ga.listeners||{},ga.listeners.beforechoose=ua.filterAction))}else ga.empty=1;;break;case $o.getString('Composite'):ga.fieldLabel=ua.name,ga.xtype='fieldcontainer',ga.layout='hbox',ua.labelWidth&&(ga.labelWidth=ua.labelWidth);;break;case $o.getString('Group'):ga.title=ua.name,ga.height=ua.height?ua.height:void 0,ga.xtype='fieldset',ga.collapsible=1;break;case'xtype':ga=ua.item;}if(da.childNodes.length&&(ga.items=[],la(da,ga.items),da.get('text').split(':')[0]==$o.getString('Composite')))for(let pa=0,ma;pa<ga.items.length;pa++)if(ma=ga.items[pa],ma.style='margin-right: 10px',ma.attr&&!ma.fieldLabel){let fa=aa.attrs[ma.attr].get('type');(2==fa||3==fa)&&(ma.width=100),3==fa&&ma.timefield&&(ma.width=200)}ga.empty||na.push(ga)}};return la(aa.treeStore.getRootNode(),ia),ia},getClsByTag:function(ea){let aa=this,ia=aa.layoutCard.value.card.object;for(let la=0;la<ia.length;la++)if(ia[la].tag==ea){let ra=$o.getClass(ia[la].cls);return ra}},setValue:function(ea){function aa(ra,na){for(let oa=0;oa<ra.length;oa++){let da=ra[oa],ua=ia.counter++,ga;if('fieldcontainer'==da.xtype)ga={id:ua,text:$o.getString('Composite')+': '+(da.fieldLabel||''),leaf:!(da.items&&da.items.length)},ia.data[ua]={name:da.fieldLabel,width:da.width,labelWidth:da.labelWidth};else if('fieldset'==da.xtype)ga={id:ua,text:$o.getString('Group')+': '+(da.title||''),leaf:!(da.items&&da.items.length)},ia.data[ua]={name:da.title,width:da.width,height:da.height};else if(!da.objectId)ga={id:ua,text:'xtype: '+(da.xtype||''),leaf:!(da.items&&da.items.length)},ia.data[ua]={name:'xtype: '+(da.xtype||''),item:da};else{let pa=ia.getClsByTag(da.objectId),ma=pa.attrs,fa=ma[da.attr]||ma[da.attr.split('.')[1]];ga={id:ua,text:$o.getString('Field')+': '+(da.fieldLabel||fa.get('name')),leaf:!0},ia.data[ua]={name:da.fieldLabel,width:da.width,height:da.height,showTime:!!da.timefield,minValue:da.minValue,maxValue:da.maxValue,htmlEditor:!('htmleditor'!=da.xtype),labelWidth:da.labelWidth,readOnly:da.readOnly,attr:fa.get('code'),tag:da.objectId,classId:pa.get('id')},da.choose&&(ia.data[ua].viewWidth=da.choose.width,ia.data[ua].viewHeight=da.choose.height,ia.data[ua].view=da.choose.id,ia.data[ua].viewAttr=da.choose.attr,ia.data[ua].filterAction=da.listeners?da.listeners.beforechoose:void 0,ia.data[ua].hideActions=da.choose.hideActions);for(let ha=0;ha<ia.storeAttrs.getCount();ha++)if(ia.storeAttrs.getAt(ha).get('id')==fa.get('code')){ia.storeAttrs.removeAt(ha);break}}da.items&&da.items.length&&(ga.children=[],aa(da.items,ga.children));na==la?na.appendChild(ga):na.push(ga)}}let ia=this;ea=ea||[];let la=ia.down('treepanel').getRootNode();for(let ra=la.childNodes.length-1;0<=ra;ra--)la.childNodes[ra].remove();aa(ea,la)},remove:function(){let ea=this,aa=ea.down('treepanel'),ia=aa.getSelectionModel(),la=ia.getSelection()[0],ra=la.parentNode;delete ea.data[la.get('id')],ea.down('*[name=attr]').setValue(null),la.remove(),ra==aa.getStore().getRootNode()||ra.childNodes.length||ra.set('leaf',!0)},preview:function(){let aa=this,ia=Ext.create('Ext.Window',{width:800,height:600,layout:'fit',bodyPadding:5,border:!1,resizable:!0,closable:!0,modal:!0,items:{xtype:'$layout',$layout:{card:{hideToolbar:1,items:aa.getValue({preview:1})}}}});ia.show()}}),Ext.define('$o.app',{singleton:!0,mixins:{observable:'Ext.util.Observable'},extReady:!1,constructor:function(ea){this.mixins.observable.constructor.call(this,ea),this.addEvents('extReady','ready','viewLayout')},message:function(ea,aa){Ext.Msg.alert($o.app.name||$o.app.code,ea,aa)},login:function(ea){let aa=this,ia=ea,la=ea.success;if($o.authorized)return void la.call(ia.scope||this,ia);if($o.util.getCookie('esiaUser')&&(ea.login=$o.util.getCookie('esiaUser'),$o.util.setCookie('esiaUser','','/'),ea.hash=$o.util.getCookie('esiaHash'),$o.util.setCookie('esiaHash','','/'),$o.util.setCookie('esiaAuth','1','/')),ea.login&&ea.hash)return Ext.getBody().mask($o.getString('Loading')+' ...'),void $o.authorize({login:ea.login,password:ea.hash,success:function(){$o.init(Ext.apply(ia,{success:function(){Ext.getBody().unmask(!0),la.call(ia.scope||this,ia)}}))}});let ra=function(){let da=Ext.getCmp('$o.app.login.field').getValue(),ua=Ext.getCmp('$o.app.password.field').getValue();if(!da||!ua)return;oa.getEl().mask($o.getString('Loading'));let ga=$o.util.sha1(ua);'password in cookie'==ua&&(ga=$o.util.getCookie('password'),ua=$o.util.getCookie('passwordPlain')),$o.authorize({login:da,password:ga,passwordPlain:ua,success:function(){Ext.getCmp('$o.app.remember').getValue()?($zu.setCookie('login',da),$zu.setCookie('password',ga),$zu.setCookie('passwordPlain',ua)):($zu.removeCookie('login'),$zu.removeCookie('password'),$zu.removeCookie('passwordPlain'));let ma=ia.success;$o.init(Ext.apply(ia,{success:function(){oa.getEl().unmask(!0),oa.close(),ma.call(ia.scope||this,ia)}}))},failure:function(pa){oa.getEl().unmask(!0),$o.app.message($o.locale.getString(pa)||$o.getString('Authentication error'),function(){Ext.getCmp('$o.app.password.field').setValue(''),Ext.getCmp('$o.app.login.field').focus()})}})},na={xtype:'button',text:$o.getString('Enter'),iconCls:'gi_ok',width:100,style:{marginTop:10},handler:ra};ea.esia&&(na={border:!1,layout:'hbox',items:[{xtype:'button',text:'\u0412\u043E\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437 \u0415\u0421\u0418\u0410',iconCls:'gi_keys',width:150,style:{marginTop:10,marginRight:5},handler:function(){let da=window.location.protocol+'//'+window.location.hostname;window.location.port&&(da+=':'+window.location.port),da+='/projects/'+ea.code+'/plugins/?fn=service.esia';let ua=Ext.create('Ext.form.Panel',{standardSubmit:!0,url:ea.esia});ua.submit({params:{ReturnUrl:da}})}},na]});let oa=Ext.create('Ext.Window',{title:aa.name||$o.getString('Authorization'),iconCls:'gi_keys',width:300,height:200,layout:'vbox',bodyPadding:5,closable:!1,monitorValid:!0,defaults:{listeners:{specialkey:function(da,ua){ua.getKey()==ua.ENTER&&ra()}}},items:[{xtype:'textfield',emptyText:$o.getString('Login'),id:'$o.app.login.field',allowBlank:!1,msgTarget:'side',width:270,style:{marginTop:10}},{xtype:'textfield',emptyText:$o.getString('Password'),id:'$o.app.password.field',inputType:'password',allowBlank:!1,msgTarget:'side',width:270,style:{marginTop:10}},{xtype:'checkbox',boxLabel:$o.getString('Remember'),id:'$o.app.remember',width:270,style:{marginTop:10}},na]});oa.show(null,function(){Ext.getCmp('$o.app.login.field').focus(),$o.util.getCookie('login')&&(Ext.getCmp('$o.app.remember').setValue(1),Ext.getCmp('$o.app.login.field').setValue($o.util.getCookie('login')),Ext.getCmp('$o.app.password.field').setValue('password in cookie'))})},initTreeStore:function(ea){let aa=Ext.ModelManager.getModel(ea.model),ia=aa.getFields(),la=ea.map,ra=function(oa){for(let da=0,ua;da<ia.length;da++)ua=ia[da],oa.r[ua.name]=oa.c.get(ua.name);if(oa.c.childs.length){oa.r.children=[];for(let da=0,ua;da<oa.c.childs.length;da++)ua={},ra({c:la[oa.c.childs[da]],r:ua}),oa.r.children.push(ua)}else oa.r.leaf=!0},na=[];for(let oa=0,da;oa<$o.store[ea.data].getCount();oa++){if(da=$o.store[ea.data].getAt(oa),da.get('parent'))continue;let ua={};ra({c:da,r:ua}),na.push(ua)}this.treeStore[ea.data]=Ext.create('Ext.data.TreeStore',{model:ea.model,autoLoad:!0,root:{text:'.',children:na},proxy:{type:'memory',reader:{type:'json'}}})},tabChangeListener:function(ea){let aa=ea.getActiveTab();if(!aa)return;aa.id&&(document.location.href='#'+aa.id);let ia=aa.title;if(aa.id)if('o'==aa.id[0]){let la=$zs.getObject(aa.id.substr(1));ia=la.get('name')}else if('v'==aa.id[0]){let la=$zs.viewsMap[aa.id.substr(1)];try{ia=la.stub.get('name')}catch(ra){ia=la.get('name')}}document.title=ia+' - '+$ptitle},createDesktop:function(ea){let aa=this,ia=ea.cleanViewport;$o.app.tp=Ext.create('Ext.tab.Panel',{region:'center',layout:'fit',listeners:{tabchange:{fn:aa.tabChangeListener,scope:aa}}}),$o.app.lb=Ext.create('Ext.Toolbar',{region:'west',dock:'left',autoScroll:!0,items:[]}),$o.app.rb=Ext.create('Ext.Toolbar',{region:'east',dock:'right',items:[]}),$o.app.tb=Ext.create('Ext.Toolbar',{region:'north',items:[]}),$o.app.bb=Ext.create('Ext.Toolbar',{region:'south',items:[]});let la=[];if('admin'==$o.currentUser){let ra=[{xtype:'label',text:'Visual Objectum',style:'font-weight: bold; color: #073255; margin-left: 5px; margin-right: 15px; text-shadow: -1px -1px 1px white, 1px -1px 1px white, -1px 1px 1px white, 1px 1px 1px white;'},{text:$o.getString('Classes'),iconCls:'gi_cogwheels',handler:function(){$o.app.show({items:{id:'conf_classes',xtype:'$o.classes',title:$o.getString('Classes'),iconCls:'gi_cogwheels',name:'classes'}})}},{text:$o.getString('Views'),iconCls:'gi_eye_open',handler:function(){$o.app.show({items:{id:'conf_views',xtype:'$o.views',title:$o.getString('Views'),iconCls:'gi_eye_open',name:'views'}})}}];$o.visualObjectum&&$o.visualObjectum.menuConstructor&&ra.push({text:$o.getString('Menu'),iconCls:'gi_list',handler:function(){$o.app.show.call($o.app,{record:$o.getView('system.vo.menu')})}});$o.visualObjectum&&$o.visualObjectum.accessConstructor&&ra.push({text:$o.getString('Access'),iconCls:'gi_keys',handler:function(){$o.app.show.call($o.app,{record:$o.getView('system.vo.access')})}});$o.visualObjectum&&$o.visualObjectum.projectConstructor&&ra.push({text:$o.getString('Project'),iconCls:'gi_briefcase',name:'project',handler:function(){$o.app.show({items:{id:'conf_project',xtype:'$projectdesigner',title:$o.getString('Project'),name:'project',iconCls:'gi_briefcase'}})}});ra.push('->'),ra.push({text:$o.getString('Exit'),iconCls:'gi_exit',handler:function(){$o.logout({success:function(){location.reload()}})}}),$o.app.cb=Ext.create('Ext.Toolbar',{region:'north',border:!1,style:'background-color: #b8d7f1; padding: 5px; margin-bottom: 3px;',items:ra}),la.push($o.app.cb)}if($o.visualObjectum&&$o.visualObjectum.menuConstructor)if($o.visualObjectum.logo.left&&$o.visualObjectum.logo.height){let ra=window,na=document,oa=na.documentElement,da=na.getElementsByTagName('body')[0],ua=ra.innerWidth||oa.clientWidth||da.clientWidth,ga=ra.innerHeight||oa.clientHeight||da.clientHeight;la=[new Ext.Panel({region:'north',border:!1,width:ua,height:$o.visualObjectum.logo.height,xtype:'panel',bodyStyle:'background-color: #ffffff; padding: 0px !important; border-bottom: 1px solid #428bca !important;',html:'<div style=\'width: 100%; height: '+$o.visualObjectum.logo.height+';\'><img src=\''+$o.visualObjectum.logo.left+'\'>'+($o.visualObjectum.logo.right?'<img src=\''+$o.visualObjectum.logo.right+'\' align=right>':'')+'</div>'})].concat(la)}else la.push(Ext.create('Ext.Toolbar',{region:'north',border:!1,style:'background-color: #fff; padding: 5px; margin-bottom: 3px;',items:[{xtype:'label',text:$ptitle,style:'font-weight: bold; font-size: 15pt; font-style: italic; color: #b8d7f1; margin-left: 5px; margin-right: 15px; text-shadow: -1px -1px 1px #073255, 1px -1px 1px #073255, -1px 1px 1px #073255, 1px 1px 1px #073255;'}]}));la=la.concat($o.app.lb,$o.app.rb,$o.app.tb,$o.app.bb),ia?($o.app.tb.hide(),$o.app.lb.hide(),$o.app.rb.hide()):la.push($o.app.tp);$o.app.vp&&$o.app.vp.destroy();$o.app.vp=Ext.create('Ext.container.Viewport',{layout:'border',border:!1,defaults:{border:!1},items:la}),Ext.window.Window.prototype.maxHeight=Ext.getBody().getViewSize().height},show:function(ea){let aa=this,ia=ea.items,la=ea.record,ra=ea.readOnly,na;if(la){let da=Ext.getClassName(la);if('$o.View.Model'==da){if(!la.get('query')&&!la.get('layout'))return;na='v'+la.get('id'),la.get('layout')&&(ia={xtype:'$o.layout',record:la,$layout:ra?common.makeReadOnlyLayout(la.get('layout')):la.get('layout')});!la.get('layout')&&la.get('query')&&(ia={xtype:'$o.layout',$layout:{olap:{id:'olap',view:la.getFullCode()}}})}}else ia.hasOwnProperty('closable')||(ia.closable=!0),na=ia.id;if(ia){let oa=$o.app.vp.down('*[region=\'center\']');if('Ext.tab.Panel'==Ext.getClassName(oa)){let da=aa.tp.down('#'+na);da||(la?da=aa.tp.add({id:na,title:$o.getString(la.get('name')),iconCls:la.get('iconCls'),closable:!0,layout:'fit',border:!1,isTab:1,items:ia}):(ia.isTab=1,da=aa.tp.add(ia))),aa.tp.doLayout(),aa.tp.setActiveTab(na)}else $o.app.vp.remove(oa),ia.region='center',$o.app.vp.add(ia)}},beforerequest:function(conn,options,eOpts){let me=this,url=options.url,olapRequest=function(){let start=1<options.params.page?(options.params.page-1)*options.params.limit:0,limit=options.params.limit,tokens=url.substr(12,url.length-12).split('&'),id=tokens[0].split('=')[1],cmpId=tokens[1].split('=')[1];options.url='?sessionId='+$sessionId,options.method='POST';let order=null;if(options.params.sort){let sort=eval('('+options.params.sort+')');order=[sort[0].property,sort[0].direction]}let filter=[],grid=Ext.getCmp(cmpId);if(grid){let ea=grid.getFilter();ea&&ea.length&&(filter=[ea])}else grid={};if(options.params.filter){let fs=eval('('+options.params.filter+')'),va=$o.viewsMap[id].attrs;for(let ea=0,aa;ea<fs.length;ea++){if(aa=fs[ea],'object'==typeof aa.value&&aa.value.isNotNull){filter.length&&filter.push('and'),filter.push(aa.field),filter.push('is not null');continue}else if('object'==typeof aa.value&&aa.value.isNull){filter.length&&filter.push('and'),filter.push(aa.field),filter.push('is null');continue}let ia;if(ia=va[aa.field].get('classAttr')?$o.classAttrsMap[va[aa.field].get('classAttr')].getDataType():'number','string'==ia){let la=0;for(let ra=1;ra<filter.length;ra++)if('like'==filter[ra]&&filter[ra-1]==aa.field&&filter[ra+1]==aa.value+'%'){la=1;break}if(la)continue}if('bool'==ia){aa.value=aa.value?1:0;let la=0;for(let ra=1;ra<filter.length;ra++)if('='==filter[ra]&&filter[ra-1]==aa.field&&filter[ra+1]==aa.value){la=1;break}if(la)continue}if(filter.length&&filter.push('and'),'bool'==ia)aa.value?filter.push([aa.field,'=',1]):filter.push([aa.field,'=',0,'or',aa.field,'is null']);else if('date'==ia&&'eq'==aa.comparison){if(_.isArray(filter[0])){let la=filter[0].indexOf(aa.field);-1<la&&(4==filter[0].length?filter.splice(0,2):0==la?filter[0].splice(0,4):filter[0].splice(la-1,4))}filter=filter.concat(aa.field,'>=',aa.value+' 00:00:00','and',aa.field,'<=',aa.value+' 23:59:59')}else{if(filter.push(aa.field),aa.comparison)'lt'==aa.comparison&&filter.push('<'),'gt'==aa.comparison&&filter.push('>'),'eq'==aa.comparison&&filter.push('='),'lte'==aa.comparison&&filter.push('<='),'gte'==aa.comparison&&filter.push('>='),'neq'==aa.comparison&&filter.push('<>');else if('string'==ia){let la=aa.value;'object'==typeof la?-1<la.value.indexOf(',')?(la.notLike?filter.push('not in'):filter.push('in'),aa.value=la.value.split(',').join('.,.').split('.')):(la.notLike?filter.push('not like'):filter.push('like'),aa.value=la.value+'%'):(filter.push('like'),aa.value+='%')}else filter.push('=');filter.push(aa.value)}}}filter&&1==filter.length&&(filter=filter[0]);options.params=$o.code+'.View.getContent('+id+', 0,'+start+', 50, '+limit+', null, [!{"filter":'+JSON.stringify(filter)+',"order":'+JSON.stringify(order)+',"total":'+JSON.stringify(grid.total||null)+',"dateAttrs":'+JSON.stringify(grid.dateAttrs||null)+',"timeOffsetMin":'+new Date().getTimezoneOffset()+'}!])',options.intercepted='getContent',options.viewId=id,options.cmpId=cmpId,options.start=start},treegridRequest=function(){let node='root'==options.params.node?null:options.params.node,tokens=url.substr(16,url.length-16).split('&'),id=tokens[0].split('=')[1],view=$o.viewsMap[id],cmpId=tokens[1].split('=')[1],treegrid=Ext.getCmp(cmpId),fieldParent=tokens[2].split('=')[1],fieldId=tokens[3].split('=')[1];options.url='?sessionId='+$sessionId,options.method='POST';let query=eval('('+view.get('query')+')'),alias,table;for(alias in query.from[0]){table=query.from[0][alias];break}let fieldParentPair={},attrParent;for(let ea=1;ea<query.select.length;ea+=2)if(query.select[ea]==fieldParent)for(let aa in fieldParentPair=$o.util.clone(query.select[ea-1]),fieldParentPair)attrParent=fieldParentPair[aa];let fieldIdPair={},attrId;for(let ea=1;ea<query.select.length;ea+=2)if(query.select[ea]==fieldId)for(let aa in fieldIdPair=$o.util.clone(query.select[ea-1]),fieldIdPair)attrId=fieldIdPair[aa];let filter=[fieldParentPair,'is null'];node&&(filter=[fieldParentPair,'=',node]);let where=query.where||[];where.length&&where.push('and'),where=where.concat(filter),query.select=query.select.concat([{___childs:attrId},'___childId',fieldParentPair,'___parentId']);let field2={};if(field2[alias]=attrId,query.from=query.from.concat(['left-join',{___childs:table},'on',[{___childs:attrParent},'=',field2]]),treegrid.filter&&treegrid.filter.childsFn){let ea=treegrid.filter.childsFn();ea&&ea.length&&(query.from[query.from.length-1]=query.from[query.from.length-1].concat('and',ea))}let convertFilter=function(ea,aa){let ia={};for(let ra=0;ra<ea.select.length;ra+=2)ia[ea.select[ra+1]]=ea.select[ra];let la=[];for(let ra=0;ra<aa.length;ra++)Ext.isArray(aa[ra])?la.push(convertFilter(ea,aa[ra])):ia[aa[ra]]?la.push($o.util.clone(ia[aa[ra]])):la.push(aa[ra]);return la};if(treegrid.filter&&(!node||node&&treegrid.filter.all)){let ea=treegrid.getFilter(),aa=convertFilter(query,ea);aa&&aa.length&&(where=where.concat('and',aa))}if(!node&&treegrid.$opened.length){let ea=[fieldParentPair,'in',treegrid.$opened.join('.,.').split('.')];if(treegrid.filter&&treegrid.filter.all){let aa=treegrid.getFilter(),ia=convertFilter(query,aa);ia&&ia.length&&(ea=ea.concat('and',ia))}where.push('or'),where.push(ea)}query.where=where,options.params=$o.code+'.Storage.execute([!'+JSON.stringify(query)+'!])',options.intercepted='treegrid',options.viewId=id,options.query=query,options.fieldId=fieldId,options.node=node,options.cmpId=cmpId};'view?read=1'==url.substr(0,11)&&olapRequest();'treegrid?read=1'==url.substr(0,15)&&treegridRequest()},requestcomplete:function(conn,response,options,eOpts){let r;try{r=eval('('+response.responseText+')')}catch(ea){}if(r&&r.header&&r.header.error){let ea=r.header.error,aa=Ext.create('Ext.window.Window',{title:$ptitle,resizable:!1,closable:!0,width:600,height:400,layout:'fit',modal:!0,items:[{xtype:'panel',border:!1,style:'padding: 5',html:'<font color=red>'+$o.locale.translate(ea)+'</font>'}],buttons:[{text:$o.getString('More'),iconCls:'gi_circle_question_mark',handler:function(){aa.removeAll(),aa.add({xtype:'panel',border:!1,style:'padding: 5',html:'<font color=red>'+$o.locale.translate(ea)+'</font><br>'+JSON.stringify(options)})}},{text:'Ok',name:'ok',iconCls:'gi_ok',handler:function(){aa.close()}}]});throw aa.show(null,function(){aa.down('*[name=\'ok\']').focus()}),r.header.error+' options: '+JSON.stringify(options)}let olapResponse=function(){let model=Ext.ModelManager.getModel('$o.View.'+options.viewId+'.Model'),mFields=model.getFields(),rt=eval('('+response.responseText+')'),vFields=[],fieldsMap={},grid=Ext.getCmp(options.cmpId);for(let ea in rt.data.column){let aa=rt.data.column[ea][0].attr;vFields.push(aa);for(let ia=0;ia<mFields.length;ia++)if(mFields[ia].name==aa){fieldsMap[ea]=mFields[ia].name;break}delete grid.totalValues[aa],rt.data.column[ea][0].total&&(grid.totalValues[aa]=rt.data.column[ea][0].total)}let data=[];for(let ea=0;ea<rt.data.tree.currentLength;ea++){let aa=rt.data.tree[options.start+ea].data,ia={};for(let la=0;la<vFields.length;la++)ia[fieldsMap[la]]=aa[la].text;data.push(ia)}grid.countOverflow=rt.data.tree.overflow;let r={success:!0,total:rt.data.tree.length,data:data};response.responseText=JSON.stringify(r)},treegridResponse=function(){let node=options.node||null,model=Ext.ModelManager.getModel('$o.View.'+options.viewId+'.Model'),view=$o.viewsMap[options.viewId],treegrid=Ext.getCmp(options.cmpId),mFields=view.orderedFields,rt=eval('('+response.responseText+')'),fieldsMap={},query=options.query;for(let ea=0;ea<query.select.length;ea+=2){let aa;for(let ia in query.select[ea]){aa=query.select[ea+1];break}for(let ia=0;ia<mFields.length;ia++)if(mFields[ia].name==aa){fieldsMap[ea/2]=mFields[ia].name;break}}let levels={},hasId=[];for(let ea=0;ea<rt.data.length;ea++){let aa=rt.data[ea],ia={},la;for(la=0;la<mFields.length;la++)ia[fieldsMap[la]]=aa[la];let ra=aa[la],na=aa[la+1];-1==hasId.indexOf(ia[options.fieldId])&&(ra||(ia.leaf=!0),treegrid&&treegrid.showChecks&&(ia.checked=!1),levels[na]=levels[na]||[],levels[na].push(ia),hasId.push(ia[options.fieldId]))}if(!node&&levels[null]&&levels[null].length){let ea=function(aa){let ia=levels[aa[options.fieldId]];if(ia){let la=[];for(let ra=0;ra<ia.length;ra++)la.push(ia[ra]),ea(ia[ra]);aa.children=la,aa.expanded=!0}};for(let aa=0;aa<levels[null].length;aa++)ea(levels[null][aa])}let data=levels[node],r={text:'.',children:data};response.responseText=JSON.stringify(r)};'getContent'==options.intercepted&&olapResponse();'treegrid'==options.intercepted&&treegridResponse()},requestexception:function(ea,aa,ia){if($o.idleTimer>$o.maxIdleSec)return;let ra='<html><head><title>Unauthenticated</title></head><body><h1>401 Unauthenticated</h1></body></html>'==aa.responseText?$o.getString('Session not authorized. Please, reload browser page'):aa.responseText;ra||(ra=$o.getString('Could not connect to server')+'<br>status: '+aa.status+' '+aa.statusText);common.message('<font color=red>'+ra+'</font><br>url: '+ia.url+'<br>params: '+ia.params)},start:function(options){let me=this,meOptions=options;me.code=options.code,me.name=options.name,me.version=options.version,me.locale=options.locale;let success=options.success,scope=options.scope;$ptitle=options.name,$pversion=options.version;let useHash=options.useHash,go=function(){'en'!=meOptions.locale&&$o.locale.load('/client/extjs4/locale/'+meOptions.locale+'.json');$o.executeQueueFunctions(),Ext.Ajax.on('beforerequest',$o.app.beforerequest,$o.app),Ext.Ajax.on('requestcomplete',$o.app.requestcomplete,$o.app),Ext.Ajax.on('requestexception',$o.app.requestexception,$o.app),me.login(Ext.apply(meOptions,{scope:me,success:function(options){if(me.treeStore={},me.initTreeStore({model:'$o.Class.Model',data:'classes',map:$o.classesMap}),me.initTreeStore({model:'$o.View.Model',data:'views',map:$o.viewsMap}),me.createDesktop(options),$o.initAdapter(),$o.visualObjectum){if('admin'==$o.currentUser){let ea=common.getConf('projectNeedBuild');ea.used&&$o.app.vp.down('*[name=project]')&&(me.projectNeedBuildTooltip=Ext.create('Ext.tip.ToolTip',{title:$o.getString('Need assembly'),target:$o.app.vp.down('*[name=project]').id,anchor:'top',html:$o.getString('To update actions'),width:200,autoHide:!0,autoShow:!0,closable:!0}))}let href=document.location.href;if(-1<href.indexOf('#')&&!useHash){let ea=href.split('#');document.location.href=ea[0]+'#'}if($o.visualObjectum.menuConstructor&&(system.init(),system.vo.buildMenu(),$o.visualObjectum.initAction)){let fn_=eval('('+$o.visualObjectum.initAction+')');fn_()}}$o.app.fireEvent('ready'),success&&success.call(scope||me,options)}}))};$o.app.extReady?go.call(me):$o.app.on('extReady',go,me)},loginDialog:function(ea){for(let ia in $o.app.vp.destroy(),$o.viewsMap){let la=Ext.getCmp('v'+ia);la&&la.destroy()}let aa=this;ea=ea||{},$o.app.start({code:aa.code||ea.code,name:aa.name||ea.name,version:aa.version||ea.version,locale:aa.locale||ea.locale,success:ea.success})},sendMail:function(ea){(ea=ea||{},ea.to&&ea.subject&&ea.message)&&Ext.Ajax.request({url:'sendmail?sessionId='+$sessionId,method:'post',params:{to:ea.to,from:ea.from,subject:ea.subject,message:ea.message,attachments:JSON.stringify(ea.attachments)}})},loadScript:function(ea,aa){let ia=document.createElement('script'),la=document.getElementsByTagName('head')[0];ia.readyState&&!ia.onload?ia.onreadystatechange=function(){('loaded'==ia.readyState||'complete'==ia.readyState)&&(ia.onreadystatechange=null,aa())}:ia.onload=aa;ia.src=ea,la.appendChild(ia)}}),Ext.onReady(function(){Ext.QuickTips.init(),$o.app.extReady=!0,Ext.Ajax.disableCaching=!1,Ext.Ajax.timeout=1.2e5,$o.app.fireEvent('extReady')}),Ext.define('$o.app.view',{singleton:!0,getItems:function(ea){let aa=this,ia={id:'e'+ea.get('id'),xtype:'tabpanel',title:ea.get('name')||ea.get('code'),iconCls:'gi_eye_open',layout:'fit',defaults:{bodyPadding:5},items:[{title:$o.getString('Commons'),layout:'form',tbar:[{text:$o.getString('Save'),iconCls:'gi_floppy_save',handler:aa.saveCommon}],items:[{xtype:'textfield',fieldLabel:'ID',value:ea.get('id'),readOnly:!0},{xtype:'textfield',fieldLabel:$o.getString('Name'),value:ea.get('name')},{xtype:'textfield',fieldLabel:$o.getString('Code'),value:ea.get('code')},{xtype:'textfield',fieldLabel:$o.getString('Parent'),value:ea.get('parent')?$o.getView(ea.get('parent')).toString():''},{xtype:'textfield',fieldLabel:$o.getString('Icon'),value:ea.get('iconCls')},{xtype:'textarea',fieldLabel:$o.getString('Description'),value:ea.get('description')}]}]};return ia},saveCommon:function(){let ea=this;console.log(ea)}}),$zs=$o,$s=$o,$zp={application:$o.app},Ext.Component.AUTO_ID=1e6,objectum={ui:{}},$o.initAdapter=function(){$zp.application.toolbar=$o.app.tb,$zp.application.mainPanel=$o.app.tp,$zs.views=$o.viewsTree,$zs.views.get=function(ea){let aa=$o.getView({code:ea});return aa},objectum.ui.layout={},objectum.ui.layout.ViewLayout=$o.Layout.Widget,$zs.classes=$o.classesTree,$zs.viewAttrs=$o.viewAttrsMap,$zp.currentUser=$o.currentUser,$zp.application.onClickMenuItem=function(ea){let aa=$o.viewsMap[ea.record.stub.get('id')];$o.app.show({record:aa})},$VERSION_MAJOR=$o.serverVersion,$o.app.on('ready',function(){$zp.onLogin&&$zp.onLogin()}),$zs.id=$o.code,objectum.ui.ObjectField=$o.ObjectField.Widget,$zr=$o.locale},Ext.override(Ext.Component,{initComponent:function(){let me=this;if(me.code&&(me.iconCls=me.iconCls?me.iconCls:me.code,me.text=me.text?$o.locale.getString(me.text):$o.locale.getString(me.code)),'string'==typeof me.handler&&(me.handler=eval(me.handler)),me.listeners)for(let event in me.listeners){let ef=me.listeners[event];if('string'==typeof ef)try{me.listeners[event]=eval(ef)}catch(ea){me.listeners[event]=function(){console.log('unknown function: '+ef)}}else if(ef&&ef.fn&&'string'==typeof ef.fn)try{me.listeners[event].fn=eval(ef.fn)}catch(ea){me.listeners[event].fn=function(){console.log('unknown function: '+ef.fn)}}}me.callOverridden()}}),Ext.override(Ext.Panel,{initComponent:function(){this.code&&(this.iconCls=this.iconCls?this.iconCls:this.code,this.title=this.title?$o.locale.getString(this.title):$o.locale.getString(this.code));this.callOverridden()}}),Ext.override(Ext.form.field.Date,{initComponent:function(){this.format='d.m.Y',this.callOverridden()}}),Ext.override(Ext.form.field.Time,{initComponent:function(){this.format='H:i:s',this.callOverridden()}}),Ext.override(Ext.form.field.Checkbox,{initComponent:function(){this.addEvents('check'),this.on('change',function(ea,aa,ia){this.fireEvent('check',ea,aa,ia)},this),this.callOverridden()}}),Ext.override(Ext.toolbar.Toolbar,{initComponent:function(){this.hasOwnProperty('border')||(this.border=!1);this.callOverridden()}}),Ext.override(Ext.form.field.Base,{initComponent:function(){this.readOnly&&!this.objectField&&'Ext.form.field.File'!=Ext.getClassName(this)&&'displayfield'!=this.xtype&&this.addCls('readonly-field');this.hasOwnProperty('allowBlank')&&!this.allowBlank&&this.fieldLabel&&(this.fieldLabel+='<span style=\'color: red !important\'>*</span>');this.callOverridden()},setReadOnly:function(){this.objectField||'Ext.form.field.File'==Ext.getClassName(this)||'displayfield'==this.xtype||(this.readOnly?this.addCls('readonly-field'):this.removeCls('readonly-field'));this.callOverridden()}}),Ext.define('Ext.fix.util.AbstractMixedCollection',{override:'Ext.util.AbstractMixedCollection',itemAt:function(ea){return this.getAt(ea)}}),Date.prototype.toStringOriginal=Date.prototype.toString,Date.prototype.toString=function(){let aa=this.getDate(),ia=this.getMonth()+1,la=this.getFullYear(),ra=this.getHours(),na=this.getMinutes(),oa=this.getSeconds();10>aa&&(aa='0'+aa),10>ia&&(ia='0'+ia);let da=aa+'.'+ia+'.'+la;return(ra||na||oa)&&(10>ra&&(ra='0'+ra),10>na&&(na='0'+na),10>oa&&(oa='0'+oa),da+=' '+ra+':'+na+':'+oa),da},Date.prototype.toUTCString=function(){let ea=this,aa=function(ia){return 10>ia?'0'+ia:ia};return 0==ea.getHours()&&0==ea.getMinutes()&&0==ea.getSeconds()?'"'+aa(ea.getDate())+'.'+aa(ea.getMonth()+1)+'.'+aa(ea.getFullYear())+'"':'"'+aa(ea.getUTCDate())+'.'+aa(ea.getUTCMonth()+1)+'.'+aa(ea.getUTCFullYear())+' '+aa(ea.getUTCHours())+':'+aa(ea.getUTCMinutes())+':'+aa(ea.getUTCSeconds())+'"'},$zu.getThemeBGColor=function(){return window.$themeBGColor||'#ffffff'},Ext.define('$o.locale',{singleton:!0,strings:{},load:function(ea){let aa=Ext.Ajax.request({url:ea,async:!1});try{_.each(JSON.parse(aa.responseText),function(ia,la){$o.locale.strings[la.toLowerCase()]=ia})}catch(ia){let la=Ext.Ajax.request({url:ea,async:!1}).responseXML,ra=Ext.DomQuery.select('string',la.documentElement);for(let na=0;na<ra.length;na++){let oa=ra[na].attributes[0].value,da=ra[na].textContent||ra[na].text;$o.locale.strings[oa]=da}}},getString:function(){let ea=_.map(_.toArray(arguments),function(aa){if(!aa)return aa;let ia=_.has($o.locale.strings,aa.toLowerCase())?$o.locale.strings[aa.toLowerCase()]:aa;return aa&&ia&&(ia=aa[0].toUpperCase()==aa[0]||-1<['create','remove','delete','open','choose','cancel'].indexOf(aa)?ia[0].toUpperCase()+ia.substr(1):ia[0].toLowerCase()+ia.substr(1)),ia});return ea.join(' ')},translate:function(ea){if(-1<ea.indexOf('connection limit exceeded')&&(ea='\u0418\u0437\u0432\u0438\u043D\u0438\u0442\u0435. \u0421\u0435\u0440\u0432\u0435\u0440 \u0432 \u0434\u0430\u043D\u043D\u044B\u0439 \u043C\u043E\u043C\u0435\u043D\u0442 \u043F\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043D. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0440\u043E\u0441 \u043F\u043E\u0437\u0434\u043D\u0435\u0435.'),-1<ea.indexOf('value exists')){let aa=ea.split(':');ea='\u0417\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \''+aa[1].trim()+'\' \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0441\u044F. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0434\u0440\u0443\u0433\u043E\u0435.'}return ea}}),$zu.dialog={},$zu.dialog.getNameAndCode=function(ea){let aa=ea.title,ia=ea.success,la=ea.scope||this,ra=new Ext.Button({code:'Ok',formBind:!0,scope:this,handler:function(){ia.call(la,oa.getValue(),da.getValue()),ga.close()}}),na=new Ext.Button({code:'Cancel',scope:this,handler:function(){ga.close()}}),oa=new Ext.form.TextField({selectOnFocus:!0,fieldLabel:$zr.getString('Name'),allowBlank:!1,msgTarget:'side',anchor:'95%',listeners:{render:function(){oa.focus(!1,200)},specialkey:function(pa,ma){ma.getKey()!=ma.ENTER||ra.disabled||(ia.call(la,oa.getValue(),da.getValue()),ga.close())},scope:this}}),da=new Ext.form.TextField({selectOnFocus:!0,fieldLabel:$zr.getString('Code'),allowBlank:!1,msgTarget:'side',anchor:'95%',maskRe:/[A-Za-z0-9\_]/,listeners:{specialkey:function(pa,ma){ma.getKey()!=ma.ENTER||ra.disabled||(ia.call(la,oa.getValue(),da.getValue()),ga.close())},scope:this}}),ua=new Ext.FormPanel({frame:!1,border:!1,defaultType:'textfield',monitorValid:!0,buttonAlign:'right',autoScroll:!0,bodyPadding:5,layout:'form',items:[oa,da],buttons:[ra,na]}),ga=new Ext.Window({width:400,height:150,layout:'fit',modal:!0,title:aa,items:[ua]});ga.show(null,function(){oa.focus(!1,200)})},$zu.dialog.getNameAndCodeAndType=function(ea){let aa=ea.title,ia=ea.success,la=ea.scope||this,ra=new Ext.Button({code:'Ok',formBind:!0,scope:this,handler:function(){ia.call(la,oa.getValue(),da.getValue(),ua.getValue()),pa.close()}}),na=new Ext.Button({code:'Cancel',scope:this,handler:function(){pa.close()}}),oa=new Ext.form.TextField({selectOnFocus:!0,fieldLabel:$zr.getString('Name'),allowBlank:!1,msgTarget:'side',anchor:'95%',listeners:{render:function(){oa.focus(!1,200)},specialkey:function(ma,fa){fa.getKey()!=fa.ENTER||ra.disabled||(ia.call(la,oa.getValue(),da.getValue(),ua.getValue()),pa.close())},scope:this}}),da=new Ext.form.TextField({selectOnFocus:!0,fieldLabel:$zr.getString('Code'),allowBlank:!1,msgTarget:'side',anchor:'95%',maskRe:/[A-Za-z0-9\_]/,listeners:{specialkey:function(ma,fa){fa.getKey()!=fa.ENTER||ra.disabled||(ia.call(la,oa.getValue(),da.getValue(),ua.getValue()),pa.close())},scope:this}}),ua=new Ext.create('$o.ConfField.Widget',{conf:'classAttr',confRef:'class',choose:{type:'view',id:'system.classes',attr:'olap.id',width:500,height:400},fieldLabel:$o.getString('Type'),value:1,allowBlank:!1,msgTarget:'side',anchor:'95%',listeners:{change:function(ma){if(1e3<=ma){let fa=$o.getClass(ma);oa.setValue(fa.get('name')),da.setValue(fa.get('code'))}}}}),ga=new Ext.FormPanel({frame:!1,border:!1,defaultType:'textfield',monitorValid:!0,buttonAlign:'right',autoScroll:!0,bodyPadding:5,layout:'form',items:[ua,oa,da],buttons:[ra,na]}),pa=new Ext.Window({width:400,height:200,layout:'fit',modal:!0,title:aa,items:[ga]});pa.show(null,function(){oa.focus(!1,200)})},_.findWhere=_.findLast,_.where=_.filter,Ext.namespace('common','common.chart','common.window','common.card','common.tpl','common.report','obj','dialog','$report','$dbf','$csv'),common.message=function(ea,aa){Ext.Msg.alert($ptitle,ea,aa)},common.confirm=function(ea){let aa=ea.scope?ea.scope:this;Ext.Msg.show({title:$ptitle,msg:ea.message,buttons:Ext.Msg.YESNO,fn:ea.fn,animEl:'elId',icon:Ext.MessageBox.QUESTION,scope:aa})},common.recordSelected=function(ea){ea=ea||{};let ia=ea.attr||'id',aa;aa=ea.olap?this.relatives[ea.olap]:this;let la=!1,ra;return ra=aa.getSelectionModel?aa.getSelectionModel().hasSelection():aa.getCurrentValue(ia),ra&&(la=!0),la},obj.create=function(ea){let aa=$zs.createObject(ea.classCode);aa.commit();let ia=aa.getId();if(ea.attrs){for(let la in ea.attrs)ea.attrs.hasOwnProperty(la)&&aa.set(la,ea.attrs[la]);aa.commit()}return ea.refresh&&this.refresh({callback:function(la,ra,na){na&&this.selectRow({filter:['&id','=',ia]})},scope:this}),ia},obj.remove=function(ea){if(null==ea.id)return common.message($zr.getString('object must be selected')),!1;let aa=!1,ia=$zs.getObject(ea.id);if(ia){if(ea.objects){let la=ea.objects;for(let ra=0;ra<la.length;ra++)if(la[ra].classCode){let na=common.execSQL({select:[{a:'id'},'id'],from:[{a:la[ra].classCode}],where:[{a:la[ra].attr},'=',ea.id]});for(let oa=0,da;oa<na.length;oa++)da=$zs.getObject(na.get(oa,'id')),da&&(da.remove(),da.commit())}else if(ia.get(la[ra])){let na=$zs.getObject(ia.get(la[ra]));na&&(na.remove(),na.commit())}}else if(!ea.force){ea.object=ia;let la=obj.getDependentObjects(ea);if(la.length){let ra='<table id="objDetails" style="font-family:Tahoma !important; font-size:8pt !important;"><tr><td><b>\u0422\u0438\u043F</b></td><td style="padding-left: 5px;"><b>\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435</b></td></tr>',na=0;for(let oa=0,da;oa<la.length;oa++){if(da=$zs.getObject(la[oa]),!da)continue;na++;let ua;try{ua=da.get('name')||'id: '+da.get('id')}catch(pa){ua='id: '+da.get('id')}let ga=$zs.classesMap[da.get('classId')].stub.get('name');if('section_'==ga.substr(0,8)){if(ga='\u0414\u0430\u043D\u043D\u044B\u0435',ua='',da.get('subject')){let pa=$zs.getObject(da.get('subject'));ua+=pa.get('name')}if(da.get('repDate')){ua&&(ua+=', ');let pa=$zs.getObject(da.get('repDate'));ua+=pa.get('name')}}ra+='<tr><td>'+ga+'</td>',ra+='<td style="padding-left: 5px;">'+ua+'</td></tr>'}if(ra+='</table>',na)return common.message('\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0437\u0430\u0432\u0438\u0441\u0438\u043C\u044B\u0445 \u043E\u0431\u044A\u0435\u043A\u0442\u043E\u0432: '+la.length+' (id: '+JSON.stringify(la)+')<br><a href="#" id="detailsLink">\u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438</a>'),Ext.get('detailsLink').on('click',function(){let oa=window.open('','window1','width=600, height=400, resizable=yes, scrollbars=yes, status=yes, top=10, left=10');oa.document.open(),oa.document.write(ra)},this),!1}}ia=$zs.getObject(ea.id),ia.remove(),ia.commit(),aa=!0,ea.refresh&&(this.getSelectionModel().deselectAll(),this.refresh())}return aa},obj.getValue=function(ea,aa){let ia=null;if(aa&&'$'==aa[0]){let la=aa.split('.'),ra=la[0].substr(1,la[0].length-1);ea[ra]&&(ea=$o.getObject(ea[ra]),la.splice(0,1),aa=la.join('.'))}if(ea){let la=aa.split('.');for(let ra=0;ra<la.length;ra++){if('$date'==la[ra])return ia?ia.toString('d.m.Y'):ia;if(ra){if(!ia)break;ea=$o.getObject(ia)}if(!ea)break;ia=ea.get?ea.get(la[ra]):ea[la[ra]]}}return ia},common.getValue=obj.getValue,common.currentDate=function(){let ea=new Date,aa=ea.getDate(),ia=ea.getMonth()+1,la=ea.getFullYear(),ra='';return 10>aa&&(ra+='0'),ra+=aa+'.',10>ia&&(ra+='0'),ra+=ia+'.',ra+=la+'',ra},common.getDate=function(ea){if(!ea)return'';let aa=ea.getDate(),ia=ea.getMonth()+1,la=ea.getFullYear(),ra='';return 10>aa&&(ra+='0'),ra+=aa+'.',10>ia&&(ra+='0'),ra+=ia+'.',ra+=la+'',ra},common.getDateFromDDMMYYYY=function(ea){let aa=null;return ea&&10==ea.length&&'.'==ea[2]&&'.'==ea[5]&&(aa=new Date(ea.substr(6,4),ea.substr(3,2)-1,ea.substr(0,2))),aa},common.currentTime=function(){let ea=new Date,aa=ea.getHours(),ia=ea.getMinutes(),la=ea.getSeconds(),ra='';return 10>aa&&(ra+='0'),ra+=aa+':',10>ia&&(ra+='0'),ra+=ia+':',10>la&&(ra+='0'),ra+=la+'',ra},common.currentTimestamp=function(){return common.currentDate()+' '+common.currentTime()},common.getDate=function(ea){if(!ea)return'';let aa=ea.getDate(),ia=ea.getMonth()+1,la=ea.getFullYear(),ra='';return 10>aa&&(ra+='0'),ra+=aa+'.',10>ia&&(ra+='0'),ra+=ia+'.',ra+=la+'',ra},common.getDateISO=function(ea){if(!ea)return ea;let aa=ea.getDate(),ia=ea.getMonth()+1,la=ea.getFullYear(),ra=la+'-';return 10>ia&&(ra+='0'),ra+=ia+'-',10>aa&&(ra+='0'),ra+=aa+'',ra},common.getTime=function(ea){let aa=ea.getHours(),ia=ea.getMinutes(),la=ea.getSeconds(),ra='';return 10>aa&&(ra+='0'),ra+=aa+':',10>ia&&(ra+='0'),ra+=ia+':',10>la&&(ra+='0'),ra+=la+'',ra},common.getTimestamp=function(ea){return common.getDate(ea)+' '+common.getTime(ea)},common.getUTCDate=function(ea){let aa=ea.getUTCDate(),ia=ea.getUTCMonth()+1,la=ea.getUTCFullYear(),ra='';return 10>aa&&(ra+='0'),ra+=aa+'.',10>ia&&(ra+='0'),ra+=ia+'.',ra+=la+'',ra},common.getUTCTime=function(ea){let aa=ea.getUTCHours(),ia=ea.getUTCMinutes(),la=ea.getUTCSeconds(),ra='';return 10>aa&&(ra+='0'),ra+=aa+':',10>ia&&(ra+='0'),ra+=ia+':',10>la&&(ra+='0'),ra+=la+'',ra},common.getUTCTimestamp=function(ea){return common.getUTCDate(ea)+' '+common.getUTCTime(ea)},common.getJulianDay=function(ea){if(''==ea)return 0;let aa=ea.getDate(),ia=ea.getMonth()+1,la=ea.getFullYear();return jd=_Mathfloor(1461*(la+4800+(ia-14)/12))/4+_Mathfloor(_Mathfloor(367*(ia-2-12*((ia-14)/12)))/12)-3*_Mathfloor(_Mathfloor(la+4900+(ia-14)/12)/100)/4+aa-32075,_Mathfloor(jd)},common.getDateByJulianDay=function(ea){let aa,ia,la,ra,na,oa,da;return aa=ea+68569,ia=_Mathfloor(4*aa/146097),aa=_Mathfloor(aa-(146097*ia+3)/4),la=_Mathfloor(4e3*(aa+1)/1461001),aa=aa-_Mathfloor(1461*la/4)+31,ra=_Mathfloor(80*aa/2447),na=aa-_Mathfloor(2447*ra/80),aa=_Mathfloor(ra/11),oa=ra+2-12*aa,da=100*(ia-49)+la+aa,new Date(da,oa-1,na)},common.execSQL=function(ea){let aa,ia;ia=$zs?$zs.execute({query:ea,async:!1}):zerp.Storage.STORAGES[0].execute('Storage.execute([!'+BiJson.serialize(ea)+'!])');try{ia.length}catch(la){ia={},ia.length=0}for(ia.fields={},aa=0;aa<ea.select.length/2;aa++)ia.fields[ea.select[2*aa+1]]=aa,ia.fields[aa]=aa;return ia.get=function(la,ra){let na=this.fields[ra];if(null==na)throw'result.get: col unknown (row:'+la+',col:'+ra+')';let oa=this[la][na];return void 0==oa&&(oa=null),oa},ia},obj.getDependentObjects=function(ea){let aa=common.execSQL({select:[{a:'___fid'},'id'],from:[{a:'system.object'},'left-join',{b:'system.object_attr'},'on',[{a:'___fid'},'=',{b:'___fobject_id'}],'left-join',{c:'system.class_attr'},'on',[{b:'___fclass_attr_id'},'=',{c:'___fid'}]],where:[{a:'___fend_id'},'=',system.revision.maxRevision,'and',{b:'___fend_id'},'=',system.revision.maxRevision,'and',{c:'___fend_id'},'=',system.revision.maxRevision,'and',{c:'___ftype_id'},'>=',1e3,'and',{b:'___fnumber'},'=',ea.id]}),ia=[];for(let la=0;la<aa.length;la++)-1==ia.indexOf(aa.get(la,'id'))&&ia.push(aa.get(la,'id'));return ia},common.window.list=[],common.window.titleMaxLength=12,common.window.cardFn=null,common.window.callCardFn=function(ea){return common.window.cardFn(ea)},common.window.options=null,common.card=function(){return{}},common.window.onViewLayout=function(ea){let aa=ea.record,ia=ea.layout;if($zs.views.ser.card.stub.get('id')==aa.stub.get('id')&&common.window.options){let la=common.window.options.cardFn,ra=la(common.window.options);Ext.apply(ia,ra),common.window.options=null}},common.window.show=function(ea){ea=ea||{};let aa=ea.id;ea.olap&&ea.attr&&(aa=this.relatives[ea.olap].getCurrentValue(ea.attr)),ea.id=aa;let ia='Window-'+ ++Ext.Component.AUTO_ID,ra=$zs.views.ser.card,la;if(4==common.extMajorVersion()?la=Ext.create('$o.Layout.Widget',{record:ra,$layout:ea.cardFn(ea)}):(ra.stub.set('layout','common.card ()'),common.window.options=ea,la=new objectum.ui.layout.ViewLayout(Ext.apply({border:!1,record:ra,bodyStyle:'background-color: '+$zu.getThemeBGColor()+';'},ea.viewOptions))),la.on('destroy',function(){let na=common.window.list.indexOf(this);if(-1<na&&common.window.list.splice(na,1),ea.refreshOlap)try{ea.refreshOlap.refresh({callback:function(oa,da,ua){ua&&ea.refreshOlap.selectRow({filter:['&id','=',aa]})}})}catch(oa){}},this),ea.refresh&&(ea.refreshOlap=this.relatives[ea.olap]),ea.asWindow){ea.width=ea.width||800,ea.height=ea.height||600,ea.listeners&&!ea.listeners.scope&&(ea.listeners.scope=this);let na=new Ext.Window({id:ia,title:ea.title,resizable:!0,closable:!0,maximizable:ea.maximizable,maximized:ea.maximized,modal:ea.modal,width:ea.width,height:ea.height,iconCls:ea.iconCls,bodyPadding:2,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',layout:'fit',stateful:!1,items:[la],listeners:ea.listeners});la.win=na,na.on('show',function(){let oa=na.getPosition();0>oa[1]&&na.setPosition(oa[0],0)},this),na.show(),common.window.list.push(na)}else{let na='o'+aa,oa=$zp.application,da=function(){if(ea.listeners&&ea.listeners.close){let ua=ea.listeners.close.scope||ea.listeners.scope||this,ga=ea.listeners.close.fn||ea.listeners.close;ga.call(ua)}};$o.app.tp.down('#'+na)||($o.app.tp.add({id:na,xtype:'panel',layout:'fit',node:1,iconCls:ea.iconCls,tooltip:ea.title,title:ea.title.length>common.window.titleMaxLength?ea.title.substr(0,common.window.titleMaxLength)+'...':ea.title,closable:!0,bodyStyle:'background-color: '+$zu.getThemeBGColor()+';',items:[la],close:function(){oa.mainPanel.remove(oa.openPages[na]),da()},listeners:{destroy:function(){da()},scope:this}}),$o.app.tp.doLayout()),$o.app.tp.setActiveTab(na),document.location.href='#'+na}$zp.application.fireEvent('showPage',{record:ra,showOptions:ea})},common.window.closeAll=function(){for(let ea=0;ea<common.window.list.length;ea++)common.window.list[ea].close()},common.data={},common.getId=function(ea){if(null==common.data[ea.classCode]){common.data[ea.classCode]={};let ia=common.execSQL({select:[{a:'id'},'id',{a:'code'},'code'],from:[{a:ea.classCode}]});for(let la=0;la<ia.length;la++)common.data[ea.classCode][ia.get(la,'code')]=ia.get(la,'id')}let aa=common.data[ea.classCode][ea.code];if(null==aa)throw{name:'common.getId exception',message:'classCode:'+ea.classCode+', code:'+ea.code+' not exist'};return aa},common.sprLayout=function(ea){let aa={split:{orientation:'vertical',width:250,pages:[{olap:{id:ea.olapId,view:ea.viewCode,actions:[{id:ea.classCode+'.create',caption:'create',icon:'new',group:!0},{id:ea.classCode+'.remove',active:{fn:common.recordSelected,arguments:{olap:'olap',attr:'id'}},caption:'delete',icon:'delete'}]}},{card:{id:ea.cardId,fields:[{id:'olap',attr:'id.npp'},{id:'olap',attr:'id.name'},{id:'olap',attr:'id.code'},{id:'olap',attr:'id.used'},{id:'olap',attr:'id.description'}]}}]}};return aa},common.chart.show=function(ea){let aa=new Ext.data.JsonStore({fields:ea.fields,data:ea.data}),ia=ea.width||800,la=ea.height||600,ra=new Ext.Window({title:ea.title,resizable:!0,closable:!0,maximizable:!0,width:ia,height:la,layout:'fit',items:[{xtype:ea.xtype,store:aa,xField:ea.xField,xAxis:new Ext.chart.CategoryAxis({title:ea.xAxisTitle}),yAxis:new Ext.chart.NumericAxis({title:ea.yAxisTitle,majorUnit:ea.majorUnit}),series:ea.yFields,extraStyle:{legend:{display:'right'}}}]});ra.show()},Ext.apply(Ext.form.VTypes,{daterange:function(ea,aa){let ia=aa.parseDate(ea);if(!ia)return!1;if(aa.startDateField){let la=Ext.getCmp(aa.startDateField);la.maxValue&&ia.getTime()==la.maxValue.getTime()||(la.setMaxValue(ia),la.validate())}else if(aa.endDateField){let la=Ext.getCmp(aa.endDateField);la.minValue&&ia.getTime()==la.minValue.getTime()||(la.setMinValue(ia),la.validate())}return!0}}),dialog.getPeriod=function(ea){let aa=new Ext.FormPanel({labelWidth:75,frame:!0,style:'background-color: #fff',bodyStyle:'background-color: #fff',bodyPadding:5,width:300,defaults:{width:225},defaultType:'datefield',items:[{fieldLabel:$zr.getString('From'),allowBlank:!1,msgTarget:'side',value:common.currentDate(),format:'d.m.Y',name:'startdt',id:'startdt',vtype:'daterange',endDateField:'enddt'},{fieldLabel:$zr.getString('To'),allowBlank:!1,msgTarget:'side',value:common.currentDate(),format:'d.m.Y',name:'enddt',id:'enddt',vtype:'daterange',startDateField:'startdt'}]}),ia=ea.scope||this,la=new Ext.Window({title:ea.title,resizable:!0,closable:!0,maximizable:!1,modal:!0,width:300,height:150,layout:'fit',items:[aa],buttons:[{code:'ok',formBind:!0,handler:function(){let ra=aa.items.items[0].getValue(),na=aa.items.items[1].getValue();la.close(),ea.success.call(ia,{startDate:ra,dateStart:ra,endDate:na,dateEnd:na})}},{code:'cancel',formBind:!1,handler:function(){la.close()}}]});la.show()},dialog.getObject=function(ea){let ia=ea.width||600,la=ea.height||400;ea.title||(ea.title=$zr.getString('object.choosing'));let ra=ea.scope||this,na;if(ea.view)na=new objectum.ui.layout.ViewLayout({xtype:'zviewlayout',border:!1,record:$zs.views.get(ea.view,{async:!1}),bodyStyle:'background-color: '+$zu.getThemeBGColor()+';'});else{let ua=$zs.views.get('ser.card',{async:!1});ua.stub.set('layout','string'==typeof ea.layout?ea.layout:JSON.stringify(ea.layout)),na=new objectum.ui.layout.ViewLayout({xtype:'zviewlayout',border:!1,record:ua,bodyStyle:'background-color: '+$zu.getThemeBGColor()+';'})}let da=new Ext.Window({title:ea.title,resizable:!0,closable:!0,height:la,width:ia,layout:'fit',modal:!0,tbar:[{code:'choose',handler:function(){let ga=ea.attr||'id',ua;ga=ga.split('.'),ua=1==ga.length?na.relatives.olap.getCurrentValues(ga[0]):na.relatives[ga[0]].getCurrentValues(ga[1]);let pa=ua[0];da.close(),ea.success.call(ra,{value:pa,values:ua})},scope:ra},{code:'cancel',handler:function(){da.close()}}],items:[na]});da.show()},dialog.selectObject=function(ea){let aa=ea.success,ia=ea.scope,la={olap:{id:'olap',view:ea.view,listeners:{dblclick:function(){oa()}}}},ra=$zs.views.get('ser.card',{async:!1});ra.stub.set('layout',JSON.stringify(la));let na=new objectum.ui.layout.ViewLayout({xtype:'zviewlayout',border:!1,record:ra,bodyStyle:'background-color: '+$zu.getThemeBGColor()+';'}),oa=function(){let pa=na.relatives.olap.getCurrentValue('id');ga.close(),aa.call(ia||this,{value:pa})},da=new Ext.Button({code:'choose',disabled:!0,handler:oa,scope:this}),ua=new Ext.Button({code:'cancel',handler:function(){ga.close()}});na.on('load',function(){let pa=na.relatives.olap;if(pa){pa.selModel.on('selectionchange',function(){pa.getCurrentValue('id')?da.setDisabled(!1):da.setDisabled(!0)},this)}},this);let ga=new Ext.Window({code:$o.getString('Choose object'),resizable:!0,closable:!0,width:ea.width||600,height:ea.height||400,layout:'fit',modal:!0,tbar:new Ext.Toolbar({items:[da,ua]}),items:[na]});ga.show()},dialog.getDate=function(ea){let aa=new Ext.FormPanel({labelWidth:75,bodyStyle:'background-color: '+$zu.getThemeBGColor()+'; padding: 5px 5px 0;',width:300,border:!1,defaults:{width:225},defaultType:'datefield',items:[{fieldLabel:$zr.getString('Date'),allowBlank:!1,msgTarget:'side',value:ea.value||common.currentDate(),minValue:ea.minValue,maxValue:ea.maxValue,format:'d.m.Y',name:'dt',id:'dt'}]}),ia=ea.scope||this,la=new Ext.Window({title:ea.title,closable:!0,modal:!0,width:300,height:120,layout:'fit',items:[aa],buttons:[{text:'Ok',iconCls:'ok',formBind:!0,handler:function(){let ra=aa.items.items[0].getValue();la.close(),ea.success.call(ia,{date:ra})}},{code:'cancel',formBind:!1,handler:function(){la.close()}}]});la.show()},dialog.getString=function(ea){let aa=ea.title||$ptitle,ia=ea.success,la=ea.failure,ra=ea.scope||this,na=ea.value,oa=new Ext.Button({code:'Ok',formBind:!0,scope:this,handler:function(){ia.call(ra,ua.getValue()),pa.close()}}),da=new Ext.Button({code:'Cancel',scope:this,handler:function(){la&&la.call(ra),pa.close()}}),ua=new Ext.form.TextField({selectOnFocus:!0,fieldLabel:ea.fieldLabel||$o.getString('Enter string'),allowBlank:!1,msgTarget:'side',anchor:'95%',value:na,listeners:{render:function(){ua.focus(!1,200)},specialkey:function(ma,fa){fa.getKey()!=fa.ENTER||oa.disabled||(ia.call(ra,ua.getValue()),pa.close())},scope:this}}),ga=new Ext.FormPanel({frame:!1,border:!1,defaultType:'textfield',monitorValid:!0,buttonAlign:'right',autoScroll:!0,bodyStyle:'background-color: '+$zu.getThemeBGColor()+'; padding: 5px;',layout:'form',items:[ua],buttons:[oa,da]}),pa=new Ext.Window({width:450,height:150,layout:'fit',modal:!0,title:aa,items:[ga]});pa.show(null,function(){ua.focus()})},dialog.getNumber=function(ea){let aa=ea.title||$ptitle,ia=ea.success,la=ea.failure,ra=ea.scope||this,na=new Ext.Button({code:'Ok',formBind:!0,scope:this,handler:function(){ia.call(ra,da.getValue()),ga.close()}}),oa=new Ext.Button({code:'Cancel',scope:this,handler:function(){la&&la.call(ra),ga.close()}}),da=new Ext.form.NumberField({selectOnFocus:!0,fieldLabel:ea.fieldLabel||$o.getString('Enter number'),allowBlank:!1,msgTarget:'side',anchor:'95%',listeners:{render:function(){da.focus(!1,200)},specialkey:function(pa,ma){ma.getKey()!=ma.ENTER||na.disabled||(ia.call(ra,da.getValue()),ga.close())},scope:this}}),ua=new Ext.FormPanel({frame:!1,border:!1,defaultType:'textfield',monitorValid:!0,buttonAlign:'right',autoScroll:!0,bodyStyle:'background-color: '+$zu.getThemeBGColor()+'; padding: 5px;',layout:'form',items:[da],buttons:[na,oa]}),ga=new Ext.Window({width:450,height:150,layout:'fit',modal:!0,title:aa,items:[ua]});ga.show(null,function(){da.focus()})},$report.sheet=function(ea){ea=ea||{},this.name=ea.name||'Sheet',this.orientation=ea.orientation||'portrait',this.scale=ea.scale||'100',this.margins=ea.margins||{left:15,top:15,right:15,bottom:15},this.rows=ea.rows||[],this.validation=ea.validation||[],this.namedRange=ea.namedRange||[],this.columns=ea.columns||{},this.ell=ea.ell||{},this.autoFitHeight=ea.autoFitHeight},$report.row=function(ea){ea=ea||{},this.height=ea.height||12.75,this.cells=ea.cells||[],this.startIndex=ea.startIndex||0},$report.xmlss=function(){this.params={},this.styles={'default':'hAlign:Left,vAlign:Center,wrap:true,fontSize:9',center:'hAlign:Center,vAlign:Center,wrap:true,fontSize:9',center_bold:'hAlign:Center,vAlign:Center,wrap:true,fontSize:9,bold:true',bold:'hAlign:Left,vAlign:Center,wrap:true,fontSize:9,bold:true',border:'hAlign:Left,vAlign:Top,wrap:true,fontSize:9,borders:All',border_center:'hAlign:Center,vAlign:Center,wrap:true,fontSize:9,borders:All',border_bold:'hAlign:Left,vAlign:Center,wrap:true,fontSize:9,borders:All,bold:true',border_bold_underline:'hAlign:Left,vAlign:Center,wrap:true,fontSize:9,borders:All,bold:true,underline:true',border_underline:'hAlign:Left,vAlign:Center,wrap:true,fontSize:9,borders:All,underline:true',border_bold_center:'hAlign:Center,vAlign:Center,wrap:true,fontSize:9,borders:All,bold:true',border_bottom:'hAlign:Left,vAlign:Center,wrap:true,fontSize:9,borders:Bottom',right:'hAlign:Right,vAlign:Center,wrap:true,fontSize:9'},this.columns={},this.rows=[],this.sheets=[],this.normalize=function(aa){if(Ext.isArray(this.columns)){let ia={};for(let la=0;la<this.columns.length;la++)ia[la+1]={width:this.columns[la]};this.columns=ia}this.rows&&this.rows.length||(this.rows=[{cells:[{text:''}]}]);for(let ia=0,la;ia<this.rows.length;ia++){la=this.rows[ia],la.height=la.height||12.75,la.cells=la.cells||[];for(let ra=0;ra<la.cells.length;ra++)'number'==typeof la.cells[ra].text&&(la.cells[ra].text+='');la.startIndex=la.startIndex||0}for(let ia=0,la;ia<this.sheets.length;ia++){if(la=this.sheets[ia],Ext.isArray(la.columns)){let ra={};for(let na=0;na<la.columns.length;na++)ra[na+1]={width:la.columns[na]};la.columns=ra}la.rows=la.rows||[];for(let ra=0,na;ra<la.rows.length;ra++){na=la.rows[ra],na.height=na.height||12.75,na.cells=na.cells||[];for(let oa=0,da;oa<na.cells.length;oa++)da=na.cells[oa].text,'number'==typeof da&&(na.cells[oa].text+=''),'string'==typeof da&&(na.cells[oa].text='null'==da?'':da.split('<').join('&lt;').split('>').join('&gt;')),aa&&aa.showNull&&(null==da||''==da||'null'==da)&&(na.cells[oa].text='null'),na.cells[oa].style=na.cells[oa].style||'default';na.startIndex=na.startIndex||0}la.rows.length||(la.rows=[{startIndex:0,height:12.75,cells:[{text:'',style:'default'}]}])}},this.preview=function(aa){let ia=this;aa=aa||{},ia.title=aa.title;let la=new Ext.Window({title:$o.getString('Preview'),resizable:!0,closable:!0,maximizable:!0,modal:!0,width:1e3,height:600,border:!1,iconCls:'gi_print',layout:'fit',items:{html:ia.createHTML({generate:1}),autoScroll:!0},buttons:[{text:aa.xlsx?'\u0422\u0430\u0431\u043B\u0438\u0446\u0430 XML - MS Excel':'\u041F\u0435\u0447\u0430\u0442\u044C',iconCls:'gi_print',handler:function(){ia.create()}},{text:'XLSX - MS Excel',iconCls:'gi_print',hidden:!aa.xlsx,handler:function(){ia.createXLSX()}}]});la.show()},this.create=function(aa){this.normalize(aa);let ia='report?sessionId='+$sessionId+'&username='+$zp.currentUser+'&format=xmlss&custom=1';document.getElementById('loading').innerHTML='<form name=\'form_report\' method=\'post\' target=\'_blank\' action=\''+ia+'\'><textarea style=\'display: none\' name=\'params\'>'+JSON.stringify(this.params)+'</textarea><textarea style=\'display: none\' name=\'styles\'>'+JSON.stringify(this.styles)+'</textarea><textarea style=\'display: none\' name=\'columns\'>'+JSON.stringify(this.columns)+'</textarea><textarea style=\'display: none\' name=\'rows\'>'+JSON.stringify(this.rows)+'</textarea><textarea style=\'display: none\' name=\'sheets\'>'+JSON.stringify(this.sheets)+'</textarea></form>',document.forms.form_report.submit()},this.createXLSX=function(aa){this.normalize(aa);let ia='report?sessionId='+$sessionId+'&username='+$zp.currentUser+'&format=xlsx';document.getElementById('loading').innerHTML='<form name=\'form_report\' method=\'post\' target=\'_blank\' action=\''+ia+'\'><textarea style=\'display: none\' name=\'params\'>'+JSON.stringify(this.params)+'</textarea><textarea style=\'display: none\' name=\'styles\'>'+JSON.stringify(this.styles)+'</textarea><textarea style=\'display: none\' name=\'columns\'>'+JSON.stringify(this.columns)+'</textarea><textarea style=\'display: none\' name=\'rows\'>'+JSON.stringify(this.rows)+'</textarea><textarea style=\'display: none\' name=\'sheets\'>'+JSON.stringify(this.sheets)+'</textarea></form>',document.forms.form_report.submit()},this.createCSV=function(aa){this.normalize(aa);let ia='report?sessionId='+$sessionId+'&username='+$zp.currentUser+'&format=xlsx&convert_csv=1&win1251=1';document.getElementById('loading').innerHTML='<form name=\'form_report\' method=\'post\' target=\'_blank\' action=\''+ia+'\'><textarea style=\'display: none\' name=\'params\'>'+JSON.stringify(this.params)+'</textarea><textarea style=\'display: none\' name=\'styles\'>'+JSON.stringify(this.styles)+'</textarea><textarea style=\'display: none\' name=\'columns\'>'+JSON.stringify(this.columns)+'</textarea><textarea style=\'display: none\' name=\'rows\'>'+JSON.stringify(this.rows)+'</textarea><textarea style=\'display: none\' name=\'sheets\'>'+JSON.stringify(this.sheets)+'</textarea></form>',document.forms.form_report.submit()},this.createPDF=function(){this.normalize();let ia='pdf?sessionId='+$sessionId;document.getElementById('loading').innerHTML='<form name=\'form_report\' method=\'post\' target=\'_blank\' action=\''+ia+'\'><textarea style=\'display: none\' name=\'params\'>'+JSON.stringify(this.params)+'</textarea><textarea style=\'display: none\' name=\'styles\'>'+JSON.stringify(this.styles)+'</textarea><textarea style=\'display: none\' name=\'columns\'>'+JSON.stringify(this.columns)+'</textarea><textarea style=\'display: none\' name=\'rows\'>'+JSON.stringify(this.rows)+'</textarea><textarea style=\'display: none\' name=\'sheets\'>'+JSON.stringify(this.sheets)+'</textarea></form>',document.forms.form_report.submit()},this.createHTML=function(aa){this.normalize(),aa=aa||{};let ia=aa.rows||this.rows;this.sheets.length&&(ia=this.sheets[0].rows);let la;la=aa.generate?{document:{open:function(){},close:function(){},html:'',write:function(ra){this.html+=ra}}}:window.open('','window1','width=800, height=600, resizable=yes, scrollbars=yes, status=yes, top=10, left=10'),la.document.open(),aa.title&&la.document.write('<p><b>'+aa.title+'</b></p>'),la.document.write('<style type=\\\'text/css\\\'>\\n* {\\n   font-family: Tahoma;\\n   font-size: 8pt;\\n}\\ntable {\\n\\tborder-left: 0px;\\n\\tborder-top: 0px;\\n\\tborder-right: 1px solid #BBBBBB;\\n\\tborder-bottom: 1px solid #BBBBBB;\\n}\\ntr {\\n\\tborder: 0px;\\n}\\ntd {\\n\\tborder-left: 1px solid #BBBBBB;\\n\\tborder-top: 1px solid #BBBBBB;\\n\\tborder-right: 0px;\\n\\tborder-bottom: 0px;\\n}\\n.tb-text {\\n\\ttext-align: left;\\n\\tpadding: 5px;\\n}\\n.tb-header {\\n\\tpadding: 5px;\\n\\tfont-weight: bold;\\n\\tbackground: #DDDDDD;\\n}\\n.tb-title {\\n\\tpadding: 5px;\\n\\tpadding-left: 20px !important;\\n\\tbackground: #DDEEFF;\\n}\\n<\\/style>\\n'),la.document.write('<table cellpadding=0 cellspacing=0>');for(let ra=0;ra<ia.length;ra++){let na=ia[ra],oa=na.cells,da='<tr>';for(let ua=0;ua<oa.length;ua++){let ga=oa[ua],pa=ga.text;(void 0===pa||null===pa||''===pa)&&(pa='<img width=1 height=1>'),ga.style=ga.style||'',-1<ga.style.indexOf('bold')&&(pa='<b>'+pa+'</b>'),'border_gray'==ga.style&&(pa='<font color=\'gray\'>'+pa+'</font>');let ma='';'border_bg_gray'==ga.style&&(ma='bgcolor=\'#DDDDDD\''),'border_bg_red'==ga.style&&(ma='bgcolor=\'#ff9999\''),'border_bg_green'==ga.style&&(ma='bgcolor=\'#99ff99\''),'border_bg_blue'==ga.style&&(ma='bgcolor=\'#9999ff\''),da+='<td class=\'tb-text\' colspan='+ga.colspan+' rowspan='+ga.rowspan+' '+ma+'>'+pa+'</td>'}da+='</tr>',la.document.write(da)}if(la.document.write('</table>'),la.document.close(),aa.generate)return la.document.html}},$dbf.field=function(ea){this.name=ea.name,this.type=ea.type,this.size='D'==ea.type?8:ea.size||0;this.dec=ea.dec||0},$dbf.file=function(ea){ea=ea||{},this.options={filename:'data.dbf',coding:ea.coding||'WIN'},this.fields=ea.fields||[],this.rows=ea.rows||[],this.create=function(){let ia='report?sessionId='+$sessionId+'&username='+$zp.currentUser+'&format=dbf&custom=1&filename='+this.options.filename;for(let la=0,ra;la<this.rows.length;la++)for(let na in ra=this.rows[la],ra)ra[na]+='';document.getElementById('loading').innerHTML='<form name=\'form_report\' method=\'post\' action=\''+ia+'\'><textarea style=\'display: none\' name=\'options\'>'+JSON.stringify(this.options)+'</textarea><textarea style=\'display: none\' name=\'fields\'>'+JSON.stringify(this.fields)+'</textarea><textarea style=\'display: none\' name=\'rows\'>'+JSON.stringify(this.rows)+'</textarea></form>',document.forms.form_report.submit()}},$csv.file=function(ea){ea=ea||{},this.body=ea.body||'',this.create=function(){let ia='report?sessionId='+$sessionId+'&username='+$o.currentUser+'&format=xmlss&custom=1&csv=1';document.getElementById('loading').innerHTML='<form name=\'form_report\' method=\'post\' action=\''+ia+'\'><textarea style=\'display: none\' name=\'body\'>'+this.body+'</textarea></form>',document.forms.form_report.submit()}},_Stringprototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,'').replace(/\s+/g,' ')},common.isEmail=function(ea){let aa=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return aa.test(ea)},Ext.example=function(){function ea(aa,ia){return['<div class="msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',aa,'</h3>',ia,'</div></div></div>','<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>','</div>'].join('')}return{msg:function(aa,ia,la){let ra=Ext.DomHelper.insertFirst(la||document.body,{id:'msg-div'},!0),na=Ext.DomHelper.append(ra,{html:ea(aa,ia)},!0);na.slideIn('t').pause(500).ghost('t',{remove:!0})},init:function(){let aa=Ext.get('lib-bar');aa&&aa.show()}}}(),common.balloon=function(ea,aa){Ext.example.msg(ea,aa)},common.rowLinks=function(ea,aa,ia,la,ra,na,oa){return(aa.id==(oa.fieldName||'name')||aa.column&&aa.column.dataIndex==(oa.fieldName||'name'))&&(ea=ea||oa.nullText||$o.getString('Untitled'),oa.id=ia.data[oa.fieldId||'id'],ea='<a href=\'#\' onclick=\''+oa.fn+'.call (Ext.getCmp ("'+this.id+'"), '+JSON.stringify(oa)+')\'>'+ea+'</a>'),ea},common.round=function(ea,aa){if(!ea)return ea;let ia;switch(aa){case null:case void 0:case 0:ia=1;break;case 1:ia=10;break;case 2:ia=100;break;case 3:ia=1e3;break;case 4:ia=1e4;break;default:throw'common.round - invalid n: '+aa;}let la=Math.round(ea*ia)/ia;return la},common.isNumber=function(ea){return!isNaN(parseFloat(ea))&&isFinite(ea)},common.sqlArray=function(ea){let aa=[];for(let ia=0;ia<ea.length;ia++)ia&&aa.push(','),aa.push(ea[ia]);return aa},common.extMajorVersion=function(){let ea=Ext.version||Ext.getVersion().version;return ea.split('.')[0]},common.isEmail=function(ea){let aa=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return aa.test(ea)},common.unicode={escape:function(ea){if(!ea)return ea;return ea.replace(/^[-~]|\\/g,function(aa){let ia=aa.charCodeAt(0);return'\\u'+(16>ia?'000':256>ia?'00':4096>ia?'0':'')+ia.toString(16)})},unescape:function(ea){if(!ea)return ea;return ea.replace(/\\u([a-fA-F0-9]{4})/g,function(aa,ia){return _StringfromCharCode(parseInt(ia,16))})}},common.addRecord=function(ea){function aa(oa,da){let ua=da.split('.'),ga=oa[ua[0]];for(let pa=1,ma;pa<ua.length;pa++){if(ma=$o.getObject(ga),!ma){ga=null;break}ga=ma.get(ua[pa])}return ga}let ia=ea.store,la=ea.data,ra=ea.map;if(!ia||!la||!ra)return la;for(let oa in ra)la[oa]=aa(la,ra[oa]);let na=ea.cmp;if(-1<na.getXType().indexOf('tree')){let oa=na.getSelectionModel(),da;oa.hasSelection()?(da=oa.getSelection()[0],da.set('leaf',!1)):da=na.getStore().getRootNode();la.leaf=!0,da.appendChild(la)}else ia.add(la);return la},common.updateRecord=function(ea){function aa(ra,na){let oa=na.split('.'),da=ra.get(oa[0]);for(let ua=1,ga;ua<oa.length;ua++){if(ga=$o.getObject(da),!ga){da=void 0;break}da=ga.get(oa[ua])}return da}let ia=ea.record,la=ea.map;if(!ia||!la)return ia;for(let ra in la){let na=aa(ia,la[ra]);void 0!==na&&ia.set(ra,na)}return ia.commit(),ia},common.tpl.remove=function(ea){ea=ea||{};let aa=this;common.confirm({message:$o.getString('Are you sure?'),fn:function(ia){if('yes'==ia){let la=ea.id||aa.getValue('a_id')||aa.getValue('id');if(la){$o.startTransaction({description:'Remove '+la});let ra=$o.getObject(la);if(ra.remove(),ra.commit(),$o.commitTransaction(),aa.getSelectionModel){let na=aa.getSelectionModel().getSelection()[0];if(-1<aa.getXType().indexOf('tree')){let oa=na.parentNode;na.remove(),oa==aa.getStore().getRootNode()||oa.childNodes.length||oa.set('leaf',!0)}else aa.getStore().remove(na)}}}}})},common.tpl.show=function(options){let me=this;options=options||{},options.id=options.id||this.getValue('a_id')||this.getValue('id');let refresh=options.refresh,fn=options.card;fn&&(fn='string'==typeof fn?eval(fn):fn);let layout=options.layout;if(options.title=options.title||'',options.id){let ea=$s.getObject(options.id);options.title=ea.get('name')||'ID: '+(0>options.id?$o.getString('Adding'):options.id)}let map=options.map||me.map||{},sql=eval('('+me.$view.get('query')+')'),getTree=function(ea){function aa(ra){for(let na=2;na<ea.length;na+=4){for(var oa in ea[na])break;if(ia[oa])continue;let da=ea[na+2];for(let ua=0;ua<da.length;ua++)if('object'==typeof da[ua]){for(var ga in da[ua])break;ga==ra&&'id'!=da[ua][ga]&&(ia[oa]=ia[ra]+'.'+da[ua][ga],aa(oa))}}}let ia={},la;for(la in ea[0])break;return ia[la]=me.$view.attrs.a_id?'a_id':'id',aa(la),ia},tree=getTree(sql.from);for(let ea=1;ea<sql.select.length;ea++)if('string'==typeof sql.select[ea])for(let aa=0;aa<me.columns.length;aa++)if(me.columns[aa].dataIndex==sql.select[ea]){for(var ia in sql.select[ea-1])break;map[sql.select[ea]]=map[sql.select[ea]]||tree[ia]+'.'+sql.select[ea-1][ia]}layout=layout||fn.call(this,options),options.readOnly&&common.makeReadOnlyLayout(layout);let items={id:'o'+options.id,objectId:options.id,name:'viewContainer',xtype:'$o.layout',opener:me,title:options.title,$layout:layout,listeners:{destroy:function(){let ea=$s.getObject(options.id);if(ea.get('id')!=options.id){common.addRecord({cmp:me,store:me.getStore(),data:me.$view.attrs.a_id?{a_id:ea.get('id')}:{id:ea.get('id')},map:map});-1==me.getXType().indexOf('tree')&&(me.getSelectionModel().deselectAll(),me.getSelectionModel().select(me.getStore().getCount()-1))}else{let aa=me.getSelectionModel().getSelection()[0];if(!aa){let ia=me.getStore(),la=me.getSelectionModel();aa=ia.getById(options.id),aa&&la.select(aa)}common.updateRecord({cmp:me,record:aa,map:map})}refresh&&'function'==typeof me.refresh&&me.refresh()}}};if(options.asWindow){items.title=void 0;let ea=Ext.create('Ext.window.Window',{title:options.title,resizable:!0,closable:!0,width:options.width||800,height:options.height||600,layout:'fit',modal:!0,items:items});ea.show()}else $o.app.show({items:items})},common.tpl.getViewObjectId=function(){let ea=0,aa=this.up('*[name=viewContainer]');return aa&&(ea=aa.objectId),ea},common.tpl.getOpener=function(){let ea=this.up('*[name=viewContainer]');if(ea)return ea.opener},common.tpl.create=function(options){let me=this,o=$s.createObject(options.classCode,'local');if(options.attrs)for(let ea in options.attrs){let aa=options.attrs[ea];'[object Array]'===Object.prototype.toString.apply(aa)&&(aa=me.relatives[aa[0]].getValue(aa[1])),o.set(ea,aa)}if(-1<me.getXType().indexOf('tree')&&o.set(me.fields.parent,me.getValue(me.fields.id)),options.id=o.get('id'),options.fn){let fn='string'==typeof options.fn?eval(options.fn):options.fn;fn.call(me,o,options)}options.layout||(options.card=options.card||options.classCode+'.card'),common.tpl.show.call(this,options)},common.tpl.updateTags=function(ea,aa){if(!ea)return ea;let ia=[],la=0;'object'==typeof ea&&(ea=JSON.stringify(ea),la=1);for(let ra=1;ra<ea.length;ra++)if(('$'==ea[ra]||'#'==ea[ra])&&'['==ea[ra-1]){let na='';for(;ra<ea.length&&']'!=ea[ra];ra++)na+=ea[ra];-1==ia.indexOf(na)&&ia.push(na)}for(let ra=0;ra<ia.length;ra++){let na;na='$'==ia[ra][0]?common.getValue(aa,ia[ra]):aa[ia[ra].substr(1)],ea=ea.split('['+ia[ra]+']').join(na)}return la&&(ea=JSON.parse(ea)),ea},dialog.getClass=function(ea){let aa=ea.success,ia=Ext.create('Ext.Window',{title:$o.getString('Choose','class'),width:900,height:700,layout:'fit',frame:!1,border:!1,bodyPadding:1,items:{xtype:'$o.classes',name:'classes'},listeners:{afterrender:function(){let la=ia.down('*[zid=olap]'),ra,na=Ext.create('Ext.Button',{text:$o.getString('Choose'),iconCls:'ok',disabled:!0,handler:function(){aa({id:ra}),ia.close()}});la.selModel.on('selectionchange',function(){ra=la.getCurrentValue('id'),ra?na.setDisabled(!1):na.setDisabled(!0)},this),la.lconfig&&la.lconfig.listeners&&la.lconfig.listeners.dblclick&&delete la.lconfig.listeners.dblclick;la.on('itemdblclick',function(){na.handler()});let oa=la.down('toolbar[dock=top]');oa.insert(0,[na]),oa.doLayout()}}});ia.show()},dialog.getView=function(ea){let aa=ea.success,ia=Ext.create('Ext.Window',{title:$o.getString('Select')+' '+(ea.hasQuery?$o.getString('query'):$o.getString('view')),width:900,height:700,layout:'fit',frame:!1,border:!1,bodyPadding:1,items:{xtype:'$o.views',name:'views'},listeners:{afterrender:function(){let la=ia.down('*[zid=olap]'),ra,na=Ext.create('Ext.Button',{text:$o.getString('Choose'),iconCls:'ok',disabled:!0,handler:function(){aa({id:ra}),ia.close()}});la.selModel.on('selectionchange',function(){ra=la.getCurrentValue('id'),ra&&(!ea.hasQuery||ea.hasQuery&&$o.getView(ra).get('query'))?na.setDisabled(!1):na.setDisabled(!0)},this),la.lconfig&&la.lconfig.listeners&&la.lconfig.listeners.dblclick&&delete la.lconfig.listeners.dblclick;la.on('itemdblclick',function(){na.handler()});let oa=la.down('toolbar[dock=top]');oa.insert(0,[na]),oa.doLayout()}}});ia.show()},dialog.getAction=function(ea){let aa=ea.success,ia=Ext.create('Ext.Window',{title:$o.getString('Select','action'),width:900,height:700,layout:'fit',frame:!1,border:!1,bodyPadding:1,items:{xtype:'$o.classes',name:'classes'},listeners:{afterrender:function(){let la=ia.down('*[zid=olapActions]');la.up('tabpanel').setActiveTab(2);let ra,na=Ext.create('Ext.Button',{text:$o.getString('Choose'),iconCls:'ok',disabled:!0,handler:function(){aa({id:ra}),ia.close()}});la.selModel.on('selectionchange',function(){ra=la.getCurrentValue('id'),ra?na.setDisabled(!1):na.setDisabled(!0)},this),la.lconfig&&la.lconfig.listeners&&la.lconfig.listeners.dblclick&&delete la.lconfig.listeners.dblclick;la.on('itemdblclick',function(){na.handler()});let oa=la.down('toolbar[dock=top]');oa.insert(0,[na]),oa.doLayout()}}});ia.show()},common.report.show=function(ea){let aa=$o.getObject(ea.id),ia=ea.success,la=aa.get('options')?JSON.parse(aa.get('options')):null,ra=Ext.create('Ext.Window',{title:$o.getString('Report'),iconCls:'gi_print',width:800,height:600,layout:'fit',frame:!1,border:!1,bodyPadding:1,modal:!0,maximizable:!0,tbar:[{text:$o.getString('Save'),iconCls:'save',handler:function(){let na=ra.down('*[name=reportdesigner]'),oa=na.getValue();if(!oa.code)return void common.message($o.getString('Enter report code'));$o.startTransaction(),aa.set('name',oa.name),aa.set('code',oa.code),aa.set('options',JSON.stringify(oa)),aa.sync('local'),$o.commitTransaction(),ia&&ia({id:aa.get('id')})}},{text:$o.getString('Preview'),iconCls:'gi_search',handler:function(){let na=JSON.parse(aa.get('options')),oa=Ext.create('$o.ReportDesigner.Widget',{value:na});oa.build({html:1})}}],items:{xtype:'$o.reportdesigner',name:'reportdesigner',value:la}});ra.show()},common.report.build=function(ea){let aa=ea.code,ia=$o.execute({select:[{a:'id'},'id'],from:[{a:'system.vo.report'}],where:[{a:'code'},'=',aa]});if(!ia.length)return void common.message($o.getString('Report')+' \''+aa+'\' '+$o.getString('not exists'));let la=$o.getObject(ia.get(0,'id')),ra=JSON.parse(la.get('options')),na=Ext.create('$o.ReportDesigner.Widget',{value:ra});na.build(ea)},common.merge=function(ea,aa){let ia={};for(let la in ea)ea.hasOwnProperty(la)&&(ia[la]=ea[la]);for(let la in aa)aa.hasOwnProperty(la)&&(ia.hasOwnProperty(la)?'object'==typeof ia[la]&&ia[la].constructor===Object&&'object'==typeof aa[la]&&aa[la].constructor===Object&&(ia[la]=common.merge(ia[la],aa[la])):ia[la]=aa[la]);return ia},common.makeReadOnlyLayout=function(layout){function go(ea){for(let aa in ea)if('object'==typeof ea[aa])if('actions'==aa&&Ext.isArray(ea[aa]))for(let ia=ea[aa].length-1;0<=ia;ia--)-1<[$o.getString('Open')].indexOf(ea[aa][ia].text)||-1<['open'].indexOf(ea[aa][ia].caption)?(ea[aa][ia].arguments=ea[aa][ia].arguments||{},ea[aa][ia].arguments.readOnly=!0):-1<[$o.getString('Add'),$o.getString('Remove')].indexOf(ea[aa][ia].text)||-1<['create','delete'].indexOf(ea[aa][ia].caption)?ea[aa][ia].active=function(){return!1}:(ea[aa][ia].arguments=ea[aa][ia].arguments||{},ea[aa][ia].arguments.readOnly=!0);else'listeners'==aa&&ea.listeners.dblclick?delete ea.listeners.dblclick:'card'==aa?ea[aa].readOnly=!0:go(ea[aa])}try{JSON.stringify(layout)}catch(ea){return}return'string'==typeof layout&&(layout=eval('('+layout+')')),go(layout),layout},common.setThousandSeparator=function(ea){let aa=this,ia=ea+'',la=[];for(let ra=0;ra<ia.length%3;ra++)ia=' '+ia;for(let ra=0;ra<ia.length;ra+=3)la.push(ia.substr(ra,3));return la.join(' ')},common.findObject=function(ea,aa){let ia,la,ra,na;for(ia in aa)aa.hasOwnProperty(ia)&&(la=ia,ra=aa[ia]);for(ia in ea)if(ia==la){if(ea[ia]==ra)return ea;}else if(ea[ia]instanceof Object&&ea.hasOwnProperty(ia)&&(na=common.findObject(ea[ia],aa),na))return na;return!1},common.findMenuItem=function(ea,aa){let ia=ea.items;for(let la=0;la<ia.getCount();la++){let ra=ia.getAt(la),na=!0;if(_.each(aa,function(oa,da){oa!=ra[da]&&(na=!1)}),na)return ra;if(ra.menu&&(ra=common.findMenuItem(ra.menu,aa),ra))return ra}},common.updateMenuItemText=function(ea,aa,ia){let la=common.findMenuItem(ea,aa);la&&la.setText&&la.setText(ia)},common.reportTpl=function(ea){if('post'==ea.method){let aa='report?storage='+$o.code+'&sessionId='+$sessionId+'&username='+$o.currentUser+'&time_offset_min='+new Date().getTimezoneOffset()+'&format='+ea.format+'&template='+ea.template;ea.files&&(aa+='&files='+ea.files);let ia=document.createElement('form');ia.target='Map',ia.method='POST',ia.action=aa;let la=document.createElement('input');la.type='text',la.name='opts',la.value=JSON.stringify(ea),ia.appendChild(la),document.body.appendChild(ia),map=window.open('','Map'),ia.submit()}else{let aa='report?';_.each(ea,function(ra,na){aa+=na+'='+ra+'&'}),aa+='storage='+$o.code+'&sessionId='+$sessionId+'&username='+$o.currentUser+'&time_offset_min='+new Date().getTimezoneOffset();let la=window.open(aa);la.focus()}},common.serverJob=function(ea){ea='string'==typeof ea?{fn:ea}:ea,$o.execute({fn:'service.job',args:ea,success:function(aa){window.open('/projects/'+$o.id+'/resources/html/'+aa.logFile,aa.logFile)}})},Ext.namespace('system.object','system.object_attr','system.class_','system.class_attr','system.view','system.view_attr','system.revision','system.LoginPassword','spr.conf','system.access','$layout.card','ose.role','ose.srole','ose.ext','ose.object','system.vo.menu','system.vo.menuItems','subject.human'),system.init=function(){$zp.onLogin=function(){'3'==$VERSION_MAJOR&&system.getObjNews()},$zp.onLogout=function(){common.window.closeAll()},$zp.application.on('ready',function(){function ea(){let ra=document.location.href,na=ra.split('#');return 2==na.length?(na=na[1],na):''}function aa(ra){let na=$zp.application.mainPanel.items;for(let oa=0,da;oa<na.getCount();oa++)if(da=na.getAt(oa),da.id==ra)return $zp.application.mainPanel.setActiveTab(da.id),!0;return!1}function ia(ra){if('v'==ra[0]){let na=$zs.viewsMap[ra.substr(1)];if(na)try{$zp.application.onClickMenuItem.call($zp.application,{record:na,text:na.stub.get('name')})}catch(oa){$o.app.show.call($o.app,{record:na})}}else if('o'==ra[0]){let na=ra.substr(1),oa=$zs.getObject(na);oa&&system.object.show({id:na})}}function la(){let ra=ea();ra!=$zp.hash&&(aa(ra)||ia(ra),$zp.hash=ra);setTimeout(la,200)}$zp.hash=ea();$zp.hash&&(aa($zp.hash)||ia($zp.hash));'onhashchange'in window?window.onhashchange=la:setTimeout(la,200);common.getConf('maxIdleSec').used&&($o.maxIdleSec=common.getConf('maxIdleSec').value)}),$zp.application.on('viewlayout',common.window.onViewLayout)},system.object_attr.history=function(ea){ea=ea||{};let aa;if(ea.id)aa=ea.id;else if(ea.objectId){let ia=common.execSQL({select:[{a:'___fid'},'id'],from:[{a:'system.object_attr'}],where:[{a:'___fend_id'},'=',system.revision.maxRevision,'and',{a:'___fobject_id'},'=',ea.objectId,'and',{a:'___fclass_attr_id'},'=',ea.classAttrId]});if(0==ia.length)return;aa=ia.get(0,'id')}else ea.olap=ea.olap||'olap',ea.attr=ea.attr||'id',aa=this.relatives[ea.olap].getCurrentValue(ea.attr);common.window.show.call(this,{id:aa,asWindow:!0,modal:!0,title:$zr.getString('History of changes'),iconCls:'event-log',cardFn:function(ia){let la={olap:{id:'olap',view:'ser.system.objectAttrHistory',filter:['fid','=',ia.id]}};return la}})},system.revision.maxRevision=2147483647,system.object.classes={},system.object.registerClass=function(ea){system.object.classes[ea.classId]={},system.object.classes[ea.classId].showFunc=ea.showFunc},system.object.show=function(ea){let aa=ea.id;!aa&&ea.olap&&ea.attr&&(aa=this.zview.getCurrentValue(ea.olap,ea.attr));let ia=$zs.getObject(aa),la=$o.getClass(ia.get('classId')),ra=la.get('id');system.object.classes[ra]?system.object.classes[ra].showFunc.call(this,{id:aa}):common.window.show({id:aa,asWindow:!0,modal:!0,title:$zr.getString('Object')+' ID: '+ia.getId(),width:800,height:600,cardFn:function(na){let oa=$zs.getObject(na.id),da={card:{id:'objectCard',readOnly:!0,fields:[]}};for(let ua in oa.data)'classId'!=ua&&'id'!=ua&&da.card.fields.push({objectId:na.id,attr:ua});return da}})},system.view.chooseAll=function(ea){this.relatives[ea.olap].selModel.selectAll()},system.view.selectQuery=function(ea){function aa(ua){let ga={text:ua.toString()};if(ua.childs){ga.expanded=0,ga.children=[];for(let pa=0;pa<ua.childs.length;pa++)ga.children.push(aa($o.viewsMap[ua.childs[pa]]))}else ga.leaf=1;return ga}let ia=this,la=ea.success;let ra=[];for(let ua in $o.viewsMap){let ga=$o.viewsMap[ua];ga.get('parent')||ga.get('system')||ra.push(aa($o.viewsMap[ua]))}let na=Ext.create('Ext.data.TreeStore',{root:{expanded:!0,children:ra},sorters:[{property:'text',direction:'ASC'}]}),oa,da=Ext.create('Ext.Window',{width:800,height:600,layout:'border',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Select','query'),iconCls:'gi_cogwheel',bodyPadding:5,modal:1,tbar:[{text:$o.getString('Choose'),iconCls:'gi_ok',name:'ok',disabled:1,handler:function(){la({value:oa}),da.close()}},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){da.close()}}],items:[{split:!0,region:'west',width:400,layout:'fit',items:{xtype:'treepanel',title:$o.getString('Views'),iconCls:'gi_eye_open',store:na,rootVisible:!1,border:0,listeners:{select:function(ua,ga){let fa=0;if(ga){let ha=ga.get('text').split(':')[1].split(')')[0],ba=$o.getView(+ha);da.down('*[name=query]').setValue(ba.get('query')?ba.get('query'):''),ba.get('query')&&(fa=1);oa=ba.get('id')}fa?da.down('*[name=ok]').enable():da.down('*[name=ok]').disable()}}}},{region:'center',layout:'fit',items:{title:$o.getString('Query'),name:'query',iconCls:'gi_cogwheel',xtype:'codemirrortextarea',mode:'application/ld+json',border:0}}]});da.show()},system.view.showPanel=function(ea){let aa=$zp.application,ia=$zs.views.get(ea.id,{async:!1}),la='View-'+ia.stub.get('id'),ra=new objectum.ui.layout.ViewLayout({border:!1,record:ia,bodyStyle:'background-color: '+$zu.getThemeBGColor()+';'});if(!(la in aa.openPages)){let oa=ia.iconCls;!oa&&ia.stub&&ia.stub.get('iconCls')&&(oa=ia.stub.get('iconCls')),aa.openPages[la]=aa.mainPanel.add({id:la,xtype:'panel',layout:'fit',node:1,iconCls:oa,tabTip:null,title:ia.stub.get('name'),closable:!0,bodyStyle:'background-color: '+$zu.getThemeBGColor()+';',items:[ra]}),aa.mainPanel.doLayout()}aa.mainPanel.activate(aa.openPages[la])},system.class_.create=function(ea){let aa=ea.name,ia=ea.code,la=ea.parent;if(3==common.extMajorVersion()){let ra=$zs.classesMap;for(let ua in ra)if(la==ra[ua].stub.get('parent')&&ia==ra[ua].stub.get('code'))throw'class with code "'+ia+'" already exists';let na=new objectum.server.Class({code:ia,name:aa});la&&na.set('parent',la);na.commit();let da=objectum.server.Object.create([]);da.stub=na,da.storage=$zs,da.storage.registerClass(da)}else{let ra=$o.createClass({name:aa,code:ia,parent:la?la:null});ra.sync()}},system.class_attr.create=function(ea){function aa(ia){if(3==common.extMajorVersion()){let la=new objectum.server.ClassAttr({name:ia.name,code:ia.code,'class':ia.classId,type:ia.typeId});la.commit(),la.storage=$zs,$zs.classAttrs[la.get('id')]=la;let ra=$zs.classAttrsMap[la.get('class')]||[];ra.push(la),$zs.classAttrsMap[la.get('class')]=ra}else{let la=$o.createClassAttr({name:ia.name,code:ia.code,'class':ia.classId,type:ia.typeId});la.sync()}}if(ea.hasOwnProperty('name'))aa({name:ea.name,code:ea.code,classId:ea.classId,typeId:ea.typeId});else for(let ia in ea)aa({name:ea[ia].name,code:ia,classId:$zs.getClass(ea[ia].classCode).stub.get('id'),typeId:$zs.getClass(ea[ia].typeCode).stub.get('id')})},system.class_attr.get=function(ea){let aa=ea.classId||$zs.getClass(ea.classCode).stub.get('id'),ia=common.execSQL({select:[{a:'___fid'},'id',{a:'___fcode'},'code',{a:'___fname'},'name',{a:'___ftype_id'},'type_id'],from:[{a:'system.class_attr'}],where:[{a:'___fend_id'},'=',system.revision.maxRevision,'and',{a:'___fclass_id'},'=',aa]});return ia},system.view.create=function(ea){let aa=ea.name,ia=ea.code,la=ea.parent;if(3==common.extMajorVersion()){let ra=$zs.viewsMap;for(let ua in ra)if(la==ra[ua].stub.get('parent')&&ia==ra[ua].stub.get('code'))throw'view with code "'+ia+'" already exists';let na=new objectum.server.View({code:ia,name:aa});na.set('materialized',0),la&&na.set('parent',la);na.commit();let da=objectum.server.View.create([]);da.stub=na,da.storage=$zs,da.storage.registerView(da)}else{let ra=$o.createView({name:aa,code:ia,materialized:0,parent:la?la:null});ra.sync()}},system.view_attr.create=function(ea){function aa(ia){if(3==common.extMajorVersion()){let la=new objectum.server.ViewAttr({name:ia.name,code:ia.code,view:ia.viewId,order:ia.order,area:ia.area?ia.area:0,width:ia.width?ia.width:75});la.commit(),la.storage=$zs,$zs.viewAttrs[la.get('id')]=la;let ra=$zs.viewAttrsMap[ia.viewId]||[];ra.push(la),$zs.viewAttrsMap[ia.viewId]=ra}else{let la=$o.createViewAttr({name:ia.name,code:ia.code,view:ia.viewId,order:ia.order,area:ia.area?ia.area:0,width:ia.width?ia.width:75});la.sync()}}if(ea.hasOwnProperty('name'))aa({name:ea.name,code:ea.code,viewId:ea.viewId,area:ea.area,width:ea.width});else for(let ia in ea)aa({name:ea[ia].name,code:ia,viewId:$zs.getView(ea[ia].viewCode).stub.get('id'),area:ea[ia].area?ea[ia].area:0,width:ea[ia].width?ea[ia].width:75})},system.view_attr.get=function(ea){let aa=ea.viewId||$zs.getView(ea.viewCode).stub.get('id'),ia=common.execSQL({select:[{a:'___fid'},'id',{a:'___fcode'},'code',{a:'___fname'},'name',{a:'___farea'},'area'],from:[{a:'system.view_attr'}],where:[{a:'___fend_id'},'=',system.revision.maxRevision,'and',{a:'___fview_id'},'=',aa]});return ia},spr.conf.create=function(ea){let aa=this.getCurrentValue('id')||null,ia=obj.create.call(this,{classCode:'spr.conf',attrs:{parent:aa},refresh:!ea.silence});return ea.silence?ia:void(ea.id=ia,spr.conf.show.call(this,ea))},spr.conf.remove=function(){obj.remove.call(this,{id:this.getCurrentValue('id'),refresh:!0})},spr.conf.card=function(ea){let aa=ea.id;return{card:{id:'confCard',listeners:{afterSave:function(){if(common.data.hasOwnProperty('spr.conf')){let la=$zs.getObject(aa);common.data['spr.conf'][la.get('code')]={id:la.get('id'),used:la.get('used'),name:la.get('name'),value:la.get('value')}}}},fields:[{objectId:aa,attr:'npp'},{objectId:aa,attr:'name'},{objectId:aa,attr:'code'},{objectId:aa,attr:'used'},{objectId:aa,attr:'value'},{objectId:aa,attr:'description'},{objectId:aa,attr:'parent',choose:{type:'view',id:'system.conf',attr:'olap.id',width:600,height:400}}]}}},spr.conf.show=function(ea){common.window.show.call(this,Ext.apply(ea,{title:$zr.getString('Option'),cardFn:spr.conf.card,iconCls:'gi_settings'}))},spr.conf.get=function(ea){let aa=common.execSQL({select:[{a:'value'},'value'],from:[{a:'spr.conf'}],where:[{a:'code'},'=',ea.code]});return aa.length?aa.get(0,'value'):null},common.data=common.data||{},common.data['spr.conf']={},common.loadConf=function(ea){common.data['spr.conf'][ea]={};let aa=common.execSQL({select:[{a:'id'},'id',{a:'code'},'code',{a:'used'},'used',{a:'name'},'name',{a:'value'},'value',{a:'subject'},'subject'],from:[{a:'spr.conf'}],where:ea?[{a:'subject'},'=',ea]:[{a:'subject'},'is null']});for(let ia=0;ia<aa.length;ia++)common.data['spr.conf'][ea][aa.get(ia,'code')]={id:aa.get(ia,'id'),used:aa.get(ia,'used'),name:aa.get(ia,'name'),value:aa.get(ia,'value')}},common.getConf=function(ea){let aa=ea.subject||null;common.data['spr.conf'][aa]||common.loadConf(aa);let ia='string'==typeof ea?ea:ea.code,la=common.data['spr.conf'][aa][ia];return null==la&&(la={}),la},common.setConf=function(ea,aa){if(!ea)return;let ia=aa.subject||null,la=$o.inTransaction,ra;la||(ra=$o.startTransaction({description:'setConf'}));let na=common.execSQL({select:[{a:'id'},'id'],from:[{a:'spr.conf'}],where:(ia?[{a:'subject'},'=',ia]:[{a:'subject'},'is null']).concat('and',{a:'code'},'=',ea)}),oa;for(let da in oa=na.length?$o.getObject(na.get(0,'id')):$o.createObject('spr.conf'),oa.set('code',ea),aa)oa.set(da,aa[da]);oa.commit(),la||$o.commitTransaction(ra),common.data['spr.conf'][ia]?common.data['spr.conf'][ia][ea]={id:oa.get('id'),used:oa.get('used'),name:oa.get('name'),value:oa.get('value')}:common.loadConf(ia)},common.setVar=function(ea,aa){if(!ea)return;let ia=$o.inTransaction,la;ia||(la=$o.startTransaction({description:'setVar'}));let ra=common.execSQL({select:[{a:'id'},'id'],from:[{a:'spr.conf'}],where:[{a:'subject'},'=',$userId?$userId:0,'and',{a:'name'},'=',ea]}),na;na=ra.length?$zs.getObject(ra.get(0,'id')):$zs.createObject('spr.conf');na.set('subject',$userId?$userId:0),na.set('name',ea),na.set('value',aa),na.commit(),ia||$o.commitTransaction(la)},common.getVar=function(ea){if(!ea)return null;let aa=common.execSQL({select:[{a:'value'},'value'],from:[{a:'spr.conf'}],where:[{a:'subject'},'=',$userId?$userId:0,'and',{a:'name'},'=',ea]});return aa.length?aa.get(0,'value'):null},system.access.getObjects=function(ea){ea=ea||{};let aa=[],ia;ia=ea.subjects?[{a:'subjectId'},'in',ea.subjects]:[{a:'subjectId'},'=',ea.subjectId];let la={select:[{a:'objectId'},'objectId',{a:'read'},'read',{a:'write'},'write'],from:[{a:'system.access'},'inner-join',{d:'system.object'},'on',[{a:'objectId'},'=',{d:'___fid'},'and',{d:'___fend_id'},'=','2147483647','and',{d:'___fclass_id'},'=',ea.classId]],where:ia},ra=common.execSQL(la);for(let na=0;na<ra.length;na++)(!0!=ea.read||ra.get(na,'read'))&&(!1!=ea.read||!ra.get(na,'read'))&&(!0!=ea.write||ra.get(na,'write'))&&(!1!=ea.write||!ra.get(na,'write'))&&(ea.comma&&aa.length&&aa.push(','),ea.detail?aa.push({id:ra.get(na,'objectId'),read:ra.get(na,'read'),write:ra.get(na,'write')}):aa.push(ra.get(na,'objectId')));return aa},system.xmlObj=null,system.getObjNews=function(revision){revision=revision||0,system.xmlObj||(window.XMLHttpRequest?system.xmlObj=new XMLHttpRequest:window.ActiveXObject&&(system.xmlObj=new ActiveXObject('Microsoft.XMLHTTP'))),system.xmlObj&&(system.xmlObj.open('POST','/objectum/obj_news?sessionId='+$sessionId+'&mustget='+Math.random(),!0),system.xmlObj.onreadystatechange=function(){if(4==system.xmlObj.readyState)if(401==system.xmlObj.status)common.message($o.getString('Session not authorized. Please, reload browser page'));else if(system.xmlObj.responseText){let r=eval('('+system.xmlObj.responseText+')');if('session removed'==r.header.error&&Ext.Msg.alert($ptitle,$zr.getString('Session disabled'),function(){location.reload()}),r.revision){revision=r.revision;let ea=r.objects;for(let aa=0;aa<ea.length;aa++)delete $zs.objectsMap[ea[aa]],$zp.application.fireEvent('objectChanged',{id:ea[aa]})}r.message&&common.balloon($zr.getString('Server message'),$zr.getString(r.message)),system.getObjNews(revision),system.objNewsFails=0}else system.objNewsFails=system.objNewsFails||0,system.objNewsFails++,setTimeout('system.getObjNews ('+revision+')',5e3)},system.xmlObj.send($zs.id+' '+revision))},Ext.ns('Ext.ux.state'),Ext.ux.state.LocalStorage=function(ea){Ext.ux.state.LocalStorage.superclass.constructor.call(this),Ext.apply(this,ea),this.state=localStorage},Ext.extend(Ext.ux.state.LocalStorage,Ext.state.Provider,{get:function(ea,aa){return'undefined'==typeof this.state[ea]?aa:this.decodeValue(this.state[ea])},set:function(ea,aa){if('undefined'==typeof aa||null===aa){try{this.clear(ea)}catch(ia){}return}this.state[ea]=this.encodeValue(aa),this.fireEvent('statechange',this,ea,aa)}}),window.localStorage)Ext.state.Manager.setProvider(new Ext.ux.state.LocalStorage);else{let ea=new Date(new Date().getTime()+2592000000);Ext.state.Manager.setProvider(new Ext.state.CookieProvider({expires:ea}))}system.LoginPassword.create=function(){let ea=$o.createObject('system.LoginPassword');ea.commit(),this.refresh()},system.LoginPassword.remove=function(){let ea=this.getCurrentValue('id');common.confirm({message:$zr.getString('Are you sure?'),scope:this,fn:function(aa){'yes'==aa&&($o.startTransaction({description:'Remove '+ea}),obj.remove.call(this,{id:ea,refresh:!0}),$o.commitTransaction())}})},ose.role.card=function(ea){let aa=ea.id;return{card:{id:'ose.role.card',items:[{objectId:aa,attr:'npp'},{objectId:aa,attr:'name'},{objectId:aa,attr:'code'},{objectId:aa,attr:'menu',choose:{type:'layout',attr:'olap.a_id',layout:{olap:{id:'olap',view:'system.vo.menu'}}}}]}}},ose.srole.card=function(ea){let aa=ea.id;return{card:{id:'ose.srole.card',items:[{objectId:aa,attr:'role',choose:{type:'layout',attr:'olap.id',layout:{olap:{id:'olap',view:'system.ose.role'}}}},{objectId:aa,attr:'subject',xtype:'numberfield'}]}}},ose.ext.card=function(ea){let aa=ea.id;return{card:{id:'ose.ext.card',items:[{objectId:aa,attr:'npp'},{objectId:aa,attr:'classAttr'},{objectId:aa,attr:'take'},{objectId:aa,attr:'give'}]}}},ose.object.card=function(ea){let aa=ea.id;return{card:{id:'ose.object.card',items:[{objectId:aa,attr:'class'},{objectId:aa,attr:'object'},{objectId:aa,attr:'subject',xtype:'numberfield'},{objectId:aa,attr:'read'},{objectId:aa,attr:'update'},{objectId:aa,attr:'delete'}]}}},system.vo.menu.card=function(ea){let aa=ea.id,ia={card:{id:'system.vo.menu.card',items:[{objectId:aa,attr:'name'},{objectId:aa,attr:'position',xtype:'combo',name:'position',width:300,triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',editable:!1,store:new Ext.data.ArrayStore({fields:['id','text'],data:[['top',$o.getString('Top')],['left',$o.getString('Left')],['bottom',$o.getString('Bottom')],['right',$o.getString('Right')]]}),valueField:'id',displayField:'text',style:'margin-top: 5px;'},{objectId:aa,attr:'large'},{objectId:aa,attr:'npp'},{objectId:aa,attr:'hidden'}]}};return ia},system.vo.menuItems.card=function(ea){let aa=ea.id,ia=$o.getObject(aa),la={tab:{items:[{card:{id:'system.vo.menu.card',title:$o.getString('Menu item'),items:[{objectId:aa,attr:'view',xtype:'numberfield',hideLabel:!0,style:'display: none'},{xtype:'$conffield',fieldLabel:$o.getString('View'),name:'view',value:ia.get('view'),anchor:'-20',confRef:'view',choose:{type:'custom',fn:function(){let ra=this;dialog.getView({success:function(na){ra.setValue(na.id)}})}},listeners:{change:function(){if(this.up('*[objectumCmp=card]').down('*[attr=view]').setValue(this.getValue()),this.getValue()){this.up('*[objectumCmp=card]').down('*[name=action]').setValue(null);let ra=$o.getView(this.getValue());this.up('*[objectumCmp=card]').down('*[attr=name]').setValue(ra.get('name')),this.up('*[objectumCmp=card]').down('*[attr=iconCls]').setValue(ra.get('iconCls'))}}}},{objectId:aa,attr:'action',xtype:'numberfield',hideLabel:!0,style:'display: none'},{xtype:'$conffield',fieldLabel:$o.getString('Action'),name:'action',value:ia.get('action'),anchor:'-20',confRef:'action',choose:{type:'custom',fn:function(){let ra=this;dialog.getAction({success:function(na){ra.setValue(na.id)}})}},listeners:{change:function(){if(this.up('*[objectumCmp=card]').down('*[attr=action]').setValue(this.getValue()),this.getValue()){this.up('*[objectumCmp=card]').down('*[name=view]').setValue(null);let ra=$o.getAction(this.getValue());this.up('*[objectumCmp=card]').down('*[attr=name]').setValue(ra.get('name'))}}}},{objectId:aa,attr:'name'},{objectId:aa,attr:'description'},{objectId:aa,attr:'iconCls',xtype:'$iconselector'},{objectId:aa,attr:'npp'},{objectId:aa,attr:'hidden'}]}},{olap:{id:'olapMenuItems',title:$o.getString('Child menu items'),view:'system.vo.menuItems',actions:[{fn:'common.tpl.show',text:$o.getString('Open'),arguments:{asWindow:1,card:'system.vo.menuItems.card'},iconCls:'gi_edit',active:'common.recordSelected'},{fn:'common.tpl.create',text:$o.getString('Add'),arguments:{asWindow:1,classCode:'system.vo.menuItems',attrs:{parent:aa}},iconCls:'gi_circle_plus'},{fn:'common.tpl.remove',text:$o.getString('Remove'),iconCls:'gi_circle_minus',active:'common.recordSelected'}],listeners:{cellRenderer:'system.vo.menuItems.cellRenderer',dblclick:{fn:'common.tpl.show',arguments:{asWindow:1,card:'system.vo.menuItems.card'}}},filter:['a_parent','=',aa]}}]}};return la},system.vo.menu.cellRenderer=function(ea,aa,ia){if(ia.get('a_position')&&'a_position'==aa.column.dataIndex)switch(ia.get('a_position')){case'top':ea=$o.getString('Top');break;case'left':ea=$o.getString('Left');break;case'bottom':ea=$o.getString('Bottom');break;case'right':ea=$o.getString('Right');}return ea},system.vo.menuItems.cellRenderer=function(ea,aa,ia){return ia.get('a_view')&&'a_view'==aa.column.dataIndex&&(ea=$o.getView(ia.get('a_view')).toString()),ia.get('action')&&'action'==aa.column.dataIndex&&(ea=$o.getAction(ia.get('action')).toString()),ea},subject.human.create=function(ea){common.tpl.create.call(this,Ext.apply(ea,{asWindow:1,classCode:'subject.human'}))},subject.human.card=function(ea){let aa=this,ia=ea.id,la=common.execSQL({select:[{a:'id'},'id',{a:'role'},'role'],from:[{a:'ose.srole'}],where:[{a:'subject'},'=',ia]}),ra=null;la.length&&(ra=la.get(0,'role'));let na={card:{id:'subject.human.card',listeners:{afterSave:function(){ra=this.down('*[name=role]').getValue();let oa;la.length?oa=$o.getObject(la.get(0,'id')):(oa=$o.createObject('ose.srole'),oa.set('subject',ia));oa.set('role',ra),oa.sync()}},items:[{objectId:ia,attr:'surname'},{objectId:ia,attr:'forename'},{objectId:ia,attr:'patronymic'},{objectId:ia,attr:'birthday',timefield:0},{objectId:ia,attr:'login'},{objectId:ia,attr:'password'},{xtype:'$objectfield',name:'role',fieldLabel:'\u0420\u043E\u043B\u044C',value:ra,anchor:'-20',choose:{type:'layout',attr:'olap.id',layout:{olap:{id:'olap',view:'system.ose.role'}}}}]}};return na},system.vo.chooseAdminMenu=function(){let ea=this,aa=Ext.create('Ext.Window',{width:400,height:100,layout:'form',frame:!1,border:!1,style:'background-color: #ffffff',bodyStyle:'background-color: #ffffff',title:$o.getString('Admin menu'),iconCls:'gi_list',bodyPadding:5,modal:1,tbar:[{text:'\u041E\u043A',iconCls:'gi_ok',handler:function(){common.setConf('adminMenu',{name:$o.getString('Admin menu'),value:aa.down('*[name=menu]').getValue()}),aa.close()}},{text:$o.getString('Cancel'),iconCls:'gi_remove',handler:function(){aa.close()}}],items:{xtype:'$objectfield',name:'menu',fieldLabel:$o.getString('Menu'),value:common.getConf('adminMenu').value,choose:{type:'layout',attr:'olap.a_id',layout:{olap:{id:'olap',view:'system.vo.menu'}}}}});aa.show()},system.vo.buildMenu=function(){function getMenuElements(menu,parentId){let items=[];for(let i=0;i<r.length;i++)if(parentId==r.get(i,'parent')){try{$o.getView(r.get(i,'view'))}catch(ea){console.log(r.get(i,'id'))}let o={text:r.get(i,'name'),iconCls:r.get(i,'iconCls'),viewRecord:$o.getView(r.get(i,'view')),viewReadOnly:r.get(i,'readOnly'),actionId:r.get(i,'action'),handler:function(){if(this.viewRecord)$o.app.show.call($o.app,{record:this.viewRecord,readOnly:this.viewReadOnly});else if(this.actionId){let actionRec=_.findWhere(actionRecs,{id:this.actionId});if(actionRec){let cls=$o.getClass(actionRec.classId),_fn=(cls?cls.getFullCode()+'.':'')+actionRec.code;_fn=eval(_fn),'function'==typeof _fn&&_fn({readOnly:this.viewReadOnly})}}}};getMenuElements(o,r.get(i,'id')),items.push(o)}items.length&&(menu.menu={items:items})}let menuId;if('admin'==$o.currentUser)menuId=common.getConf('adminMenu').value;else if('autologin'!=$o.currentUser){let ea=$o.getObject($o.userId);menuId='subject.human.vo_adm'==$o.getClass(ea.get('classId')).getFullCode()?common.getConf('adminMenu').value:$o.menuId}else if(menuId=common.getConf('autologinMenu').value,!menuId)return;if(!menuId)if(oUser.get('voRole')){let ea=$o.getObject(oUser.get('voRole'));if(ea&&ea.get('menu'))menuId=ea.get('menu');else return common.message($o.getString('User has no role'))}else return common.message($o.getString('User has no role'));let m=common.execSQL({select:[{a:'id'},'id',{a:'position'},'position',{a:'large'},'large'],from:[{a:'system.vo.menu'}],where:[[{a:'hidden'},'is null','or',{a:'hidden'},'=',0],'and',{a:'id'},'=',menuId],order:[{a:'npp'},',',{a:'name'}]});if(!m.length)return;let r=common.execSQL({select:[{a:'id'},'id',{a:'menu'},'menu',{a:'name'},'name',{a:'iconCls'},'iconCls',{a:'parent'},'parent',{a:'view'},'view',{a:'action'},'action',{a:'readOnly'},'readOnly'],from:[{a:'system.vo.menuItems'}],where:[{a:'hidden'},'is null','or',{a:'hidden'},'=',0],order:[{a:'npp'},',',{a:'name'}]}),actions=[];for(let ea=0;ea<r.length;ea++)r.get(ea,'action')&&actions.push(r.get(ea,'action'));let actionRecs=[];actions.length&&(actionRecs=$o.execute({asArray:!0,select:[{a:'___fid'},'id',{a:'___fclass_id'},'classId',{a:'___fcode'},'code'],from:[{a:'system.action'}],where:[{a:'___fend_id'},'=',2147483647,'and',{a:'___fid'},'in',actions.join('.,.').split('.')]}));let menu=[];for(let i=0;i<r.length;i++)if(r.get(i,'menu')==menuId&&!r.get(i,'parent')){let iconCls=r.get(i,'iconCls');iconCls&&m.get(0,'large')&&(iconCls='gib'+iconCls.substr(2));let o={id:r.get(i,'id'),text:r.get(i,'name'),iconCls:iconCls,viewRecord:$o.getView(r.get(i,'view')),viewReadOnly:r.get(i,'readOnly'),actionId:r.get(i,'action'),handler:function(){if(this.viewRecord)$o.app.show.call($o.app,{record:this.viewRecord,readOnly:this.viewReadOnly});else if(this.actionId){let actionRec=_.findWhere(actionRecs,{id:this.actionId});if(actionRec){let cls=$o.getClass(actionRec.classId),_fn=(cls?cls.getFullCode()+'.':'')+actionRec.code;_fn=eval(_fn),'function'==typeof _fn&&_fn({readOnly:this.viewReadOnly})}}}};m.get(0,'large')&&(o.iconAlign='top',o.scale='large',('left'==m.get(0,'position')||'right'==m.get(0,'position'))&&(o.arrowAlign='bottom',o.menuAlign='tr',o.arrowCls='arrow-right-white')),menu.push(o)}for(let ea=0;ea<menu.length;ea++)getMenuElements(menu[ea],menu[ea].id);let o={text:$o.getString('Exit'),iconCls:'gi_exit',handler:function(){if($o.userId){$o.startTransaction();let ea=$o.getObject($o.userId);ea.set('lastLogout',new Date),ea.sync(),$o.commitTransaction()}$o.logout({success:function(){location.reload()}})}};if(m.get(0,'large')&&(o.iconCls='gib_exit',o.iconAlign='top',o.scale='large'),menu.push(o),$o.visualObjectum.timeMachine&&$o.visualObjectum.timeMachine.showDates){let ea=new Date;$o.visualObjectum.timeMachine.dates=$o.visualObjectum.timeMachine.dates||[];for(let aa=0,ia;aa<$o.visualObjectum.timeMachine.dates.length;aa++)ia=$o.visualObjectum.timeMachine.dates[aa].date,ia.getTime()<ea.getTime()&&(ea=ia);menu.push({xtype:'displayfield',value:$o.getString('System date')+':'},{xtype:'datefield',minValue:ea,maxValue:new Date,value:new Date,width:100,listeners:{render:function(){Ext.tip.QuickTipManager.register({target:this.id,text:$o.getString('View data in last dates'),width:200,dismissDelay:3e3})},change:function(aa,ia){let ra=common.getJulianDay(ia),na=common.getJulianDay(new Date),la;if(ra==na)$o.setRevision();else{for(let oa=$o.visualObjectum.timeMachine.dates.length-1,da;0<=oa;oa--)da=common.getJulianDay($o.visualObjectum.timeMachine.dates[oa].date),da<=ra&&(la=$o.visualObjectum.timeMachine.dates[oa].id);$o.setRevision(la)}}}})}switch(m.get(0,'position')){case'top':$o.app.tb.add(menu),$o.app.tb.doLayout(),$o.app.tb.show();break;case'left':$o.app.lb.add(menu),$o.app.lb.doLayout(),$o.app.lb.show();break;case'right':$o.app.rb.add(menu),$o.app.rb.doLayout(),$o.app.rb.show();break;case'bottom':$o.app.bb.add(menu),$o.app.bb.doLayout(),$o.app.bb.show();}},Ext.override(Ext.menu.Menu,{onMouseLeave:function(ea){let aa=this,ia=!1;(aa.items.each(function(la){la.menu&&la.menu.isVisible()&&(ia=!0)}),!ia)&&(aa.deactivateActiveItem(),!aa.disabled)&&aa.fireEvent('mouseleave',aa,ea)}}),Ext.namespace('subject.human.vo_adm'),subject.human.vo_adm.create=function(){common.tpl.create.call(this,{asWindow:1,classCode:'subject.human.vo_adm',fn:function(aa,ia){ia.layout=subject.human.vo_adm.card.layout(aa.get('id'))}})},subject.human.vo_adm.card=function(){let aa=this,ia=aa.getValue('id')||aa.getValue('a_id');common.tpl.show.call(this,{id:ia,asWindow:1,layout:subject.human.vo_adm.card.layout(ia)})},subject.human.vo_adm.card.layout=function(ea){let aa={card:{id:'card',items:[{anchor:'100%',fieldLabel:$o.getString('Login'),attr:'login',objectId:ea},{anchor:'100%',fieldLabel:$o.getString('Password'),attr:'password',objectId:ea},{anchor:'100%',fieldLabel:$o.getString('Surname'),attr:'surname',objectId:ea},{anchor:'100%',fieldLabel:$o.getString('Forename'),attr:'forename',objectId:ea},{anchor:'100%',fieldLabel:$o.getString('Patronymic'),attr:'patronymic',objectId:ea}]}};return aa},Ext.define('ImportCSVObjects.Widget',{extend:'Ext.panel.Panel',alias:['widget.importcsvobjects'],border:!1,layout:'fit',defaults:{border:!1},bodyPadding:2,classId:null,initComponent:function(){let ea=this;ea.oCls=$o.getClass(ea.classId),ea.attrs=_.map(ea.oCls.attrs,function(ia){return ia.set('fullName',ia.get('name')+' ('+ia.get('code')+')'),ia});let aa=new Ext.Panel({bodyStyle:'background-color: white; padding: 5px;',border:!1,html:'<input type="file" id="selectedFile">'});ea.tbar=[{xtype:'combo',fieldLabel:$o.getString('Encoding'),labelWidth:65,width:150,name:'coding',triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',store:{type:'json',fields:['id','name'],data:[{id:'utf8',name:'utf-8'},{id:'win1251',name:'win-1251'}]},valueField:'id',displayField:'name',value:'utf8',editable:!1},aa,{text:$o.getString('Load'),iconCls:'gi_table',name:'load',disabled:!0,handler:function(){let ia=Ext.getDom('selectedFile'),la=ia.files[0],ra=new FileReader;ra.onload=function(){let na=ra.result.split('\n');ea.data=[],ea.fields=[],_.each(na,function(ua,ga){let pa=ua.split(';'),ma={};_.each(pa,function(fa,ha){fa=null==fa?'':fa.trim(),ga?ma['attr-'+ha]=fa:ea.fields.push({name:fa,code:'attr-'+ha})}),ga&&pa.length&&''!=pa[0]&&ea.data.push(ma)}),ea.fields.length&&!ea.fields[ea.fields.length-1].name&&ea.fields.splice(ea.fields.length-1,1);let oa=ea.down('*[name=grid]');oa.reconfigure({xtype:'store',fields:_.map(ea.fields,function(ua){return ua.code}),data:ea.data},_.map(ea.fields,function(ua){return{text:ua.name,dataIndex:ua.code,width:90}})),oa.getStore().loadData(ea.data),ea.down('*[name=recNum]').setValue(ea.data.length);let da=_.map(ea.fields,function(ua){let ga;_.each(ea.attrs,function(ma){ma.get('name')==ua.name&&(ga=ma.get('code'))});let pa={xtype:'combo',fieldLabel:ua.name,name:ua.code,triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',store:{type:'json',fields:['id','name'],data:_.map(ea.attrs,function(ma){return{id:ma.get('code'),name:ma.get('fullName')}})},valueField:'id',displayField:'name',editable:!1,value:ga,width:'100%'};return pa});ea.down('*[name=map]').removeAll(),ea.down('*[name=map]').add(da),ea.down('*[name=import]').setDisabled(!1)},ra.readAsText(la,'utf8'==ea.down('*[name=coding]').getValue()?'utf-8':'windows-1251')}},{text:$o.getString('Import'),iconCls:'gi_file_import',name:'import',disabled:!0,handler:function(){ea.importer?ea.importer(ea.data):(Ext.MessageBox.show({title:$o.getString('Please wait'),msg:$o.getString('Action in progress')+' ...',progressText:'',width:300,progress:1,closable:0}),setTimeout(function(){$o.startTransaction();let ia={};_.each(ea.fields,function(oa){let da=ea.down('*[name='+oa.code+']');ia[oa.code]=da.getValue()});let la=[],ra=ea.down('*[name=idAttr]').getValue();ra&&(la=$o.execute({asArray:!0,select:[{a:'id'},'id',{a:ra},ra],from:[{a:ea.oCls.getFullCode()}]}));let na={};_.each(la,function(oa){na[oa[ra]]=oa.id}),async.reduce(ea.data,0,function(oa,da,ua){let ga={};_.each(da,function(ma,fa){ga[ia[fa]]=ma});let pa;(!ra||ra&&ga[ra])&&(pa=ra?na[ga[ra]]?$o.getObject(na[ga[ra]]):$o.createObject(ea.classId):$o.createObject(ea.classId),_.each(ga,function(ma,fa){pa.set(fa,ma)}),pa.sync()),Ext.MessageBox.updateProgress(oa/ea.data.length,oa+' / '+ea.data.length),setTimeout(function(){ua(null,oa+1)},1)},function(){$o.commitTransaction(),Ext.MessageBox.hide(),ea.fireEvent('imported')})},100))}}],ea.items={xtype:'tabpanel',items:[{title:$o.getString('Field mapping'),layout:'vbox',name:'map',bodyPadding:5,tbar:[{xtype:'textfield',fieldLabel:$o.getString('Class'),labelWidth:50,width:400,disabled:!0,value:ea.oCls.toString()},{xtype:'combo',fieldLabel:$o.getString('Identifier'),name:'idAttr',triggerAction:'all',lazyRender:!0,mode:'local',queryMode:'local',store:{type:'json',fields:['id','name'],data:_.map(ea.attrs,function(ia){return{id:ia.get('code'),name:ia.get('fullName')}})},width:300,style:'margin-left: 5px',valueField:'id',displayField:'name',editable:!1}],items:[]},{title:'CSV',xtype:'grid',name:'grid',tbar:[{xtype:'textfield',disabled:!0,name:'recNum',fieldLabel:$o.getString('Amount')}],store:{xtype:'store',fields:['name'],data:[]},columns:[{text:$o.getString('Name'),dataIndex:'name',width:90}],width:'100%',columnLines:!0,rowLines:!0}]},ea.on('afterrender',function(){Ext.get('selectedFile').on('change',function(){ea.down('*[name=load]').setDisabled(!1)},this)}),ea.addEvents('imported'),ea.callParent(arguments)}}),Ext.define('Ext.ux.GroupTabRenderer',{alias:'plugin.grouptabrenderer',extend:'Ext.AbstractPlugin',tableTpl:new Ext.XTemplate('<div id="{view.id}-body" class="'+Ext.baseCSSPrefix+'{view.id}-table '+Ext.baseCSSPrefix+'grid-table-resizer" style="{tableStyle}">','{%','values.view.renderRows(values.rows, values.viewStartIndex, out);','%}','</div>',{priority:5}),rowTpl:new Ext.XTemplate('{%','Ext.Array.remove(values.itemClasses, "',Ext.baseCSSPrefix+'grid-row");','var dataRowCls = values.recordIndex === -1 ? "" : " '+Ext.baseCSSPrefix+'grid-data-row";','%}','<div {[values.rowId ? ("id=\\"" + values.rowId + "\\"") : ""]} ','data-boundView="{view.id}" ','data-recordId="{record.internalId}" ','data-recordIndex="{recordIndex}" ','class="'+Ext.baseCSSPrefix+'grouptab-row {[values.itemClasses.join(" ")]} {[values.rowClasses.join(" ")]}{[dataRowCls]}" ','{rowAttr:attributes}>','<tpl for="columns">{%','parent.view.renderCell(values, parent.record, parent.recordIndex, xindex - 1, out, parent)','%}','</tpl>','</div>',{priority:5}),cellTpl:new Ext.XTemplate('{%values.tdCls = values.tdCls.replace(" '+Ext.baseCSSPrefix+'grid-cell "," ");%}','<div class="'+Ext.baseCSSPrefix+'grouptab-cell {tdCls}" {tdAttr}>','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner" style="text-align: {align}; {style};">{value}</div>','<div class="x-grouptabs-corner x-grouptabs-corner-top-left"></div>','<div class="x-grouptabs-corner x-grouptabs-corner-bottom-left"></div>','</div>',{priority:5}),selectors:{bodySelector:'div.'+Ext.baseCSSPrefix+'grid-table-resizer',nodeContainerSelector:'div.'+Ext.baseCSSPrefix+'grid-table-resizer',itemSelector:'div.'+Ext.baseCSSPrefix+'grouptab-row',dataRowSelector:'div.'+Ext.baseCSSPrefix+'grouptab-row',cellSelector:'div.'+Ext.baseCSSPrefix+'grouptab-cell',getCellSelector:function(ea){var aa='div.'+Ext.baseCSSPrefix+'grid-cell';return ea&&(aa+='-'+ea.getItemId()),aa}},init:function(ea){var aa=ea.getView(),ia=this;aa.addTableTpl(ia.tableTpl),aa.addRowTpl(ia.rowTpl),aa.addCellTpl(ia.cellTpl),Ext.apply(aa,ia.selectors)}}),Ext.define('Ext.ux.GroupTabPanel',{extend:'Ext.Container',alias:'widget.grouptabpanel',requires:['Ext.tree.Panel','Ext.ux.GroupTabRenderer'],baseCls:Ext.baseCSSPrefix+'grouptabpanel',initComponent:function(ea){var aa=this;Ext.apply(aa,ea),aa.store=aa.createTreeStore(),aa.layout={type:'hbox',align:'stretch'},aa.defaults={border:!1},aa.items=[{xtype:'treepanel',cls:'x-tree-panel x-grouptabbar',width:150,rootVisible:!1,store:aa.store,hideHeaders:!0,animate:!1,processEvent:Ext.emptyFn,border:!1,plugins:[{ptype:'grouptabrenderer'}],viewConfig:{overItemCls:'',getRowClass:aa.getRowClass},columns:[{xtype:'treecolumn',sortable:!1,dataIndex:'text',flex:1,renderer:function(ia,la,ra){var ga='';return ra.parentNode&&null===ra.parentNode.parentNode?(ga+=' x-grouptab-first',ra.previousSibling&&(ga+=' x-grouptab-prev'),(!ra.get('expanded')||null==ra.firstChild)&&(ga+=' x-grouptab-last')):null===ra.nextSibling?ga+=' x-grouptab-last':ga+=' x-grouptab-center',ra.data.activeTab&&(ga+=' x-active-tab'),la.tdCls='x-grouptab'+ga,ia}}]},{xtype:'container',flex:1,layout:'card',activeItem:aa.mainItem,baseCls:Ext.baseCSSPrefix+'grouptabcontainer',items:aa.cards}],aa.addEvents('beforetabchange','tabchange','beforegroupchange','groupchange'),aa.callParent(arguments),aa.setActiveTab(aa.activeTab),aa.setActiveGroup(aa.activeGroup),aa.mon(aa.down('treepanel').getSelectionModel(),'select',aa.onNodeSelect,aa)},getRowClass:function(ea){var ra='';return ea.data.activeGroup&&(ra+=' x-active-group'),ra},onNodeSelect:function(ea,aa){var ia=this,la=ia.store.getRootNode(),ra;if(ra=aa.parentNode&&null===aa.parentNode.parentNode?aa:aa.parentNode,!1===ia.setActiveGroup(ra.get('id'))||!1===ia.setActiveTab(aa.get('id')))return!1;for(;la;)la.set('activeTab',!1),la.set('activeGroup',!1),la=la.firstChild||la.nextSibling||la.parentNode.nextSibling;ra.set('activeGroup',!0),ra.eachChild(function(na){na.set('activeGroup',!0)}),aa.set('activeTab',!0),ea.view.refresh()},setActiveTab:function(ea){var aa=this,ia=ea,la;return(Ext.isString(ea)&&(ia=Ext.getCmp(ia)),ia!==aa.activeTab)&&(la=aa.activeTab,!1!==aa.fireEvent('beforetabchange',aa,ia,la)&&(aa.activeTab=ia,aa.rendered&&aa.down('container[baseCls='+Ext.baseCSSPrefix+'grouptabcontainer]').getLayout().setActiveItem(ia),aa.fireEvent('tabchange',aa,ia,la)),!0)},setActiveGroup:function(ea){var aa=this,ia=ea,la;if(Ext.isString(ea)&&(ia=Ext.getCmp(ia)),ia===aa.activeGroup)return!0;if(la=aa.activeGroup,!1!==aa.fireEvent('beforegroupchange',aa,ia,la))aa.activeGroup=ia,aa.fireEvent('groupchange',aa,ia,la);else return!1;return!0},createTreeStore:function(){var ea=this,aa=ea.prepareItems(ea.items),ia={text:'.',children:[]},la=ea.cards=[];return ea.activeGroup=ea.activeGroup||0,Ext.each(aa,function(ra,na){var oa=ra.items.items,da=oa[ra.mainItem]||oa[0],ua={children:[]};ua.id=da.id,ua.text=da.title,ua.iconCls=da.iconCls,ua.expanded=!0,ua.activeGroup=ea.activeGroup===na,ua.activeTab=!!ua.activeGroup,ua.activeTab&&(ea.activeTab=ua.id),ua.activeGroup&&(ea.mainItem=ra.mainItem||0,ea.activeGroup=ua.id),Ext.each(oa,function(ga){if(ga.id!==ua.id){var pa={id:ga.id,leaf:!0,text:ga.title,iconCls:ga.iconCls,activeGroup:ua.activeGroup,activeTab:!1};ua.children.push(pa)}delete ga.title,delete ga.iconCls,la.push(ga)}),ia.children.push(ua)}),Ext.create('Ext.data.TreeStore',{fields:['id','text','activeGroup','activeTab'],root:{expanded:!0},proxy:{type:'memory',data:ia}})},getActiveTab:function(){return this.activeTab},getActiveGroup:function(){return this.activeGroup}}),Ext.define('Ext.ux.form.MultiSelect',{extend:'Ext.form.FieldContainer',mixins:{bindable:'Ext.util.Bindable',field:'Ext.form.field.Field'},alternateClassName:'Ext.ux.Multiselect',alias:['widget.multiselectfield','widget.multiselect'],requires:['Ext.panel.Panel','Ext.view.BoundList','Ext.layout.container.Fit'],uses:['Ext.view.DragZone','Ext.view.DropZone'],layout:'anchor',ddReorder:!1,appendOnly:!1,displayField:'text',allowBlank:!0,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:'This field is required',minSelectionsText:'Minimum {0} item(s) required',maxSelectionsText:'Maximum {0} item(s) required',delimiter:',',dragText:'{0} Item{1}',ignoreSelectChange:0,initComponent:function(){var ea=this;ea.bindStore(ea.store,!0),ea.store.autoCreated&&(ea.valueField=ea.displayField='field1',!ea.store.expanded&&(ea.displayField='field2')),Ext.isDefined(ea.valueField)||(ea.valueField=ea.displayField),ea.items=ea.setupItems(),ea.callParent(),ea.initField(),ea.addEvents('drop')},setupItems:function(){var ea=this;return(ea.boundList=Ext.create('Ext.view.BoundList',Ext.apply({anchor:'none 100%',deferInitialRefresh:!1,border:1,multiSelect:!0,store:ea.store,displayField:ea.displayField,disabled:ea.disabled},ea.listConfig)),ea.boundList.getSelectionModel().on('selectionchange',ea.onSelectChange,ea),!ea.title)?ea.boundList:(ea.boundList.border=!1,{border:!0,anchor:'none 100%',layout:'anchor',title:ea.title,tbar:ea.tbar,items:ea.boundList})},onSelectChange:function(ea,aa){this.ignoreSelectChange||this.setValue(aa)},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},isEqual:function(ea,aa){var ia=Ext.Array.from,la=0,ra;if(ea=ia(ea),aa=ia(aa),ra=ea.length,ra!==aa.length)return!1;for(;la<ra;la++)if(aa[la]!==ea[la])return!1;return!0},afterRender:function(){var ea=this,aa;ea.callParent(),ea.selectOnRender&&(aa=ea.getRecordsForValue(ea.value),aa.length&&(++ea.ignoreSelectChange,ea.boundList.getSelectionModel().select(aa),--ea.ignoreSelectChange),delete ea.toSelect),!ea.ddReorder||ea.dragGroup||ea.dropGroup||(ea.dragGroup=ea.dropGroup='MultiselectDD-'+Ext.id()),(ea.draggable||ea.dragGroup)&&(ea.dragZone=Ext.create('Ext.view.DragZone',{view:ea.boundList,ddGroup:ea.dragGroup,dragText:ea.dragText})),(ea.droppable||ea.dropGroup)&&(ea.dropZone=Ext.create('Ext.view.DropZone',{view:ea.boundList,ddGroup:ea.dropGroup,handleNodeDrop:function(ia,la,ra){var na=this.view,oa=na.getStore(),da=ia.records,ua;ia.view.store.remove(da),ua=oa.indexOf(la),'after'===ra&&ua++,oa.insert(ua,da),na.getSelectionModel().select(da),ea.fireEvent('drop',ea,da)}}))},isValid:function(){var ea=this,aa=ea.disabled,ia=ea.forceValidation||!aa;return ia?ea.validateValue(ea.value):aa},validateValue:function(ea){var aa=this,ia=aa.getErrors(ea),la=Ext.isEmpty(ia);return aa.preventMark||(la?aa.clearInvalid():aa.markInvalid(ia)),la},markInvalid:function(ea){var aa=this,ia=aa.getActiveError();aa.setActiveErrors(Ext.Array.from(ea)),ia!==aa.getActiveError()&&aa.updateLayout()},clearInvalid:function(){var ea=this,aa=ea.hasActiveError();ea.unsetActiveError(),aa&&ea.updateLayout()},getSubmitData:function(){var ea=this,aa=null,ia;return ea.disabled||!ea.submitValue||ea.isFileUpload()||(ia=ea.getSubmitValue(),null!==ia&&(aa={},aa[ea.getName()]=ia)),aa},getSubmitValue:function(){var ea=this,aa=ea.delimiter,ia=ea.getValue();return Ext.isString(aa)?ia.join(aa):ia},getValue:function(){return this.value||[]},getRecordsForValue:function(ea){var aa=this,ia=[],la=aa.store.getRange(),ra=aa.valueField,na=0,oa=la.length,da,ua,ga;for(ga=ea.length;na<ga;++na)for(ua=0;ua<oa;++ua)da=la[ua],da.get(ra)==ea[na]&&ia.push(da);return ia},setupValue:function(ea){var aa=this.delimiter,ia=this.valueField,la=0,ra,na,oa;if(Ext.isDefined(ea)){for(aa&&Ext.isString(ea)?ea=ea.split(aa):!Ext.isArray(ea)&&(ea=[ea]),na=ea.length;la<na;++la)oa=ea[la],oa&&oa.isModel&&(ea[la]=oa.get(ia));ra=Ext.Array.unique(ea)}else ra=[];return ra},setValue:function(ea){var aa=this,ia=aa.boundList.getSelectionModel(),la=aa.store;return la.getCount()?void(ea=aa.setupValue(ea),aa.mixins.field.setValue.call(aa,ea),aa.rendered?(++aa.ignoreSelectChange,ia.deselectAll(),ia.select(aa.getRecordsForValue(ea)),--aa.ignoreSelectChange):aa.selectOnRender=!0):void la.on({load:Ext.Function.bind(aa.setValue,aa,[ea]),single:!0})},clearValue:function(){this.setValue([])},onEnable:function(){var ea=this.boundList;this.callParent(),ea&&ea.enable()},onDisable:function(){var ea=this.boundList;this.callParent(),ea&&ea.disable()},getErrors:function(ea){var aa=this,ia=Ext.String.format,la=[],ra;return ea=Ext.Array.from(ea||aa.getValue()),ra=ea.length,!aa.allowBlank&&1>ra&&la.push(aa.blankText),ra<aa.minSelections&&la.push(ia(aa.minSelectionsText,aa.minSelections)),ra>aa.maxSelections&&la.push(ia(aa.maxSelectionsText,aa.maxSelections)),la},onDestroy:function(){var ea=this;ea.bindStore(null),Ext.destroy(ea.dragZone,ea.dropZone),ea.callParent()},onBindStore:function(ea){var aa=this.boundList;aa&&aa.bindStore(ea)}}),Ext.define('Ext.ux.grid.FiltersFeature',{extend:'Ext.grid.feature.Feature',alias:'feature.filters',uses:['Ext.ux.grid.menu.ListMenu','Ext.ux.grid.menu.RangeMenu','Ext.ux.grid.filter.BooleanFilter','Ext.ux.grid.filter.DateFilter','Ext.ux.grid.filter.DateTimeFilter','Ext.ux.grid.filter.ListFilter','Ext.ux.grid.filter.NumericFilter','Ext.ux.grid.filter.StringFilter'],autoReload:!0,filterCls:'ux-filtered-column',local:!1,menuFilterText:'Filters',paramPrefix:'filter',showMenu:!0,stateId:void 0,updateBuffer:500,hasFeatureEvent:!1,constructor:function(ea){var aa=this;aa.callParent(arguments),aa.deferredUpdate=Ext.create('Ext.util.DelayedTask',aa.reload,aa),aa.filters=aa.createFiltersCollection(),aa.filterConfigs=ea.filters},init:function(ea){var aa=this,ia=aa.view,la=ia.headerCt;aa.bindStore(ia.getStore(),!0),la.on('menucreate',aa.onMenuCreate,aa),ia.on('refresh',aa.onRefresh,aa),ea.on({scope:aa,beforestaterestore:aa.applyState,beforestatesave:aa.saveState,beforedestroy:aa.destroy}),ea.filters=aa,ea.addEvents('filterupdate')},createFiltersCollection:function(){return Ext.create('Ext.util.MixedCollection',!1,function(ea){return ea?ea.dataIndex:null})},createFilters:function(){function ea(pa,ma,fa){pa&&(fa||ma)&&(da=oa.get(pa),ua={dataIndex:pa,type:da&&da.type&&da.type.type||'auto'},Ext.isObject(ma)&&Ext.apply(ua,ma),ra.replace(ua))}var aa=this,ia=aa.filters.getCount(),la=aa.getGridPanel(),ra=aa.createFiltersCollection(),na=la.store.model,oa=na.prototype.fields,da,ua,ga;ia&&(ga={},aa.saveState(null,ga)),Ext.Array.each(aa.filterConfigs,function(pa){ea(pa.dataIndex,pa)}),Ext.Array.each(la.columnManager.getColumns(),function(pa){!1===pa.filterable?ra.removeAtKey(pa.dataIndex):ea(pa.dataIndex,pa.filter,pa.filterable)}),aa.removeAll(),ra.items&&aa.initializeFilters(ra.items),ia&&aa.applyState(null,ga)},initializeFilters:function(ea){var aa=this,ia=ea.length,la,ra,na;for(la=0;la<ia;la++)ra=ea[la],ra&&(na=aa.getFilterClass(ra.type),ra=ra.menu?ra:new na(Ext.apply({grid:aa.grid},ra)),aa.filters.add(ra),Ext.util.Observable.capture(ra,this.onStateChange,this))},onMenuCreate:function(ea,aa){var ia=this;ia.createFilters(),aa.on('beforeshow',ia.onMenuBeforeShow,ia)},onMenuBeforeShow:function(ea){var aa=this,ia,la;aa.showMenu&&(ia=aa.menuItem,(!ia||ia.isDestroyed)&&(aa.createMenuItem(ea),ia=aa.menuItem),la=aa.getMenuFilter(),la&&(ia.setMenu(la.menu,!1),ia.setChecked(la.active),ia.setDisabled(!0===la.disabled)),ia.setVisible(!!la),this.sep.setVisible(!!la))},createMenuItem:function(ea){var aa=this;aa.sep=ea.add('-'),aa.menuItem=ea.add({checked:!1,itemId:'filters',text:aa.menuFilterText,listeners:{scope:aa,checkchange:aa.onCheckChange,beforecheckchange:aa.onBeforeCheck}})},getGridPanel:function(){return this.view.up('gridpanel')},applyState:function(ea,aa){var ia=this,la,ra;if(ia.applyingState=!0,ia.clearFilters(),aa.filters)for(la in aa.filters)aa.filters.hasOwnProperty(la)&&(ra=ia.filters.get(la),ra&&(ra.setValue(aa.filters[la]),ra.setActive(!0)));ia.deferredUpdate.cancel(),ia.local&&ia.reload(),delete ia.applyingState,delete aa.filters},saveState:function(ea,aa){var ia={};return this.filters.each(function(la){la.active&&(ia[la.dataIndex]=la.getValue())}),aa.filters=ia},destroy:function(){var ea=this;Ext.destroyMembers(ea,'menuItem','sep'),ea.removeAll(),ea.clearListeners()},removeAll:function(){this.filters&&(Ext.destroy.apply(Ext,this.filters.items),this.filters.clear())},bindStore:function(ea){var aa=this;aa.store&&aa.storeListeners&&aa.store.un(aa.storeListeners),ea?(aa.storeListeners={scope:aa},aa.local?aa.storeListeners.load=aa.onLoad:aa.storeListeners['before'+(ea.buffered?'prefetch':'load')]=aa.onBeforeLoad,ea.on(aa.storeListeners)):delete aa.storeListeners,aa.store=ea},getMenuFilter:function(){var ea=this.view.headerCt.getMenu().activeHeader;return ea?this.filters.get(ea.dataIndex):null},onCheckChange:function(ea,aa){this.getMenuFilter().setActive(aa)},onBeforeCheck:function(ea,aa){return!aa||this.getMenuFilter().isActivatable()},onStateChange:function(ea,aa){if('serialize'!==ea){var ia=this,la=ia.getGridPanel();aa==ia.getMenuFilter()&&ia.menuItem.setChecked(aa.active,!1),(ia.autoReload||ia.local)&&!ia.applyingState&&ia.deferredUpdate.delay(ia.updateBuffer),ia.updateColumnHeadings(),ia.applyingState||la.saveState(),la.fireEvent('filterupdate',ia,aa)}},onBeforeLoad:function(ea,aa){aa.params=aa.params||{},this.cleanParams(aa.params);var ia=this.buildQuery(this.getFilterData());Ext.apply(aa.params,ia)},onLoad:function(ea){ea.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var ea=this,aa=ea.view.headerCt;aa&&aa.items.each(function(ia){var la=ea.getFilter(ia.dataIndex);ia[la&&la.active?'addCls':'removeCls'](ea.filterCls)})},reload:function(){var ea=this,aa=ea.view.getStore();ea.local?(aa.clearFilter(!0),aa.filterBy(ea.getRecordFilter()),aa.sort()):(ea.deferredUpdate.cancel(),aa.buffered&&aa.data.clear(),aa.loadPage(1))},getRecordFilter:function(){var ea=[],la=this.lockingPartner,aa,ia;return this.filters.each(function(ra){ra.active&&ea.push(ra)}),la&&la.filters.each(function(ra){ra.active&&ea.push(ra)}),aa=ea.length,function(ra){for(ia=0;ia<aa;ia++)if(!ea[ia].validateRecord(ra))return!1;return!0}},addFilter:function(ea){var aa=this,ia=aa.getGridPanel().columnManager.getColumns(),la,ra,na,oa,da;for(la=0,ra=ia.length;la<ra;la++)na=ia[la],na.dataIndex===ea.dataIndex&&(na.filter=ea);for(aa.view.headerCt.menu?aa.createFilters():aa.view.headerCt.getMenu(),la=0,oa=aa.filters.items.length;la<oa;la++)if(da=aa.filters.items[la],da.dataIndex===ea.dataIndex)return da},addFilters:function(ea){if(ea){var aa=this,ia,la;for(ia=0,la=ea.length;ia<la;ia++)aa.addFilter(ea[ia])}},getFilter:function(ea){return this.filters.get(ea)},clearFilters:function(){this.filters.each(function(ea){ea.setActive(!1)})},getFilterItems:function(){var ea=this;return ea.lockingPartner?ea.filters.items.concat(ea.lockingPartner.filters.items):ea.filters.items},getFilterData:function(){var ea=this.getFilterItems(),aa=[],ia,la,ra,na,oa,da;for(ia=0,la=ea.length;ia<la;ia++)if(ra=ea[ia],ra.active)for(na=[].concat(ra.serialize()),oa=0,da=na.length;oa<da;oa++)aa.push({field:ra.dataIndex,data:na[oa]});return aa},buildQuery:function(ea){var aa={},ua=ea.length,ia,la,ra,na,oa,da;if(!this.encode)for(ia=0;ia<ua;ia++)for(oa in la=ea[ia],ra=[this.paramPrefix,'[',ia,']'].join(''),aa[ra+'[field]']=la.field,na=ra+'[data]',la.data)aa[[na,'[',oa,']'].join('')]=la.data[oa];else{for(da=[],ia=0;ia<ua;ia++)la=ea[ia],da.push(Ext.apply({},{field:la.field},la.data));0<da.length&&(aa[this.paramPrefix]=Ext.JSON.encode(da))}return aa},cleanParams:function(ea){if(this.encode)delete ea[this.paramPrefix];else{var aa,ia;for(ia in aa=new RegExp('^'+this.paramPrefix+'[[0-9]+]'),ea)aa.test(ia)&&delete ea[ia]}},getFilterClass:function(ea){return'auto'===ea?ea='string':'int'===ea||'float'===ea?ea='numeric':'bool'===ea?ea='boolean':void 0,Ext.ClassManager.getByAlias('gridfilter.'+ea)}}),Ext.define('Ext.ux.grid.filter.Filter',{extend:'Ext.util.Observable',active:!1,dataIndex:null,menu:null,updateBuffer:500,constructor:function(ea){Ext.apply(this,ea),this.addEvents('activate','deactivate','serialize','update'),Ext.ux.grid.filter.Filter.superclass.constructor.call(this),this.menu=this.createMenu(ea),this.init(ea),ea&&ea.value&&(this.setValue(ea.value),this.setActive(!1!==ea.active,!0),delete ea.value)},destroy:function(){this.menu&&this.menu.destroy(),this.clearListeners()},init:Ext.emptyFn,createMenu:function(ea){return ea.plain=!0,Ext.create('Ext.menu.Menu',ea)},getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return!0},getSerialArgs:Ext.emptyFn,validateRecord:function(){return!0},serialize:function(){var ea=this.getSerialArgs();return this.fireEvent('serialize',ea,this),ea},fireUpdate:function(){this.active&&this.fireEvent('update',this),this.setActive(this.isActivatable())},setActive:function(ea,aa){this.active!=ea&&(this.active=ea,!0!==aa&&this.fireEvent(ea?'activate':'deactivate',this))}}),Ext.define('Ext.ux.grid.filter.DateFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.date',uses:['Ext.picker.Date','Ext.menu.Menu'],afterText:'After',afterEqText:'After equal',beforeText:'Before',beforeEqText:'Before equal',compareMap:{beforeEq:'lte',before:'lt',afterEq:'gte',after:'gt',non:'neq',on:'eq'},dateFormat:'m/d/Y',menuItems:['beforeEq','before','afterEq','after','-','non','on'],menuItemCfgs:{selectOnFocus:!0,width:125},onText:'On',nonText:'NOn',pickerOpts:{},init:function(){var aa=this,ia,la,ra,na,oa;for(ia=Ext.apply(aa.pickerOpts,{xtype:'datepicker',minDate:aa.minDate,maxDate:aa.maxDate,format:aa.dateFormat,listeners:{scope:aa,select:aa.onMenuSelect}}),aa.fields={},(la=0,ra=aa.menuItems.length);la<ra;la++)na=aa.menuItems[la],'-'!==na&&(oa={itemId:'range-'+na,text:aa[na+'Text'],menu:Ext.create('Ext.menu.Menu',{plain:!0,items:[Ext.apply(ia,{itemId:na,listeners:{select:aa.onPickerSelect,scope:aa}})]}),listeners:{scope:aa,checkchange:aa.onCheckChange}},na=aa.fields[na]=Ext.create('Ext.menu.CheckItem',oa)),aa.menu.add(na);aa.menu.add('-'),aa.menu.add({xtype:'checkbox',name:'isNull',boxLabel:'\u041F\u0443\u0441\u0442\u043E',style:'color: white; margin-left: 4px',listeners:{change:function(){aa.setActive(aa.isActivatable()),aa.fireEvent('update',aa),aa.menu.down('*[name=isNull]').getValue()?aa.menu.down('*[name=isNotNull]').disable():aa.menu.down('*[name=isNotNull]').enable()},scope:aa}}),aa.menu.add({xtype:'checkbox',name:'isNotNull',boxLabel:'\u041D\u0435\u043F\u0443\u0441\u0442\u043E',style:'color: white; margin-left: 4px',listeners:{change:function(){aa.setActive(aa.isActivatable()),aa.fireEvent('update',aa),aa.menu.down('*[name=isNotNull]').getValue()?aa.menu.down('*[name=isNull]').disable():aa.menu.down('*[name=isNull]').enable()},scope:aa}}),aa.values={}},onCheckChange:function(ea,aa){var ia=this,la=ea.menu.items.first(),ra=la.itemId,na=ia.values;aa?na[ra]=la.getValue():delete na[ra],ia.setActive(ia.isActivatable()),ia.fireEvent('update',ia)},onInputKeyUp:function(ea,aa){var ia=aa.getKey();ia==aa.RETURN&&ea.isValid()&&(aa.stopEvent(),this.menu.hide())},onMenuSelect:function(ea,aa){var ia=this.fields,la=this.fields[ea.itemId];la.setChecked(!0),la==ia.on?(ia.before.setChecked(!1,!0),ia.after.setChecked(!1,!0)):(ia.on.setChecked(!1,!0),la==ia.after&&this.getFieldValue('before')<aa?ia.before.setChecked(!1,!0):la==ia.before&&this.getFieldValue('after')>aa&&ia.after.setChecked(!1,!0)),this.fireEvent('update',this),ea.up('menu').hide()},getValue:function(){var aa={},ea;if(me.menu.down('*[name=isNull]').getValue())return{isNull:!0};if(me.menu.down('*[name=isNotNull]').getValue())return{isNotNull:!0};for(ea in this.fields)this.fields[ea].checked&&(aa[ea]=this.getFieldValue(ea));return aa},setValue:function(ea,aa){for(var ia in this.fields)ea[ia]?(this.getPicker(ia).setValue(ea[ia]),this.fields[ia].setChecked(!0)):aa||this.fields[ia].setChecked(!1);this.fireEvent('update',this)},isActivatable:function(){var ea=this;if(ea.menu.down('*[name=isNull]').getValue())return!0;if(ea.menu.down('*[name=isNotNull]').getValue())return!0;for(var aa in ea.fields)if(ea.fields[aa].checked)return!0;return!1},getSerialArgs:function(){var ea=this;if(ea.menu.down('*[name=isNull]').getValue())return{type:'string',value:{isNull:!0}};if(ea.menu.down('*[name=isNotNull]').getValue())return{type:'string',value:{isNotNull:!0}};var aa=[];for(var ia in this.fields)this.fields[ia].checked&&aa.push({type:'date',comparison:this.compareMap[ia],value:Ext.Date.format(this.getFieldValue(ia),this.dateFormat)});return aa},getFieldValue:function(ea){return this.values[ea]},getPicker:function(ea){return this.fields[ea].menu.items.first()},validateRecord:function(ea){var la=ea.get(this.dataIndex),ra=Ext.Date.clearTime,aa,ia;if(!Ext.isDate(la))return!1;for(aa in la=ra(la,!0).getTime(),this.fields)if(this.fields[aa].checked){if(ia=ra(this.getFieldValue(aa),!0).getTime(),'beforeEq'==aa&&ia<=la)return!1;if('before'==aa&&ia<la)return!1;if('afterEq'==aa&&ia>=la)return!1;if('after'==aa&&ia>la)return!1;if('non'==aa&&ia==la)return!1;if('on'==aa&&ia!=la)return!1}return!0},onPickerSelect:function(ea,aa){this.values[ea.itemId]=aa,this.fireEvent('update',this)}}),Ext.define('Ext.ux.grid.filter.BooleanFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.boolean',defaultValue:!1,yesText:'Yes',noText:'No',init:function(){var aa=Ext.id();this.options=[Ext.create('Ext.menu.CheckItem',{text:this.yesText,group:aa,checked:!0===this.defaultValue}),Ext.create('Ext.menu.CheckItem',{text:this.noText,group:aa,checked:!1===this.defaultValue})],this.menu.add(this.options[0],this.options[1]);for(var ia=0;ia<this.options.length;ia++)this.options[ia].on('click',this.fireUpdate,this),this.options[ia].on('checkchange',this.fireUpdate,this)},getValue:function(){return this.options[0].checked},setValue:function(ea){this.options[ea?0:1].setChecked(!0)},getSerialArgs:function(){var ea={type:'boolean',value:this.getValue()};return ea},validateRecord:function(ea){return ea.get(this.dataIndex)==this.getValue()}}),Ext.define('Ext.ux.grid.filter.DateTimeFilter',{extend:'Ext.ux.grid.filter.DateFilter',alias:'gridfilter.datetime',dateDefaults:{xtype:'datepicker',format:'m/d/Y'},timeDefaults:{xtype:'timepicker',width:100,height:200,format:'g:i A'},dockDefaults:{dock:'top',buttonText:'Filter'},selectDateToFilter:!0,positionDatepickerFirst:!0,reTime:/\s(am|pm)/i,reItemId:/\w*-(\w*)$/,addTimeSelection:function(ea,aa){var ia=this,la=aa.getSelectionModel().getSelection(),ua=0,ga=[],pa=['setHours','setMinutes','setSeconds','setMilliseconds'],ra,na,oa,da;if(la.length)for(ra=la[0].get('disp'),ga=ra.replace(ia.reTime,'').split(':'),na=ga.length;ua<na;ua++)oa=pa[ua],da=ga[ua],da&&ea[oa](parseInt(da,10));return ea},init:function(){var aa=this,ia=Ext.applyIf(aa.date||{},aa.dateDefaults),la=Ext.applyIf(aa.time||{},aa.timeDefaults),ra=aa.dock,na={click:{scope:aa,click:aa.onMenuSelect},select:{scope:aa,select:aa.onMenuSelect}},ma=[ia,la],fa=0,oa,da,ua,ga,pa;for(aa.positionDatepickerFirst||(ma=ma.reverse(),fa=1),oa=Ext.apply(aa.pickerOpts,{xtype:ra?'panel':'container',layout:'hbox',items:ma}),ra?ra&&(aa.selectDateToFilter=null,ra.dockedItems?(oa.dockedItems=ra.dockedItems,oa.dockedItems.items[ra.bindToItem||0].listeners=na.click):(Ext.isBoolean(ra)&&(ra={}),ra=Ext.applyIf(ra,aa.dockDefaults),oa.dockedItems={xtype:'toolbar',dock:ra.dock,items:[{xtype:'button',text:ra.buttonText,flex:1,listeners:na.click}]})):aa.selectDateToFilter?ia.listeners=na.select:la.listeners=na.select,aa.fields={},(da=0,ua=aa.menuItems.length);da<ua;da++)ga=aa.menuItems[da],'-'!==ga&&(oa.items[fa].itemId=ga,pa={itemId:'range-'+ga,text:aa[ga+'Text'],menu:Ext.create('Ext.menu.Menu',{items:oa}),listeners:{scope:aa,checkchange:aa.onCheckChange}},ga=aa.fields[ga]=Ext.create('Ext.menu.CheckItem',pa)),aa.menu.add(ga);aa.values={}},onCheckChange:function(ea,aa){var ia=this,la=ea.menu,ra=la.down('timepicker'),na=la.down('datepicker'),oa=na.itemId,da=ia.values;aa?da[oa]=ia.addTimeSelection(na.value,ra):delete da[oa],ia.setActive(ia.isActivatable()),ia.fireEvent('update',ia)},onMenuSelect:function(ea,aa){var ia=this,la=ia.menu,ra=la.getFocusEl().itemId.replace(ia.reItemId,'$1'),na=ia.fields,oa;ea=la.queryById(ra),oa=ia.fields[ea.itemId],oa.setChecked(!0),oa==na.on?(na.before.setChecked(!1,!0),na.after.setChecked(!1,!0)):(na.on.setChecked(!1,!0),oa==na.after&&ia.getFieldValue('before')<aa?na.before.setChecked(!1,!0):oa==na.before&&ia.getFieldValue('after')>aa&&na.after.setChecked(!1,!0)),ia.fireEvent('update',ia),ea.ownerCt.ownerCt.hide()},getSerialArgs:function(){var ea=this,ia=ea.fields,la=[],aa;for(aa in ia)ia[aa].checked&&la.push({type:'datetime',comparison:ea.compareMap[aa],value:Ext.Date.format(ea.getFieldValue(aa),(ea.date.format||ea.dateDefaults.format)+' '+(ea.time.format||ea.timeDefaults.format))});return la},setValue:function(ea,aa){var ia=this,la=ia.fields,ra,na,oa;for(ra in la)na=ea[ra],na?(oa=ia.menu.down('datepicker[itemId="'+ra+'"]'),oa.update(na),oa.value=na,la[ra].setChecked(!0)):!aa&&la[ra].setChecked(!1);ia.fireEvent('update',ia)},validateRecord:function(ea){var aa=this,ra=ea.get(aa.dataIndex),ia,la;if(!Ext.isDate(ra))return!1;for(ia in ra=ra.getTime(),aa.fields)if(aa.fields[ia].checked){if(la=aa.getFieldValue(ia).getTime(),'before'==ia&&la<=ra)return!1;if('after'==ia&&la>=ra)return!1;if('on'==ia&&la!=ra)return!1}return!0}}),Ext.define('Ext.ux.grid.filter.ListFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.list',phpMode:!1,init:function(){this.dt=Ext.create('Ext.util.DelayedTask',this.fireUpdate,this)},createMenu:function(ea){var aa=Ext.create('Ext.ux.grid.menu.ListMenu',ea);return aa.on('checkchange',this.onCheckChange,this),aa},getValue:function(){return this.menu.getSelected()},setValue:function(ea){this.menu.setSelected(ea),this.fireEvent('update',this)},isActivatable:function(){return 0<this.getValue().length},getSerialArgs:function(){return{type:'list',value:this.phpMode?this.getValue().join(','):this.getValue()}},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(ea){var aa=this.getValue();return-1<Ext.Array.indexOf(aa,ea.get(this.dataIndex))}}),Ext.define('Ext.ux.grid.filter.NumericFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.numeric',uses:['Ext.form.field.Number'],createMenu:function(ea){var aa=this,ia;return ia=Ext.create('Ext.ux.grid.menu.RangeMenu',ea),ia.on('update',aa.fireUpdate,aa),ia},getValue:function(){return this.menu.getValue()},setValue:function(ea){this.menu.setValue(ea)},isActivatable:function(){var ea=this.getValue(),aa;for(aa in ea)if(ea[aa]!==void 0)return!0;return!1},getSerialArgs:function(){var aa=[],ia=this.menu.getValue(),ea;for(ea in ia)aa.push({type:'numeric',comparison:ea,value:ia[ea]});return aa},validateRecord:function(ea){var aa=ea.get(this.dataIndex),ia=this.getValue(),la=Ext.isNumber;return la(ia.eq)&&aa!=ia.eq?!1:la(ia.lt)&&aa>=ia.lt?!1:la(ia.gt)&&aa<=ia.gt?!1:!0}}),Ext.define('Ext.ux.grid.filter.StringFilter',{extend:'Ext.ux.grid.filter.Filter',alias:'gridfilter.string',iconCls:'ux-gridfilter-text-icon',emptyText:'Enter Filter Text...',selectOnFocus:!0,width:125,init:function(ea){Ext.applyIf(ea,{enableKeyEvents:!0,labelCls:'ux-rangemenu-icon '+this.iconCls,hideEmptyLabel:!1,labelSeparator:'',labelWidth:29,listeners:{scope:this,keyup:this.onInputKeyUp,el:{click:function(ia){ia.stopPropagation()}}}}),this.inputItem=Ext.create('Ext.form.field.Text',ea),this.menu.add(this.inputItem),this.menu.add({xtype:'checkbox',name:'notLike',boxLabel:'\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442',style:'color: white',listeners:{change:function(){this.updateTask.delay(1)},scope:this}});var aa=this;this.menu.add({xtype:'checkbox',name:'isNull',boxLabel:'\u041F\u0443\u0441\u0442\u043E',style:'color: white',listeners:{change:function(){this.updateTask.delay(1),aa.menu.down('*[name=isNull]').getValue()?(aa.menu.down('*[name=isNotNull]').disable(),aa.menu.down('*[name=notLike]').disable()):(aa.menu.down('*[name=isNotNull]').enable(),aa.menu.down('*[name=notLike]').enable())},scope:this}}),this.menu.add({xtype:'checkbox',name:'isNotNull',boxLabel:'\u041D\u0435\u043F\u0443\u0441\u0442\u043E',style:'color: white',listeners:{change:function(){this.updateTask.delay(1),aa.menu.down('*[name=isNotNull]').getValue()?(aa.menu.down('*[name=isNull]').disable(),aa.menu.down('*[name=notLike]').disable()):(aa.menu.down('*[name=isNull]').enable(),aa.menu.down('*[name=notLike]').enable())},scope:this}}),this.menu.showSeparator=!1,this.updateTask=Ext.create('Ext.util.DelayedTask',this.fireUpdate,this)},getValue:function(){var ea=this;return{value:ea.inputItem.getValue(),notLike:ea.menu.down('*[name=notLike]').getValue(),isNull:ea.menu.down('*[name=isNull]').getValue(),isNotNull:ea.menu.down('*[name=isNotNull]').getValue()}},setValue:function(ea){this.inputItem.setValue(ea),this.fireEvent('update',this)},isActivatable:function(){var ea=this;return 0<this.inputItem.getValue().length||ea.menu.down('*[name=isNull]').getValue()||ea.menu.down('*[name=isNotNull]').getValue()},getSerialArgs:function(){return{type:'string',value:this.getValue()}},validateRecord:function(ea){var aa=ea.get(this.dataIndex);return'string'==typeof aa?-1<aa.toLowerCase().indexOf(this.getValue().toLowerCase()):0===this.getValue().length},onInputKeyUp:function(ea,aa){var ia=aa.getKey();if(ia==aa.RETURN&&ea.isValid())return aa.stopEvent(),void this.updateTask.delay(1)}}),Ext.define('Ext.ux.grid.menu.ListMenu',{extend:'Ext.menu.Menu',idField:'id',labelField:'text',loadingText:'Loading...',loadOnShow:!0,single:!1,plain:!0,constructor:function(){var aa=this,ia,la,ra,na;if(aa.selected=[],aa.addEvents('checkchange'),aa.callParent(arguments),aa.store||aa.options||(aa.options=aa.grid.store.collect(aa.dataIndex,!1,!0)),!aa.store&&aa.options){for(ia=[],la=0,ra=aa.options.length;la<ra;la++)switch(na=aa.options[la],Ext.type(na)){case'array':ia.push(na);break;case'object':ia.push([na[aa.idField],na[aa.labelField]]);break;default:null!=na&&ia.push([na,na]);}aa.store=Ext.create('Ext.data.ArrayStore',{fields:[aa.idField,aa.labelField],data:ia,listeners:{load:aa.onLoad,scope:aa}}),aa.loaded=!0,aa.autoStore=!0}else aa.add({text:aa.loadingText,iconCls:'loading-indicator'}),aa.store.on('load',aa.onLoad,aa)},destroy:function(){var ea=this,aa=ea.store;aa&&(ea.autoStore?aa.destroyStore():aa.un('unload',ea.onLoad,ea)),ea.callParent()},show:function(){var ea=this;!ea.loadOnShow||ea.loaded||ea.store.loading||ea.store.load(),ea.callParent()},onLoad:function(ea,aa){var ia=this,da={checkchange:ia.checkChange,scope:ia},la,ra,na,oa;for(Ext.suspendLayouts(),ia.removeAll(!0),la=ia.single?Ext.id():null,(na=0,oa=aa.length);na<oa;na++)ra=aa[na].get(ia.idField),ia.add(Ext.create('Ext.menu.CheckItem',{text:aa[na].get(ia.labelField),group:la,checked:Ext.Array.contains(ia.selected,ra),hideOnClick:!1,value:ra,listeners:da}));ia.loaded=!0,Ext.resumeLayouts(!0),ia.fireEvent('load',ia,aa)},getSelected:function(){return this.selected},setSelected:function(ea){ea=this.selected=[].concat(ea),this.loaded&&this.items.each(function(aa){aa.setChecked(!1,!0);for(var ia=0,la=ea.length;ia<la;ia++)aa.value==ea[ia]&&aa.setChecked(!0,!0)})},checkChange:function(ea,aa){var ia=[];this.items.each(function(la){la.checked&&ia.push(la.value)}),this.selected=ia,this.fireEvent('checkchange',ea,aa)}}),Ext.define('Ext.ux.grid.menu.RangeMenu',{extend:'Ext.menu.Menu',fieldCls:'Ext.form.field.Number',itemIconCls:{gte:'ux-rangemenu-gt',gt:'ux-rangemenu-gt',lte:'ux-rangemenu-lt',lt:'ux-rangemenu-lt',neq:'gi_search',eq:'ux-rangemenu-eq'},itemName:{lte:'\u041C\u0435\u043D\u044C\u0448\u0435 \u0438\u043B\u0438 \u0440\u0430\u0432\u043D\u043E',lt:'\u041C\u0435\u043D\u044C\u0448\u0435',gte:'\u0411\u043E\u043B\u044C\u0448\u0435 \u0438\u043B\u0438 \u0440\u0430\u0432\u043D\u043E',gt:'\u0411\u043E\u043B\u044C\u0448\u0435',neq:'\u041D\u0435 \u0440\u0430\u0432\u043D\u043E',eq:'\u0420\u0430\u0432\u043D\u043E'},fieldLabels:{gt:'Greater Than',lt:'Less Than',eq:'Equal To'},menuItemCfgs:{emptyText:'Enter Number...',selectOnFocus:!1,width:155},menuItems:['lte','lt','gte','gt','-','neq','eq'],plain:!0,constructor:function(){var aa=this,ia,la,ra,na,oa,da,ua;for(aa.callParent(arguments),ia=aa.fields=aa.fields||{},la=aa.fieldCfg=aa.fieldCfg||{},aa.addEvents('update'),aa.updateTask=Ext.create('Ext.util.DelayedTask',aa.fireUpdate,aa),(ra=0,na=aa.menuItems.length);ra<na;ra++)oa=aa.menuItems[ra],'-'!==oa&&(da={itemId:'range-'+oa,enableKeyEvents:!0,hideEmptyLabel:!1,fieldLabel:aa.itemName[oa],labelStyle:'color: white',labelSeparator:'',labelWidth:49,listeners:{scope:aa,change:aa.onInputChange,keyup:aa.onInputKeyUp,el:{click:this.stopFn}},activate:Ext.emptyFn,deactivate:Ext.emptyFn},Ext.apply(da,Ext.applyIf(ia[oa]||{},la[oa]),aa.menuItemCfgs),ua=da.fieldCls||aa.fieldCls,oa=ia[oa]=Ext.create(ua,da)),aa.add(oa)},stopFn:function(ea){ea.stopPropagation()},fireUpdate:function(){this.fireEvent('update',this)},getValue:function(){var ea=this,aa={},ia=this.fields,la,ra;for(la in ia)ia.hasOwnProperty(la)&&(ra=ia[la],ra.isValid()&&null!==ra.getValue()&&(aa[la]=ra.getValue()));return aa},setValue:function(ea){var aa=this,ia=aa.fields,la,ra;for(la in ia)ia.hasOwnProperty(la)&&(ra=ia[la],ra.suspendEvents(),ra.setValue(la in ea?ea[la]:''),ra.resumeEvents());aa.fireEvent('update',aa)},onInputKeyUp:function(ea,aa){aa.getKey()===aa.RETURN&&ea.isValid()&&(aa.stopEvent(),this.updateTask.delay(1))},onInputChange:function(ea){var aa=this,ia=aa.fields,la=ia.neq,ra=ia.eq,na=ia.gte,oa=ia.gt,da=ia.lte,ua=ia.lt;ea==ra||ea==la?(na&&na.setValue(null),oa&&oa.setValue(null),da&&da.setValue(null),ua&&ua.setValue(null)):(la.setValue(null),ra.setValue(null))}});